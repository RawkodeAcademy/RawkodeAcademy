---
import { getCollection } from "astro:content";
import SliderClient from "./slider.vue";
import type { Testimonial } from "@/types/testimonial";

interface Props {
	type?: "maintainer" | "partner" | "consulting" | "viewer";
	blurb: string;
	limit?: number;
}

const getAudience = (type: string | undefined) => {
	switch (type) {
		case "maintainer":
			return "Maintainers";
		case "partner":
			return "Partners";
		case "consulting":
			return "Clients";
		case "viewer":
			return "Viewers";
		default:
			return "Viewers";
	}
};

const { type, blurb, limit = 10 } = Astro.props;

// Get testimonials from the collection
const allTestimonials = await getCollection("testimonials");

// Filter by type if specified
const filteredTestimonials = type
	? allTestimonials.filter((testimonial) => testimonial.data.type === type)
	: allTestimonials;

// Limit the number of testimonials if specified and manually create objects with correct property order
const testimonials: Testimonial[] = filteredTestimonials.slice(0, limit).map((testimonial) => {
	const { name, title, image, link } = testimonial.data.author;
	return {
		quote: testimonial.data.quote,
		author: {
			name,
			title,
			image,
			...(link !== undefined ? { link } : {}),
		},
	};
});
---

<div class="relative w-full">
	<div class="mx-auto w-full max-w-4xl px-4 sm:px-6">
		<div class="text-center">
			<p class="text-sm font-semibold uppercase tracking-[0.2em] text-primary/80">
				Community Spotlight
			</p>
			<h2 class="mt-3 text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl">
				What {type == "maintainer" ? "Project" : "Our"} <span class="text-primary">{getAudience(type)}</span> Say
			</h2>
			<p class="mt-4 text-base text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
				{blurb}
			</p>
		</div>
		<SliderClient testimonials={testimonials} client:visible />
	</div>
</div>

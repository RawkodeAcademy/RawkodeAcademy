---
import { Font } from "astro:assets";
import "@/styles/global.css";
import type { OpenGraphProps } from "@/types/opengraph";
import PostHog from "../posthog/index.astro";
import Opengraph from "./opengraph.astro";
import SearchActionJsonLd from "./search-action-jsonld.astro";
import OrganizationJsonLd from "./organization-jsonld.astro";

interface Props extends OpenGraphProps {}
---

<style is:global>
	@import "@/styles/global.css";



	h1,
	h2,
	h3,
	h4,
	h5,
	h6 {
		@apply font-display;
	}

	body {
		font-family: var(--font-body);
	}

	pre,
	code,
	kbd,
	samp,
	tt {
		@apply font-mono;
	}
</style>

<head>
	<Font cssVariable="--font-quicksand" preload />
	<Font cssVariable="--font-poppins" preload />
	<Font cssVariable="--font-monaspace-neon" />
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
	<link rel="manifest" href="/site.webmanifest" />
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
	<meta name="msapplication-TileColor" content="#da532c" />
	<!-- Theme color for light/dark to match UI backgrounds -->
	<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
	<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0b0b0f" />
	<meta
		name="description"
		content={Astro.props.description ||
			"The Rawkode Academy provides educational, entertaining, and cutting-edge learning paths for you, or your developers, to keep up with the fast-paced, ever-evolving, and extremely volatile Cloud Native landscape."}
	/>

	<title>{Astro.props.title}</title>

	<!-- Canonical URL -->
	<link rel="canonical" href={new URL(Astro.url.pathname, Astro.site).href} />

	<Opengraph {...Astro.props} />
	<SearchActionJsonLd />
	<OrganizationJsonLd />

	<!-- Resource hints for performance -->
	<link rel="preconnect" href="https://content.rawkode.academy" />
	<link rel="preconnect" href="https://avatars.githubusercontent.com" />
    <link rel="preconnect" href="https://unpkg.com" />
	<link rel="dns-prefetch" href="https://chat.rawkode.academy" />
	<link rel="dns-prefetch" href="https://zitadel.rawkode.academy" />

	<!-- Preload critical fonts -->

	<slot name="extra-head" />

	<link rel="sitemap" href="/sitemap-index.xml" />


    <PostHog />

	<!-- Initial theme script: respects saved preference or OS setting; avoids FOUC -->
	<script is:inline>
		(function () {
			try {
				var stored = localStorage.getItem('theme');
				var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
				var isDark = stored ? (stored === 'dark') : prefersDark;
				// Apply class for environments or components relying on .dark selector
				document.documentElement.classList.toggle('dark', !!isDark);
				// Keep meta theme-color in sync for UAs that ignore media attribute switching
				var metas = document.querySelectorAll('meta[name="theme-color"]');
				metas.forEach(function (m) {
					if (!m.media) m.setAttribute('content', isDark ? '#0b0b0f' : '#ffffff');
				});
				// React to OS changes
				if (window.matchMedia) {
					var mq = window.matchMedia('(prefers-color-scheme: dark)');
					mq.addEventListener('change', function (e) {
						var forced = localStorage.getItem('theme');
						if (forced) return; // user override wins
						var nextDark = e.matches;
						document.documentElement.classList.toggle('dark', nextDark);
						metas.forEach(function (m) { if (!m.media) m.setAttribute('content', nextDark ? '#0b0b0f' : '#ffffff'); });
					});
				}
			} catch (_) { /* no-op */ }
		})();
	</script>

	{import.meta.env.DEV && (
		<link rel="stylesheet" href="/src/styles/global.css" />
	)}
</head>

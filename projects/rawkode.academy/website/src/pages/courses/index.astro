---
import { getCollection } from "astro:content";
import GridLayout from "@/components/common/GridLayout.vue";
import CourseCard from "@/components/courses/CourseCard.astro";
import CompactCoursesHero from "@/components/courses/CompactCoursesHero.vue";
import Page from "@/wrappers/page.astro";

export const prerender = true;

// Get all courses and sort by published date
const allCourses = (await getCollection("courses")).sort(
	(a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime(),
);

// Get course modules for each course
const coursesWithMetadata = await Promise.all(
	allCourses.map(async (course) => {
		const courseModules = (await getCollection("courseModules")).filter(
			(module) => module.data.course.id === course.id,
		);
		return {
			...course,
			moduleCount: courseModules.length,
			estimatedHours: Math.ceil(courseModules.length * 1.5), // Rough estimate
		};
	}),
);

// Get featured courses (top 3 most recent)
const featuredCourses = coursesWithMetadata.slice(0, 3);

// Technology logos - hardcoded for now
const technologyLogos = [
	{ name: "Kubernetes", logo: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/kubernetes/kubernetes-plain.svg" },
	{ name: "Docker", logo: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/docker/docker-plain.svg" },
	{ name: "Go", logo: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/go/go-original.svg" },
	{ name: "TypeScript", logo: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/typescript/typescript-plain.svg" },
	{ name: "AWS", logo: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/amazonwebservices/amazonwebservices-original.svg" },
];

const pageTitle = "Cloud Native Courses | Rawkode Academy";
const pageDescription =
	"Explore our comprehensive courses on cloud-native technologies, DevOps, and modern software development.";
---

<Page title={pageTitle} description={pageDescription}>
  <!-- Compact Hero Section with Featured Courses -->
  <CompactCoursesHero
    featuredCourses={featuredCourses}
    courseCount={allCourses.length}
    technologies={technologyLogos}
    client:load
  />

  <!-- All Courses Section -->
  <div class="bg-gray-50 dark:bg-gray-900">
    <div id="all-courses" class="py-8 px-4 mx-auto max-w-screen-xl lg:py-16 lg:px-6">
      <div class="mb-8 text-center">
        <h2 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white mb-4">
          All Courses
        </h2>
        <p class="text-lg text-gray-500 dark:text-gray-400">
          Browse our complete catalog of cloud-native courses
        </p>
      </div>

      <!-- Course Stats Section -->
      <div class="mb-12 grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center shadow-sm">
          <div class="text-3xl font-bold text-primary mb-2">{allCourses.length}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Total Courses</div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center shadow-sm">
          <div class="text-3xl font-bold text-primary mb-2">100%</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Free Access</div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center shadow-sm">
          <div class="text-3xl font-bold text-primary mb-2">50+</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Hours of Content</div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center shadow-sm">
          <div class="text-3xl font-bold text-primary mb-2">15+</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Technologies</div>
        </div>
      </div>

      <!-- Courses Grid -->
      {allCourses.length === 0 ? (
        <div class="text-center py-16">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
            No courses available yet
          </h2>
          <p class="text-gray-500 dark:text-gray-400">
            We're working hard to bring you amazing courses. Check back soon!
          </p>
        </div>
      ) : (
        <div id="courses-grid">
          <GridLayout cols={{ default: 1, md: 2, lg: 3 }} gap={6}>
            {allCourses.map((course) => (
              <CourseCard course={course} />
            ))}
          </GridLayout>
        </div>
      )}
    </div>
  </div>

  <!-- Client-side smooth scrolling -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Smooth scroll to courses when clicking hero CTA
      const browseButton = document.querySelector('a[href="#all-courses"]');
      if (browseButton) {
        browseButton.addEventListener('click', (e) => {
          e.preventDefault();
          document.getElementById('all-courses')?.scrollIntoView({ behavior: 'smooth' });
        });
      }
    });
  </script>
</Page>
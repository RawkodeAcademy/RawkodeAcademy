---
import FeatureList from "@/components/feature/list.vue";
import HeroTypewriter from "@/components/hero/typewriter.tsx";
import PartnerLogos from "@/components/partner/logos.astro";
import TestimonialSlider from "@/components/testimonial/slider.astro";
import Page from "@/wrappers/page.astro";
import HeroImage from "./_hero.png";
import { getCollection } from "astro:content";
import ArticleCard from "@/components/articles/ArticleCard.astro";

// Fetch latest content
const allArticles = await getCollection("articles", ({ data }) => !data.draft);
const latestArticles = allArticles
	.sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime())
	.slice(0, 3);

const allVideos = await getCollection("videos");
const latestVideos = allVideos
	.sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime())
	.slice(0, 4); // Showing 4 videos looks better in a 2x2 or 4-col grid, but 3 matches articles. Let's do 3 for symmetry or 4 for a grid. Let's do 3 and use a 3-col grid.
	// Actually, let's stick to 3 to match the 3 articles if we do a 3-col grid.

const pageTitle = "Cloud Native & Kubernetes Education | Rawkode Academy";
const pageDescription =
	"Master Cloud Native technologies and Kubernetes with Rawkode Academy's expert-led courses, articles, and live streams. Stay ahead in the fast-evolving tech landscape.";

// Format duration helper
const formatDuration = (seconds?: number | null) => {
	if (typeof seconds !== "number" || seconds <= 0 || Number.isNaN(seconds)) {
		return "--:--";
	}
	const hours = Math.floor(seconds / 3600);
	const minutes = Math.floor((seconds % 3600) / 60);
	const secs = seconds % 60;

	if (hours > 0) {
		return `${hours}:${minutes.toString().padStart(2, "0")}:${secs
			.toString()
			.padStart(2, "0")}`;
	}
	return `${minutes}:${secs.toString().padStart(2, "0")}`;
};
---

<Page title={pageTitle} description={pageDescription}>
	<Fragment slot="extra-head">
		<!-- Preload hero image to improve LCP -->
		<link rel="preload" as="image" href={HeroImage.src} imagesrcset={HeroImage.src} fetchpriority="high" />
	</Fragment>
	<HeroTypewriter
		client:only="react"
		highlight="hard"
		image={HeroImage}
				primaryButton={{
					text: "Latest Videos",
					link: "/watch",
				}}
		secondaryButton={{
			text: "About Us",
			link: "/about",
		}}
		rotatedPrefixes={[
			"Cloud Native",
			"Kubernetes",
			"Microservices",
			"WebAssembly",
			"Platform Engineering",
			"SRE",
			"Observability",
			"DevOps",
			"Infrastructure as Code",
		]}
		suffix="may be complex, but it doesn't need to be hard."
	/>

	{/* Latest Content Section */}
	<section class="py-16 px-4 sm:py-20">
		<div class="mx-auto max-w-7xl">
			<div class="text-center mb-12">
				<h2 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white md:text-4xl mb-4">
					Latest from the <span class="text-primary">Academy</span>
				</h2>
				<p class="text-gray-600 dark:text-gray-300 text-lg max-w-3xl mx-auto">
					Fresh content to keep you ahead in the cloud-native landscape
				</p>
			</div>

			{/* Latest Articles */}
			<div class="mb-16">
				<div class="flex items-center justify-between mb-8">
					<h3 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
						<span class="text-primary">ğŸ“</span> Latest Articles
					</h3>
					<a href="/read" class="text-primary hover:text-secondary font-medium flex items-center transition-colors">
						View All <svg class="w-4 h-4 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
					</a>
				</div>
				<div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
					{latestArticles.map((article) => (
						<ArticleCard article={article} />
					))}
				</div>
			</div>

			{/* Latest Videos */}
			<div class="mb-16">
				<div class="flex items-center justify-between mb-8">
					<h3 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
						<span class="text-primary">ğŸ“º</span> Latest Videos
					</h3>
					<a href="/watch" class="text-primary hover:text-secondary font-medium flex items-center transition-colors">
						View All <svg class="w-4 h-4 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" /></svg>
					</a>
				</div>
				<div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
					{latestVideos.slice(0, 3).map((video) => (
						<a
							href={`/watch/${video.data.slug}`}
							class="group block bg-white dark:bg-gray-800 rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 dark:border-gray-700"
						>
							{/* Thumbnail */}
							<div class="relative aspect-video overflow-hidden bg-gray-100 dark:bg-gray-700">
								<img
									src={`https://content.rawkode.academy/videos/${video.data.videoId}/thumbnail.jpg`}
									alt={video.data.title}
									class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
									loading="lazy"
								/>
								{/* Duration badge */}
								<div class="absolute bottom-2 right-2 bg-black/80 text-white text-xs px-2 py-1 rounded backdrop-blur-sm">
									{formatDuration(typeof video.data.duration === "number" ? video.data.duration : undefined)}
								</div>
								{/* Play overlay */}
								<div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black/20">
									<div class="w-12 h-12 rounded-full bg-white/90 flex items-center justify-center text-primary shadow-lg transform scale-75 group-hover:scale-100 transition-transform duration-300">
										<svg class="w-6 h-6 ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
									</div>
								</div>
							</div>

							{/* Content */}
							<div class="p-5">
								<h3 class="text-lg font-semibold text-gray-900 dark:text-white line-clamp-2 group-hover:text-primary transition-colors mb-2">
									{video.data.title}
								</h3>
								
								<div class="flex items-center text-sm text-gray-500 dark:text-gray-400">
									<svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
									</svg>
									{video.data.publishedAt.toLocaleDateString("en-US", { year: 'numeric', month: 'short', day: 'numeric' })}
								</div>
							</div>
						</a>
					))}
				</div>
			</div>

			{/* Featured Technologies Highlight */}
			<div class="glass-panel rounded-3xl p-8">
				<h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center">
					ğŸš€ Featured Technology Guides
				</h3>
				<div class="grid grid-cols-2 md:grid-cols-5 gap-4">
					<a href="/technology/kubernetes" class="group flex flex-col items-center p-4 rounded-xl hover:bg-primary/10 transition-colors">
						<div class="text-4xl mb-2">â˜¸ï¸</div>
						<span class="text-sm font-medium text-gray-900 dark:text-white group-hover:text-primary">Kubernetes</span>
					</a>
					<a href="/technology/docker" class="group flex flex-col items-center p-4 rounded-xl hover:bg-primary/10 transition-colors">
						<div class="text-4xl mb-2">ğŸ³</div>
						<span class="text-sm font-medium text-gray-900 dark:text-white group-hover:text-primary">Docker</span>
					</a>
					<a href="/technology/fluxcd" class="group flex flex-col items-center p-4 rounded-xl hover:bg-primary/10 transition-colors">
						<div class="text-4xl mb-2">ğŸ”„</div>
						<span class="text-sm font-medium text-gray-900 dark:text-white group-hover:text-primary">FluxCD</span>
					</a>
					<a href="/technology/cilium" class="group flex flex-col items-center p-4 rounded-xl hover:bg-primary/10 transition-colors">
						<div class="text-4xl mb-2">ğŸ</div>
						<span class="text-sm font-medium text-gray-900 dark:text-white group-hover:text-primary">Cilium</span>
					</a>
					<a href="/technology/dagger" class="group flex flex-col items-center p-4 rounded-xl hover:bg-primary/10 transition-colors">
						<div class="text-4xl mb-2">âš¡</div>
						<span class="text-sm font-medium text-gray-900 dark:text-white group-hover:text-primary">Dagger</span>
					</a>
				</div>
			</div>
		</div>
	</section>

	<FeatureList
		title="Our Learning Path & Values"
		description="The Rawkode Academy provides educational, entertaining, and cutting-edge learning paths for you, or your developers, to keep up with the fast-paced, ever-evolving, and extremely volatile Cloud Native and Kubernetes landscape."
		segments={[
			{
				title: "Authenticity",
				emoji: "ğŸ­",
				description:
					"The content we produce is authentic, and we don't shy away from the hard topics.",
			},
			{
				title: "Organic Content",
				emoji: "ğŸŒ±",
				description:
					"As we learn, you learn. You'll notice a lot of the more recent content features: us solving our own problems, building this platform, and the technologies we used.",
			},
			{
				title: "Embracing Failure",
				emoji: "ğŸ¤¦",
				description:
					"Our live content won't be without mistakes. In fact, we encourage things to go wrong. We all learn through failures, why edit them out?",
			},
			{
				title: "Hands-On",
				emoji: "âŒ¨ï¸",
				description:
					"Forget the slides, we're all about the hands-on keyboard experience. We'll be in the terminal, writing code, and building things together.",
			},
			{
				title: "Forward-Facing, Forward-Thinking",
				emoji: "ğŸ”­",
				description:
					"We're always looking for the greatest and latest technologies, and we're not afraid to dive in headfirst.",
			},
			{
				title: "Open & Closed Source",
				emoji: "ğŸ”",
				description:
					"There's a time to build and there's a time to buy. We'll cover both and do our best to explain when you should trade your money for time.",
			},
		]}
	/>

	<section class="section-highlight section-separator">
		<div class="py-12 px-4 mx-auto max-w-(--breakpoint-xl) lg:py-16 lg:px-6">
				<TestimonialSlider type="viewer" blurb="We're proud of the content we produce, but don't take our word for it. Here's what our viewers have to say about the Rawkode Academy." />
		</div>
	</section>

	<section class="relative py-16 px-4 sm:py-20">
		<div class="pointer-events-none absolute inset-0 flex justify-center">
			<div class="h-full w-5/6 max-w-6xl rounded-[40px] bg-gradient-to-r from-primary/25 via-white/30 to-secondary/25 blur-[220px] opacity-40 dark:from-primary/40 dark:via-gray-900/40 dark:to-secondary/40"></div>
		</div>
		<div class="glass-panel relative mx-auto max-w-7xl rounded-[40px] overflow-hidden">
			<div class="absolute inset-0 opacity-60">
				<div class="absolute inset-0 bg-gradient-to-br from-white/30 via-transparent to-primary/10 dark:from-gray-900/20"></div>
				<div class="absolute -top-24 -right-24 h-72 w-72 rounded-full bg-gradient-to-br from-secondary/40 to-primary/30 blur-3xl"></div>
			</div>
			<div class="relative px-6 py-12 sm:px-12 lg:px-16">
				<div class="mb-10 lg:mb-14 text-center">
					<h2 class="mb-4 text-3xl font-bold tracking-tight text-gray-900 dark:text-white md:text-4xl">
						Our <span class="text-primary">Trusted</span> Partners
					</h2>
					<p class="text-gray-600 sm:text-xl dark:text-gray-300 max-w-3xl mx-auto">
						The Rawkode Academy couldn't exist without the support of our partners. Visit their websites, contact them, and remember to let them know that you found them right here.
					</p>
					<div class="mt-6">
						<a
							href="/organizations/partnerships"
							title="Become a Partner"
							class="inline-flex items-center gap-2 px-6 py-3 text-base font-semibold text-white rounded-2xl border border-white/40 dark:border-white/10 bg-gradient-to-r from-primary to-secondary shadow-[0_15px_40px_rgba(99,102,241,0.35)] dark:shadow-[0_30px_70px_rgba(0,0,0,0.6)] transition hover:scale-[1.02] hover:shadow-[0_20px_45px_rgba(99,102,241,0.45)]"
						>
							Become a Partner
							<svg aria-hidden="true" class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
								<path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
							</svg>
						</a>
					</div>
				</div>
				<div class="relative">
					<PartnerLogos />
				</div>
			</div>
		</div>
	</section>
</Page>

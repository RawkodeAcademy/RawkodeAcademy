WEBVTT

NOTE
Transcription provided by Deepgram
Request Id: 0942ce52-1218-4006-935f-3b28b06c35fc
Created: 2025-04-29T16:58:12.424Z
Duration: 3602.931
Channels: 1

00:00:54.220 --> 00:00:54.860
<v Speaker 0>Hello,

00:00:56.300 --> 00:00:57.660
<v Speaker 0>and welcome

00:00:57.660 --> 00:00:59.980
<v Speaker 0>to the next workshop

00:01:00.700 --> 00:01:03.100
<v Speaker 0>in the complete guide to Teleport course.

00:01:04.505 --> 00:01:05.385
<v Speaker 0>Today,

00:01:05.385 --> 00:01:06.985
<v Speaker 0>we are gonna be taking a look at

00:01:06.985 --> 00:01:09.785
<v Speaker 0>a really cool feature of Teleport, which allows

00:01:09.785 --> 00:01:11.785
<v Speaker 0>you to commoditize the access

00:01:12.425 --> 00:01:13.865
<v Speaker 0>to your databases.

00:01:14.665 --> 00:01:17.065
<v Speaker 0>Today, we will be using a Postgres

00:01:17.950 --> 00:01:19.390
<v Speaker 0>through the Teleport system.

00:01:19.790 --> 00:01:22.030
<v Speaker 0>We are going to be doing another database

00:01:22.030 --> 00:01:24.829
<v Speaker 0>access workshop next week on MongoDB.

00:01:25.310 --> 00:01:27.229
<v Speaker 0>So we'll be aiming to cover Postgres and

00:01:27.229 --> 00:01:29.149
<v Speaker 0>Mongo in a week to show you this

00:01:29.149 --> 00:01:30.990
<v Speaker 0>just amazing feature of Teleport.

00:01:32.055 --> 00:01:34.855
<v Speaker 0>Database access is something that is notoriously

00:01:34.855 --> 00:01:35.735
<v Speaker 0>tricky

00:01:35.975 --> 00:01:38.215
<v Speaker 0>to do in a safe and secure way,

00:01:38.215 --> 00:01:40.375
<v Speaker 0>you know, through bastion boxes,

00:01:40.695 --> 00:01:41.975
<v Speaker 0>the key management,

00:01:43.415 --> 00:01:45.990
<v Speaker 0>even speaking and talking about passwords over the

00:01:45.990 --> 00:01:48.070
<v Speaker 0>phone. We do some weird and wonderful things

00:01:48.070 --> 00:01:49.830
<v Speaker 0>in the IT community when it comes to

00:01:49.830 --> 00:01:50.950
<v Speaker 0>database access.

00:01:52.070 --> 00:01:55.030
<v Speaker 0>From having our GUI clients have red colored

00:01:55.030 --> 00:01:56.950
<v Speaker 0>backgrounds and themes to indicate that we're on

00:01:56.950 --> 00:01:58.950
<v Speaker 0>production, and maybe we wanna think about our

00:01:58.950 --> 00:01:59.990
<v Speaker 0>commands a little bit more.

00:02:01.805 --> 00:02:02.765
<v Speaker 0>We have a

00:02:03.325 --> 00:02:05.005
<v Speaker 0>GitHub repository

00:02:05.405 --> 00:02:08.125
<v Speaker 0>for all of the workshops that we have

00:02:08.125 --> 00:02:08.925
<v Speaker 0>as

00:02:10.285 --> 00:02:11.725
<v Speaker 0>part of this course.

00:02:11.805 --> 00:02:13.805
<v Speaker 0>So, let me get my screen shared.

00:02:15.050 --> 00:02:17.370
<v Speaker 0>You

00:02:18.490 --> 00:02:20.970
<v Speaker 0>will find it at Rawkode Academy,

00:02:21.130 --> 00:02:23.210
<v Speaker 0>which is the organization on GitHub.

00:02:23.610 --> 00:02:26.330
<v Speaker 0>And then there is a repository called courses.

00:02:28.745 --> 00:02:30.985
<v Speaker 0>We have our first low.

00:02:31.785 --> 00:02:34.425
<v Speaker 0>Hey, Russell. Thank you for joining us.

00:02:37.065 --> 00:02:39.145
<v Speaker 0>So you can find this database access here.

00:02:39.710 --> 00:02:41.470
<v Speaker 0>I think this is part seven, to be

00:02:41.470 --> 00:02:43.310
<v Speaker 0>honest, I've gotten a little bit confused about

00:02:43.310 --> 00:02:45.390
<v Speaker 0>the order I planned on doing this in,

00:02:45.709 --> 00:02:48.910
<v Speaker 0>just because of my father in law's funeral

00:02:48.910 --> 00:02:50.910
<v Speaker 0>at the end of last year, I'm currently

00:02:50.910 --> 00:02:52.750
<v Speaker 0>trying to sell my house and move house

00:02:53.504 --> 00:02:55.665
<v Speaker 0>and of course, the festive and new year

00:02:55.665 --> 00:02:58.145
<v Speaker 0>period. So my head is a bit scattered,

00:02:58.305 --> 00:03:00.625
<v Speaker 0>but maybe seven, I may change out there.

00:03:01.185 --> 00:03:03.105
<v Speaker 0>However, there are a few prerequisites

00:03:03.105 --> 00:03:04.625
<v Speaker 0>that are required if you wish to follow

00:03:04.625 --> 00:03:06.385
<v Speaker 0>along or do this in your own time,

00:03:06.385 --> 00:03:07.584
<v Speaker 0>depending on if you're watching it right now

00:03:07.584 --> 00:03:09.640
<v Speaker 0>and you can actually say hello or whether

00:03:09.640 --> 00:03:11.480
<v Speaker 0>you're doing this in the future.

00:03:11.880 --> 00:03:14.840
<v Speaker 0>You will require a running and working Teleport.

00:03:15.320 --> 00:03:18.200
<v Speaker 0>I'm doing things a little bit different today.

00:03:18.360 --> 00:03:19.160
<v Speaker 0>Normally,

00:03:19.640 --> 00:03:21.800
<v Speaker 0>I would run my own Teleport.

00:03:22.185 --> 00:03:24.185
<v Speaker 0>Typically, I spin it up on a cloud

00:03:24.185 --> 00:03:26.265
<v Speaker 0>provider of choice, throw a DNS name on

00:03:26.265 --> 00:03:27.065
<v Speaker 0>it, usually

00:03:27.864 --> 00:03:28.665
<v Speaker 0>something.

00:03:28.745 --> 00:03:30.105
<v Speaker 0>Rokode.live,

00:03:30.825 --> 00:03:32.105
<v Speaker 0>and I use that.

00:03:32.665 --> 00:03:35.065
<v Speaker 0>However, I decided today to try and make

00:03:35.065 --> 00:03:36.345
<v Speaker 0>my life a little bit easier,

00:03:37.100 --> 00:03:39.580
<v Speaker 0>and I'm using Teleport Cloud.

00:03:40.459 --> 00:03:42.700
<v Speaker 0>So I get a nice DNS name of

00:03:42.700 --> 00:03:44.620
<v Speaker 0>Rawkode.teleportsh

00:03:44.620 --> 00:03:45.180
<v Speaker 0>and

00:03:45.580 --> 00:03:47.340
<v Speaker 0>I get the latest and greatest version of

00:03:47.340 --> 00:03:48.140
<v Speaker 0>Teleport.

00:03:48.700 --> 00:03:51.765
<v Speaker 0>So let's see how this goes, right? Of

00:03:51.765 --> 00:03:54.084
<v Speaker 0>course, when they change things on this, nothing

00:03:54.084 --> 00:03:55.845
<v Speaker 0>ever goes wrong, right?

00:03:56.965 --> 00:03:58.965
<v Speaker 0>So I don't need to worry about

00:03:59.045 --> 00:04:02.084
<v Speaker 0>running and working Teleport. I've let Intelliport do

00:04:02.084 --> 00:04:04.080
<v Speaker 0>that all for me. Now, it's not free.

00:04:04.080 --> 00:04:05.760
<v Speaker 0>I'm on a fourteen day trial. I'll see

00:04:05.760 --> 00:04:07.440
<v Speaker 0>how I like it. But so far, it

00:04:07.440 --> 00:04:08.480
<v Speaker 0>seems pretty cool.

00:04:09.840 --> 00:04:12.800
<v Speaker 0>We need a running and working Postgres.

00:04:13.680 --> 00:04:16.160
<v Speaker 0>Okay. So let's do that together.

00:04:16.625 --> 00:04:17.425
<v Speaker 0>I

00:04:17.425 --> 00:04:20.945
<v Speaker 0>have a virtual machine running on Civo cloud

00:04:20.945 --> 00:04:21.585
<v Speaker 0>and

00:04:23.265 --> 00:04:24.785
<v Speaker 0>I have a terminal.

00:04:27.185 --> 00:04:27.825
<v Speaker 0>Add.

00:04:30.785 --> 00:04:33.090
<v Speaker 0>Add a terminal, which is nicely timed out

00:04:33.090 --> 00:04:34.930
<v Speaker 0>on me. Let's see if I can pop

00:04:34.930 --> 00:04:36.050
<v Speaker 0>that back open.

00:04:38.610 --> 00:04:39.090
<v Speaker 0>Rawkode.

00:04:45.345 --> 00:04:46.865
<v Speaker 0>Well, I fixed this. We have a hello

00:04:46.865 --> 00:04:49.105
<v Speaker 0>from Jeffrey. Hey, Jeffrey. How's it going?

00:04:50.225 --> 00:04:51.825
<v Speaker 0>Thank you for joining me for this live

00:04:51.825 --> 00:04:54.465
<v Speaker 0>workshop where only good, happy things happen and

00:04:54.465 --> 00:04:55.985
<v Speaker 0>nothing bad ever happens.

00:04:57.930 --> 00:04:59.530
<v Speaker 0>The IP address is wrong here. So my

00:04:59.530 --> 00:05:01.690
<v Speaker 0>auto complete didn't close to the latest one.

00:05:01.770 --> 00:05:03.690
<v Speaker 0>This one has now closed, but here I

00:05:03.690 --> 00:05:05.690
<v Speaker 0>am. So this is just a

00:05:06.490 --> 00:05:08.169
<v Speaker 0>Let me just pull this over here.

00:05:10.325 --> 00:05:12.965
<v Speaker 0>This is one of Siebel's large boxes,

00:05:13.845 --> 00:05:15.685
<v Speaker 0>which is four CPUs and eight gig of

00:05:15.685 --> 00:05:17.605
<v Speaker 0>RAM coming from a bare metal world.

00:05:17.845 --> 00:05:19.765
<v Speaker 0>I'm not inclined to call that large, however.

00:05:19.765 --> 00:05:22.165
<v Speaker 0>I guess in a virtual world, it is

00:05:22.165 --> 00:05:22.725
<v Speaker 0>quite chunky.

00:05:24.530 --> 00:05:26.930
<v Speaker 0>I've run an apt update and, you know,

00:05:26.930 --> 00:05:29.650
<v Speaker 0>Postgres is ubiquitous. This is why I started

00:05:30.690 --> 00:05:33.010
<v Speaker 0>with the database access for Postgres because

00:05:33.729 --> 00:05:36.130
<v Speaker 0>an app installed PostgresQL is always gonna work

00:05:36.130 --> 00:05:37.569
<v Speaker 0>unless it fails, in which case it's probably

00:05:37.569 --> 00:05:40.145
<v Speaker 0>DNS installed Postgres. You know, there's not a

00:05:40.145 --> 00:05:42.305
<v Speaker 0>lot of variation here. Not gonna be difficult

00:05:42.305 --> 00:05:43.345
<v Speaker 0>to get this right.

00:05:44.224 --> 00:05:46.384
<v Speaker 0>Putting a lot of confidence there myself, but,

00:05:46.384 --> 00:05:48.785
<v Speaker 0>and Postgres is, I see no issue, it's

00:05:48.785 --> 00:05:49.985
<v Speaker 0>on every operating system.

00:05:55.090 --> 00:05:57.490
<v Speaker 0>That red line has been worried already.

00:05:57.810 --> 00:05:59.090
<v Speaker 0>I'm on a bint too.

00:05:59.890 --> 00:06:01.570
<v Speaker 0>You're supposed to be good at this.

00:06:02.690 --> 00:06:05.010
<v Speaker 0>We'll let it finish before I start debugging.

00:06:11.615 --> 00:06:12.895
<v Speaker 0>Data's down.

00:06:16.255 --> 00:06:18.015
<v Speaker 0>Well, mean, it's definitely not what I was

00:06:18.015 --> 00:06:18.495
<v Speaker 0>expecting.

00:06:18.860 --> 00:06:19.660
<v Speaker 0>But

00:06:20.540 --> 00:06:22.860
<v Speaker 0>app is having a moment. So let's

00:06:25.260 --> 00:06:26.460
<v Speaker 0>just give it a second.

00:06:28.300 --> 00:06:30.540
<v Speaker 0>This is why I choose Postgres. It's ubiquitous.

00:06:30.540 --> 00:06:32.620
<v Speaker 0>Every operating system has it and it fails.

00:06:39.835 --> 00:06:42.074
<v Speaker 0>I wonder if this is the post installation

00:06:42.074 --> 00:06:42.955
<v Speaker 0>step,

00:06:43.034 --> 00:06:44.955
<v Speaker 0>which is now not gonna complete because of

00:06:44.955 --> 00:06:46.474
<v Speaker 0>that one little red line.

00:06:51.300 --> 00:06:54.180
<v Speaker 0>Hello, Omar. Thank you for joining this very

00:06:54.180 --> 00:06:57.140
<v Speaker 0>special edition of clustered butler posters.

00:07:00.715 --> 00:07:02.075
<v Speaker 0>Let's see what the error was.

00:07:04.235 --> 00:07:05.915
<v Speaker 0>This is this is this is taking too

00:07:05.915 --> 00:07:07.275
<v Speaker 0>long for me. I don't feel like I'm

00:07:07.275 --> 00:07:08.795
<v Speaker 0>being impatient. I think this is

00:07:10.395 --> 00:07:11.995
<v Speaker 0>control c doesn't work, by the way.

00:07:13.115 --> 00:07:14.635
<v Speaker 0>We're just gonna keep opening terminals.

00:07:18.370 --> 00:07:20.850
<v Speaker 0>Okay. What we got? Database system is ready

00:07:20.850 --> 00:07:22.210
<v Speaker 0>to accept connections.

00:07:28.210 --> 00:07:30.715
<v Speaker 0>Peer authentication field for user Postgres. Okay, that

00:07:30.715 --> 00:07:32.875
<v Speaker 0>I can fix that. Not fussed. Oh,

00:07:33.515 --> 00:07:35.195
<v Speaker 0>maybe I was being impatient.

00:07:36.315 --> 00:07:38.235
<v Speaker 0>And now that my control C has come

00:07:38.235 --> 00:07:40.075
<v Speaker 0>through as it was processing the triggers on

00:07:40.075 --> 00:07:41.915
<v Speaker 0>the libc bend. So let's just make sure

00:07:41.915 --> 00:07:45.080
<v Speaker 0>it's happy. Right, okay. So the Pure authentication

00:07:45.080 --> 00:07:46.360
<v Speaker 0>failed for Postgres.

00:07:46.439 --> 00:07:47.000
<v Speaker 0>I

00:07:48.120 --> 00:07:49.560
<v Speaker 0>want to be able to debug

00:07:49.560 --> 00:07:51.000
<v Speaker 0>things as I go along.

00:07:51.319 --> 00:07:52.520
<v Speaker 0>And so I need to be able to

00:07:52.520 --> 00:07:54.520
<v Speaker 0>connect to Postgres. So I am going to

00:07:54.520 --> 00:07:55.719
<v Speaker 0>do a Postgres

00:07:59.685 --> 00:08:01.285
<v Speaker 0>pghba,

00:08:03.285 --> 00:08:05.925
<v Speaker 0>and I'm gonna change local all Postgres to

00:08:05.925 --> 00:08:06.725
<v Speaker 0>trust.

00:08:08.245 --> 00:08:10.645
<v Speaker 0>This will keep my life easier. Of course,

00:08:10.645 --> 00:08:13.365
<v Speaker 0>it does mean that any local user on

00:08:12.360 --> 00:08:14.759
<v Speaker 0>machine can connect, but then as I have

00:08:14.759 --> 00:08:16.600
<v Speaker 0>access to this machine, I've got bigger problems.

00:08:17.000 --> 00:08:17.639
<v Speaker 0>So,

00:08:18.039 --> 00:08:19.240
<v Speaker 0>before we start,

00:08:19.719 --> 00:08:21.960
<v Speaker 0>and this should allow me to do the

00:08:21.960 --> 00:08:23.479
<v Speaker 0>SQL user,

00:08:23.879 --> 00:08:24.439
<v Speaker 0>Postgres.

00:08:24.925 --> 00:08:25.645
<v Speaker 0>Tada.

00:08:27.005 --> 00:08:28.445
<v Speaker 0>That's about what we want. So now we

00:08:28.445 --> 00:08:29.805
<v Speaker 0>have a working Postgres.

00:08:30.925 --> 00:08:31.565
<v Speaker 0>So,

00:08:32.045 --> 00:08:34.045
<v Speaker 0>done. The next thing that we need is

00:08:34.045 --> 00:08:36.365
<v Speaker 0>a Teleport CLI authenticated.

00:08:36.684 --> 00:08:37.885
<v Speaker 0>So at the moment,

00:08:40.449 --> 00:08:41.570
<v Speaker 0>I'm not gonna be able to do app

00:08:41.570 --> 00:08:42.690
<v Speaker 0>install Teleport.

00:08:43.570 --> 00:08:45.410
<v Speaker 0>However, it is a single

00:08:47.730 --> 00:08:49.649
<v Speaker 0>well, I know it's a single line. It's

00:08:49.649 --> 00:08:51.730
<v Speaker 0>a couple of lanes, but it's particular.

00:08:52.050 --> 00:08:53.250
<v Speaker 0>It's pretty simple.

00:08:53.570 --> 00:08:55.355
<v Speaker 0>So we just quickly grab this and then

00:08:55.355 --> 00:08:56.954
<v Speaker 0>we'll talk about the tasks that we're gonna

00:08:56.954 --> 00:09:00.235
<v Speaker 0>accomplish on today's workshop. Well, this quickly runs.

00:09:01.995 --> 00:09:03.755
<v Speaker 0>The curl.

00:09:05.595 --> 00:09:06.875
<v Speaker 0>Oh, yeah, the curl worked.

00:09:09.589 --> 00:09:11.430
<v Speaker 0>We'll do apt install.

00:09:11.509 --> 00:09:12.870
<v Speaker 0>Js Teleport.

00:09:12.870 --> 00:09:14.389
<v Speaker 0>And that should just do its thing.

00:09:15.589 --> 00:09:17.750
<v Speaker 0>I'll authenticate with that in just a second.

00:09:17.990 --> 00:09:20.355
<v Speaker 0>So, there are a few different stages to

00:09:20.995 --> 00:09:23.635
<v Speaker 0>exposing your databases through the Teleport system.

00:09:24.435 --> 00:09:25.875
<v Speaker 0>First thing we need to do, and I

00:09:25.875 --> 00:09:26.515
<v Speaker 0>think we

00:09:26.835 --> 00:09:29.555
<v Speaker 0>covered this on application access, is that Teleport

00:09:29.555 --> 00:09:31.395
<v Speaker 0>is broken down into a few components.

00:09:31.555 --> 00:09:33.395
<v Speaker 0>There's like the Teleport server,

00:09:34.940 --> 00:09:37.900
<v Speaker 0>which runs, typically runs the off server

00:09:38.220 --> 00:09:40.300
<v Speaker 0>and the SSH server,

00:09:41.180 --> 00:09:42.620
<v Speaker 0>and everything else is kind of opt in

00:09:42.620 --> 00:09:45.100
<v Speaker 0>after that, the proxy server, the app server,

00:09:45.100 --> 00:09:46.540
<v Speaker 0>the DB servers, etcetera.

00:09:47.815 --> 00:09:51.975
<v Speaker 0>In order for us to run a TeleportDB

00:09:51.975 --> 00:09:55.815
<v Speaker 0>proxy DB server next to our Postgres server,

00:09:55.815 --> 00:09:57.255
<v Speaker 0>you know, we don't probably want these to

00:09:57.255 --> 00:09:59.335
<v Speaker 0>be far apart because then we'd be exposing

00:09:59.335 --> 00:10:01.415
<v Speaker 0>our Postgres over the big bad internet.

00:10:02.790 --> 00:10:04.230
<v Speaker 0>Then we just need to be able to

00:10:04.230 --> 00:10:06.710
<v Speaker 0>generate a token that speaks to the Teleport

00:10:06.710 --> 00:10:08.310
<v Speaker 0>server and says, hey, I want a token

00:10:08.310 --> 00:10:10.550
<v Speaker 0>that's gonna allow me to expose a database

00:10:10.550 --> 00:10:12.470
<v Speaker 0>on this machine. So we're gonna generate one

00:10:12.470 --> 00:10:13.110
<v Speaker 0>of those.

00:10:13.590 --> 00:10:16.274
<v Speaker 0>We then have to generate certificates. This only

00:10:16.274 --> 00:10:18.995
<v Speaker 0>works with x five zero nine TLS

00:10:19.075 --> 00:10:21.555
<v Speaker 0>mutual authentication on the client side. So we

00:10:21.555 --> 00:10:23.875
<v Speaker 0>have to generate those certificates, Teleport will do

00:10:23.875 --> 00:10:24.834
<v Speaker 0>that for us,

00:10:25.235 --> 00:10:27.795
<v Speaker 0>and configure Postgres to accept that as a

00:10:27.795 --> 00:10:28.595
<v Speaker 0>means of authentication.

00:10:30.560 --> 00:10:32.480
<v Speaker 0>Once that's configured, we need to tweak the

00:10:32.480 --> 00:10:34.480
<v Speaker 0>roles a little bit just to allow my

00:10:34.480 --> 00:10:36.160
<v Speaker 0>user and the Teleport system to be able

00:10:36.160 --> 00:10:37.920
<v Speaker 0>to access this database system.

00:10:38.880 --> 00:10:39.440
<v Speaker 0>And

00:10:40.320 --> 00:10:42.160
<v Speaker 0>something I found out when I was trialing

00:10:42.160 --> 00:10:44.535
<v Speaker 0>this workshop is that Teleport Cloud just needs

00:10:44.535 --> 00:10:46.774
<v Speaker 0>to do one extra little step because I

00:10:46.774 --> 00:10:49.175
<v Speaker 0>don't control the Teleport server component,

00:10:49.334 --> 00:10:50.694
<v Speaker 0>but we do have to modify a role

00:10:50.694 --> 00:10:52.935
<v Speaker 0>to allow impersonation of the DB persona.

00:10:53.735 --> 00:10:56.055
<v Speaker 0>We then run our Teleport DB proxy, and

00:10:56.055 --> 00:10:57.814
<v Speaker 0>then we'll start interacting with it. We'll list

00:10:57.814 --> 00:10:58.694
<v Speaker 0>available databases,

00:10:59.070 --> 00:11:01.550
<v Speaker 0>we'll log into Postgres and connect to Postgres.

00:11:01.550 --> 00:11:03.070
<v Speaker 0>And then just at the end,

00:11:03.870 --> 00:11:05.470
<v Speaker 0>to show you how this works with your

00:11:05.470 --> 00:11:07.710
<v Speaker 0>standard tooling, I'll show you how to connect

00:11:07.710 --> 00:11:09.390
<v Speaker 0>with just PSQL

00:11:09.870 --> 00:11:12.110
<v Speaker 0>using a Postgres GUI.

00:11:13.125 --> 00:11:14.965
<v Speaker 0>So we should be able to do this

00:11:14.965 --> 00:11:17.205
<v Speaker 0>and just under the hour, at least my

00:11:17.205 --> 00:11:19.525
<v Speaker 0>tests left it that way. I've included all

00:11:19.525 --> 00:11:21.205
<v Speaker 0>of the answers, so you don't really need

00:11:21.205 --> 00:11:22.325
<v Speaker 0>to sit and listen to me if you

00:11:22.325 --> 00:11:23.765
<v Speaker 0>don't want to, but of course I do

00:11:23.765 --> 00:11:24.965
<v Speaker 0>appreciate the company.

00:11:26.005 --> 00:11:26.885
<v Speaker 0>And you

00:11:27.140 --> 00:11:29.060
<v Speaker 0>should be fine to run to the diskette.

00:11:29.140 --> 00:11:30.900
<v Speaker 0>It should just work

00:11:31.540 --> 00:11:33.540
<v Speaker 0>minus any little random things.

00:11:34.100 --> 00:11:36.820
<v Speaker 0>And hopefully that was enough waffle for Teleport

00:11:36.820 --> 00:11:37.700
<v Speaker 0>to be installed.

00:11:38.180 --> 00:11:40.660
<v Speaker 0>So if I run TSH

00:11:40.660 --> 00:11:41.860
<v Speaker 0>status

00:11:43.585 --> 00:11:44.545
<v Speaker 0>status.

00:11:45.265 --> 00:11:46.865
<v Speaker 0>That duration is on there. I cannot automate

00:11:46.865 --> 00:11:48.065
<v Speaker 0>it crazy, but we

00:11:49.105 --> 00:11:52.385
<v Speaker 0>don't have any credentials. We're not authenticated against

00:11:52.385 --> 00:11:53.585
<v Speaker 0>the Teleport server.

00:11:54.705 --> 00:11:56.705
<v Speaker 0>So we're going to do

00:11:56.785 --> 00:11:57.665
<v Speaker 0>TSH

00:11:57.665 --> 00:11:58.545
<v Speaker 0>login

00:11:58.560 --> 00:12:00.640
<v Speaker 0>and we have to provide the proxy server,

00:12:00.640 --> 00:12:02.720
<v Speaker 0>which for me will be Rawkode.

00:12:03.360 --> 00:12:06.240
<v Speaker 0>Teleport SSH on port four forty three.

00:12:07.200 --> 00:12:08.960
<v Speaker 0>I'm not rich.

00:12:09.200 --> 00:12:10.720
<v Speaker 0>So, that'll be user.

00:12:13.695 --> 00:12:14.655
<v Speaker 0>Like so.

00:12:14.815 --> 00:12:15.615
<v Speaker 0>Alright.

00:12:15.695 --> 00:12:17.535
<v Speaker 0>Now I need my password.

00:12:21.695 --> 00:12:22.495
<v Speaker 0>Password.

00:12:23.455 --> 00:12:23.695
<v Speaker 0>OTP.

00:12:27.390 --> 00:12:28.590
<v Speaker 0>Fingers crossed.

00:12:32.830 --> 00:12:35.070
<v Speaker 0>And good. Yep. There we go. So now

00:12:35.070 --> 00:12:37.310
<v Speaker 0>I'm authenticated against my

00:12:38.030 --> 00:12:39.390
<v Speaker 0>Teleport Cloud

00:12:39.470 --> 00:12:40.030
<v Speaker 0>instance.

00:12:41.055 --> 00:12:41.855
<v Speaker 0>Magic.

00:12:43.055 --> 00:12:45.055
<v Speaker 0>Hey, Mozz, thanks for joining us.

00:12:46.735 --> 00:12:47.375
<v Speaker 0>Okay.

00:12:47.695 --> 00:12:51.055
<v Speaker 0>So we can see now

00:12:51.775 --> 00:12:55.055
<v Speaker 0>that I have a TSH status, which is

00:12:55.055 --> 00:12:55.935
<v Speaker 0>gonna be the same output.

00:12:56.790 --> 00:12:58.310
<v Speaker 0>I have my Postgres

00:12:58.310 --> 00:13:00.230
<v Speaker 0>running and we tested the work. We connected

00:13:00.230 --> 00:13:02.149
<v Speaker 0>to it by enabling the trust and

00:13:03.269 --> 00:13:05.269
<v Speaker 0>the Teleport is already proven. So the first

00:13:05.269 --> 00:13:06.310
<v Speaker 0>thing we need to do

00:13:06.870 --> 00:13:07.510
<v Speaker 0>is

00:13:07.750 --> 00:13:10.310
<v Speaker 0>it's not formatted correctly. I'll fix that there.

00:13:10.855 --> 00:13:13.975
<v Speaker 0>It's use T control, Teleport Control,

00:13:14.215 --> 00:13:17.335
<v Speaker 0>to generate a new token of type database.

00:13:17.335 --> 00:13:18.535
<v Speaker 0>Now this just means

00:13:19.015 --> 00:13:19.575
<v Speaker 0>that

00:13:20.455 --> 00:13:22.295
<v Speaker 0>when a Teleport,

00:13:22.615 --> 00:13:24.135
<v Speaker 0>it's not a server, what is that? A

00:13:24.135 --> 00:13:24.695
<v Speaker 0>Teleport

00:13:25.290 --> 00:13:27.529
<v Speaker 0>proxy, I think that might be it.

00:13:27.930 --> 00:13:28.810
<v Speaker 0>Teleport

00:13:28.970 --> 00:13:31.690
<v Speaker 0>edge server, DB server. I need to confirm

00:13:31.690 --> 00:13:34.250
<v Speaker 0>the lingo there. But when this Teleport instance

00:13:34.250 --> 00:13:35.770
<v Speaker 0>that we are gonna run locally

00:13:36.089 --> 00:13:37.769
<v Speaker 0>can only register

00:13:38.295 --> 00:13:40.214
<v Speaker 0>the database. It only has access to register

00:13:40.214 --> 00:13:42.055
<v Speaker 0>databases on the server. We don't want it

00:13:42.055 --> 00:13:43.095
<v Speaker 0>to be able to do anything else. Like,

00:13:43.095 --> 00:13:44.295
<v Speaker 0>we don't want it to allow people to

00:13:44.295 --> 00:13:46.695
<v Speaker 0>connect their own servers to our Teleport, or

00:13:46.695 --> 00:13:48.774
<v Speaker 0>I suppose their own applications or anything like

00:13:48.774 --> 00:13:49.654
<v Speaker 0>could be

00:13:50.135 --> 00:13:51.334
<v Speaker 0>used and abused.

00:13:53.310 --> 00:13:56.590
<v Speaker 0>So, we're gonna run Teleport Control tokens add

00:13:56.590 --> 00:13:57.630
<v Speaker 0>type DB,

00:13:57.790 --> 00:13:59.150
<v Speaker 0>and this should

00:14:00.910 --> 00:14:01.630
<v Speaker 0>just

00:14:02.110 --> 00:14:02.990
<v Speaker 0>spit out

00:14:04.110 --> 00:14:05.710
<v Speaker 0>this nice little helper command,

00:14:06.285 --> 00:14:09.084
<v Speaker 0>which tells us how to start a TeleportDB

00:14:09.084 --> 00:14:09.805
<v Speaker 0>proxy.

00:14:10.285 --> 00:14:12.285
<v Speaker 0>The command line arguments we need, it's got

00:14:12.285 --> 00:14:14.524
<v Speaker 0>the token here that we just generated as

00:14:14.524 --> 00:14:16.204
<v Speaker 0>well as the CA pin so that we

00:14:16.204 --> 00:14:18.045
<v Speaker 0>can always guarantee and confirm that we are

00:14:18.045 --> 00:14:19.565
<v Speaker 0>speaking to the correct Teleport server.

00:14:20.730 --> 00:14:22.730
<v Speaker 0>It has the auth server dropped in here,

00:14:22.730 --> 00:14:24.250
<v Speaker 0>which we already knew, and then we have

00:14:24.250 --> 00:14:26.570
<v Speaker 0>the name, the protocol, the URI.

00:14:26.730 --> 00:14:28.649
<v Speaker 0>So I'm just gonna keep this,

00:14:30.889 --> 00:14:31.690
<v Speaker 0>create

00:14:31.690 --> 00:14:32.889
<v Speaker 0>bb proxy,

00:14:33.575 --> 00:14:35.735
<v Speaker 0>and just dump this into here so we

00:14:35.735 --> 00:14:36.855
<v Speaker 0>can use it later.

00:14:40.935 --> 00:14:41.735
<v Speaker 0>Excel.

00:14:44.935 --> 00:14:46.855
<v Speaker 0>I believe we can do,

00:14:49.100 --> 00:14:50.540
<v Speaker 0>am I getting too confident?

00:14:51.900 --> 00:14:53.740
<v Speaker 0>Yeah, there we go. TCTR. I can never

00:14:53.740 --> 00:14:56.460
<v Speaker 0>remember what's Teleport Control and what's TSH.

00:14:56.620 --> 00:14:57.420
<v Speaker 0>Tokens,

00:14:58.300 --> 00:14:59.420
<v Speaker 0>learn to spell.

00:14:59.580 --> 00:15:01.500
<v Speaker 0>Because LSLX flow and

00:15:02.140 --> 00:15:03.340
<v Speaker 0>we should see

00:15:04.405 --> 00:15:06.485
<v Speaker 0>our DB. Well, that proxy one. I probably

00:15:06.485 --> 00:15:07.525
<v Speaker 0>shouldn't show you that.

00:15:09.365 --> 00:15:10.725
<v Speaker 0>I'm sure it's okay.

00:15:10.965 --> 00:15:13.125
<v Speaker 0>Here is our DB token. So, if you

00:15:13.125 --> 00:15:14.325
<v Speaker 0>ever need to get that back, you can

00:15:14.325 --> 00:15:16.645
<v Speaker 0>use Teleport Control Tokens l s. And I'll

00:15:16.645 --> 00:15:18.269
<v Speaker 0>clear my screen just in case, even though

00:15:18.269 --> 00:15:19.630
<v Speaker 0>you can write it and pause it. But

00:15:19.630 --> 00:15:21.149
<v Speaker 0>still, it makes me feel better.

00:15:22.029 --> 00:15:25.390
<v Speaker 0>Alright. Thank you, generate token. We are done.

00:15:26.750 --> 00:15:28.269
<v Speaker 0>And, obviously, I just clicked on the answer

00:15:28.269 --> 00:15:31.149
<v Speaker 0>there. The documentation is is great. You can

00:15:31.149 --> 00:15:33.070
<v Speaker 0>come in to here and go to database.

00:15:36.635 --> 00:15:40.555
<v Speaker 0>There we go. Database access was self hosted

00:15:40.555 --> 00:15:41.355
<v Speaker 0>Postgres.

00:15:41.755 --> 00:15:43.515
<v Speaker 0>A lot of these steps are already covered

00:15:43.515 --> 00:15:44.155
<v Speaker 0>here.

00:15:45.275 --> 00:15:46.795
<v Speaker 0>This is where you find all of your

00:15:46.795 --> 00:15:47.195
<v Speaker 0>answers.

00:15:50.460 --> 00:15:52.860
<v Speaker 0>So we've got a question from Moz

00:15:52.940 --> 00:15:55.500
<v Speaker 0>asking, is it possible to run Teleport DB

00:15:55.500 --> 00:15:59.180
<v Speaker 0>proxy as a daemon? Yeah, totally. 100%

00:15:59.180 --> 00:15:59.980
<v Speaker 0>you can.

00:16:00.300 --> 00:16:02.300
<v Speaker 0>You can create a system new unit file

00:16:02.300 --> 00:16:03.820
<v Speaker 0>and manage it anyway you want.

00:16:05.075 --> 00:16:07.315
<v Speaker 0>It's just a banging away with some arguments.

00:16:07.395 --> 00:16:10.035
<v Speaker 0>So whatever your supervisor system is, feel free

00:16:10.035 --> 00:16:11.235
<v Speaker 0>to take it and run it that way.

00:16:11.235 --> 00:16:13.075
<v Speaker 0>Of course, that is a much preferred way,

00:16:13.475 --> 00:16:15.155
<v Speaker 0>just not something I'm gonna be doing today,

00:16:15.155 --> 00:16:16.595
<v Speaker 0>but you can totally do it.

00:16:17.475 --> 00:16:19.475
<v Speaker 0>And there's this increment here. Cool.

00:16:21.410 --> 00:16:23.810
<v Speaker 0>So, the next step is we wanna be

00:16:23.810 --> 00:16:26.850
<v Speaker 0>able to generate the certificates for Postgres

00:16:26.850 --> 00:16:28.770
<v Speaker 0>to run-in TLS mode.

00:16:30.050 --> 00:16:32.370
<v Speaker 0>So, we'll just pop open this answer

00:16:32.930 --> 00:16:35.010
<v Speaker 0>and copy this and we'll run through each

00:16:35.010 --> 00:16:35.970
<v Speaker 0>of these things here.

00:16:37.795 --> 00:16:40.995
<v Speaker 0>So this is a Teleport Control off SANE.

00:16:41.235 --> 00:16:43.235
<v Speaker 0>This is just gonna speak to the Teleport

00:16:43.235 --> 00:16:45.315
<v Speaker 0>server and say that we want to be

00:16:45.315 --> 00:16:46.035
<v Speaker 0>able to,

00:16:46.275 --> 00:16:47.075
<v Speaker 0>you know,

00:16:47.395 --> 00:16:50.195
<v Speaker 0>provision some certificates that can authenticate against the

00:16:50.195 --> 00:16:50.595
<v Speaker 0>server.

00:16:51.740 --> 00:16:54.139
<v Speaker 0>The format here is because we're very specifically

00:16:54.139 --> 00:16:56.540
<v Speaker 0>allowing access to the databases, but we have

00:16:56.540 --> 00:16:57.660
<v Speaker 0>format DB.

00:16:58.300 --> 00:17:00.220
<v Speaker 0>We need to provide the host. So this

00:17:00.220 --> 00:17:02.700
<v Speaker 0>is where is my Postgres server.

00:17:04.325 --> 00:17:06.724
<v Speaker 0>I'm going to use localhost today because I'm

00:17:06.724 --> 00:17:08.484
<v Speaker 0>running Postgres on the same machine that I

00:17:08.484 --> 00:17:10.484
<v Speaker 0>am running my DB proxy.

00:17:12.085 --> 00:17:14.484
<v Speaker 0>We can pass dash dash out. This just

00:17:14.484 --> 00:17:15.125
<v Speaker 0>tells it

00:17:15.619 --> 00:17:17.380
<v Speaker 0>what prefix to use for the file names.

00:17:17.380 --> 00:17:18.740
<v Speaker 0>So you're gonna get like a

00:17:20.100 --> 00:17:22.740
<v Speaker 0>server dot CRT, a server dot PEM, a

00:17:22.740 --> 00:17:23.140
<v Speaker 0>server

00:17:24.340 --> 00:17:26.099
<v Speaker 0>I'm sure there's one more.

00:17:28.740 --> 00:17:29.985
<v Speaker 0>And this is just what they are. So

00:17:29.985 --> 00:17:31.905
<v Speaker 0>we will just call this server.

00:17:32.305 --> 00:17:33.905
<v Speaker 0>And we get these attempts to leverage how

00:17:33.905 --> 00:17:35.585
<v Speaker 0>long should these certificates live.

00:17:37.745 --> 00:17:39.425
<v Speaker 0>So this should finish.

00:17:39.665 --> 00:17:41.440
<v Speaker 0>And, you know, Teleport,

00:17:41.440 --> 00:17:42.800
<v Speaker 0>you know, as I was working through this

00:17:42.800 --> 00:17:43.840
<v Speaker 0>and trying to see how to get this

00:17:43.840 --> 00:17:45.680
<v Speaker 0>working, there was one thing that tripped me

00:17:45.680 --> 00:17:47.200
<v Speaker 0>up and we can talk about that later.

00:17:47.200 --> 00:17:47.680
<v Speaker 0>But

00:17:48.080 --> 00:17:49.840
<v Speaker 0>Teleport

00:17:49.840 --> 00:17:52.160
<v Speaker 0>is very handily just giving you everything that

00:17:52.160 --> 00:17:53.635
<v Speaker 0>you need along the way. You know, we

00:17:53.635 --> 00:17:55.395
<v Speaker 0>created the DB token and it's like, Hey,

00:17:55.395 --> 00:17:56.995
<v Speaker 0>you're gonna wanna run a DB proxy here's

00:17:56.995 --> 00:17:57.875
<v Speaker 0>the command.

00:17:57.875 --> 00:18:00.355
<v Speaker 0>Like, this is, it's just, it's almost too

00:18:00.355 --> 00:18:02.355
<v Speaker 0>easy to get this, you know, to get

00:18:02.355 --> 00:18:04.115
<v Speaker 0>this effect, to get this access that I

00:18:04.115 --> 00:18:06.595
<v Speaker 0>want. And I really appreciate that

00:18:06.755 --> 00:18:07.715
<v Speaker 0>from the Teleport team.

00:18:09.210 --> 00:18:11.049
<v Speaker 0>So, we've got our CA file, our key,

00:18:11.049 --> 00:18:12.250
<v Speaker 0>and our certificate.

00:18:12.250 --> 00:18:14.250
<v Speaker 0>It has given us the exact thing that

00:18:14.250 --> 00:18:16.250
<v Speaker 0>we need to copy into the Postgres configuration

00:18:16.250 --> 00:18:17.529
<v Speaker 0>to make that work.

00:18:18.090 --> 00:18:19.529
<v Speaker 0>And if we run ALS,

00:18:19.610 --> 00:18:21.289
<v Speaker 0>we have our files here.

00:18:23.705 --> 00:18:25.704
<v Speaker 0>Wonderful. So let's close that.

00:18:26.585 --> 00:18:27.304
<v Speaker 0>So,

00:18:28.105 --> 00:18:31.065
<v Speaker 0>Postgres doesn't support TLS mode by default. We

00:18:31.065 --> 00:18:32.745
<v Speaker 0>do need to configure it. There's a couple

00:18:32.745 --> 00:18:34.024
<v Speaker 0>of different steps here.

00:18:37.340 --> 00:18:39.740
<v Speaker 0>We need to add, we can just copy

00:18:39.740 --> 00:18:40.299
<v Speaker 0>this.

00:18:40.620 --> 00:18:42.140
<v Speaker 0>Well, I've not moved them yet.

00:18:42.620 --> 00:18:45.660
<v Speaker 0>So we've got slash path to server CRT.

00:18:45.660 --> 00:18:48.060
<v Speaker 0>So yeah, do we really wanna leave these

00:18:48.060 --> 00:18:50.380
<v Speaker 0>line and slash root? Probably

00:18:50.380 --> 00:18:50.860
<v Speaker 0>not.

00:18:51.945 --> 00:18:55.225
<v Speaker 0>Postgres makes use of varlib.

00:18:56.025 --> 00:18:56.984
<v Speaker 0>Postgres

00:18:57.065 --> 00:18:59.785
<v Speaker 0>12 main as a directory with all its

00:18:59.785 --> 00:19:02.664
<v Speaker 0>configuration and stuff. It also makes use of

00:19:02.664 --> 00:19:03.145
<v Speaker 0>etc.

00:19:03.809 --> 00:19:04.610
<v Speaker 0>Postgres

00:19:04.610 --> 00:19:07.570
<v Speaker 0>12 main, where it has more configurate Oh,

00:19:07.570 --> 00:19:09.730
<v Speaker 0>I guess the varlib is more state than

00:19:09.730 --> 00:19:10.529
<v Speaker 0>configuration.

00:19:11.889 --> 00:19:13.649
<v Speaker 0>And all the config lists and etc.

00:19:15.585 --> 00:19:17.265
<v Speaker 0>I've never really had much of an opinion

00:19:17.265 --> 00:19:18.864
<v Speaker 0>on whether sets are

00:19:19.184 --> 00:19:21.825
<v Speaker 0>config or state, I feel the line in

00:19:21.825 --> 00:19:22.544
<v Speaker 0>the middle.

00:19:22.865 --> 00:19:25.345
<v Speaker 0>But for the basis of today, and because

00:19:25.345 --> 00:19:26.385
<v Speaker 0>this is how I did it on my

00:19:26.385 --> 00:19:27.024
<v Speaker 0>tests,

00:19:27.424 --> 00:19:29.585
<v Speaker 0>we're gonna move all of these server files

00:19:29.585 --> 00:19:31.024
<v Speaker 0>to the varlab

00:19:31.510 --> 00:19:32.389
<v Speaker 0>postgres

00:19:32.549 --> 00:19:33.990
<v Speaker 0>12 main.

00:19:34.710 --> 00:19:36.629
<v Speaker 0>And if we run our LS again

00:19:39.910 --> 00:19:42.070
<v Speaker 0>Oh, wrong LS. I was a bit worried

00:19:42.070 --> 00:19:42.309
<v Speaker 0>there.

00:19:43.205 --> 00:19:44.085
<v Speaker 0>We

00:19:44.565 --> 00:19:46.885
<v Speaker 0>have our server fails. And of course, if

00:19:46.885 --> 00:19:48.644
<v Speaker 0>we run that with a dash L,

00:19:49.125 --> 00:19:51.365
<v Speaker 0>right? Spot the elephant in the room, we

00:19:51.365 --> 00:19:53.525
<v Speaker 0>of course need to change the permissions

00:19:53.525 --> 00:19:56.485
<v Speaker 0>on these fails too. Postgres does not run

00:19:56.485 --> 00:19:57.765
<v Speaker 0>as a root user,

00:19:58.330 --> 00:20:00.330
<v Speaker 0>so it would actually not even be able

00:20:00.330 --> 00:20:00.890
<v Speaker 0>to

00:20:01.930 --> 00:20:04.090
<v Speaker 0>read those files. So we can do a

00:20:04.090 --> 00:20:05.530
<v Speaker 0>change on ownership,

00:20:05.530 --> 00:20:06.890
<v Speaker 0>Postgres, Postgres,

00:20:07.370 --> 00:20:08.809
<v Speaker 0>Rlib,

00:20:08.810 --> 00:20:09.690
<v Speaker 0>Postgres,

00:20:09.690 --> 00:20:10.650
<v Speaker 0>12 main,

00:20:10.730 --> 00:20:11.370
<v Speaker 0>server star.

00:20:13.995 --> 00:20:16.075
<v Speaker 0>I'll run my LS one more time.

00:20:16.475 --> 00:20:17.594
<v Speaker 0>And that looks

00:20:17.755 --> 00:20:19.914
<v Speaker 0>pretty good. I'm happy with that.

00:20:21.355 --> 00:20:21.914
<v Speaker 0>Okay.

00:20:22.715 --> 00:20:23.914
<v Speaker 0>Did I copy?

00:20:26.280 --> 00:20:28.840
<v Speaker 0>No, I didn't. So we're gonna scroll up

00:20:30.040 --> 00:20:31.480
<v Speaker 0>and copy

00:20:31.640 --> 00:20:32.360
<v Speaker 0>this.

00:20:34.040 --> 00:20:36.840
<v Speaker 0>So we need to add this to our

00:20:36.840 --> 00:20:37.800
<v Speaker 0>Postgres

00:20:37.880 --> 00:20:38.600
<v Speaker 0>configuration.

00:20:40.165 --> 00:20:43.365
<v Speaker 0>Well, main and that lives inside of PostgresQL

00:20:43.365 --> 00:20:44.404
<v Speaker 0>dot conf.

00:20:44.885 --> 00:20:46.485
<v Speaker 0>We're just gonna jump all the way down

00:20:46.485 --> 00:20:48.405
<v Speaker 0>to the bottom. And I'm just gonna save

00:20:48.405 --> 00:20:50.325
<v Speaker 0>this quickly so that I can copy

00:20:50.725 --> 00:20:53.445
<v Speaker 0>the path for where all the files are.

00:20:57.870 --> 00:20:58.990
<v Speaker 0>There we go.

00:21:00.830 --> 00:21:02.910
<v Speaker 0>Let's see if I'm

00:21:03.790 --> 00:21:05.070
<v Speaker 0>gonna get this right.

00:21:07.475 --> 00:21:09.315
<v Speaker 0>Just put this don't allow me to use

00:21:09.315 --> 00:21:10.595
<v Speaker 0>arbitrary

00:21:12.675 --> 00:21:13.635
<v Speaker 0>splatters.

00:21:14.915 --> 00:21:16.035
<v Speaker 0>Let's find that.

00:21:16.915 --> 00:21:17.715
<v Speaker 0>Drop this in.

00:21:20.580 --> 00:21:22.980
<v Speaker 0>Thank you, Vim. I know a

00:21:23.380 --> 00:21:25.380
<v Speaker 0>lot of commands said and such, you can

00:21:25.380 --> 00:21:26.980
<v Speaker 0>actually use wherever it doesn't have to be

00:21:26.980 --> 00:21:28.500
<v Speaker 0>a slash after like the S at the

00:21:28.500 --> 00:21:30.020
<v Speaker 0>start to the substitute.

00:21:30.180 --> 00:21:32.740
<v Speaker 0>You can use anything, it just has to

00:21:32.055 --> 00:21:33.975
<v Speaker 0>be repeated on the other side. So that's

00:21:33.975 --> 00:21:34.455
<v Speaker 0>good.

00:21:35.735 --> 00:21:38.295
<v Speaker 0>So we'll configure our SSL cert file, our

00:21:38.295 --> 00:21:41.575
<v Speaker 0>SSL key file and our SSL CA file

00:21:41.815 --> 00:21:43.575
<v Speaker 0>and turned SSL on.

00:21:44.455 --> 00:21:46.535
<v Speaker 0>The real test now would be to save

00:21:46.535 --> 00:21:47.255
<v Speaker 0>this

00:21:49.390 --> 00:21:51.070
<v Speaker 0>and restart

00:21:51.630 --> 00:21:52.510
<v Speaker 0>Postgres.

00:21:59.070 --> 00:21:59.710
<v Speaker 0>Okay.

00:22:00.670 --> 00:22:02.350
<v Speaker 0>Well, let's use

00:22:03.045 --> 00:22:04.645
<v Speaker 0>the control status.

00:22:07.285 --> 00:22:08.165
<v Speaker 0>Postgres

00:22:08.885 --> 00:22:09.685
<v Speaker 0>exited

00:22:09.685 --> 00:22:12.165
<v Speaker 0>ten seconds ago. So I have

00:22:13.125 --> 00:22:13.765
<v Speaker 0>broken it.

00:22:19.550 --> 00:22:20.270
<v Speaker 0>Okay.

00:22:20.430 --> 00:22:22.270
<v Speaker 0>Let's go to the logs and see what

00:22:22.270 --> 00:22:22.990
<v Speaker 0>I did.

00:22:25.550 --> 00:22:26.350
<v Speaker 0>Oh, it's ready.

00:22:34.245 --> 00:22:35.604
<v Speaker 0>Active exited.

00:22:36.885 --> 00:22:38.565
<v Speaker 0>I must be reading that wrong.

00:22:40.485 --> 00:22:41.604
<v Speaker 0>Oh, postgres.

00:22:42.005 --> 00:22:43.284
<v Speaker 0>Yeah. Yeah. It's fine.

00:22:44.580 --> 00:22:46.340
<v Speaker 0>System d trying to obviously

00:22:46.900 --> 00:22:48.820
<v Speaker 0>confuse and scare me there,

00:22:49.220 --> 00:22:50.179
<v Speaker 0>but we're good.

00:22:51.620 --> 00:22:53.139
<v Speaker 0>So Mozz asked,

00:22:53.220 --> 00:22:54.419
<v Speaker 0>what does the

00:22:54.820 --> 00:22:58.020
<v Speaker 0>hash symbol mean on the VUM substitute command?

00:22:58.705 --> 00:23:01.185
<v Speaker 0>Yeah. That's a good question. So,

00:23:03.185 --> 00:23:04.145
<v Speaker 0>I I would

00:23:04.785 --> 00:23:06.065
<v Speaker 0>turn this into like a

00:23:06.785 --> 00:23:08.625
<v Speaker 0>VUM session or anything, but let's say we

00:23:08.625 --> 00:23:09.185
<v Speaker 0>have hello.

00:23:10.770 --> 00:23:12.370
<v Speaker 0>Why is with my typing?

00:23:13.010 --> 00:23:13.650
<v Speaker 0>Goodbye.

00:23:14.530 --> 00:23:15.330
<v Speaker 0>Thanks.

00:23:16.610 --> 00:23:18.610
<v Speaker 0>Alright. The Scottish version.

00:23:19.730 --> 00:23:21.330
<v Speaker 0>Is that we can now use

00:23:21.650 --> 00:23:22.290
<v Speaker 0>I'm not sure.

00:23:23.695 --> 00:23:26.575
<v Speaker 0>It's regex syntax. I'm not sure if it's

00:23:26.575 --> 00:23:29.294
<v Speaker 0>specific to them and said that supports the

00:23:29.294 --> 00:23:30.894
<v Speaker 0>random delimiter,

00:23:30.975 --> 00:23:32.815
<v Speaker 0>but I'm pretty sure it's pretty

00:23:33.215 --> 00:23:33.615
<v Speaker 0>common.

00:23:35.070 --> 00:23:36.349
<v Speaker 0>So find me,

00:23:36.510 --> 00:23:37.549
<v Speaker 0>replace me.

00:23:37.710 --> 00:23:38.669
<v Speaker 0>This is

00:23:38.909 --> 00:23:40.190
<v Speaker 0>a really standard

00:23:40.350 --> 00:23:42.349
<v Speaker 0>search and replace regex.

00:23:42.990 --> 00:23:44.190
<v Speaker 0>You do s

00:23:44.510 --> 00:23:45.549
<v Speaker 0>and slash.

00:23:45.630 --> 00:23:46.509
<v Speaker 0>So I

00:23:47.070 --> 00:23:48.510
<v Speaker 0>wish I could tell you that the s

00:23:48.510 --> 00:23:50.750
<v Speaker 0>means search or substitute. I think it does,

00:23:50.750 --> 00:23:52.085
<v Speaker 0>but I'm not entirely sure.

00:23:52.885 --> 00:23:55.765
<v Speaker 0>And then normally with regex, we would do

00:23:55.765 --> 00:23:59.045
<v Speaker 0>slash search term slash replace term

00:23:59.525 --> 00:24:00.405
<v Speaker 0>slash

00:24:01.525 --> 00:24:02.965
<v Speaker 0>and then the g on the end is

00:24:02.965 --> 00:24:04.085
<v Speaker 0>for modifiers

00:24:04.085 --> 00:24:05.845
<v Speaker 0>to your search and replace.

00:24:06.400 --> 00:24:08.080
<v Speaker 0>You can do the G, which is global,

00:24:08.080 --> 00:24:09.999
<v Speaker 0>which means replace everything.

00:24:10.480 --> 00:24:12.800
<v Speaker 0>You can do I, which is a case

00:24:12.800 --> 00:24:13.440
<v Speaker 0>sensitive.

00:24:14.080 --> 00:24:15.279
<v Speaker 0>And there is

00:24:16.320 --> 00:24:19.405
<v Speaker 0>M for multilane. I can't remember. No. Yeah.

00:24:19.405 --> 00:24:21.245
<v Speaker 0>If you're not doing global, there's maybe like

00:24:21.245 --> 00:24:23.164
<v Speaker 0>an M which allows you to do multilanes.

00:24:24.045 --> 00:24:25.245
<v Speaker 0>There's a whole bunch of modifiers that you

00:24:25.245 --> 00:24:26.125
<v Speaker 0>can put on the end.

00:24:26.845 --> 00:24:27.405
<v Speaker 0>But

00:24:27.645 --> 00:24:30.205
<v Speaker 0>because forward slash is such a common symbol

00:24:30.205 --> 00:24:32.925
<v Speaker 0>and like web addresses and code and stuff

00:24:32.925 --> 00:24:36.169
<v Speaker 0>like that, You can actually use any delimiter

00:24:36.169 --> 00:24:38.250
<v Speaker 0>on the search replace modifiers

00:24:38.250 --> 00:24:39.369
<v Speaker 0>that you want

00:24:39.610 --> 00:24:40.409
<v Speaker 0>and

00:24:40.570 --> 00:24:41.690
<v Speaker 0>it just works.

00:24:42.330 --> 00:24:44.490
<v Speaker 0>So as an example here, if we do

00:24:44.490 --> 00:24:47.289
<v Speaker 0>s and we're gonna do search, I'll do

00:24:47.289 --> 00:24:49.210
<v Speaker 0>it slash, I mean, that's the default term.

00:24:49.665 --> 00:24:51.905
<v Speaker 0>We can say hello should be

00:24:52.065 --> 00:24:52.945
<v Speaker 0>howdy.

00:24:57.745 --> 00:24:59.825
<v Speaker 0>Oh, I didn't do global.

00:25:02.065 --> 00:25:03.265
<v Speaker 0>Hello,

00:25:03.745 --> 00:25:04.225
<v Speaker 0>howdy.

00:25:05.309 --> 00:25:07.710
<v Speaker 0>There we go. Our hello changes to howdy.

00:25:08.190 --> 00:25:09.549
<v Speaker 0>But I can do that again and this

00:25:09.549 --> 00:25:11.870
<v Speaker 0>time I say how without the slash and

00:25:11.870 --> 00:25:14.109
<v Speaker 0>I can use a plus

00:25:14.429 --> 00:25:16.510
<v Speaker 0>and do howdy plus

00:25:16.510 --> 00:25:17.389
<v Speaker 0>hello

00:25:17.549 --> 00:25:19.390
<v Speaker 0>plus g and it still works.

00:25:20.725 --> 00:25:21.364
<v Speaker 0>So,

00:25:22.965 --> 00:25:24.725
<v Speaker 0>yeah, there you go. It doesn't matter what

00:25:24.725 --> 00:25:25.764
<v Speaker 0>the dormer is.

00:25:26.884 --> 00:25:28.884
<v Speaker 0>You use whatever works

00:25:28.965 --> 00:25:30.725
<v Speaker 0>depending on what you wanna search and what

00:25:30.725 --> 00:25:31.684
<v Speaker 0>you wanna replace.

00:25:33.205 --> 00:25:34.245
<v Speaker 0>Sweet. Okay.

00:25:37.679 --> 00:25:39.600
<v Speaker 0>Oh, yes. So our postgres is working,

00:25:40.000 --> 00:25:41.200
<v Speaker 0>which is fantastic.

00:25:43.760 --> 00:25:45.280
<v Speaker 0>So let's

00:25:45.280 --> 00:25:46.960
<v Speaker 0>jump back to our workshop.

00:25:47.120 --> 00:25:48.960
<v Speaker 0>So configure it for TLS mode. I think

00:25:48.960 --> 00:25:50.400
<v Speaker 0>we've done this. I'm gonna pop open the

00:25:50.400 --> 00:25:51.760
<v Speaker 0>answer, make sure I've not missed anything.

00:25:53.305 --> 00:25:55.545
<v Speaker 0>So I say here, yeah, move the start.

00:25:55.545 --> 00:25:58.105
<v Speaker 0>So location that Postgres has access to,

00:25:58.425 --> 00:26:00.025
<v Speaker 0>this is a solid choice.

00:26:00.665 --> 00:26:01.945
<v Speaker 0>Change the ownership,

00:26:02.265 --> 00:26:02.985
<v Speaker 0>which it did.

00:26:05.159 --> 00:26:08.359
<v Speaker 0>We ran the off sync command.

00:26:09.480 --> 00:26:11.239
<v Speaker 0>We added these lanes.

00:26:11.639 --> 00:26:13.880
<v Speaker 0>Oh yeah. And one last thing. So this

00:26:13.880 --> 00:26:15.799
<v Speaker 0>is in the documentation as well.

00:26:16.679 --> 00:26:17.000
<v Speaker 0>Host

00:26:18.755 --> 00:26:19.875
<v Speaker 0>SSL

00:26:20.035 --> 00:26:22.595
<v Speaker 0>is when you're configuring a server, you can

00:26:22.595 --> 00:26:23.475
<v Speaker 0>additionally

00:26:23.635 --> 00:26:24.515
<v Speaker 0>modify

00:26:24.995 --> 00:26:27.795
<v Speaker 0>the PGHP fail. So this fail is kinda

00:26:27.795 --> 00:26:30.755
<v Speaker 0>like, you know, your PAM configuration on a

00:26:30.755 --> 00:26:32.920
<v Speaker 0>Linux machine where you configure whether people are

00:26:32.920 --> 00:26:34.680
<v Speaker 0>gonna log in with password or just keys.

00:26:34.680 --> 00:26:36.120
<v Speaker 0>And then the order and the fail is

00:26:36.120 --> 00:26:38.680
<v Speaker 0>the order that the priority exists within the

00:26:38.680 --> 00:26:39.799
<v Speaker 0>authentication system.

00:26:40.120 --> 00:26:42.200
<v Speaker 0>It's pretty much the exact same for Postgres.

00:26:42.760 --> 00:26:45.560
<v Speaker 0>So, we can just copy these two lanes

00:26:45.560 --> 00:26:48.155
<v Speaker 0>and put them into our PGHBA.

00:26:48.155 --> 00:26:50.235
<v Speaker 0>And this will just tell us that we

00:26:50.235 --> 00:26:50.955
<v Speaker 0>allow

00:26:51.515 --> 00:26:54.955
<v Speaker 0>when someone connects over SSLTLS

00:26:55.355 --> 00:26:57.915
<v Speaker 0>for all user, all databases and all IP

00:26:57.915 --> 00:27:00.475
<v Speaker 0>addresses that we allow certificate based authentication.

00:27:02.180 --> 00:27:03.860
<v Speaker 0>So we need to make that change. So

00:27:03.860 --> 00:27:05.700
<v Speaker 0>we go to etcetera,

00:27:06.900 --> 00:27:07.860
<v Speaker 0>Postgres,

00:27:07.860 --> 00:27:08.820
<v Speaker 0>12 main,

00:27:09.540 --> 00:27:09.940
<v Speaker 0>pg.

00:27:13.665 --> 00:27:16.545
<v Speaker 0>And we're gonna stick this right up

00:27:16.945 --> 00:27:17.665
<v Speaker 0>here.

00:27:21.825 --> 00:27:22.625
<v Speaker 0>So we

00:27:23.025 --> 00:27:25.825
<v Speaker 0>prioritize and prepare certificate based authentication. We're gonna

00:27:25.825 --> 00:27:26.545
<v Speaker 0>check that first.

00:27:28.919 --> 00:27:31.799
<v Speaker 0>Now we do another big scary restart.

00:27:35.080 --> 00:27:37.400
<v Speaker 0>I'm

00:27:37.400 --> 00:27:38.440
<v Speaker 0>not gonna trust

00:27:39.000 --> 00:27:40.919
<v Speaker 0>some of the status.

00:27:41.080 --> 00:27:42.360
<v Speaker 0>I will just test.

00:27:44.265 --> 00:27:45.305
<v Speaker 0>Still good.

00:27:45.625 --> 00:27:46.345
<v Speaker 0>Nice.

00:27:46.985 --> 00:27:49.545
<v Speaker 0>So now we have configured

00:27:49.545 --> 00:27:52.585
<v Speaker 0>Postgres. Postgres is now ready for us to

00:27:52.585 --> 00:27:55.785
<v Speaker 0>start proxying our access through the Teleport system.

00:27:57.910 --> 00:28:00.390
<v Speaker 0>Okay, so I'll close these as I go,

00:28:00.390 --> 00:28:01.910
<v Speaker 0>so I don't get too confused. I'm easy,

00:28:01.910 --> 00:28:02.950
<v Speaker 0>easy confused.

00:28:03.830 --> 00:28:05.990
<v Speaker 0>So now we have exercise five and there's

00:28:05.990 --> 00:28:07.430
<v Speaker 0>a 5B. 5B,

00:28:07.430 --> 00:28:08.790
<v Speaker 0>I'm gonna have to do it because this

00:28:08.790 --> 00:28:11.030
<v Speaker 0>is Teleport Cloud. If you're just using Teleport

00:28:11.030 --> 00:28:13.795
<v Speaker 0>that you configured yourself, you do not need

00:28:13.795 --> 00:28:15.075
<v Speaker 0>to do that step.

00:28:16.755 --> 00:28:19.395
<v Speaker 0>So we have to add a role now.

00:28:21.875 --> 00:28:23.635
<v Speaker 0>Format is dreadful.

00:28:23.635 --> 00:28:25.155
<v Speaker 0>I don't know if had it can't be

00:28:25.155 --> 00:28:27.235
<v Speaker 0>because it's a pop down. It's just I've

00:28:27.235 --> 00:28:29.290
<v Speaker 0>just messed this up. I will fix all

00:28:29.290 --> 00:28:30.330
<v Speaker 0>the formatting.

00:28:31.370 --> 00:28:32.490
<v Speaker 0>I mean, in fact, you know what? I'm

00:28:32.490 --> 00:28:35.130
<v Speaker 0>gonna view this as raw just for today.

00:28:35.210 --> 00:28:36.410
<v Speaker 0>Oh, no. Because then I'll see all my

00:28:36.490 --> 00:28:39.610
<v Speaker 0>I'll

00:28:39.610 --> 00:28:41.370
<v Speaker 0>I'll pop it open in raw too. There

00:28:41.370 --> 00:28:42.970
<v Speaker 0>we go. That's a good idea. And then

00:28:42.970 --> 00:28:44.410
<v Speaker 0>I can copy and paste what I

00:28:49.185 --> 00:28:51.745
<v Speaker 0>So exercise five, we're

00:28:51.745 --> 00:28:53.664
<v Speaker 0>gonna add a rule. Yeah. That's okay.

00:28:54.065 --> 00:28:56.305
<v Speaker 0>I never like it's weird and like, you

00:28:56.305 --> 00:28:57.825
<v Speaker 0>need the space after the paragraph.

00:29:01.210 --> 00:29:02.730
<v Speaker 0>I I could commit it and see, but

00:29:02.730 --> 00:29:04.169
<v Speaker 0>it's not important.

00:29:04.730 --> 00:29:06.410
<v Speaker 0>Stop following rabbit holes, Dave.

00:29:06.890 --> 00:29:08.169
<v Speaker 0>Okay. So

00:29:08.810 --> 00:29:11.210
<v Speaker 0>we need to create a role that is

00:29:11.210 --> 00:29:12.250
<v Speaker 0>gonna allow

00:29:12.330 --> 00:29:14.865
<v Speaker 0>anyone who has that role to be able

00:29:14.865 --> 00:29:16.304
<v Speaker 0>to access the databases.

00:29:16.385 --> 00:29:18.625
<v Speaker 0>So we have a workshop on

00:29:18.865 --> 00:29:20.625
<v Speaker 0>a deep dive into the RBAC system and

00:29:20.625 --> 00:29:22.705
<v Speaker 0>Teleport that we'll be covering in a couple

00:29:22.705 --> 00:29:23.345
<v Speaker 0>of weeks.

00:29:23.665 --> 00:29:25.745
<v Speaker 0>So we'll keep it super professional for today.

00:29:26.225 --> 00:29:27.745
<v Speaker 0>But if you have questions, I'm happy to

00:29:27.745 --> 00:29:28.625
<v Speaker 0>answer them as we go.

00:29:29.870 --> 00:29:32.110
<v Speaker 0>So we're gonna create a roles file. We

00:29:32.110 --> 00:29:33.310
<v Speaker 0>paste this in.

00:29:33.630 --> 00:29:36.350
<v Speaker 0>We don't need this. So the default are

00:29:36.350 --> 00:29:38.350
<v Speaker 0>really Kubernetes manifests,

00:29:38.350 --> 00:29:39.550
<v Speaker 0>they'll say here,

00:29:40.190 --> 00:29:42.350
<v Speaker 0>kind and version. So this is role V4

00:29:42.350 --> 00:29:45.065
<v Speaker 0>with a metadata and the name. The name

00:29:45.065 --> 00:29:46.105
<v Speaker 0>is arbitrary.

00:29:46.425 --> 00:29:47.865
<v Speaker 0>I can call this

00:29:49.225 --> 00:29:50.184
<v Speaker 0>local

00:29:50.185 --> 00:29:51.385
<v Speaker 0>post for SQL

00:29:51.785 --> 00:29:52.664
<v Speaker 0>access.

00:29:53.865 --> 00:29:55.385
<v Speaker 0>And the spec here is that we're gonna

00:29:55.385 --> 00:29:56.185
<v Speaker 0>allow

00:29:57.200 --> 00:29:59.040
<v Speaker 0>star star all the way down. So anyone

00:29:59.040 --> 00:30:02.320
<v Speaker 0>with this role can connect to any database

00:30:02.560 --> 00:30:05.440
<v Speaker 0>that is configured and proxy for the Teleport

00:30:05.440 --> 00:30:06.000
<v Speaker 0>system.

00:30:06.560 --> 00:30:09.520
<v Speaker 0>And I'll never remember to type this. So

00:30:09.520 --> 00:30:10.560
<v Speaker 0>let's just call it DB.

00:30:13.005 --> 00:30:15.005
<v Speaker 0>We can then apply that. So, you can

00:30:15.005 --> 00:30:17.885
<v Speaker 0>use t control dash f, very Kubernetes like

00:30:17.885 --> 00:30:18.445
<v Speaker 0>again,

00:30:19.005 --> 00:30:21.645
<v Speaker 0>where we just say, hey, go and create

00:30:21.645 --> 00:30:22.605
<v Speaker 0>this role for me please.

00:30:24.190 --> 00:30:26.110
<v Speaker 0>That's done. We can use

00:30:26.910 --> 00:30:28.350
<v Speaker 0>roles ls.

00:30:29.150 --> 00:30:29.870
<v Speaker 0>Nope.

00:30:36.110 --> 00:30:36.830
<v Speaker 0>Am I wrong?

00:30:42.965 --> 00:30:45.445
<v Speaker 0>Thought you could get roles. Alright. Okay. We

00:30:45.445 --> 00:30:47.365
<v Speaker 0>can run the get command, which I think

00:30:47.365 --> 00:30:48.725
<v Speaker 0>gives you a back of YAML. I guess

00:30:48.725 --> 00:30:50.005
<v Speaker 0>that's good enough for today.

00:30:50.725 --> 00:30:52.245
<v Speaker 0>And we can see all the roles in

00:30:52.245 --> 00:30:53.125
<v Speaker 0>the system.

00:30:53.445 --> 00:30:54.805
<v Speaker 0>Does it work if No. It doesn't work.

00:31:00.860 --> 00:31:02.380
<v Speaker 0>Not sure why you can't

00:31:03.500 --> 00:31:04.620
<v Speaker 0>roles list.

00:31:06.220 --> 00:31:07.500
<v Speaker 0>You can users list.

00:31:12.605 --> 00:31:13.644
<v Speaker 0>Not a big deal.

00:31:18.445 --> 00:31:19.245
<v Speaker 0>Okay. So we

00:31:24.549 --> 00:31:27.109
<v Speaker 0>The Mars has jumped in the comments saying

00:31:27.350 --> 00:31:29.829
<v Speaker 0>he can teleport control DB get rules.

00:31:31.110 --> 00:31:33.589
<v Speaker 0>No, because this rule isn't actually specific

00:31:34.070 --> 00:31:34.789
<v Speaker 0>to

00:31:34.870 --> 00:31:37.269
<v Speaker 0>databases. This is a general teleport rule that

00:31:37.269 --> 00:31:37.830
<v Speaker 0>works

00:31:38.475 --> 00:31:41.195
<v Speaker 0>across app proxy and database proxy and server

00:31:41.195 --> 00:31:42.394
<v Speaker 0>management, etcetera.

00:31:43.914 --> 00:31:45.835
<v Speaker 0>But I will I'll I'll try it.

00:31:51.434 --> 00:31:51.835
<v Speaker 0>No.

00:31:53.520 --> 00:31:55.200
<v Speaker 0>Just dbls. Yeah.

00:31:55.840 --> 00:31:57.760
<v Speaker 0>To be honest, the problem is just not

00:31:57.760 --> 00:31:59.200
<v Speaker 0>implemented rules ls.

00:31:59.600 --> 00:32:01.680
<v Speaker 0>Not a big deal. We don't use it

00:32:01.680 --> 00:32:03.039
<v Speaker 0>for today anyway.

00:32:03.120 --> 00:32:04.799
<v Speaker 0>You can always do

00:32:05.040 --> 00:32:05.760
<v Speaker 0>p control,

00:32:07.325 --> 00:32:08.524
<v Speaker 0>get roles,

00:32:08.525 --> 00:32:10.685
<v Speaker 0>save that YAML file and then create apply

00:32:10.685 --> 00:32:11.965
<v Speaker 0>over the top of it. So if you

00:32:11.965 --> 00:32:13.405
<v Speaker 0>don't need to change the roles, that's just

00:32:13.405 --> 00:32:14.925
<v Speaker 0>how you would do it. Not being able

00:32:14.925 --> 00:32:16.605
<v Speaker 0>to list them on the end of world,

00:32:16.605 --> 00:32:17.725
<v Speaker 0>let's get it. Keep moving.

00:32:18.045 --> 00:32:20.125
<v Speaker 0>What we do need to do is we

00:32:20.125 --> 00:32:21.929
<v Speaker 0>can use users

00:32:22.330 --> 00:32:23.210
<v Speaker 0>l s

00:32:25.130 --> 00:32:26.249
<v Speaker 0>to see me.

00:32:26.410 --> 00:32:29.049
<v Speaker 0>Yep. There we go. I don't have

00:32:30.090 --> 00:32:31.049
<v Speaker 0>this rule.

00:32:32.169 --> 00:32:33.770
<v Speaker 0>So we can do t control,

00:32:36.665 --> 00:32:37.544
<v Speaker 0>get

00:32:37.865 --> 00:32:38.745
<v Speaker 0>users,

00:32:39.865 --> 00:32:41.544
<v Speaker 0>users dot YAML,

00:32:45.465 --> 00:32:46.905
<v Speaker 0>and then modify

00:32:46.905 --> 00:32:48.105
<v Speaker 0>the YAML,

00:32:48.265 --> 00:32:49.225
<v Speaker 0>go to roles,

00:32:50.260 --> 00:32:52.500
<v Speaker 0>and I just jumped straight in here, like

00:32:52.500 --> 00:32:55.700
<v Speaker 0>an absolute wild card and save the YAML

00:32:56.100 --> 00:32:59.140
<v Speaker 0>and then create apply over the top. Now

00:32:59.140 --> 00:33:00.739
<v Speaker 0>it allows me to modify my user.

00:33:02.660 --> 00:33:03.860
<v Speaker 0>There is a nicer way,

00:33:05.165 --> 00:33:07.565
<v Speaker 0>but I can never remember what it is.

00:33:09.325 --> 00:33:11.804
<v Speaker 0>What's the subcommand on users?

00:33:14.605 --> 00:33:17.085
<v Speaker 0>Not reset. That's like a user

00:33:17.380 --> 00:33:19.860
<v Speaker 0>mod command. Maybe it's in my my cheat

00:33:19.860 --> 00:33:20.419
<v Speaker 0>sheet.

00:33:24.659 --> 00:33:25.299
<v Speaker 0>Oh,

00:33:26.179 --> 00:33:27.940
<v Speaker 0>okay. You can just do that. So I

00:33:27.940 --> 00:33:30.659
<v Speaker 0>could have done use add

00:33:32.015 --> 00:33:33.054
<v Speaker 0>roles.

00:33:33.054 --> 00:33:34.815
<v Speaker 0>Oh, but I have to specify all the

00:33:34.815 --> 00:33:35.455
<v Speaker 0>roles.

00:33:35.775 --> 00:33:37.455
<v Speaker 0>Oh yeah. I think that's gonna overrate it

00:33:37.455 --> 00:33:39.535
<v Speaker 0>completely. Let's try it. Right? I like to

00:33:39.535 --> 00:33:40.335
<v Speaker 0>break things.

00:33:41.054 --> 00:33:41.855
<v Speaker 0>Access.

00:33:42.335 --> 00:33:43.855
<v Speaker 0>What are the roles that I have?

00:33:44.495 --> 00:33:45.135
<v Speaker 0>An order.

00:33:46.540 --> 00:33:47.899
<v Speaker 0>Audit r

00:33:48.300 --> 00:33:49.179
<v Speaker 0>David

00:33:49.260 --> 00:33:50.539
<v Speaker 0>Rawkode.

00:33:50.780 --> 00:33:52.780
<v Speaker 0>So was that removed DB? We're about to

00:33:52.780 --> 00:33:53.500
<v Speaker 0>find out.

00:33:56.620 --> 00:33:58.220
<v Speaker 0>Oh, no. Sorry. Okay. So that's just for

00:33:58.220 --> 00:34:00.725
<v Speaker 0>adding new users. Alright. Okay. So, maybe the

00:34:00.725 --> 00:34:02.485
<v Speaker 0>only way to edit is just through the

00:34:02.485 --> 00:34:04.725
<v Speaker 0>get users, modify the YAML, chuck it back

00:34:04.725 --> 00:34:07.365
<v Speaker 0>in. Something I'd appreciate,

00:34:07.365 --> 00:34:09.445
<v Speaker 0>we're using Teleport Cloud. I had never noticed

00:34:09.445 --> 00:34:11.925
<v Speaker 0>this on open source, but maybe, I don't

00:34:11.925 --> 00:34:14.165
<v Speaker 0>know if it's different is that you can

00:34:15.429 --> 00:34:17.190
<v Speaker 0>modify myself from here.

00:34:18.949 --> 00:34:21.430
<v Speaker 0>Don't want DB. Well, get myself DB.

00:34:22.230 --> 00:34:23.590
<v Speaker 0>I haven't seen this in the open source

00:34:23.590 --> 00:34:24.790
<v Speaker 0>one. I don't know if it's coming or

00:34:24.790 --> 00:34:27.110
<v Speaker 0>if it's just on cloud or enterprise,

00:34:27.190 --> 00:34:28.710
<v Speaker 0>but I thought that was quite a new

00:34:28.710 --> 00:34:30.974
<v Speaker 0>feature. You can also modify the rules themselves

00:34:30.974 --> 00:34:31.614
<v Speaker 0>too.

00:34:34.574 --> 00:34:35.455
<v Speaker 0>Excuse me.

00:34:36.255 --> 00:34:38.494
<v Speaker 0>And that's dropped straight into your YAML thing.

00:34:38.494 --> 00:34:39.375
<v Speaker 0>There you go.

00:34:40.494 --> 00:34:42.175
<v Speaker 0>And they list them here. Maybe there's a

00:34:42.175 --> 00:34:43.694
<v Speaker 0>secret API for getting the rules.

00:34:50.780 --> 00:34:53.580
<v Speaker 0>So we have a question from Oz.

00:34:54.859 --> 00:34:57.260
<v Speaker 0>The access rule also has DB names and

00:34:57.260 --> 00:34:59.340
<v Speaker 0>DB users. Does that override your rule?

00:35:00.875 --> 00:35:02.155
<v Speaker 0>No, they're merged.

00:35:02.875 --> 00:35:05.675
<v Speaker 0>So it's not overwritten

00:35:05.675 --> 00:35:07.195
<v Speaker 0>in any way, they're just merged.

00:35:12.339 --> 00:35:14.980
<v Speaker 0>So it has DB labels, but not DB

00:35:14.980 --> 00:35:16.500
<v Speaker 0>names and DB users.

00:35:17.540 --> 00:35:19.380
<v Speaker 0>So you would still need

00:35:20.819 --> 00:35:22.900
<v Speaker 0>to give yourself a database role with star

00:35:22.900 --> 00:35:24.340
<v Speaker 0>star across the board.

00:35:24.900 --> 00:35:27.619
<v Speaker 0>At least I believe that's my answer. That's

00:35:27.174 --> 00:35:28.375
<v Speaker 0>how I think it works.

00:35:32.615 --> 00:35:35.015
<v Speaker 0>One more question from Russell.

00:35:35.335 --> 00:35:37.494
<v Speaker 0>Does that UI show which users are assigned

00:35:37.494 --> 00:35:38.615
<v Speaker 0>to the role?

00:35:39.494 --> 00:35:40.214
<v Speaker 0>No,

00:35:40.375 --> 00:35:41.734
<v Speaker 0>but here you can see them on this

00:35:41.734 --> 00:35:42.940
<v Speaker 0>list here.

00:35:44.220 --> 00:35:46.220
<v Speaker 0>That's a wee bit small, isn't it? You

00:35:48.140 --> 00:35:49.740
<v Speaker 0>can see the roles a user has here,

00:35:49.740 --> 00:35:52.380
<v Speaker 0>but there's no user list on the corresponding

00:35:52.380 --> 00:35:53.260
<v Speaker 0>role

00:35:53.340 --> 00:35:53.980
<v Speaker 0>thing.

00:35:55.340 --> 00:35:56.860
<v Speaker 0>So, you can't see the users from here.

00:35:58.065 --> 00:36:00.145
<v Speaker 0>Something I did notice during my testing is

00:36:00.145 --> 00:36:01.505
<v Speaker 0>that now that I have a saying, I

00:36:01.505 --> 00:36:03.185
<v Speaker 0>bet this works now, that's gonna be annoying

00:36:03.185 --> 00:36:04.865
<v Speaker 0>me. If I try and delete the database

00:36:04.865 --> 00:36:06.145
<v Speaker 0>rule, it will tell me that a user

00:36:06.145 --> 00:36:07.025
<v Speaker 0>has it.

00:36:08.225 --> 00:36:09.425
<v Speaker 0>Yeah. Because

00:36:10.225 --> 00:36:11.984
<v Speaker 0>it's still used by user, so you can't

00:36:11.984 --> 00:36:12.225
<v Speaker 0>do it.

00:36:13.690 --> 00:36:15.610
<v Speaker 0>Another thing that wasted

00:36:15.850 --> 00:36:16.490
<v Speaker 0>a substantial

00:36:17.130 --> 00:36:18.250
<v Speaker 0>amount of

00:36:19.210 --> 00:36:21.770
<v Speaker 0>my time during the testing here is that

00:36:21.770 --> 00:36:22.970
<v Speaker 0>your roles,

00:36:23.370 --> 00:36:25.050
<v Speaker 0>if you change your roles, you need to

00:36:25.050 --> 00:36:27.370
<v Speaker 0>log out and log back into the system.

00:36:28.695 --> 00:36:29.415
<v Speaker 0>So,

00:36:31.015 --> 00:36:32.615
<v Speaker 0>search status,

00:36:33.335 --> 00:36:35.015
<v Speaker 0>you'll see here that even though I now

00:36:35.015 --> 00:36:36.455
<v Speaker 0>have the database role,

00:36:37.495 --> 00:36:38.695
<v Speaker 0>I don't have

00:36:39.335 --> 00:36:42.375
<v Speaker 0>listed locally. And when I try to execute

00:36:43.160 --> 00:36:44.120
<v Speaker 0>any of

00:36:44.520 --> 00:36:45.080
<v Speaker 0>the

00:36:45.400 --> 00:36:47.720
<v Speaker 0>database commands to connect to the database, etcetera,

00:36:47.720 --> 00:36:49.480
<v Speaker 0>they failed with an access denied. And it's

00:36:49.480 --> 00:36:51.080
<v Speaker 0>just because the token

00:36:52.040 --> 00:36:53.640
<v Speaker 0>that I got when I signed in,

00:36:54.200 --> 00:36:55.960
<v Speaker 0>obviously, you know, if you're familiar with JSON

00:36:55.960 --> 00:36:58.625
<v Speaker 0>web tokens, they have like the subject and

00:36:58.625 --> 00:37:00.945
<v Speaker 0>they have the capabilities all embedded in HMAC

00:37:00.945 --> 00:37:01.665
<v Speaker 0>consent.

00:37:01.825 --> 00:37:02.945
<v Speaker 0>And so you have to log out and

00:37:02.945 --> 00:37:05.105
<v Speaker 0>log back in to refresh that.

00:37:07.745 --> 00:37:09.425
<v Speaker 0>We got another question

00:37:10.310 --> 00:37:11.430
<v Speaker 0>from Russell.

00:37:11.430 --> 00:37:12.550
<v Speaker 0>Can you filter

00:37:12.710 --> 00:37:15.030
<v Speaker 0>the user screen by role?

00:37:15.510 --> 00:37:16.230
<v Speaker 0>Let's find out.

00:37:24.425 --> 00:37:25.545
<v Speaker 0>Yes.

00:37:29.625 --> 00:37:31.865
<v Speaker 0>Because when I say DB, I don't disappear.

00:37:32.425 --> 00:37:33.145
<v Speaker 0>So

00:37:33.545 --> 00:37:35.385
<v Speaker 0>yes, you can filter by

00:37:35.705 --> 00:37:36.105
<v Speaker 0>editor.

00:37:37.080 --> 00:37:37.880
<v Speaker 0>Yeah.

00:37:38.120 --> 00:37:39.320
<v Speaker 0>So it appear you can type in a

00:37:39.320 --> 00:37:41.000
<v Speaker 0>role name and it will filter the users.

00:37:42.360 --> 00:37:44.920
<v Speaker 0>Not the most intuitive search bar, like whether

00:37:44.920 --> 00:37:46.360
<v Speaker 0>I knew I could do that, but, you

00:37:46.360 --> 00:37:47.560
<v Speaker 0>know, trial and error, that's how we do

00:37:47.560 --> 00:37:47.800
<v Speaker 0>things.

00:37:49.625 --> 00:37:51.705
<v Speaker 0>All right, let's get back on track. So

00:37:52.184 --> 00:37:54.825
<v Speaker 0>we have created our database role, which is

00:37:54.825 --> 00:37:56.505
<v Speaker 0>star star across the board.

00:37:56.825 --> 00:37:57.944
<v Speaker 0>Let's take a look at that one more

00:37:57.944 --> 00:37:58.585
<v Speaker 0>time.

00:38:01.305 --> 00:38:02.744
<v Speaker 0>So

00:38:02.470 --> 00:38:04.790
<v Speaker 0>labels, names, and users, star slash star. So

00:38:04.790 --> 00:38:06.230
<v Speaker 0>anyone with that role can speak to any

00:38:06.230 --> 00:38:08.310
<v Speaker 0>database that is proxied by Teleport system.

00:38:08.550 --> 00:38:10.550
<v Speaker 0>I don't have that role yet.

00:38:10.710 --> 00:38:12.790
<v Speaker 0>I'll need to log out and log back

00:38:12.790 --> 00:38:15.270
<v Speaker 0>in, but we'll I wonder if there's a

00:38:15.270 --> 00:38:16.630
<v Speaker 0>way for me to refresh that.

00:38:17.505 --> 00:38:19.184
<v Speaker 0>Well, let's not get a rabbit hole. I've

00:38:19.184 --> 00:38:21.904
<v Speaker 0>got twenty three minutes left. Okay. So let's

00:38:21.904 --> 00:38:23.984
<v Speaker 0>carry on. If you have any more questions,

00:38:23.984 --> 00:38:24.865
<v Speaker 0>keep them coming.

00:38:27.025 --> 00:38:29.664
<v Speaker 0>So we created the role, we modified our

00:38:29.664 --> 00:38:33.280
<v Speaker 0>user, I'll add the get users, edit, apply

00:38:33.280 --> 00:38:35.440
<v Speaker 0>thing here, just for anyone as using self

00:38:35.440 --> 00:38:36.800
<v Speaker 0>hosted. You

00:38:37.200 --> 00:38:38.400
<v Speaker 0>may have to be able to just create

00:38:38.400 --> 00:38:40.000
<v Speaker 0>a new user. Of course, I could just

00:38:40.000 --> 00:38:42.160
<v Speaker 0>have created a new user too called my

00:38:42.160 --> 00:38:43.200
<v Speaker 0>special DB user,

00:38:43.795 --> 00:38:45.155
<v Speaker 0>but that's not we'll

00:38:45.795 --> 00:38:48.915
<v Speaker 0>forget I said that. Okay. On Teleport Cloud,

00:38:49.075 --> 00:38:50.995
<v Speaker 0>I did find that we needed to add

00:38:50.995 --> 00:38:52.195
<v Speaker 0>this impersonate

00:38:53.395 --> 00:38:54.035
<v Speaker 0>capability.

00:38:55.900 --> 00:38:59.340
<v Speaker 0>So we're going to use the get rules,

00:38:59.340 --> 00:39:02.140
<v Speaker 0>edit rules, create rules trick at the to

00:39:02.140 --> 00:39:04.700
<v Speaker 0>add this to our DB rule.

00:39:05.420 --> 00:39:07.500
<v Speaker 0>So get

00:39:07.500 --> 00:39:08.220
<v Speaker 0>rules.

00:39:08.380 --> 00:39:09.100
<v Speaker 0>Roles.

00:39:09.260 --> 00:39:09.740
<v Speaker 0>Yaml.

00:39:17.825 --> 00:39:19.265
<v Speaker 0>This access.

00:39:19.904 --> 00:39:20.545
<v Speaker 0>Order.

00:39:21.105 --> 00:39:21.984
<v Speaker 0>D b.

00:39:23.424 --> 00:39:23.825
<v Speaker 0>Allow.

00:39:27.170 --> 00:39:28.130
<v Speaker 0>Delete,

00:39:28.849 --> 00:39:29.730
<v Speaker 0>boom, boom.

00:39:30.450 --> 00:39:32.849
<v Speaker 0>Yep. That's it. So everyone with this rule

00:39:32.849 --> 00:39:35.329
<v Speaker 0>can impersonate, gives us some rules. Weird though

00:39:35.329 --> 00:39:35.890
<v Speaker 0>that

00:39:36.210 --> 00:39:37.890
<v Speaker 0>this is also on the

00:39:38.530 --> 00:39:39.250
<v Speaker 0>access one.

00:39:41.445 --> 00:39:42.805
<v Speaker 0>Yeah. Impersonate

00:39:43.845 --> 00:39:44.565
<v Speaker 0>here.

00:39:46.965 --> 00:39:48.245
<v Speaker 0>But I'm pretty sure it had an error

00:39:48.245 --> 00:39:49.525
<v Speaker 0>when I didn't add it to the DB

00:39:49.525 --> 00:39:50.485
<v Speaker 0>one. So

00:39:51.765 --> 00:39:54.405
<v Speaker 0>just when in doubt, do it twice.

00:39:55.445 --> 00:39:56.405
<v Speaker 0>And we'll apply that.

00:40:05.800 --> 00:40:08.120
<v Speaker 0>There's a question from Russell that I can

00:40:08.120 --> 00:40:08.920
<v Speaker 0>definitely

00:40:09.365 --> 00:40:11.525
<v Speaker 0>guess based on what I've seen

00:40:12.645 --> 00:40:15.684
<v Speaker 0>during my Teleport workshops. So Russell is asking,

00:40:15.684 --> 00:40:17.525
<v Speaker 0>if you also have the role privileges, does

00:40:17.525 --> 00:40:19.684
<v Speaker 0>it apply straight away? I could you grab

00:40:19.684 --> 00:40:21.444
<v Speaker 0>start to a role you already have and

00:40:21.444 --> 00:40:22.724
<v Speaker 0>suddenly get full access?

00:40:27.360 --> 00:40:28.080
<v Speaker 0>Yes.

00:40:28.960 --> 00:40:29.760
<v Speaker 0>Because

00:40:32.240 --> 00:40:35.680
<v Speaker 0>the only thing my authenticated token contains is

00:40:35.680 --> 00:40:37.120
<v Speaker 0>the roles that I have and not the

00:40:37.120 --> 00:40:39.675
<v Speaker 0>capabilities of that role. So, if I can

00:40:39.675 --> 00:40:41.515
<v Speaker 0>speak to the server with my JSON web

00:40:41.515 --> 00:40:43.355
<v Speaker 0>token saying here, can I look at my

00:40:43.355 --> 00:40:44.555
<v Speaker 0>JSON web token?

00:40:48.475 --> 00:40:49.035
<v Speaker 0>Key.

00:40:59.240 --> 00:41:01.720
<v Speaker 0>Should I be putting this over here? This

00:41:01.720 --> 00:41:03.400
<v Speaker 0>is my Teleport load account.

00:41:09.724 --> 00:41:11.325
<v Speaker 0>For once in my life, I'm adding on

00:41:11.325 --> 00:41:12.525
<v Speaker 0>the state of caution.

00:41:17.244 --> 00:41:19.085
<v Speaker 0>I'm gonna look at it locally first

00:41:20.765 --> 00:41:21.964
<v Speaker 0>because I'm worried.

00:41:24.270 --> 00:41:26.670
<v Speaker 0>Yeah. Great advice, Russell. Don't do it.

00:41:30.110 --> 00:41:31.470
<v Speaker 0>So

00:41:31.470 --> 00:41:32.990
<v Speaker 0>I'm just pulling up locally. I wanna

00:41:35.630 --> 00:41:36.830
<v Speaker 0>Yeah. I can't share that.

00:41:38.744 --> 00:41:39.464
<v Speaker 0>Okay.

00:41:40.345 --> 00:41:43.144
<v Speaker 0>It's not adjacent web token, which I didn't

00:41:43.144 --> 00:41:45.944
<v Speaker 0>know either. It's the actual x5.1 language, I

00:41:45.944 --> 00:41:48.345
<v Speaker 0>guess makes sense. But the roles are, will

00:41:48.345 --> 00:41:49.785
<v Speaker 0>be same than that rather

00:41:52.105 --> 00:41:54.490
<v Speaker 0>than the capability. So I guess if we

00:41:54.490 --> 00:41:56.570
<v Speaker 0>have time at the end, we'll try it.

00:41:56.809 --> 00:41:58.730
<v Speaker 0>We'll remove all of my roles,

00:41:58.890 --> 00:42:01.290
<v Speaker 0>bar the DB one and incrementally add new

00:42:01.290 --> 00:42:03.530
<v Speaker 0>functionality to it and see if things work.

00:42:03.530 --> 00:42:04.569
<v Speaker 0>But I suspect it will.

00:42:06.605 --> 00:42:07.325
<v Speaker 0>Right.

00:42:07.484 --> 00:42:08.925
<v Speaker 0>Let's get back on track.

00:42:10.845 --> 00:42:13.645
<v Speaker 0>So now that we have added the impersonate

00:42:13.645 --> 00:42:15.085
<v Speaker 0>thing, which is just a cloud thing, don't

00:42:15.085 --> 00:42:16.605
<v Speaker 0>worry about it for self hosted, we wanna

00:42:16.605 --> 00:42:18.444
<v Speaker 0>be able to run this proxy. Now we

00:42:18.630 --> 00:42:19.829
<v Speaker 0>format is annoying.

00:42:20.470 --> 00:42:22.070
<v Speaker 0>We saved this command

00:42:22.230 --> 00:42:22.869
<v Speaker 0>and

00:42:23.670 --> 00:42:25.510
<v Speaker 0>a local file, didn't we?

00:42:26.390 --> 00:42:29.269
<v Speaker 0>Yep. Create DB proxy. So let's fill this

00:42:29.269 --> 00:42:29.829
<v Speaker 0>out.

00:42:30.390 --> 00:42:33.589
<v Speaker 0>So we have a token. We've got the

00:42:33.589 --> 00:42:33.910
<v Speaker 0>pen.

00:42:34.965 --> 00:42:37.205
<v Speaker 0>We call this my Postgres,

00:42:38.405 --> 00:42:39.845
<v Speaker 0>the protocol is

00:42:40.485 --> 00:42:41.365
<v Speaker 0>Postgres

00:42:41.605 --> 00:42:44.005
<v Speaker 0>and it is available on local host five

00:42:44.005 --> 00:42:45.205
<v Speaker 0>forty three.

00:42:45.365 --> 00:42:45.845
<v Speaker 0>Sure.

00:42:46.725 --> 00:42:48.485
<v Speaker 0>We can make this executable

00:42:48.565 --> 00:42:49.445
<v Speaker 0>and away we go.

00:42:51.200 --> 00:42:53.599
<v Speaker 0>So we can see here that is joining

00:42:53.599 --> 00:42:55.200
<v Speaker 0>our secure cluster.

00:42:56.559 --> 00:42:58.400
<v Speaker 0>Things are working. It seems to be happy

00:42:58.400 --> 00:43:01.040
<v Speaker 0>and the database service has been successfully started.

00:43:01.359 --> 00:43:03.760
<v Speaker 0>So let's pop open one more terminal

00:43:03.825 --> 00:43:05.825
<v Speaker 0>and get back to where we were.

00:43:06.224 --> 00:43:06.785
<v Speaker 0>Perfect.

00:43:08.145 --> 00:43:10.225
<v Speaker 0>I should still have my status.

00:43:12.305 --> 00:43:14.065
<v Speaker 0>While this is done is because we've had

00:43:14.065 --> 00:43:16.224
<v Speaker 0>this database proxy run on the machine and

00:43:16.224 --> 00:43:18.180
<v Speaker 0>register itself is that we're now in a

00:43:18.180 --> 00:43:20.260
<v Speaker 0>position where if we pop over to databases,

00:43:20.900 --> 00:43:22.660
<v Speaker 0>we will see that we have a self

00:43:22.660 --> 00:43:25.140
<v Speaker 0>hosted post GRES cluster

00:43:25.300 --> 00:43:27.220
<v Speaker 0>and click connect, that gives you all the

00:43:27.220 --> 00:43:28.500
<v Speaker 0>commands that you need to be able to

00:43:28.500 --> 00:43:29.700
<v Speaker 0>try and interact with this.

00:43:31.825 --> 00:43:34.145
<v Speaker 0>Yeah, and there's some documentation for the GUI

00:43:34.145 --> 00:43:35.265
<v Speaker 0>stuff, but I'll show you that in a

00:43:35.265 --> 00:43:35.745
<v Speaker 0>minute.

00:43:36.705 --> 00:43:38.785
<v Speaker 0>So we have our app proxy.

00:43:39.905 --> 00:43:40.385
<v Speaker 0>Done.

00:43:43.025 --> 00:43:45.105
<v Speaker 0>Now we want to list the available databases.

00:43:45.730 --> 00:43:48.210
<v Speaker 0>I already mentioned this command. You can run

00:43:48.210 --> 00:43:49.810
<v Speaker 0>DBLS,

00:43:49.890 --> 00:43:51.490
<v Speaker 0>so you can do everything from the command

00:43:51.490 --> 00:43:52.930
<v Speaker 0>line that we can do from the gray.

00:43:52.930 --> 00:43:54.930
<v Speaker 0>I can see here that I have a

00:43:54.930 --> 00:43:57.250
<v Speaker 0>Postgres, but I'm not connected to it. There's

00:43:57.250 --> 00:43:59.570
<v Speaker 0>no information here. I don't give a description

00:43:59.570 --> 00:44:02.015
<v Speaker 0>or label that same, but we're not connected.

00:44:02.015 --> 00:44:03.615
<v Speaker 0>And the next task as well,

00:44:04.415 --> 00:44:06.255
<v Speaker 0>log in and connect to it.

00:44:07.855 --> 00:44:09.775
<v Speaker 0>So we can do a TSH

00:44:09.775 --> 00:44:10.575
<v Speaker 0>DB

00:44:10.815 --> 00:44:12.495
<v Speaker 0>log in and then we look at the

00:44:12.495 --> 00:44:15.055
<v Speaker 0>parameters here. We have to tell the database,

00:44:15.055 --> 00:44:16.495
<v Speaker 0>which will just be Postgres for me.

00:44:17.160 --> 00:44:18.760
<v Speaker 0>But when we log in, we can also

00:44:18.760 --> 00:44:22.200
<v Speaker 0>specify the database user and database name

00:44:22.920 --> 00:44:24.680
<v Speaker 0>that we wanna be able to access through

00:44:24.680 --> 00:44:26.760
<v Speaker 0>that session. So we can do a TSH

00:44:26.760 --> 00:44:30.280
<v Speaker 0>DB login DB user, Postgres

00:44:30.280 --> 00:44:31.000
<v Speaker 0>DB

00:44:31.494 --> 00:44:32.375
<v Speaker 0>name,

00:44:32.375 --> 00:44:33.335
<v Speaker 0>Postgres.

00:44:33.974 --> 00:44:34.855
<v Speaker 0>Like so.

00:44:35.335 --> 00:44:37.335
<v Speaker 0>And Postgres is the DB name.

00:44:39.734 --> 00:44:40.855
<v Speaker 0>Let's see if that works.

00:44:47.849 --> 00:44:50.570
<v Speaker 0>Our connection information for database Postgres has been

00:44:50.570 --> 00:44:51.130
<v Speaker 0>saved.

00:44:51.770 --> 00:44:53.370
<v Speaker 0>So let's try

00:44:53.530 --> 00:44:55.210
<v Speaker 0>connect Postgres

00:44:55.290 --> 00:44:56.170
<v Speaker 0>like it suggests.

00:45:04.155 --> 00:45:06.075
<v Speaker 0>And we get access denied.

00:45:07.115 --> 00:45:08.555
<v Speaker 0>So this is how

00:45:08.954 --> 00:45:10.155
<v Speaker 0>I discovered

00:45:10.155 --> 00:45:11.595
<v Speaker 0>that your roles

00:45:11.755 --> 00:45:13.275
<v Speaker 0>yeah. You need to say no and load

00:45:13.275 --> 00:45:14.315
<v Speaker 0>back in for your roles.

00:45:14.880 --> 00:45:16.560
<v Speaker 0>And the way that I discovered that,

00:45:17.359 --> 00:45:19.599
<v Speaker 0>there's nothing in the logs here.

00:45:20.319 --> 00:45:21.599
<v Speaker 0>I enabled

00:45:22.400 --> 00:45:25.119
<v Speaker 0>session logging on Postgres. I wasn't seeing any

00:45:25.119 --> 00:45:26.400
<v Speaker 0>connection. I was

00:45:26.735 --> 00:45:28.655
<v Speaker 0>pulling my hair out mad,

00:45:29.375 --> 00:45:30.975
<v Speaker 0>but there's a command.

00:45:31.295 --> 00:45:32.975
<v Speaker 0>We can add a flag

00:45:34.015 --> 00:45:34.975
<v Speaker 0>debug

00:45:35.215 --> 00:45:36.975
<v Speaker 0>to our proxy and we're gonna get a

00:45:36.975 --> 00:45:39.855
<v Speaker 0>whole lot more logs. Hopefully nothing

00:45:40.500 --> 00:45:41.780
<v Speaker 0>scary that I should be sharing with the

00:45:41.780 --> 00:45:42.340
<v Speaker 0>world.

00:45:42.980 --> 00:45:44.740
<v Speaker 0>But if we run this again, we'll see

00:45:44.740 --> 00:45:47.140
<v Speaker 0>the exact error message that finally

00:45:47.300 --> 00:45:48.820
<v Speaker 0>led me to work out what the hell

00:45:48.820 --> 00:45:49.700
<v Speaker 0>is going on.

00:45:50.500 --> 00:45:51.940
<v Speaker 0>Let's try that connect again.

00:45:57.385 --> 00:45:58.425
<v Speaker 0>There we go.

00:46:00.105 --> 00:46:02.185
<v Speaker 0>That is the culprit there.

00:46:02.425 --> 00:46:04.905
<v Speaker 0>So access to DB Postgres denied,

00:46:05.305 --> 00:46:08.770
<v Speaker 0>no allow rule matched, rule access matches, rule

00:46:08.770 --> 00:46:09.970
<v Speaker 0>editor matches,

00:46:09.970 --> 00:46:11.490
<v Speaker 0>rule other matches,

00:46:11.490 --> 00:46:14.050
<v Speaker 0>rule default matches, no role DB.

00:46:14.130 --> 00:46:15.810
<v Speaker 0>And that's when I finally clicked.

00:46:16.530 --> 00:46:18.530
<v Speaker 0>The frustrating thing about that is I didn't

00:46:18.530 --> 00:46:21.970
<v Speaker 0>really get that information from the activity thing.

00:46:21.970 --> 00:46:23.255
<v Speaker 0>So we come to the auto log. You

00:46:23.255 --> 00:46:25.255
<v Speaker 0>can actually see when people are trying to

00:46:25.255 --> 00:46:27.895
<v Speaker 0>use your databases to Teleport. Again, very, very

00:46:27.895 --> 00:46:28.375
<v Speaker 0>cool.

00:46:29.415 --> 00:46:30.135
<v Speaker 0>To me,

00:46:30.535 --> 00:46:32.455
<v Speaker 0>it just looks like it's a Postgres that

00:46:32.455 --> 00:46:34.055
<v Speaker 0>are denying me. And I was jumping through

00:46:34.055 --> 00:46:35.895
<v Speaker 0>lots of hoops of Postgres and checking that

00:46:35.895 --> 00:46:38.740
<v Speaker 0>host SSL and the HBA configuration and all

00:46:38.740 --> 00:46:40.579
<v Speaker 0>this stuff. And all you need to do

00:46:40.579 --> 00:46:43.300
<v Speaker 0>is log out. That's it. So

00:46:44.260 --> 00:46:46.260
<v Speaker 0>we'll just leave that in debug mode, not

00:46:46.260 --> 00:46:47.220
<v Speaker 0>the underworld.

00:46:47.460 --> 00:46:48.580
<v Speaker 0>We'll log out.

00:46:49.700 --> 00:46:50.900
<v Speaker 0>We will log in,

00:46:52.395 --> 00:46:53.515
<v Speaker 0>proxy,

00:46:55.275 --> 00:46:56.155
<v Speaker 0>Rawkode

00:46:56.155 --> 00:46:57.115
<v Speaker 0>Teleport,

00:46:57.195 --> 00:46:59.595
<v Speaker 0>SH four four three user.

00:47:04.809 --> 00:47:05.690
<v Speaker 0>And

00:47:06.650 --> 00:47:07.609
<v Speaker 0>Teleport

00:47:07.609 --> 00:47:08.490
<v Speaker 0>Cloud.

00:47:08.490 --> 00:47:11.130
<v Speaker 0>Password.

00:47:13.369 --> 00:47:13.609
<v Speaker 0>OTP.

00:47:22.215 --> 00:47:25.575
<v Speaker 0>And now you'll see we have our database

00:47:25.575 --> 00:47:26.935
<v Speaker 0>role available.

00:47:27.495 --> 00:47:29.255
<v Speaker 0>And that just means that if I do

00:47:29.255 --> 00:47:31.895
<v Speaker 0>a connect to Postgres, we should land an

00:47:31.895 --> 00:47:33.335
<v Speaker 0>AP SQL prompt.

00:47:46.845 --> 00:47:48.285
<v Speaker 0>Hey, that's

00:47:48.285 --> 00:47:49.005
<v Speaker 0>all right.

00:47:50.765 --> 00:47:52.285
<v Speaker 0>So the problem is

00:47:53.645 --> 00:47:55.085
<v Speaker 0>I need to log in again.

00:48:01.460 --> 00:48:02.740
<v Speaker 0>I

00:48:03.539 --> 00:48:05.140
<v Speaker 0>guess it's telling me I can use the

00:48:05.140 --> 00:48:07.540
<v Speaker 0>DB Gazerna Connect, but I'm pretty sure

00:48:09.859 --> 00:48:12.339
<v Speaker 0>that should do it. So when I logged

00:48:12.339 --> 00:48:14.465
<v Speaker 0>out of TSH and logged back in, I

00:48:14.465 --> 00:48:16.705
<v Speaker 0>think what happened is the TSH DB connect

00:48:16.705 --> 00:48:17.425
<v Speaker 0>was

00:48:19.105 --> 00:48:20.865
<v Speaker 0>I think it did a login for me,

00:48:20.865 --> 00:48:23.025
<v Speaker 0>but without the DB user and DB

00:48:23.425 --> 00:48:24.705
<v Speaker 0>name parameters.

00:48:26.625 --> 00:48:28.945
<v Speaker 0>So let's try

00:48:28.390 --> 00:48:30.310
<v Speaker 0>and see if that changes anything here.

00:48:31.990 --> 00:48:33.750
<v Speaker 0>Yeah. So you can see now when I

00:48:33.750 --> 00:48:35.990
<v Speaker 0>do the list, I don't know the connect

00:48:35.990 --> 00:48:37.430
<v Speaker 0>would do the login for me. There you

00:48:37.430 --> 00:48:39.430
<v Speaker 0>go. We can see that we've now configured

00:48:39.430 --> 00:48:41.505
<v Speaker 0>it as Postgres Postgres. So I should be

00:48:41.505 --> 00:48:43.025
<v Speaker 0>able to just do connect now and it

00:48:43.025 --> 00:48:45.425
<v Speaker 0>should just work without any additional parameters.

00:48:50.944 --> 00:48:53.664
<v Speaker 0>It's doing the dance. There we go. And

00:48:53.664 --> 00:48:55.105
<v Speaker 0>we now have access to Postgres

00:48:55.539 --> 00:48:56.820
<v Speaker 0>through Teleport.

00:48:57.539 --> 00:48:58.339
<v Speaker 0>Awesome.

00:48:59.539 --> 00:49:00.500
<v Speaker 0>That's cool.

00:49:02.099 --> 00:49:04.099
<v Speaker 0>So a couple of questions from Moz there.

00:49:04.099 --> 00:49:04.820
<v Speaker 0>I missed

00:49:06.579 --> 00:49:08.740
<v Speaker 0>did you enable the DB proxies to use

00:49:08.819 --> 00:49:11.595
<v Speaker 0>SSL to connect with the Postgres DB? The

00:49:11.595 --> 00:49:12.715
<v Speaker 0>proxy only

00:49:12.715 --> 00:49:15.675
<v Speaker 0>will communicate through TLS mutual authentication.

00:49:15.675 --> 00:49:17.915
<v Speaker 0>So it doesn't need to configure it. It's

00:49:17.915 --> 00:49:19.355
<v Speaker 0>just the way that it works.

00:49:19.675 --> 00:49:20.715
<v Speaker 0>The commands

00:49:20.955 --> 00:49:22.875
<v Speaker 0>that we use

00:49:23.515 --> 00:49:25.195
<v Speaker 0>Yeah. You don't need to configure that. It

00:49:25.195 --> 00:49:25.595
<v Speaker 0>just works.

00:49:27.270 --> 00:49:28.390
<v Speaker 0>Where's my mess?

00:49:29.750 --> 00:49:31.510
<v Speaker 0>And most tell me, yes, I will have

00:49:31.510 --> 00:49:32.870
<v Speaker 0>to log in again. Yep.

00:49:33.910 --> 00:49:35.990
<v Speaker 0>Cool that the connect does do

00:49:36.390 --> 00:49:37.110
<v Speaker 0>the

00:49:38.070 --> 00:49:40.150
<v Speaker 0>login for you. So I guess it's probably

00:49:40.150 --> 00:49:43.430
<v Speaker 0>just a bit easier to do connect

00:49:42.345 --> 00:49:43.865
<v Speaker 0>DB user,

00:49:43.865 --> 00:49:44.745
<v Speaker 0>blah, blah, blah.

00:49:47.145 --> 00:49:49.385
<v Speaker 0>Yeah, log in first. Be nice and explicit.

00:49:51.305 --> 00:49:53.545
<v Speaker 0>All right, we've got ten minutes left. Let's

00:49:53.545 --> 00:49:54.744
<v Speaker 0>take a look at our audit log.

00:49:58.170 --> 00:50:01.050
<v Speaker 0>We have our database session ended.

00:50:01.130 --> 00:50:02.810
<v Speaker 0>Look at this, is this not just the

00:50:02.810 --> 00:50:05.690
<v Speaker 0>coolest thing ever, right? Our database session was

00:50:05.690 --> 00:50:06.410
<v Speaker 0>started.

00:50:06.570 --> 00:50:08.410
<v Speaker 0>So we can see what time I started

00:50:08.410 --> 00:50:09.290
<v Speaker 0>my session,

00:50:09.690 --> 00:50:10.490
<v Speaker 0>the user,

00:50:11.565 --> 00:50:13.645
<v Speaker 0>we can pop open the queries.

00:50:13.645 --> 00:50:15.565
<v Speaker 0>So, you know, I could hook, I would

00:50:15.565 --> 00:50:17.165
<v Speaker 0>love to hook all of this up to

00:50:17.165 --> 00:50:18.365
<v Speaker 0>influx DB,

00:50:18.525 --> 00:50:20.285
<v Speaker 0>low key, and just

00:50:20.525 --> 00:50:22.445
<v Speaker 0>analyze queries and see what's going on.

00:50:24.050 --> 00:50:25.810
<v Speaker 0>It's just practical.

00:50:25.970 --> 00:50:27.490
<v Speaker 0>And we can see that I ran a

00:50:27.490 --> 00:50:29.730
<v Speaker 0>select from the catalog, although I used the

00:50:29.730 --> 00:50:30.530
<v Speaker 0>alias

00:50:30.690 --> 00:50:31.890
<v Speaker 0>backslash L.

00:50:35.090 --> 00:50:36.450
<v Speaker 0>What does it upload the session?

00:50:39.355 --> 00:50:40.795
<v Speaker 0>I don't think so.

00:50:42.395 --> 00:50:44.875
<v Speaker 0>Record the session has been uploaded.

00:50:46.954 --> 00:50:49.595
<v Speaker 0>Oh, yeah. Okay. So something Teleport Cloud does

00:50:49.595 --> 00:50:51.515
<v Speaker 0>is work through a session recording to Amazon

00:50:51.515 --> 00:50:52.234
<v Speaker 0>s three

00:50:53.450 --> 00:50:54.250
<v Speaker 0>for you.

00:50:56.490 --> 00:50:59.130
<v Speaker 0>Don't know why it doesn't show here.

00:50:58.970 --> 00:51:01.369
<v Speaker 0>Wonder if there's a small delay on picking

00:51:01.369 --> 00:51:03.210
<v Speaker 0>that up. Not a big deal. But I'm

00:51:03.210 --> 00:51:04.809
<v Speaker 0>assuming I can replay that, which is nice.

00:51:04.809 --> 00:51:05.369
<v Speaker 0>I didn't know that.

00:51:06.645 --> 00:51:08.885
<v Speaker 0>So we'll come back here and

00:51:08.885 --> 00:51:11.445
<v Speaker 0>we got two tasks to finish just to

00:51:11.445 --> 00:51:13.045
<v Speaker 0>end this with a bit of fun.

00:51:13.445 --> 00:51:15.205
<v Speaker 0>So we logged in,

00:51:15.445 --> 00:51:18.405
<v Speaker 0>command is there. We connected, command is there.

00:51:20.049 --> 00:51:21.170
<v Speaker 0>There's a really

00:51:21.970 --> 00:51:23.730
<v Speaker 0>cool thing you can use instead of using

00:51:23.730 --> 00:51:25.490
<v Speaker 0>a DB login and connect, you can actually

00:51:25.490 --> 00:51:27.010
<v Speaker 0>ask for a config, which will allow you

00:51:27.010 --> 00:51:28.450
<v Speaker 0>to use the native tooling.

00:51:29.089 --> 00:51:31.410
<v Speaker 0>So we can do DB

00:51:31.890 --> 00:51:33.329
<v Speaker 0>config postgres.

00:51:36.785 --> 00:51:41.345
<v Speaker 0>I'm

00:51:41.345 --> 00:51:42.625
<v Speaker 0>sure there was another

00:51:43.664 --> 00:51:45.105
<v Speaker 0>thing you could do.

00:51:46.785 --> 00:51:47.905
<v Speaker 0>Yeah. Env.

00:51:48.065 --> 00:51:48.704
<v Speaker 0>There we go.

00:51:50.470 --> 00:51:52.710
<v Speaker 0>This will actually drop out something I can

00:51:52.710 --> 00:51:54.790
<v Speaker 0>then evaluate in my shell and get a

00:51:54.790 --> 00:51:57.190
<v Speaker 0>whole bunch of the PSQL things that I

00:51:57.190 --> 00:51:58.070
<v Speaker 0>need to connect.

00:51:59.110 --> 00:52:01.510
<v Speaker 0>So let's try it that way. That's not

00:52:01.510 --> 00:52:02.390
<v Speaker 0>in my

00:52:03.335 --> 00:52:04.934
<v Speaker 0>gate, but I'm gonna add it because it's

00:52:04.934 --> 00:52:05.655
<v Speaker 0>too cool.

00:52:06.055 --> 00:52:07.415
<v Speaker 0>So let's do

00:52:12.855 --> 00:52:14.615
<v Speaker 0>pb env equals

00:52:14.615 --> 00:52:15.494
<v Speaker 0>to res

00:52:16.214 --> 00:52:16.775
<v Speaker 0>eval.

00:52:18.270 --> 00:52:19.630
<v Speaker 0>Make sure that worked.

00:52:21.310 --> 00:52:22.030
<v Speaker 0>Mhmm.

00:52:22.190 --> 00:52:23.710
<v Speaker 0>So I just did that.

00:52:25.710 --> 00:52:27.470
<v Speaker 0>Yeah. See, it's going through. We can see

00:52:27.470 --> 00:52:29.230
<v Speaker 0>the logs that's set in the proxy.

00:52:29.950 --> 00:52:30.670
<v Speaker 0>And there I am.

00:52:32.105 --> 00:52:34.825
<v Speaker 0>It's an SSL connection. So typically when I

00:52:34.825 --> 00:52:36.345
<v Speaker 0>would run PSQL,

00:52:36.345 --> 00:52:38.505
<v Speaker 0>that's just gonna use the daemon approach

00:52:38.984 --> 00:52:41.224
<v Speaker 0>and log in. But the fact that we

00:52:41.224 --> 00:52:42.905
<v Speaker 0>can do the DBN and go through the

00:52:42.905 --> 00:52:44.905
<v Speaker 0>secure way, which is also recorded, that's really

00:52:44.905 --> 00:52:48.480
<v Speaker 0>cool. So as a Postgres operator administrator,

00:52:48.480 --> 00:52:49.200
<v Speaker 0>I would

00:52:49.600 --> 00:52:51.040
<v Speaker 0>blanket just block

00:52:51.280 --> 00:52:51.920
<v Speaker 0>any

00:52:53.280 --> 00:52:56.160
<v Speaker 0>access that rely on our proxy

00:52:56.560 --> 00:52:57.920
<v Speaker 0>and set authentication.

00:52:58.160 --> 00:52:59.920
<v Speaker 0>That's awesome. I love that too.

00:53:03.065 --> 00:53:04.425
<v Speaker 0>So, Mozz

00:53:04.425 --> 00:53:05.225
<v Speaker 0>asked,

00:53:06.184 --> 00:53:08.025
<v Speaker 0>would I please share some details on how

00:53:08.025 --> 00:53:10.105
<v Speaker 0>to enable session recording on Teleport eight? You

00:53:10.105 --> 00:53:11.705
<v Speaker 0>tried just to do it, it wasn't working.

00:53:11.865 --> 00:53:13.785
<v Speaker 0>Feel free to post the error message that

00:53:13.785 --> 00:53:16.184
<v Speaker 0>you got into the Discord channel. I'll be

00:53:16.184 --> 00:53:18.130
<v Speaker 0>sure to take a look at it. And

00:53:18.130 --> 00:53:19.970
<v Speaker 0>I'll do some tests tomorrow as well and

00:53:19.970 --> 00:53:21.330
<v Speaker 0>make sure it's still working for me. I

00:53:21.330 --> 00:53:24.130
<v Speaker 0>didn't notice any problems on my local setup,

00:53:24.850 --> 00:53:26.850
<v Speaker 0>but we'll work it out. Just drop it

00:53:26.850 --> 00:53:29.010
<v Speaker 0>into the Discord and I'll get you some

00:53:29.010 --> 00:53:29.250
<v Speaker 0>help.

00:53:30.795 --> 00:53:32.714
<v Speaker 0>Alright. So, what about the GUI? So, I'm

00:53:32.714 --> 00:53:33.995
<v Speaker 0>gonna jump onto

00:53:34.714 --> 00:53:36.155
<v Speaker 0>my local machine.

00:53:37.915 --> 00:53:39.515
<v Speaker 0>I don't have the rule.

00:53:39.835 --> 00:53:41.675
<v Speaker 0>I'm gonna have to log out.

00:53:43.275 --> 00:53:43.755
<v Speaker 0>Again,

00:53:47.280 --> 00:53:48.560
<v Speaker 0>Password again.

00:53:52.960 --> 00:53:53.440
<v Speaker 0>OTP.

00:53:58.395 --> 00:54:00.475
<v Speaker 0>So this is cool. And as I send

00:54:00.475 --> 00:54:02.235
<v Speaker 0>the answer here, but you can use the

00:54:02.235 --> 00:54:03.435
<v Speaker 0>proxy command

00:54:04.635 --> 00:54:05.755
<v Speaker 0>to get a

00:54:07.115 --> 00:54:08.235
<v Speaker 0>Oh, wow.

00:54:08.795 --> 00:54:09.355
<v Speaker 0>There we go.

00:54:11.289 --> 00:54:12.089
<v Speaker 0>Teleport

00:54:12.089 --> 00:54:13.609
<v Speaker 0>is watching. Hey, Teleport.

00:54:15.049 --> 00:54:16.329
<v Speaker 0>Teleport says,

00:54:16.329 --> 00:54:18.250
<v Speaker 0>you may want to check the RBAC for

00:54:18.250 --> 00:54:19.050
<v Speaker 0>access.

00:54:21.289 --> 00:54:22.009
<v Speaker 0>Yeah. So

00:54:25.765 --> 00:54:27.925
<v Speaker 0>Moz, I believe that's the relation

00:54:28.165 --> 00:54:29.205
<v Speaker 0>to your question.

00:54:29.685 --> 00:54:30.645
<v Speaker 0>Okay. So,

00:54:30.965 --> 00:54:33.365
<v Speaker 0>got a few minutes left. So we wanna

00:54:33.365 --> 00:54:36.325
<v Speaker 0>use the GUI. So there is a TSH

00:54:36.325 --> 00:54:37.525
<v Speaker 0>proxy command

00:54:38.360 --> 00:54:40.360
<v Speaker 0>where we can run a proxy to the

00:54:40.360 --> 00:54:41.080
<v Speaker 0>DB

00:54:41.800 --> 00:54:43.160
<v Speaker 0>and to Postgres.

00:54:43.240 --> 00:54:46.280
<v Speaker 0>And that's just I didn't log in. Didn't

00:54:46.280 --> 00:54:47.640
<v Speaker 0>log in, not this thing.

00:54:48.440 --> 00:54:50.840
<v Speaker 0>Log in Postgres DB

00:54:51.494 --> 00:54:52.295
<v Speaker 0>user

00:54:52.295 --> 00:54:55.015
<v Speaker 0>Postgres DB name Postgres.

00:55:01.255 --> 00:55:03.575
<v Speaker 0>I guess this has to go

00:55:04.370 --> 00:55:05.090
<v Speaker 0>yeah.

00:55:05.570 --> 00:55:07.170
<v Speaker 0>The database name on the end.

00:55:07.890 --> 00:55:09.170
<v Speaker 0>This should log me in and then I

00:55:09.170 --> 00:55:10.610
<v Speaker 0>should be able to create that proxy, which

00:55:10.610 --> 00:55:12.770
<v Speaker 0>will allow me to use a GUI client,

00:55:12.770 --> 00:55:13.730
<v Speaker 0>which, you know,

00:55:14.450 --> 00:55:15.890
<v Speaker 0>maybe a lot nicer

00:55:16.715 --> 00:55:19.355
<v Speaker 0>than learn how to PSQL command.

00:55:20.395 --> 00:55:21.915
<v Speaker 0>So it runs a proxy on a port

00:55:21.915 --> 00:55:23.995
<v Speaker 0>as port number changes every time. So you

00:55:23.995 --> 00:55:25.355
<v Speaker 0>do need to copy this.

00:55:27.915 --> 00:55:30.635
<v Speaker 0>I don't think Teleport have a Discord channel.

00:55:30.635 --> 00:55:31.435
<v Speaker 0>They have a Slack.

00:55:32.720 --> 00:55:35.440
<v Speaker 0>Sorry, Moz is in the comments. Can you

00:55:35.440 --> 00:55:38.720
<v Speaker 0>please share your So my Discord is Rawkode.chat

00:55:38.720 --> 00:55:43.680
<v Speaker 0>and the Teleport Slack, I believe is goteleport.com/slack.

00:55:45.915 --> 00:55:47.435
<v Speaker 0>Yeah, there we go. Was trying to log

00:55:47.435 --> 00:55:50.555
<v Speaker 0>me in, but yeah, so goteleport.com/slack

00:55:50.555 --> 00:55:52.555
<v Speaker 0>and lots of really helpful people in there

00:55:52.555 --> 00:55:53.275
<v Speaker 0>as well.

00:55:54.715 --> 00:55:57.995
<v Speaker 0>Okay, so we've ran our TSH DB proxy

00:55:57.995 --> 00:56:00.620
<v Speaker 0>postgres. We've got this port number and IP

00:56:00.620 --> 00:56:02.780
<v Speaker 0>address, just local host, and then we've got

00:56:02.780 --> 00:56:04.220
<v Speaker 0>a whole bunch of files that we can

00:56:04.220 --> 00:56:05.900
<v Speaker 0>configure with our client.

00:56:06.300 --> 00:56:08.620
<v Speaker 0>So far today, I'm gonna use Beekeeper studio.

00:56:09.900 --> 00:56:11.180
<v Speaker 0>I thought it looked good.

00:56:11.580 --> 00:56:13.260
<v Speaker 0>That was my reason for picking it. I

00:56:13.260 --> 00:56:14.780
<v Speaker 0>thought it was the nicest looking of the

00:56:14.780 --> 00:56:16.140
<v Speaker 0>clients I was playing with earlier.

00:56:16.835 --> 00:56:18.755
<v Speaker 0>So we're gonna connect to Postgres,

00:56:20.035 --> 00:56:21.155
<v Speaker 0>local host.

00:56:21.234 --> 00:56:23.075
<v Speaker 0>We drop the port and

00:56:26.194 --> 00:56:28.515
<v Speaker 0>Oh, it's not letting on the thing, but

00:56:28.515 --> 00:56:31.440
<v Speaker 0>there we go. Five, was it 55544?

00:56:31.440 --> 00:56:33.120
<v Speaker 0>Yeah, 55544.

00:56:33.440 --> 00:56:34.720
<v Speaker 0>We have to enable

00:56:34.960 --> 00:56:36.320
<v Speaker 0>SSL and

00:56:36.880 --> 00:56:39.360
<v Speaker 0>then we can hook up these files.

00:56:39.520 --> 00:56:42.000
<v Speaker 0>So we need our CA cert,

00:56:44.545 --> 00:56:46.785
<v Speaker 0>which is certs. Pen,

00:56:47.025 --> 00:56:48.305
<v Speaker 0>our certificate,

00:56:48.465 --> 00:56:49.825
<v Speaker 0>which is, you know, I'm just reading this

00:56:49.825 --> 00:56:51.345
<v Speaker 0>from this line on the bottom of my

00:56:51.345 --> 00:56:52.865
<v Speaker 0>terminal here. The certificate

00:56:52.945 --> 00:56:55.185
<v Speaker 0>is the Postgres X509,

00:56:56.225 --> 00:56:57.425
<v Speaker 0>which is in this directory.

00:56:59.540 --> 00:57:01.460
<v Speaker 0>And we need the key file, which is

00:57:01.460 --> 00:57:02.500
<v Speaker 0>just my

00:57:02.660 --> 00:57:04.900
<v Speaker 0>x five one nine identity key.

00:57:05.060 --> 00:57:06.500
<v Speaker 0>So that will be here.

00:57:09.380 --> 00:57:12.100
<v Speaker 0>And we're going to connect as Postgres.

00:57:12.924 --> 00:57:14.525
<v Speaker 0>We don't need the password

00:57:14.684 --> 00:57:16.205
<v Speaker 0>to the Postgres

00:57:16.285 --> 00:57:17.165
<v Speaker 0>database.

00:57:18.045 --> 00:57:19.085
<v Speaker 0>Attest.

00:57:20.605 --> 00:57:21.805
<v Speaker 0>Moment of truth.

00:57:22.924 --> 00:57:25.085
<v Speaker 0>Longer is better, right? I mean,

00:57:25.990 --> 00:57:27.910
<v Speaker 0>yeah, that's worked. And

00:57:28.390 --> 00:57:29.430
<v Speaker 0>we hit connect.

00:57:35.910 --> 00:57:36.630
<v Speaker 0>Look at that.

00:57:37.775 --> 00:57:38.655
<v Speaker 0>We're in.

00:57:39.055 --> 00:57:41.055
<v Speaker 0>We can see on the left, it's finding

00:57:41.055 --> 00:57:43.135
<v Speaker 0>tables. We'll give that just a few seconds.

00:57:43.135 --> 00:57:44.735
<v Speaker 0>We've got the query where I can type

00:57:44.735 --> 00:57:45.695
<v Speaker 0>something here.

00:57:46.015 --> 00:57:47.935
<v Speaker 0>You know, can just select star

00:57:48.095 --> 00:57:48.815
<v Speaker 0>from

00:57:49.775 --> 00:57:50.735
<v Speaker 0>information

00:57:50.735 --> 00:57:51.615
<v Speaker 0>schema.

00:57:51.695 --> 00:57:52.095
<v Speaker 0>Nope.

00:57:53.460 --> 00:57:55.460
<v Speaker 0>That's my all complete. I can't do this

00:57:55.460 --> 00:57:56.180
<v Speaker 0>on my own.

00:57:58.500 --> 00:57:59.780
<v Speaker 0>P g

00:58:01.140 --> 00:58:02.260
<v Speaker 0>catalog.

00:58:02.500 --> 00:58:03.220
<v Speaker 0>I

00:58:04.020 --> 00:58:04.660
<v Speaker 0>can't remember.

00:58:06.605 --> 00:58:08.205
<v Speaker 0>Maybe that's pulling out

00:58:08.525 --> 00:58:11.805
<v Speaker 0>millions of stuff. Let's cancel. Oh no, wasn't

00:58:11.805 --> 00:58:14.925
<v Speaker 0>too bad. But we can just pop around

00:58:14.925 --> 00:58:16.125
<v Speaker 0>and take a look

00:58:16.765 --> 00:58:17.565
<v Speaker 0>at the schema.

00:58:18.279 --> 00:58:19.880
<v Speaker 0>I thought that was really cool. I haven't

00:58:19.880 --> 00:58:21.480
<v Speaker 0>used this client an awful lot, but I

00:58:21.480 --> 00:58:23.319
<v Speaker 0>thought it was a nice looking native black

00:58:23.319 --> 00:58:24.599
<v Speaker 0>client. So that's what we went with for

00:58:24.599 --> 00:58:25.240
<v Speaker 0>today.

00:58:25.480 --> 00:58:27.800
<v Speaker 0>I'm gonna close that. I'm gonna close this

00:58:28.680 --> 00:58:29.480
<v Speaker 0>and this

00:58:30.485 --> 00:58:32.165
<v Speaker 0>head back to here. And we have completed

00:58:32.165 --> 00:58:34.725
<v Speaker 0>all the tasks in today's workshop with a

00:58:34.725 --> 00:58:35.365
<v Speaker 0>record

00:58:35.845 --> 00:58:38.485
<v Speaker 0>just under two minutes left to go. I'm

00:58:38.485 --> 00:58:39.685
<v Speaker 0>gonna pop back over

00:58:40.005 --> 00:58:42.405
<v Speaker 0>here. If you have any questions, drop them

00:58:42.405 --> 00:58:45.020
<v Speaker 0>into the chat and I'll tackle them before

00:58:45.020 --> 00:58:46.700
<v Speaker 0>we wrap up for today's session.

00:58:47.340 --> 00:58:48.860
<v Speaker 0>But we'll be back on

00:58:49.180 --> 00:58:50.060
<v Speaker 0>Monday

00:58:50.140 --> 00:58:51.660
<v Speaker 0>at 12:30

00:58:52.060 --> 00:58:53.340
<v Speaker 0>UTC,

00:58:55.180 --> 00:58:56.380
<v Speaker 0>where we are doing

00:58:56.540 --> 00:58:57.340
<v Speaker 0>MongoDB.

00:58:59.565 --> 00:59:01.405
<v Speaker 0>Let me take a look at my channel.

00:59:03.484 --> 00:59:06.605
<v Speaker 0>Oh, no. Monday is deploying Teleport on Kubernetes.

00:59:06.925 --> 00:59:09.165
<v Speaker 0>There we go. And then next this time

00:59:09.165 --> 00:59:10.365
<v Speaker 0>next week, we'll be doing MongoDB.

00:59:11.180 --> 00:59:13.020
<v Speaker 0>There we go. I may swap them. Just

00:59:13.020 --> 00:59:14.700
<v Speaker 0>so we're doing the database ones back to

00:59:14.700 --> 00:59:15.180
<v Speaker 0>back.

00:59:15.980 --> 00:59:17.420
<v Speaker 0>We'll do the Kubernetes one at the end

00:59:17.420 --> 00:59:19.260
<v Speaker 0>of week. We'll see. I'll think about it.

00:59:20.220 --> 00:59:23.020
<v Speaker 0>All right. So there haven't been any questions.

00:59:23.020 --> 00:59:25.180
<v Speaker 0>Ma says, this is awesome. You're right. This

00:59:25.180 --> 00:59:27.435
<v Speaker 0>is a really cool feature. I love to

00:59:27.435 --> 00:59:28.555
<v Speaker 0>do the best access.

00:59:28.715 --> 00:59:31.195
<v Speaker 0>I love as I was typing Teleport commands

00:59:31.195 --> 00:59:33.115
<v Speaker 0>that the output was then guiding me on

00:59:33.115 --> 00:59:35.275
<v Speaker 0>the next step and helping me get forward.

00:59:35.515 --> 00:59:37.595
<v Speaker 0>I like it when tools really just kind

00:59:37.595 --> 00:59:39.355
<v Speaker 0>of try to make good life easier. So

00:59:39.355 --> 00:59:41.275
<v Speaker 0>thanks and props to the Teleport team.

00:59:42.549 --> 00:59:44.309
<v Speaker 0>All right. Let's call that a wrap. Thanks

00:59:44.309 --> 00:59:46.309
<v Speaker 0>for joining me today. Some great questions. I

00:59:46.309 --> 00:59:47.829
<v Speaker 0>hope you like this feature. Let me know

00:59:47.829 --> 00:59:49.430
<v Speaker 0>how you get on and

00:59:49.510 --> 00:59:51.510
<v Speaker 0>have a wonderful weekend. Goodbye all.

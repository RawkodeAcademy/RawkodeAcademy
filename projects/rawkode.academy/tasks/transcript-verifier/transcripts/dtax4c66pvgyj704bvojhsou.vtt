WEBVTT

NOTE
Transcription provided by Deepgram
Request Id: ed90c182-e71a-4db6-b2c0-ab90b7b0642c
Created: 2025-04-29T16:57:52.983Z
Duration: 3672.3933
Channels: 1

00:00:38.765 --> 00:00:39.565
<v Speaker 0>Hello,

00:00:40.445 --> 00:00:43.885
<v Speaker 0>and welcome back to the Rawkode Academy.

00:00:44.765 --> 00:00:47.804
<v Speaker 0>We are continuing on with our complete guide

00:00:47.804 --> 00:00:50.204
<v Speaker 0>to Teleport course today.

00:00:53.210 --> 00:00:56.649
<v Speaker 0>Before we begin, I will caveat this with

00:00:57.050 --> 00:01:00.010
<v Speaker 0>this is my first stream on my M1

00:01:00.010 --> 00:01:04.010
<v Speaker 0>Mac. As such, if anything seems weird, please

00:01:04.010 --> 00:01:04.569
<v Speaker 0>let me know.

00:01:06.065 --> 00:01:07.905
<v Speaker 0>I think my audio is okay. I think

00:01:07.905 --> 00:01:09.665
<v Speaker 0>my video is okay. I think my scenes

00:01:09.665 --> 00:01:10.465
<v Speaker 0>are okay.

00:01:11.345 --> 00:01:12.865
<v Speaker 0>But feel free to jump into the chat

00:01:12.865 --> 00:01:14.225
<v Speaker 0>and say, hey, something's not right, and I

00:01:14.225 --> 00:01:15.665
<v Speaker 0>will do my best to fix it

00:01:15.985 --> 00:01:16.784
<v Speaker 0>because

00:01:16.785 --> 00:01:18.785
<v Speaker 0>we want this to sound and look as

00:01:18.785 --> 00:01:19.585
<v Speaker 0>good as possible.

00:01:21.820 --> 00:01:24.140
<v Speaker 0>Alright. So what is on the agenda for

00:01:24.140 --> 00:01:26.780
<v Speaker 0>today? Well, today, we are diving into

00:01:26.780 --> 00:01:29.580
<v Speaker 0>another workshop where we take a look at

00:01:29.580 --> 00:01:32.220
<v Speaker 0>running Teleport on top of Kubernetes.

00:01:32.700 --> 00:01:33.020
<v Speaker 0>There's

00:01:33.805 --> 00:01:35.884
<v Speaker 0>some weird things

00:01:35.965 --> 00:01:38.284
<v Speaker 0>to discover when working through this,

00:01:38.445 --> 00:01:40.524
<v Speaker 0>just that Helm charts are a little bit

00:01:40.524 --> 00:01:41.564
<v Speaker 0>difficult to find.

00:01:42.445 --> 00:01:44.125
<v Speaker 0>Some of them are deprecated, but it's not

00:01:44.125 --> 00:01:45.645
<v Speaker 0>obvious that they're deprecated.

00:01:45.804 --> 00:01:47.405
<v Speaker 0>And I'm gonna try and do my best

00:01:47.405 --> 00:01:49.500
<v Speaker 0>to just kinda walk you through this from

00:01:49.500 --> 00:01:50.380
<v Speaker 0>each step.

00:01:51.020 --> 00:01:53.659
<v Speaker 0>If we pop open my screen share,

00:01:54.460 --> 00:01:55.020
<v Speaker 0>we

00:01:56.299 --> 00:01:59.659
<v Speaker 0>have the new workshop pushed to the Rawkode

00:01:59.659 --> 00:02:00.460
<v Speaker 0>Academy

00:02:00.460 --> 00:02:02.939
<v Speaker 0>slash courses repository on github.com.

00:02:03.955 --> 00:02:07.235
<v Speaker 0>You will find a directory called eight kubernetes

00:02:07.235 --> 00:02:08.915
<v Speaker 0>with the README that we will be using

00:02:08.915 --> 00:02:11.475
<v Speaker 0>for today's session. So feel free to work

00:02:11.475 --> 00:02:12.195
<v Speaker 0>through this

00:02:12.675 --> 00:02:14.195
<v Speaker 0>and let me know how you get on.

00:02:14.835 --> 00:02:16.515
<v Speaker 0>Today's is a little bit different from the

00:02:16.515 --> 00:02:18.115
<v Speaker 0>other ones I've done. Normally, I try and

00:02:18.115 --> 00:02:19.640
<v Speaker 0>hide the answers. Today, I have to say

00:02:19.640 --> 00:02:21.480
<v Speaker 0>we just kind of leave them all here,

00:02:21.480 --> 00:02:23.000
<v Speaker 0>more of a follow along.

00:02:23.640 --> 00:02:25.239
<v Speaker 0>Let me know which format you prefer and

00:02:25.239 --> 00:02:27.320
<v Speaker 0>we'll tweak that for any future workshops.

00:02:29.000 --> 00:02:30.120
<v Speaker 0>The prerequisites

00:02:30.120 --> 00:02:32.280
<v Speaker 0>for today are obviously Kubernetes,

00:02:32.815 --> 00:02:34.495
<v Speaker 0>easiest thing in the world to deploy.

00:02:34.895 --> 00:02:36.655
<v Speaker 0>Everything we're doing today should

00:02:36.895 --> 00:02:38.415
<v Speaker 0>should work

00:02:38.415 --> 00:02:39.615
<v Speaker 0>on local

00:02:39.615 --> 00:02:42.255
<v Speaker 0>Kubernetes setups, but you will have to bear

00:02:42.255 --> 00:02:43.375
<v Speaker 0>in mind that

00:02:43.694 --> 00:02:44.895
<v Speaker 0>Teleport

00:02:44.975 --> 00:02:47.375
<v Speaker 0>really wants to be served over TLS.

00:02:48.300 --> 00:02:50.300
<v Speaker 0>So, really it wants a domain name,

00:02:50.620 --> 00:02:52.220
<v Speaker 0>and you may find you have to do

00:02:52.220 --> 00:02:53.980
<v Speaker 0>a few extra steps to get this to

00:02:53.980 --> 00:02:56.380
<v Speaker 0>work with Minikube or Kine or any other

00:02:56.540 --> 00:02:59.580
<v Speaker 0>Rancher desktop, Docker desktop, etcetera. So, for today

00:02:59.580 --> 00:03:00.860
<v Speaker 0>and to make my life a little bit

00:03:00.860 --> 00:03:01.420
<v Speaker 0>easier,

00:03:01.900 --> 00:03:02.780
<v Speaker 0>I am using

00:03:03.715 --> 00:03:06.915
<v Speaker 0>managed Kubernetes clusters. I have two on Cboe

00:03:06.915 --> 00:03:08.755
<v Speaker 0>and one on JKE.

00:03:09.635 --> 00:03:11.555
<v Speaker 0>And I'll explain why I've made the decision

00:03:11.555 --> 00:03:13.875
<v Speaker 0>with these two clusters, the three clusters,

00:03:14.034 --> 00:03:16.515
<v Speaker 0>as we work through the exercises for today's

00:03:16.515 --> 00:03:16.915
<v Speaker 0>workshop.

00:03:20.390 --> 00:03:21.110
<v Speaker 0>Okay.

00:03:23.270 --> 00:03:23.990
<v Speaker 0>So

00:03:25.190 --> 00:03:27.750
<v Speaker 0>we got we got people here.

00:03:29.670 --> 00:03:30.950
<v Speaker 0>Hello, Moz.

00:03:32.310 --> 00:03:33.190
<v Speaker 0>Hello, Russell.

00:03:33.685 --> 00:03:35.765
<v Speaker 0>Thank you for joining us.

00:03:36.805 --> 00:03:38.325
<v Speaker 0>If you missed the caveat at the start,

00:03:38.325 --> 00:03:40.005
<v Speaker 0>let me know if my audio was okay.

00:03:40.165 --> 00:03:41.845
<v Speaker 0>I'm on a new machine and I'm very

00:03:41.845 --> 00:03:43.525
<v Speaker 0>worried because the audio is always the first

00:03:43.525 --> 00:03:44.405
<v Speaker 0>thing to break.

00:03:45.525 --> 00:03:47.284
<v Speaker 0>Okay. So the first thing you have to

00:03:47.284 --> 00:03:48.805
<v Speaker 0>do when you want to deploy

00:03:49.200 --> 00:03:51.760
<v Speaker 0>Teleport to Kubernetes is just to say what

00:03:51.760 --> 00:03:53.280
<v Speaker 0>way you want to do it. Now, the

00:03:53.280 --> 00:03:55.840
<v Speaker 0>Teleport team do provide some Helm charts that

00:03:55.840 --> 00:03:57.680
<v Speaker 0>allow us to simplify this process.

00:03:58.000 --> 00:03:59.680
<v Speaker 0>So we're gonna run through those today.

00:04:01.885 --> 00:04:03.644
<v Speaker 0>For me, the first thing I had to

00:04:03.644 --> 00:04:05.245
<v Speaker 0>do was find the Helm charts.

00:04:05.724 --> 00:04:07.565
<v Speaker 0>What I would suggest is go into the

00:04:07.565 --> 00:04:09.245
<v Speaker 0>Teleport Teleport repository.

00:04:09.965 --> 00:04:12.205
<v Speaker 0>They're not gravitational.

00:04:12.284 --> 00:04:13.885
<v Speaker 0>Got that wrong already. Here we go.

00:04:15.280 --> 00:04:17.279
<v Speaker 0>They're not in the most obvious place. Typically,

00:04:17.279 --> 00:04:19.600
<v Speaker 0>projects in the cloud native space will have

00:04:19.600 --> 00:04:22.320
<v Speaker 0>just a deploy or a chart directory at

00:04:22.320 --> 00:04:24.560
<v Speaker 0>the top level. I mean, it's almost ubiquitous

00:04:24.560 --> 00:04:26.000
<v Speaker 0>now across most

00:04:26.479 --> 00:04:27.840
<v Speaker 0>Go projects at least.

00:04:28.639 --> 00:04:29.039
<v Speaker 0>However,

00:04:30.335 --> 00:04:34.015
<v Speaker 0>Teleports live under the examples repository.

00:04:34.095 --> 00:04:35.855
<v Speaker 0>And that seems to be their examples of

00:04:35.855 --> 00:04:38.975
<v Speaker 0>how to deploy Teleport rather than like their,

00:04:39.455 --> 00:04:41.935
<v Speaker 0>this is our production deployment, you can go

00:04:41.935 --> 00:04:43.935
<v Speaker 0>and just use it as you wish. It

00:04:43.935 --> 00:04:46.760
<v Speaker 0>feels like it's take it, maybe modify it,

00:04:46.760 --> 00:04:48.280
<v Speaker 0>and make it suit your own needs.

00:04:49.400 --> 00:04:50.920
<v Speaker 0>But we are gonna use them today. So

00:04:50.920 --> 00:04:52.840
<v Speaker 0>an example of ratio, we have chart,

00:04:53.160 --> 00:04:54.360
<v Speaker 0>and we have a whole bunch of things

00:04:54.360 --> 00:04:55.560
<v Speaker 0>here. Now,

00:04:55.880 --> 00:04:57.480
<v Speaker 0>most of these charts are deprecated,

00:04:57.884 --> 00:04:59.245
<v Speaker 0>but there's not really any way to know

00:04:59.245 --> 00:05:01.884
<v Speaker 0>that without looking into the actual chart dot

00:05:01.884 --> 00:05:02.605
<v Speaker 0>YAML,

00:05:02.685 --> 00:05:03.965
<v Speaker 0>where it will say

00:05:05.485 --> 00:05:06.845
<v Speaker 0>deprecated true

00:05:07.245 --> 00:05:07.965
<v Speaker 0>here.

00:05:08.845 --> 00:05:11.805
<v Speaker 0>So while there are a selection of charts

00:05:11.805 --> 00:05:12.205
<v Speaker 0>here,

00:05:13.370 --> 00:05:15.610
<v Speaker 0>only two of them are presently

00:05:16.009 --> 00:05:17.130
<v Speaker 0>doing anything.

00:05:20.889 --> 00:05:22.650
<v Speaker 0>I popped that out. We don't need

00:05:23.530 --> 00:05:23.770
<v Speaker 0>to.

00:05:25.225 --> 00:05:26.985
<v Speaker 0>So I've kind of broken it down in

00:05:26.985 --> 00:05:29.225
<v Speaker 0>this readme of what these charts are for.

00:05:29.305 --> 00:05:31.545
<v Speaker 0>So we have the Teleport cluster chart,

00:05:31.785 --> 00:05:33.785
<v Speaker 0>and that's just sets up your standard single

00:05:33.785 --> 00:05:36.985
<v Speaker 0>node Teleport cluster running on Kubernetes with a

00:05:36.985 --> 00:05:38.745
<v Speaker 0>local authentication back end

00:05:39.350 --> 00:05:42.470
<v Speaker 0>as opposed to OAuth, GitHub, SAML, etcetera,

00:05:43.030 --> 00:05:45.750
<v Speaker 0>using a persistent volume claim for storage.

00:05:46.310 --> 00:05:47.270
<v Speaker 0>And really

00:05:47.669 --> 00:05:49.270
<v Speaker 0>it's the easiest way, right? You can just

00:05:49.270 --> 00:05:50.150
<v Speaker 0>deploy this chart,

00:05:51.045 --> 00:05:52.965
<v Speaker 0>update some DNS records, which we're about to

00:05:52.965 --> 00:05:55.605
<v Speaker 0>do, and you get a working Teleport cluster.

00:05:55.605 --> 00:05:57.045
<v Speaker 0>Now you do have to go onto the

00:05:57.045 --> 00:05:59.365
<v Speaker 0>cluster itself and manage your users, etcetera.

00:06:00.005 --> 00:06:01.925
<v Speaker 0>But these are examples. So you can take

00:06:01.925 --> 00:06:03.605
<v Speaker 0>that config map. You can swap out the

00:06:03.605 --> 00:06:05.500
<v Speaker 0>local authentication and you can configure it with

00:06:05.500 --> 00:06:07.979
<v Speaker 0>your GitHub application credentials if you're using open

00:06:07.979 --> 00:06:10.460
<v Speaker 0>source. If you're using enterprise, hook that up

00:06:10.460 --> 00:06:12.780
<v Speaker 0>to Google SAML, whatever you want, and go

00:06:12.780 --> 00:06:13.340
<v Speaker 0>nuts.

00:06:14.699 --> 00:06:16.699
<v Speaker 0>It seems to be that the Teleport chart,

00:06:16.955 --> 00:06:18.955
<v Speaker 0>which was essentially the exact same as the

00:06:18.955 --> 00:06:21.595
<v Speaker 0>Teleport cluster one, is deprecated. I assume this

00:06:21.595 --> 00:06:23.755
<v Speaker 0>was just the first one that they started

00:06:23.755 --> 00:06:25.595
<v Speaker 0>putting together and then decided to kind of

00:06:25.595 --> 00:06:27.915
<v Speaker 0>deprecate in favor of the Teleport cluster. So

00:06:27.915 --> 00:06:29.595
<v Speaker 0>we won't be looking at Teleport. If it's

00:06:29.595 --> 00:06:30.395
<v Speaker 0>deprecated,

00:06:30.475 --> 00:06:32.235
<v Speaker 0>please don't be using that as an example.

00:06:33.800 --> 00:06:35.319
<v Speaker 0>The next thing I found, and I actually

00:06:35.319 --> 00:06:37.479
<v Speaker 0>got quite excited by this one, the Teleport

00:06:37.479 --> 00:06:39.240
<v Speaker 0>daemon set. I was like, yay.

00:06:40.120 --> 00:06:41.000
<v Speaker 0>We can

00:06:41.240 --> 00:06:43.560
<v Speaker 0>run super privileged pods across all of our

00:06:43.560 --> 00:06:45.159
<v Speaker 0>infrastructure and get us to switch access to

00:06:45.159 --> 00:06:46.440
<v Speaker 0>them well, so I'll get an access to

00:06:46.440 --> 00:06:48.544
<v Speaker 0>a Kubernetes cluster at the same time. This

00:06:48.544 --> 00:06:51.104
<v Speaker 0>is also deprecated. However, I am going to

00:06:51.104 --> 00:06:54.064
<v Speaker 0>be replicating it through my own dirty hack

00:06:54.064 --> 00:06:56.944
<v Speaker 0>today. So you can't use the redeemer set

00:06:56.944 --> 00:06:59.745
<v Speaker 0>chart, but it was good as an inspiration

00:06:59.745 --> 00:07:01.824
<v Speaker 0>for just a proof of concept that I

00:07:01.824 --> 00:07:02.784
<v Speaker 0>wanted to build out together.

00:07:06.750 --> 00:07:09.070
<v Speaker 0>Welcome to it up. Nice to see you.

00:07:10.750 --> 00:07:11.470
<v Speaker 0>Okay.

00:07:11.630 --> 00:07:14.030
<v Speaker 0>Let's keep working. So we've got the Teleport

00:07:14.030 --> 00:07:16.030
<v Speaker 0>Kube agent. We are definitely using this one

00:07:16.030 --> 00:07:18.555
<v Speaker 0>today. This allows you to if you have

00:07:18.555 --> 00:07:21.275
<v Speaker 0>an existing Teleport cluster, possibly the best way

00:07:21.275 --> 00:07:23.835
<v Speaker 0>to run Teleport is on bare metal and

00:07:23.835 --> 00:07:26.235
<v Speaker 0>then expose all of your cloud stuff back

00:07:26.235 --> 00:07:27.595
<v Speaker 0>to it. However,

00:07:30.690 --> 00:07:32.610
<v Speaker 0>and the KubeAgent chart is the best way

00:07:32.610 --> 00:07:33.810
<v Speaker 0>to get started with that because you can

00:07:33.810 --> 00:07:34.690
<v Speaker 0>just deploy

00:07:35.090 --> 00:07:38.130
<v Speaker 0>the Kubernetes proxy with that configuration to any

00:07:38.130 --> 00:07:40.290
<v Speaker 0>Kubernetes cluster and then filter them all back

00:07:40.290 --> 00:07:42.050
<v Speaker 0>to some other Teleport, and we will be

00:07:42.050 --> 00:07:43.330
<v Speaker 0>looking at how to do that today as

00:07:43.330 --> 00:07:43.410
<v Speaker 0>well.

00:07:44.835 --> 00:07:47.074
<v Speaker 0>The next chart is also deprecated in the

00:07:47.074 --> 00:07:49.315
<v Speaker 0>last chart, which is the Teleport Auto Trusted

00:07:49.315 --> 00:07:49.955
<v Speaker 0>Cluster.

00:07:50.514 --> 00:07:52.275
<v Speaker 0>This seems to be a chart which, again,

00:07:52.275 --> 00:07:53.634
<v Speaker 0>is good as an example if you want

00:07:53.634 --> 00:07:55.074
<v Speaker 0>to go and see how to implement this

00:07:55.074 --> 00:07:55.635
<v Speaker 0>stuff.

00:07:55.875 --> 00:07:57.875
<v Speaker 0>But Teleport works really well in a cluster

00:07:57.875 --> 00:08:00.060
<v Speaker 0>of cluster mode, in that you have one

00:08:00.060 --> 00:08:01.180
<v Speaker 0>centralised,

00:08:01.900 --> 00:08:04.139
<v Speaker 0>pet like, super friendly cluster that you take

00:08:04.139 --> 00:08:06.460
<v Speaker 0>care of, and then you have other Teleport

00:08:06.460 --> 00:08:07.340
<v Speaker 0>clusters

00:08:08.300 --> 00:08:10.939
<v Speaker 0>at the edge or on different regions, etcetera,

00:08:11.775 --> 00:08:13.295
<v Speaker 0>which can then use

00:08:13.375 --> 00:08:15.455
<v Speaker 0>the root cluster for authentication,

00:08:15.455 --> 00:08:17.455
<v Speaker 0>privileges, permissions, etcetera.

00:08:17.695 --> 00:08:18.575
<v Speaker 0>We

00:08:18.575 --> 00:08:21.455
<v Speaker 0>may actually do an episode on the kind

00:08:21.455 --> 00:08:23.615
<v Speaker 0>of federated cluster of clusters approach towards the

00:08:23.615 --> 00:08:26.020
<v Speaker 0>end of this course. So, tuned for that.

00:08:29.380 --> 00:08:31.220
<v Speaker 0>I actually need to update this. You should

00:08:31.220 --> 00:08:32.340
<v Speaker 0>not run a daemon set when it was

00:08:32.340 --> 00:08:34.020
<v Speaker 0>deprecated. This is what I was going to

00:08:34.020 --> 00:08:35.460
<v Speaker 0>try and encourage, but we're going look at

00:08:35.460 --> 00:08:36.340
<v Speaker 0>doing this a different way.

00:08:37.655 --> 00:08:39.575
<v Speaker 0>Alright. So, exercise one. We know where the

00:08:39.575 --> 00:08:41.735
<v Speaker 0>Helm charts are. We know which ones are

00:08:41.735 --> 00:08:43.495
<v Speaker 0>active, we know which ones are deprecated, and

00:08:43.495 --> 00:08:45.735
<v Speaker 0>we have a good understanding, hopefully, of what

00:08:45.735 --> 00:08:47.655
<v Speaker 0>each of these Helm charts does.

00:08:48.455 --> 00:08:50.055
<v Speaker 0>Now, the next step is we want to

00:08:50.055 --> 00:08:52.615
<v Speaker 0>install Teleport to

00:08:52.070 --> 00:08:54.070
<v Speaker 0>one of our Kubernetes clusters.

00:08:54.630 --> 00:08:55.670
<v Speaker 0>So, I've included

00:08:56.149 --> 00:08:58.310
<v Speaker 0>let me zoom in a bit. There we

00:08:58.310 --> 00:08:58.790
<v Speaker 0>go.

00:08:59.350 --> 00:09:01.510
<v Speaker 0>Can we go one more? Yeah. There we

00:09:01.510 --> 00:09:03.430
<v Speaker 0>go. So, I've included a bit of a

00:09:03.430 --> 00:09:05.110
<v Speaker 0>warning at the start of this task.

00:09:06.725 --> 00:09:10.085
<v Speaker 0>The Teleport charts are not published through the

00:09:10.085 --> 00:09:11.125
<v Speaker 0>Artifact Hub.

00:09:12.245 --> 00:09:15.285
<v Speaker 0>If you're not familiar with the Artifact Hub,

00:09:16.325 --> 00:09:17.205
<v Speaker 0>there

00:09:17.205 --> 00:09:19.925
<v Speaker 0>we go, Artifact Hub. This is like the

00:09:19.925 --> 00:09:21.205
<v Speaker 0>new Helm Hub

00:09:22.139 --> 00:09:25.100
<v Speaker 0>or even a replacement or discovery mechanism from

00:09:25.100 --> 00:09:27.500
<v Speaker 0>the Google Helm stable and Helm incubator,

00:09:27.500 --> 00:09:29.420
<v Speaker 0>etcetera, where you can just come on and

00:09:29.420 --> 00:09:31.420
<v Speaker 0>fax it for something that's definitely not gonna

00:09:31.420 --> 00:09:31.980
<v Speaker 0>be there.

00:09:32.699 --> 00:09:34.139
<v Speaker 0>Like the reddest chart, and you can see

00:09:34.139 --> 00:09:36.300
<v Speaker 0>that this is by the Falco team. We

00:09:35.945 --> 00:09:37.785
<v Speaker 0>got one by Bitnami, the Bitnami chart is

00:09:37.785 --> 00:09:39.945
<v Speaker 0>usually a pretty safe bet for everybody.

00:09:41.065 --> 00:09:42.904
<v Speaker 0>But if you search for Teleport,

00:09:44.105 --> 00:09:45.625
<v Speaker 0>there are charts here

00:09:46.185 --> 00:09:47.065
<v Speaker 0>and

00:09:49.670 --> 00:09:50.630
<v Speaker 0>they're all

00:09:51.670 --> 00:09:52.870
<v Speaker 0>not official.

00:09:53.430 --> 00:09:56.550
<v Speaker 0>They're contributed by other people, other teams, etcetera.

00:09:56.630 --> 00:09:59.110
<v Speaker 0>So they are there. You may find them

00:09:59.110 --> 00:10:01.430
<v Speaker 0>that way, but I would probably suggest that

00:10:01.430 --> 00:10:03.030
<v Speaker 0>you use the ones provided by Teleport.

00:10:04.154 --> 00:10:05.595
<v Speaker 0>And in order to do so, you can

00:10:05.595 --> 00:10:08.235
<v Speaker 0>just do a Helm repository or Ripple add

00:10:08.235 --> 00:10:10.315
<v Speaker 0>Teleport with the URL.

00:10:10.715 --> 00:10:12.475
<v Speaker 0>I've already done this. I don't need to

00:10:12.475 --> 00:10:14.555
<v Speaker 0>do it again, but I can run Helm

00:10:14.555 --> 00:10:15.995
<v Speaker 0>Ripple list, and you'll see that we have

00:10:15.995 --> 00:10:19.090
<v Speaker 0>already added the Teleport repository to my local

00:10:19.090 --> 00:10:19.890
<v Speaker 0>environment.

00:10:21.810 --> 00:10:22.850
<v Speaker 0>You can also,

00:10:23.170 --> 00:10:24.210
<v Speaker 0>if you want,

00:10:24.530 --> 00:10:26.290
<v Speaker 0>just do like a shallow clone of the

00:10:26.290 --> 00:10:28.610
<v Speaker 0>actual gravitational Teleport repository.

00:10:28.770 --> 00:10:31.330
<v Speaker 0>When you're deploying and using Helm,

00:10:31.745 --> 00:10:33.265
<v Speaker 0>if you don't want to include

00:10:33.584 --> 00:10:36.785
<v Speaker 0>the chart name or repository slash chart name

00:10:36.785 --> 00:10:38.705
<v Speaker 0>at the end, you can just use a

00:10:38.705 --> 00:10:39.665
<v Speaker 0>local directory,

00:10:39.985 --> 00:10:42.464
<v Speaker 0>especially if you do want to make modifications

00:10:42.464 --> 00:10:45.000
<v Speaker 0>to the example charts and to replace that

00:10:45.000 --> 00:10:48.440
<v Speaker 0>local authentication with a GitHub authentication, etcetera.

00:10:48.920 --> 00:10:50.200
<v Speaker 0>So, that's a really good way to do

00:10:50.200 --> 00:10:52.360
<v Speaker 0>it. We probably won't do that today unless

00:10:52.360 --> 00:10:54.200
<v Speaker 0>I'm getting particularly bold

00:10:54.279 --> 00:10:56.519
<v Speaker 0>towards the end. We are just gonna use

00:10:56.519 --> 00:10:58.279
<v Speaker 0>the example charts with a little bit of

00:10:58.279 --> 00:10:58.839
<v Speaker 0>configuration.

00:11:01.465 --> 00:11:04.185
<v Speaker 0>Cool. So, we're just going to copy this

00:11:04.185 --> 00:11:05.305
<v Speaker 0>verbatim and

00:11:05.945 --> 00:11:08.905
<v Speaker 0>deploy our first Teleport cluster using the Teleport

00:11:08.905 --> 00:11:10.105
<v Speaker 0>cluster chart

00:11:10.105 --> 00:11:12.105
<v Speaker 0>to my first Kubernetes cluster.

00:11:16.500 --> 00:11:17.940
<v Speaker 0>I am using

00:11:18.019 --> 00:11:19.060
<v Speaker 0>Kubei.

00:11:21.459 --> 00:11:22.980
<v Speaker 0>Trying to at least.

00:11:24.660 --> 00:11:26.420
<v Speaker 0>How'd you do it? Oh, there we go.

00:11:26.500 --> 00:11:28.740
<v Speaker 0>I've got my three different clusters here. So,

00:11:28.740 --> 00:11:31.015
<v Speaker 0>I'm going to deploy to JKE first, and

00:11:31.015 --> 00:11:32.695
<v Speaker 0>then I'll tell you why I'm deploying to

00:11:32.695 --> 00:11:33.815
<v Speaker 0>JKE first.

00:11:35.175 --> 00:11:37.975
<v Speaker 0>We'll make sure that I have JKE

00:11:37.975 --> 00:11:40.055
<v Speaker 0>cluster. So, I'm looking for

00:11:40.774 --> 00:11:41.015
<v Speaker 0>Yeah.

00:11:43.410 --> 00:11:45.410
<v Speaker 0>Some of this stuff only really exists in

00:11:45.410 --> 00:11:47.010
<v Speaker 0>a JKE cluster.

00:11:47.890 --> 00:11:48.530
<v Speaker 0>Plus,

00:11:49.970 --> 00:11:51.730
<v Speaker 0>what do we need? Oh, yeah. We're copying

00:11:51.730 --> 00:11:53.090
<v Speaker 0>and pasting this command.

00:11:54.450 --> 00:11:56.130
<v Speaker 0>Nope. I've now copied and pasted the wrong

00:11:56.130 --> 00:11:56.450
<v Speaker 0>thing.

00:11:59.305 --> 00:12:00.185
<v Speaker 0>Much better.

00:12:01.144 --> 00:12:03.384
<v Speaker 0>So, we're going to call this helm release

00:12:03.384 --> 00:12:04.904
<v Speaker 0>Teleport cluster.

00:12:05.785 --> 00:12:07.625
<v Speaker 0>It doesn't really matter what name you give

00:12:07.625 --> 00:12:07.865
<v Speaker 0>it.

00:12:09.480 --> 00:12:10.680
<v Speaker 0>You just need to be able to know

00:12:10.680 --> 00:12:11.959
<v Speaker 0>the name when you want to run helm

00:12:11.959 --> 00:12:13.080
<v Speaker 0>upgrade commands,

00:12:13.240 --> 00:12:15.000
<v Speaker 0>to be able to tweak or modify the

00:12:15.000 --> 00:12:15.800
<v Speaker 0>configuration.

00:12:17.080 --> 00:12:19.640
<v Speaker 0>We're going to run with Acme on. So,

00:12:19.640 --> 00:12:21.480
<v Speaker 0>one of the cool things about Teleport, and

00:12:21.480 --> 00:12:23.560
<v Speaker 0>we covered this in the first installation video

00:12:23.560 --> 00:12:25.865
<v Speaker 0>where we looked at running with Docker and

00:12:25.865 --> 00:12:26.745
<v Speaker 0>with the

00:12:27.225 --> 00:12:28.345
<v Speaker 0>compelled binaries,

00:12:28.505 --> 00:12:30.185
<v Speaker 0>is that it has built in support to

00:12:30.185 --> 00:12:32.505
<v Speaker 0>reach out to Let's Encrypt to get certificates.

00:12:32.505 --> 00:12:34.345
<v Speaker 0>So in order to enable that, we just

00:12:34.345 --> 00:12:36.505
<v Speaker 0>need to set Acme to true

00:12:36.930 --> 00:12:39.010
<v Speaker 0>and then pass in our email address because

00:12:39.010 --> 00:12:40.850
<v Speaker 0>less encrypt requires that all

00:12:41.170 --> 00:12:42.770
<v Speaker 0>certificates have an email address with it so

00:12:42.770 --> 00:12:44.610
<v Speaker 0>they know who's provisioning them, there are wait

00:12:44.610 --> 00:12:45.650
<v Speaker 0>limits, etcetera.

00:12:46.529 --> 00:12:48.930
<v Speaker 0>And we give our cluster a name. This

00:12:48.930 --> 00:12:50.770
<v Speaker 0>is going to be a fully qualified domain

00:12:50.770 --> 00:12:52.535
<v Speaker 0>name. And for today, I am just using

00:12:52.535 --> 00:12:53.895
<v Speaker 0>my Rawkode.sh

00:12:53.895 --> 00:12:55.575
<v Speaker 0>domain, which is

00:12:56.935 --> 00:12:59.015
<v Speaker 0>relatively unused to date.

00:13:00.295 --> 00:13:02.295
<v Speaker 0>I'm telling this chart to create a namespace

00:13:02.295 --> 00:13:03.575
<v Speaker 0>and that I want to keep all my

00:13:03.575 --> 00:13:06.055
<v Speaker 0>Teleport stuff in a Teleport cluster namespace,

00:13:07.090 --> 00:13:09.090
<v Speaker 0>followed by the chart name.

00:13:09.650 --> 00:13:11.810
<v Speaker 0>With this, we can hit return.

00:13:13.330 --> 00:13:14.930
<v Speaker 0>Wait just a moment.

00:13:17.650 --> 00:13:19.010
<v Speaker 0>And it is deployed.

00:13:21.065 --> 00:13:23.225
<v Speaker 0>So we can do Teleport

00:13:23.384 --> 00:13:24.264
<v Speaker 0>cluster

00:13:24.425 --> 00:13:25.225
<v Speaker 0>get

00:13:26.345 --> 00:13:28.985
<v Speaker 0>pods. We'll see that's currently container creating, so

00:13:28.985 --> 00:13:30.425
<v Speaker 0>we'll stick a watch on that and just

00:13:30.425 --> 00:13:33.144
<v Speaker 0>give that a moment. So this shouldn't take

00:13:33.980 --> 00:13:34.860
<v Speaker 0>too long.

00:13:35.180 --> 00:13:37.899
<v Speaker 0>It's just provisioning a persistent volume,

00:13:38.779 --> 00:13:41.580
<v Speaker 0>pulling image and starting the container.

00:13:42.300 --> 00:13:44.380
<v Speaker 0>We can see that it's running now and

00:13:44.380 --> 00:13:45.100
<v Speaker 0>it's healthy.

00:13:46.255 --> 00:13:46.975
<v Speaker 0>So,

00:13:47.295 --> 00:13:48.975
<v Speaker 0>we're kind of almost

00:13:48.975 --> 00:13:49.695
<v Speaker 0>done.

00:13:50.735 --> 00:13:52.334
<v Speaker 0>Of course, I'm gonna show you it working.

00:13:52.334 --> 00:13:53.455
<v Speaker 0>You don't need to take my word for

00:13:53.455 --> 00:13:56.015
<v Speaker 0>this. But the reason we're using the JKE

00:13:56.015 --> 00:13:57.774
<v Speaker 0>cluster first is because

00:13:58.760 --> 00:14:00.520
<v Speaker 0>one of the things that the chart does

00:14:00.520 --> 00:14:01.240
<v Speaker 0>by default

00:14:03.560 --> 00:14:04.760
<v Speaker 0>I

00:14:04.760 --> 00:14:07.560
<v Speaker 0>really should just set my namespace, we'll do

00:14:07.560 --> 00:14:09.480
<v Speaker 0>it this way. One of the things the

00:14:09.480 --> 00:14:10.200
<v Speaker 0>chart does

00:14:10.695 --> 00:14:12.855
<v Speaker 0>by default is deploy a load balancer type

00:14:12.855 --> 00:14:15.255
<v Speaker 0>service. This is a Kubernetes service where the

00:14:15.255 --> 00:14:16.855
<v Speaker 0>type is not cluster IP,

00:14:17.175 --> 00:14:19.735
<v Speaker 0>it has load balancer. So, this does not

00:14:19.735 --> 00:14:22.135
<v Speaker 0>work in all Kubernetes environments and the fact

00:14:22.135 --> 00:14:24.455
<v Speaker 0>is very unlikely to work in Minikube, Docker

00:14:24.455 --> 00:14:25.940
<v Speaker 0>for Mac kind

00:14:26.260 --> 00:14:28.740
<v Speaker 0>because they won't have the ability to provision

00:14:28.740 --> 00:14:29.780
<v Speaker 0>a load balancer.

00:14:30.260 --> 00:14:32.260
<v Speaker 0>The service type load balancer is really a

00:14:32.260 --> 00:14:34.900
<v Speaker 0>cloud construct with providers for AWS,

00:14:34.980 --> 00:14:35.860
<v Speaker 0>GCP,

00:14:36.740 --> 00:14:40.195
<v Speaker 0>DigitalOcean, Linode. They all have cluster controller managers

00:14:40.195 --> 00:14:42.435
<v Speaker 0>that monitor for this service and actually reach

00:14:42.435 --> 00:14:42.995
<v Speaker 0>out,

00:14:43.315 --> 00:14:44.835
<v Speaker 0>get an Elastic IP,

00:14:44.915 --> 00:14:46.595
<v Speaker 0>and then attach it to the service.

00:14:47.395 --> 00:14:49.235
<v Speaker 0>So, I use JKE so you can see

00:14:49.235 --> 00:14:50.035
<v Speaker 0>that work.

00:14:50.355 --> 00:14:51.555
<v Speaker 0>And the next step I need to do

00:14:51.555 --> 00:14:52.915
<v Speaker 0>is to copy

00:14:52.915 --> 00:14:54.435
<v Speaker 0>this IP address,

00:14:55.510 --> 00:14:57.430
<v Speaker 0>jump over to my DNS,

00:14:58.550 --> 00:15:01.430
<v Speaker 0>and add a record for the fully qualified

00:15:01.430 --> 00:15:03.589
<v Speaker 0>domain name that I added to my cluster

00:15:03.589 --> 00:15:04.790
<v Speaker 0>and save that.

00:15:05.350 --> 00:15:06.630
<v Speaker 0>And we just need to give that a

00:15:06.630 --> 00:15:08.150
<v Speaker 0>minute for that to propagate.

00:15:08.150 --> 00:15:09.190
<v Speaker 0>And what should happen?

00:15:10.334 --> 00:15:12.175
<v Speaker 0>Is we should be able

00:15:14.175 --> 00:15:17.615
<v Speaker 0>that's my cloud instance, Teleport.Rawkode.sh.

00:15:19.055 --> 00:15:20.495
<v Speaker 0>And we should be able to browse to

00:15:20.495 --> 00:15:21.774
<v Speaker 0>this momentarily.

00:15:22.495 --> 00:15:23.855
<v Speaker 0>There we go. Awesome.

00:15:24.650 --> 00:15:26.810
<v Speaker 0>That's one of the reasons I use Cloudflare.

00:15:27.130 --> 00:15:29.290
<v Speaker 0>The propagation of their two ENSE records is

00:15:29.290 --> 00:15:30.970
<v Speaker 0>just ridiculously fast.

00:15:31.610 --> 00:15:33.690
<v Speaker 0>And we have Carlos with us today. Hey,

00:15:33.690 --> 00:15:35.370
<v Speaker 0>man. How's it going? Nice to see you.

00:15:36.570 --> 00:15:37.370
<v Speaker 0>Okay.

00:15:38.815 --> 00:15:41.935
<v Speaker 0>So we have deployed with the Helm chart,

00:15:41.935 --> 00:15:44.654
<v Speaker 0>Teleport cluster to JKE. It's got our load

00:15:44.654 --> 00:15:46.815
<v Speaker 0>balancer. We updated our DNS record.

00:15:46.975 --> 00:15:49.615
<v Speaker 0>Teleport can now satisfy the ACMI challenge,

00:15:49.775 --> 00:15:51.375
<v Speaker 0>and we have a cluster.

00:15:52.389 --> 00:15:54.230
<v Speaker 0>And we could tick our box in, yes,

00:15:54.230 --> 00:15:56.550
<v Speaker 0>we've created our DNS record and it worked.

00:15:57.190 --> 00:15:57.990
<v Speaker 0>However,

00:15:58.070 --> 00:16:00.870
<v Speaker 0>you may be running a local environment or

00:16:00.870 --> 00:16:04.230
<v Speaker 0>non cloud environments, bare metal environments, where there's

00:16:04.230 --> 00:16:06.389
<v Speaker 0>no load balancer service, and I wanna run

00:16:06.389 --> 00:16:07.589
<v Speaker 0>you through how this works too.

00:16:08.325 --> 00:16:11.045
<v Speaker 0>Well, I do provide another command here,

00:16:12.165 --> 00:16:14.165
<v Speaker 0>and we will switch my

00:16:14.325 --> 00:16:15.765
<v Speaker 0>Kubernetes context

00:16:16.245 --> 00:16:18.485
<v Speaker 0>to Teleport one. This is

00:16:19.365 --> 00:16:21.525
<v Speaker 0>a Siebel KCS cluster.

00:16:23.250 --> 00:16:23.970
<v Speaker 0>And

00:16:24.450 --> 00:16:25.570
<v Speaker 0>it responds.

00:16:28.370 --> 00:16:29.970
<v Speaker 0>And it does. Awesome.

00:16:30.690 --> 00:16:33.570
<v Speaker 0>So, I mean, we could do the same

00:16:33.570 --> 00:16:35.970
<v Speaker 0>helmets document I just run. However, what we're

00:16:35.970 --> 00:16:39.089
<v Speaker 0>gonna see would be the service

00:16:43.725 --> 00:16:45.404
<v Speaker 0>Comment from Russell saying my audio is a

00:16:45.404 --> 00:16:47.565
<v Speaker 0>bit muffled. Maybe I am just muffled. I'm

00:16:47.565 --> 00:16:49.725
<v Speaker 0>not sure. I'll try and then see a

00:16:49.725 --> 00:16:50.605
<v Speaker 0>little bit better.

00:16:51.084 --> 00:16:52.204
<v Speaker 0>But thanks for the heads up.

00:16:54.670 --> 00:16:57.550
<v Speaker 0>Okay, so we could deploy the We could

00:16:57.550 --> 00:17:00.030
<v Speaker 0>run the first command again to this cluster.

00:17:00.030 --> 00:17:02.110
<v Speaker 0>However, the service load balancer would set in

00:17:02.110 --> 00:17:03.630
<v Speaker 0>a pending state indefinitely.

00:17:04.190 --> 00:17:05.230
<v Speaker 0>Civo Cloud,

00:17:05.390 --> 00:17:07.230
<v Speaker 0>along with many other clouds, just don't provide

00:17:07.230 --> 00:17:10.325
<v Speaker 0>load balancers as a service. They're also expensive.

00:17:10.885 --> 00:17:13.365
<v Speaker 0>If you run a Elastic Load Balancer on

00:17:13.365 --> 00:17:15.765
<v Speaker 0>AWS, I think each one of them is

00:17:15.765 --> 00:17:17.444
<v Speaker 0>20 to $25 a month.

00:17:17.845 --> 00:17:19.445
<v Speaker 0>You can go down the road of using

00:17:19.445 --> 00:17:21.045
<v Speaker 0>the application load balancers, which are a lot

00:17:21.045 --> 00:17:21.365
<v Speaker 0>cheaper.

00:17:23.290 --> 00:17:24.890
<v Speaker 0>Carlos thinks I'm getting sick.

00:17:26.010 --> 00:17:27.210
<v Speaker 0>Maybe I am.

00:17:28.970 --> 00:17:30.970
<v Speaker 0>If it's just that my voice sounds a

00:17:30.970 --> 00:17:33.050
<v Speaker 0>bit nasally, perhaps I am getting a cold.

00:17:33.050 --> 00:17:34.170
<v Speaker 0>I mean, I have a three year old

00:17:34.170 --> 00:17:36.090
<v Speaker 0>who's been at nursery for

00:17:37.055 --> 00:17:39.934
<v Speaker 0>just over, well just under three months and

00:17:40.335 --> 00:17:43.055
<v Speaker 0>she's pretty much been home with new snot

00:17:43.055 --> 00:17:45.775
<v Speaker 0>and sniffles and coughs every week. So, I

00:17:45.775 --> 00:17:47.855
<v Speaker 0>guess it's inevitable that I'm going to catch

00:17:47.855 --> 00:17:48.175
<v Speaker 0>something.

00:17:50.720 --> 00:17:51.440
<v Speaker 0>Okay.

00:17:51.920 --> 00:17:52.640
<v Speaker 0>Alright.

00:17:52.800 --> 00:17:53.679
<v Speaker 0>Stay track.

00:17:53.920 --> 00:17:54.559
<v Speaker 0>So,

00:17:54.960 --> 00:17:55.520
<v Speaker 0>yes.

00:17:55.920 --> 00:17:57.520
<v Speaker 0>ELBs are expensive.

00:17:58.320 --> 00:18:01.120
<v Speaker 0>ELBs are cheaper and require more setup, but

00:18:01.120 --> 00:18:03.520
<v Speaker 0>you can just not use a service of

00:18:03.520 --> 00:18:05.575
<v Speaker 0>table advancer at all, which is what I'm

00:18:05.575 --> 00:18:06.935
<v Speaker 0>gonna show you guys. So,

00:18:08.535 --> 00:18:10.135
<v Speaker 0>we'll paste in this command

00:18:10.855 --> 00:18:12.455
<v Speaker 0>and you'll see that it's this Talm install

00:18:12.455 --> 00:18:15.495
<v Speaker 0>Teleport cluster. So it's the exact same ACME

00:18:15.495 --> 00:18:17.415
<v Speaker 0>true. We're still passing in my email address.

00:18:18.260 --> 00:18:19.940
<v Speaker 0>I am gonna change the name on this

00:18:19.940 --> 00:18:21.860
<v Speaker 0>just so I can have multiple DNS records,

00:18:21.860 --> 00:18:22.979
<v Speaker 0>and we'll call this

00:18:23.700 --> 00:18:24.659
<v Speaker 0>civo1.

00:18:24.659 --> 00:18:25.940
<v Speaker 0>Rockcode. Sh.

00:18:26.179 --> 00:18:28.019
<v Speaker 0>And now I'm using the helm.

00:18:30.434 --> 00:18:31.394
<v Speaker 0>Thanks, Carlos.

00:18:31.715 --> 00:18:33.635
<v Speaker 0>And now we're passing in a set service

00:18:33.635 --> 00:18:35.554
<v Speaker 0>dot type equals cluster IP. So now we're

00:18:35.554 --> 00:18:37.794
<v Speaker 0>telling this Helm chart, don't deploy a load

00:18:37.794 --> 00:18:40.515
<v Speaker 0>balancer, use cluster IP. I work out how

00:18:40.515 --> 00:18:42.434
<v Speaker 0>to get traffic to this in my cluster.

00:18:43.750 --> 00:18:45.669
<v Speaker 0>And here, I decided

00:18:47.670 --> 00:18:49.030
<v Speaker 0>don't know why I decided to try and

00:18:49.030 --> 00:18:50.390
<v Speaker 0>do this with the local chart, but I'm

00:18:50.390 --> 00:18:52.390
<v Speaker 0>gonna just change that and stick to what's

00:18:52.390 --> 00:18:53.429
<v Speaker 0>worked so far,

00:18:53.830 --> 00:18:55.190
<v Speaker 0>which is Teleport

00:18:55.510 --> 00:18:55.830
<v Speaker 0>cluster.

00:18:56.415 --> 00:18:59.375
<v Speaker 0>So almost identically the same command, only we

00:18:59.375 --> 00:19:01.135
<v Speaker 0>are overriding the service type.

00:19:01.455 --> 00:19:03.375
<v Speaker 0>This will deploy to Cboe

00:19:03.615 --> 00:19:06.095
<v Speaker 0>and we'll look at how to expose this.

00:19:06.255 --> 00:19:06.895
<v Speaker 0>So

00:19:07.855 --> 00:19:09.375
<v Speaker 0>we've got the same namespace,

00:19:10.460 --> 00:19:12.299
<v Speaker 0>But we can just keep that watch on.

00:19:14.460 --> 00:19:15.820
<v Speaker 0>I

00:19:17.740 --> 00:19:19.820
<v Speaker 0>don't like it when I see pending.

00:19:31.595 --> 00:19:32.634
<v Speaker 0>I

00:19:32.875 --> 00:19:33.915
<v Speaker 0>was very,

00:19:33.915 --> 00:19:36.555
<v Speaker 0>very worried there that I had deployed my

00:19:36.555 --> 00:19:38.715
<v Speaker 0>SIBO cluster without a CSI.

00:19:38.795 --> 00:19:40.179
<v Speaker 0>I wasn't even sure if that was a

00:19:40.179 --> 00:19:40.659
<v Speaker 0>thing,

00:19:40.980 --> 00:19:43.779
<v Speaker 0>but we're okay. So, the pending was provisioned

00:19:43.779 --> 00:19:46.179
<v Speaker 0>in persistent volume and the claim.

00:19:47.220 --> 00:19:49.539
<v Speaker 0>Container creating now means it's pulling the image,

00:19:50.019 --> 00:19:52.100
<v Speaker 0>and hopefully very quickly, we're going to see

00:19:52.100 --> 00:19:54.434
<v Speaker 0>that this is running. And I can panic

00:19:54.434 --> 00:19:55.714
<v Speaker 0>a little bit less.

00:20:05.075 --> 00:20:06.434
<v Speaker 0>Guess we just wait.

00:20:07.075 --> 00:20:07.955
<v Speaker 0>Wait. Wait. Wait.

00:20:09.760 --> 00:20:11.759
<v Speaker 0>So, as I say here,

00:20:12.559 --> 00:20:14.240
<v Speaker 0>you will need to create some sort of

00:20:14.240 --> 00:20:15.759
<v Speaker 0>ingress resource. So,

00:20:16.480 --> 00:20:17.999
<v Speaker 0>this Civo cluster

00:20:19.520 --> 00:20:21.840
<v Speaker 0>does get one public IP address,

00:20:23.315 --> 00:20:24.914
<v Speaker 0>which is load balanced

00:20:26.275 --> 00:20:27.554
<v Speaker 0>by default.

00:20:29.715 --> 00:20:31.315
<v Speaker 0>Because it's a workshop,

00:20:32.995 --> 00:20:34.675
<v Speaker 0>So Carlos is saying,

00:20:35.830 --> 00:20:37.750
<v Speaker 0>why am I using Helm directly and not

00:20:37.750 --> 00:20:38.950
<v Speaker 0>doing getups?

00:20:39.110 --> 00:20:41.430
<v Speaker 0>I would love to be doing getups,

00:20:41.430 --> 00:20:43.270
<v Speaker 0>but, you know, this I I just wanted

00:20:43.270 --> 00:20:44.390
<v Speaker 0>to be able to run through the commands

00:20:44.390 --> 00:20:46.390
<v Speaker 0>in an interactive fashion, like as if you

00:20:46.390 --> 00:20:47.910
<v Speaker 0>were building a proof of concept, and then

00:20:47.910 --> 00:20:49.350
<v Speaker 0>the getups can come later when you know

00:20:49.350 --> 00:20:50.150
<v Speaker 0>that it works.

00:20:50.470 --> 00:20:51.350
<v Speaker 0>However, a great question.

00:20:53.555 --> 00:20:56.435
<v Speaker 0>Say that again. Yes.

00:20:56.515 --> 00:20:58.195
<v Speaker 0>So, the Civo cluster comes with one IP

00:20:58.195 --> 00:20:59.715
<v Speaker 0>address with a load balancer.

00:21:00.675 --> 00:21:03.875
<v Speaker 0>It deploys with traffic by default as ingress.

00:21:04.115 --> 00:21:05.875
<v Speaker 0>I'm a fan of emissaries, so I just

00:21:05.875 --> 00:21:06.515
<v Speaker 0>swapped out.

00:21:07.530 --> 00:21:09.130
<v Speaker 0>What that means is,

00:21:09.210 --> 00:21:10.890
<v Speaker 0>and we can see that our Teleport is

00:21:10.890 --> 00:21:11.929
<v Speaker 0>happy, which is good.

00:21:12.650 --> 00:21:16.010
<v Speaker 0>If we do get svc dash all,

00:21:17.610 --> 00:21:18.250
<v Speaker 0>we

00:21:18.650 --> 00:21:19.050
<v Speaker 0>have

00:21:20.845 --> 00:21:21.645
<v Speaker 0>our

00:21:21.885 --> 00:21:22.765
<v Speaker 0>ambassador,

00:21:22.765 --> 00:21:24.445
<v Speaker 0>which is Emissary NGRIS,

00:21:25.085 --> 00:21:27.005
<v Speaker 0>as a load balancer, which gets that one

00:21:27.005 --> 00:21:28.845
<v Speaker 0>public IP address that is available.

00:21:29.245 --> 00:21:31.805
<v Speaker 0>That can route all other traffic via the

00:21:31.805 --> 00:21:34.525
<v Speaker 0>NGRIS or mapping objects as Emissary calls them

00:21:34.525 --> 00:21:36.205
<v Speaker 0>to the service inside of the cluster.

00:21:37.380 --> 00:21:38.740
<v Speaker 0>You can see we actually have our cluster

00:21:38.740 --> 00:21:41.540
<v Speaker 0>IP service here for Teleport.

00:21:42.020 --> 00:21:43.620
<v Speaker 0>So, in order to make all of this

00:21:43.620 --> 00:21:44.260
<v Speaker 0>work,

00:21:45.620 --> 00:21:49.220
<v Speaker 0>we need to first create the DNS record

00:21:49.860 --> 00:21:51.220
<v Speaker 0>for

00:21:53.605 --> 00:21:54.565
<v Speaker 0>C4-one,

00:21:54.565 --> 00:21:55.845
<v Speaker 0>I believe I called it.

00:21:56.565 --> 00:21:58.565
<v Speaker 0>Point it to the load balancer and hit

00:21:58.565 --> 00:21:59.365
<v Speaker 0>save,

00:22:00.725 --> 00:22:03.525
<v Speaker 0>and then create an emissary mapping. Now this

00:22:03.525 --> 00:22:05.765
<v Speaker 0>could be, if you're using traffic, use whatever

00:22:05.765 --> 00:22:08.440
<v Speaker 0>traffic custom resource they have. If you're using

00:22:08.440 --> 00:22:11.400
<v Speaker 0>Kong or you're using NGINX Ingress, whatever you're

00:22:11.400 --> 00:22:12.999
<v Speaker 0>using, you can just go to that.

00:22:13.640 --> 00:22:15.960
<v Speaker 0>You may even just be using networking V1

00:22:15.960 --> 00:22:16.760
<v Speaker 0>Ingress.

00:22:16.760 --> 00:22:17.799
<v Speaker 0>That's fine too.

00:22:18.280 --> 00:22:20.840
<v Speaker 0>So, I'm going to create my mapping.

00:22:22.275 --> 00:22:23.235
<v Speaker 0>YAML.

00:22:25.715 --> 00:22:27.955
<v Speaker 0>My host name is SQL one.

00:22:30.435 --> 00:22:31.795
<v Speaker 0>No prefix.

00:22:31.795 --> 00:22:34.435
<v Speaker 0>And I believe the service is called Teleport

00:22:34.435 --> 00:22:38.060
<v Speaker 0>cluster. I'll quickly double check that. Yeah. Teleport

00:22:38.060 --> 00:22:39.420
<v Speaker 0>cluster, Teleport cluster.

00:22:40.300 --> 00:22:42.059
<v Speaker 0>And I can now hopefully

00:22:42.220 --> 00:22:45.260
<v Speaker 0>just apply this to the same namespace.

00:22:46.780 --> 00:22:47.660
<v Speaker 0>I call it mapping.

00:22:58.655 --> 00:23:00.095
<v Speaker 0>Alright. We're debugging.

00:23:01.135 --> 00:23:04.655
<v Speaker 0>So what happened there is

00:23:03.510 --> 00:23:06.070
<v Speaker 0>my cluster is telling me that kind mapping

00:23:06.070 --> 00:23:07.269
<v Speaker 0>doesn't exist,

00:23:09.030 --> 00:23:10.470
<v Speaker 0>which I was not expecting.

00:23:12.630 --> 00:23:14.710
<v Speaker 0>So, we can use API resources.

00:23:16.355 --> 00:23:17.875
<v Speaker 0>And I wanna see

00:23:18.515 --> 00:23:20.995
<v Speaker 0>what we get in the ambassador namespace.

00:23:24.355 --> 00:23:25.075
<v Speaker 0>Ah,

00:23:26.355 --> 00:23:28.035
<v Speaker 0>this version of ambassador

00:23:28.275 --> 00:23:29.155
<v Speaker 0>is old

00:23:32.270 --> 00:23:36.030
<v Speaker 0>Because nothing ever goes simply. Alright. Let's upgrade

00:23:36.030 --> 00:23:37.710
<v Speaker 0>it. I mean, could just do like a

00:23:37.710 --> 00:23:38.750
<v Speaker 0>map in v2.

00:23:44.294 --> 00:23:45.815
<v Speaker 0>But I I don't know what's the best

00:23:45.815 --> 00:23:46.614
<v Speaker 0>approach.

00:23:48.534 --> 00:23:50.695
<v Speaker 0>I'm gonna I'm gonna upgrade it. So we

00:23:50.695 --> 00:23:52.134
<v Speaker 0>got ambassador here.

00:23:54.695 --> 00:23:55.414
<v Speaker 0>Edit

00:23:55.495 --> 00:23:56.695
<v Speaker 0>deployment

00:23:57.335 --> 00:23:57.815
<v Speaker 0>ambassador.

00:23:59.090 --> 00:24:00.690
<v Speaker 0>And we can see

00:24:14.365 --> 00:24:18.764
<v Speaker 0>We have ambassador Edge Stack one thirteen ten.

00:24:25.645 --> 00:24:28.125
<v Speaker 0>Updating that seems like really risky, doesn't it?

00:24:30.530 --> 00:24:31.490
<v Speaker 0>Maybe

00:24:38.690 --> 00:24:40.130
<v Speaker 0>I should just use the old mapping.

00:24:47.585 --> 00:24:50.065
<v Speaker 0>Drop the version there. Oh, wow. It's really

00:24:50.065 --> 00:24:50.304
<v Speaker 0>old.

00:24:58.860 --> 00:25:00.540
<v Speaker 0>The problem is when I was using the

00:25:00.540 --> 00:25:03.179
<v Speaker 0>Civo create cluster, they have like a marketplace,

00:25:03.900 --> 00:25:06.460
<v Speaker 0>which clearly they don't update their applications because

00:25:06.460 --> 00:25:07.340
<v Speaker 0>this is,

00:25:07.900 --> 00:25:09.500
<v Speaker 0>there's a substantial difference here.

00:25:10.235 --> 00:25:11.995
<v Speaker 0>However, I can still go to these versions

00:25:11.995 --> 00:25:13.674
<v Speaker 0>of the docs, which means

00:25:14.315 --> 00:25:15.515
<v Speaker 0>can hopefully

00:25:16.955 --> 00:25:19.515
<v Speaker 0>Yeah, this looks almost the exact same. So

00:25:19.515 --> 00:25:20.475
<v Speaker 0>I'm just going to

00:25:22.715 --> 00:25:24.395
<v Speaker 0>We're just gonna hope for the best

00:25:26.840 --> 00:25:28.279
<v Speaker 0>get ambassador.

00:25:29.080 --> 00:25:30.519
<v Speaker 0>I'll be two.

00:25:31.400 --> 00:25:32.999
<v Speaker 0>In fact, that leads to alpha.

00:25:35.559 --> 00:25:36.600
<v Speaker 0>Maybe this is better.

00:25:39.445 --> 00:25:40.085
<v Speaker 0>And

00:25:40.325 --> 00:25:42.085
<v Speaker 0>Teleport cluster

00:25:42.245 --> 00:25:43.284
<v Speaker 0>apply

00:25:43.445 --> 00:25:46.245
<v Speaker 0>dash f mapping.

00:25:46.645 --> 00:25:47.365
<v Speaker 0>Alright.

00:25:48.965 --> 00:25:50.165
<v Speaker 0>Port cluster.

00:25:55.930 --> 00:25:57.530
<v Speaker 0>I didn't know that was a thing on

00:25:57.530 --> 00:25:58.730
<v Speaker 0>Twitch, Russell.

00:25:59.450 --> 00:26:02.410
<v Speaker 0>Russell suggests that if this was on Twitch,

00:26:02.410 --> 00:26:05.370
<v Speaker 0>we could bet channel points. I'm not sure

00:26:04.875 --> 00:26:07.275
<v Speaker 0>what channel points are or whether I break

00:26:07.275 --> 00:26:08.075
<v Speaker 0>my cluster.

00:26:09.035 --> 00:26:10.154
<v Speaker 0>Maybe next time.

00:26:10.555 --> 00:26:11.195
<v Speaker 0>Okay.

00:26:11.995 --> 00:26:12.875
<v Speaker 0>Let's see

00:26:13.275 --> 00:26:14.554
<v Speaker 0>my services

00:26:15.115 --> 00:26:16.395
<v Speaker 0>and my mapping.

00:26:19.990 --> 00:26:22.309
<v Speaker 0>This this this may work. I have I

00:26:22.470 --> 00:26:24.149
<v Speaker 0>you know what? I have no idea. Let's

00:26:24.149 --> 00:26:25.829
<v Speaker 0>find out. Civo one

00:26:26.629 --> 00:26:27.669
<v Speaker 0>Rawkode SH.

00:26:31.285 --> 00:26:32.965
<v Speaker 0>Well, first challenge.

00:26:35.605 --> 00:26:38.885
<v Speaker 0>The certificate is the ambassador Edge Stack self

00:26:38.885 --> 00:26:39.845
<v Speaker 0>signed one,

00:26:40.245 --> 00:26:42.405
<v Speaker 0>which means that Teleport hasn't been able to

00:26:42.405 --> 00:26:43.285
<v Speaker 0>satisfy

00:26:43.365 --> 00:26:46.565
<v Speaker 0>its

00:26:50.780 --> 00:26:53.260
<v Speaker 0>Carlos is asking, why didn't I use traffic

00:26:54.620 --> 00:26:55.980
<v Speaker 0>from Civo?

00:26:57.260 --> 00:26:57.980
<v Speaker 0>I could've.

00:26:59.865 --> 00:27:02.425
<v Speaker 0>I just I like emissary ingress from the

00:27:02.425 --> 00:27:04.184
<v Speaker 0>times I've used it. I don't think it

00:27:04.184 --> 00:27:05.545
<v Speaker 0>would be too much of a hassle to

00:27:05.545 --> 00:27:06.664
<v Speaker 0>swap it out.

00:27:07.705 --> 00:27:10.745
<v Speaker 0>I am very much regretting

00:27:10.745 --> 00:27:11.465
<v Speaker 0>that decision.

00:27:12.730 --> 00:27:14.889
<v Speaker 0>But let's just see what happens.

00:27:15.289 --> 00:27:16.329
<v Speaker 0>So

00:27:16.730 --> 00:27:19.130
<v Speaker 0>we're having emissary. So the DNS record is

00:27:19.130 --> 00:27:21.129
<v Speaker 0>going to my ingress controller, which is correct.

00:27:21.289 --> 00:27:23.289
<v Speaker 0>However, the certificate that we're getting back is

00:27:23.289 --> 00:27:24.169
<v Speaker 0>incorrect.

00:27:24.570 --> 00:27:26.809
<v Speaker 0>So we can do a cboe rockode

00:27:26.809 --> 00:27:27.769
<v Speaker 0>dot sh

00:27:28.165 --> 00:27:29.924
<v Speaker 0>and reset dash

00:27:30.645 --> 00:27:32.005
<v Speaker 0>dash b

00:27:33.925 --> 00:27:35.205
<v Speaker 0>cboe one.

00:27:38.725 --> 00:27:40.485
<v Speaker 0>Alright. And then if we want to debug

00:27:40.485 --> 00:27:41.924
<v Speaker 0>the certificate,

00:27:41.925 --> 00:27:43.125
<v Speaker 0>I think we can add.

00:27:44.029 --> 00:27:44.909
<v Speaker 0>I

00:27:44.909 --> 00:27:45.789
<v Speaker 0>can't remember.

00:27:48.909 --> 00:27:49.950
<v Speaker 0>Capital a.

00:27:52.110 --> 00:27:52.989
<v Speaker 0>So

00:27:53.870 --> 00:27:55.789
<v Speaker 0>I'm gonna try one thing before I move

00:27:55.789 --> 00:27:57.674
<v Speaker 0>on to the next step. I mean, all

00:27:57.674 --> 00:27:58.554
<v Speaker 0>I was gonna show you is that you

00:27:58.554 --> 00:28:00.395
<v Speaker 0>don't need a load balancer. I've kinda proven

00:28:00.395 --> 00:28:01.914
<v Speaker 0>that, but I haven't got TLS working, so

00:28:01.914 --> 00:28:02.874
<v Speaker 0>it's not ideal.

00:28:03.914 --> 00:28:04.554
<v Speaker 0>But

00:28:05.355 --> 00:28:06.715
<v Speaker 0>close enough. Right?

00:28:07.115 --> 00:28:09.115
<v Speaker 0>I'm gonna look at the logs to see

00:28:09.115 --> 00:28:11.755
<v Speaker 0>why our ACME challenge hasn't kicked in.

00:28:14.820 --> 00:28:17.300
<v Speaker 0>Right. So management search is in ACME.

00:28:23.780 --> 00:28:25.300
<v Speaker 0>Let's try just restarting that.

00:28:27.165 --> 00:28:29.325
<v Speaker 0>When in doubt, a reboot fixes everything.

00:28:30.845 --> 00:28:33.405
<v Speaker 0>Well, let's delete our pod. We'll force stack

00:28:33.405 --> 00:28:34.685
<v Speaker 0>the challenge to come through. Now that the

00:28:34.685 --> 00:28:37.565
<v Speaker 0>DNS is there, we'll see what happens. Feeling

00:28:37.565 --> 00:28:38.765
<v Speaker 0>that and moving on. It's not a big

00:28:38.765 --> 00:28:38.925
<v Speaker 0>deal.

00:28:45.070 --> 00:28:46.750
<v Speaker 0>Okay. Follow log.

00:28:53.645 --> 00:28:55.565
<v Speaker 0>Patience is a virtue.

00:29:00.445 --> 00:29:02.765
<v Speaker 0>I've landed on another node and it's still

00:29:02.765 --> 00:29:04.365
<v Speaker 0>an image, isn't it? There we go.

00:29:13.410 --> 00:29:14.130
<v Speaker 0>Okay.

00:29:17.010 --> 00:29:18.130
<v Speaker 0>Must be quite a big image.

00:29:25.265 --> 00:29:27.345
<v Speaker 0>Bonus though, because this is my first stream

00:29:27.345 --> 00:29:28.705
<v Speaker 0>using the m one, it's also the first

00:29:28.705 --> 00:29:30.304
<v Speaker 0>stream that when I'm not talking,

00:29:30.865 --> 00:29:32.865
<v Speaker 0>there's actual silence in there. Like, I cannot

00:29:32.865 --> 00:29:35.505
<v Speaker 0>hear the fans from the machine. In fact,

00:29:35.505 --> 00:29:36.225
<v Speaker 0>they're not even on.

00:29:55.175 --> 00:29:56.375
<v Speaker 0>Wow. Slow.

00:29:57.415 --> 00:29:58.375
<v Speaker 0>There we go.

00:30:01.975 --> 00:30:02.695
<v Speaker 0>Okay.

00:30:02.775 --> 00:30:04.215
<v Speaker 0>Logs.

00:30:13.980 --> 00:30:16.779
<v Speaker 0>So our TLS server is x two. Is

00:30:16.779 --> 00:30:18.620
<v Speaker 0>that old or new though? Oh, it must

00:30:18.620 --> 00:30:19.179
<v Speaker 0>be current.

00:30:21.005 --> 00:30:23.885
<v Speaker 0>It's the M1 Pro top of the line,

00:30:23.885 --> 00:30:26.365
<v Speaker 0>not the Max, but the best Pro option.

00:30:26.365 --> 00:30:28.364
<v Speaker 0>I couldn't justify the Max, Russell.

00:30:29.565 --> 00:30:31.005
<v Speaker 0>But I could have, but I would have

00:30:31.005 --> 00:30:32.365
<v Speaker 0>been bullshit to be honest.

00:30:43.230 --> 00:30:45.630
<v Speaker 0>Oh, well. Alright. So

00:30:46.405 --> 00:30:49.045
<v Speaker 0>here's some advice. Obviously, try things before the

00:30:49.045 --> 00:30:50.245
<v Speaker 0>stream. The second,

00:30:51.845 --> 00:30:53.125
<v Speaker 0>now that I think about it, the fact

00:30:53.125 --> 00:30:54.885
<v Speaker 0>that we've been done the Emissary route, which

00:30:54.885 --> 00:30:56.885
<v Speaker 0>also has support for Let's Encrypt, I should

00:30:56.885 --> 00:30:59.125
<v Speaker 0>probably disable the ACME support

00:30:59.830 --> 00:31:01.910
<v Speaker 0>and Teleport and let Emissary deal with it

00:31:01.910 --> 00:31:03.430
<v Speaker 0>and that would just fix this. I think

00:31:03.430 --> 00:31:05.590
<v Speaker 0>what's happening right now is that Teleport is

00:31:05.590 --> 00:31:07.270
<v Speaker 0>trying to answer the request, but it's not

00:31:07.270 --> 00:31:08.310
<v Speaker 0>really getting to it.

00:31:09.110 --> 00:31:11.590
<v Speaker 0>So, we're just gonna skip this stage and

00:31:11.590 --> 00:31:13.110
<v Speaker 0>say, voila, it'll work.

00:31:13.875 --> 00:31:16.275
<v Speaker 0>Use whatever ingress controller you've got to maybe

00:31:16.275 --> 00:31:19.554
<v Speaker 0>handle the TLS certificate instead of Teleport's ACME.

00:31:20.675 --> 00:31:21.955
<v Speaker 0>I will

00:31:21.955 --> 00:31:24.275
<v Speaker 0>play with this another day and get it

00:31:24.275 --> 00:31:27.155
<v Speaker 0>working and do a small fifteen minute tutorial.

00:31:27.930 --> 00:31:28.730
<v Speaker 0>Awesome.

00:31:29.770 --> 00:31:31.210
<v Speaker 0>Okay. What's next?

00:31:32.330 --> 00:31:33.690
<v Speaker 0>It's annoying though.

00:31:34.090 --> 00:31:34.970
<v Speaker 0>Of course.

00:31:38.650 --> 00:31:41.370
<v Speaker 0>Her heart is the Emissary TLS.

00:31:47.174 --> 00:31:48.455
<v Speaker 0>That feels like a rabbit hole. I don't

00:31:48.455 --> 00:31:49.575
<v Speaker 0>really need to go down.

00:31:53.975 --> 00:31:56.215
<v Speaker 0>Yeah. Doesn't matter. Doesn't matter.

00:31:57.080 --> 00:31:58.840
<v Speaker 0>All know what cert manager is.

00:32:00.200 --> 00:32:02.120
<v Speaker 0>We all know how ingress things work. I

00:32:02.120 --> 00:32:04.440
<v Speaker 0>don't need to fix this right now. Okay.

00:32:05.000 --> 00:32:06.120
<v Speaker 0>So let's

00:32:06.120 --> 00:32:08.680
<v Speaker 0>close this one and close this one and

00:32:08.680 --> 00:32:09.480
<v Speaker 0>pop back over here.

00:32:10.165 --> 00:32:12.565
<v Speaker 0>So, the important thing was just you don't

00:32:12.565 --> 00:32:14.164
<v Speaker 0>need to have the load balancer,

00:32:15.045 --> 00:32:16.805
<v Speaker 0>but just the cluster IP and then handle

00:32:16.805 --> 00:32:18.405
<v Speaker 0>the ingress to your cluster, however you handle

00:32:18.405 --> 00:32:20.565
<v Speaker 0>it already. I mean, you're already gonna have

00:32:21.125 --> 00:32:21.925
<v Speaker 0>services

00:32:21.925 --> 00:32:25.140
<v Speaker 0>that are getting less encrypted certificates somehow and

00:32:25.140 --> 00:32:27.460
<v Speaker 0>getting routed via ingress somehow.

00:32:27.460 --> 00:32:29.540
<v Speaker 0>So, just use whatever you know

00:32:29.940 --> 00:32:30.980
<v Speaker 0>and maybe

00:32:31.060 --> 00:32:32.740
<v Speaker 0>I'll do the same next time.

00:32:33.780 --> 00:32:35.700
<v Speaker 0>So, the next challenge was,

00:32:37.300 --> 00:32:39.300
<v Speaker 0>if I to pop open

00:32:43.634 --> 00:32:46.114
<v Speaker 0>Teleport. So this is my JKE one,

00:32:47.875 --> 00:32:49.394
<v Speaker 0>which I never created to use before.

00:32:51.890 --> 00:32:54.610
<v Speaker 0>Let's do that quickly so that we can

00:32:54.610 --> 00:32:55.890
<v Speaker 0>take a look at something.

00:32:57.250 --> 00:32:59.250
<v Speaker 0>So let's go back to our JKE cluster.

00:33:04.915 --> 00:33:05.955
<v Speaker 0>Get pods.

00:33:06.755 --> 00:33:09.315
<v Speaker 0>I'm gonna actually just exec into this for

00:33:09.315 --> 00:33:11.075
<v Speaker 0>a moment and create the

00:33:12.115 --> 00:33:14.275
<v Speaker 0>our first user. So we can do TTL

00:33:14.275 --> 00:33:16.995
<v Speaker 0>users add roles

00:33:17.070 --> 00:33:17.950
<v Speaker 0>access,

00:33:18.029 --> 00:33:18.749
<v Speaker 0>editor,

00:33:18.830 --> 00:33:19.549
<v Speaker 0>order,

00:33:20.110 --> 00:33:20.909
<v Speaker 0>login,

00:33:21.070 --> 00:33:21.869
<v Speaker 0>route,

00:33:23.070 --> 00:33:26.990
<v Speaker 0>and the username, of course. Login.

00:33:29.815 --> 00:33:31.895
<v Speaker 0>And then accept my own invitation.

00:33:32.375 --> 00:33:34.615
<v Speaker 0>We can close this. We see getting started.

00:33:36.215 --> 00:33:37.655
<v Speaker 0>Save the password.

00:33:38.855 --> 00:33:40.775
<v Speaker 0>Test Teleport

00:33:41.015 --> 00:33:42.054
<v Speaker 0>Rawkode.

00:33:43.655 --> 00:33:45.015
<v Speaker 0>We'll copy the password.

00:33:54.910 --> 00:33:56.350
<v Speaker 0>Yeah. I just have I how is that

00:33:56.350 --> 00:33:56.590
<v Speaker 0>gonna

00:33:57.550 --> 00:33:59.710
<v Speaker 0>does it really scan that already for me?

00:33:59.870 --> 00:34:01.385
<v Speaker 0>That would be impressive. Normally, I have to

00:34:01.385 --> 00:34:02.825
<v Speaker 0>do that manually. Let's see.

00:34:04.025 --> 00:34:05.945
<v Speaker 0>No. Yeah. I don't know where that came

00:34:05.945 --> 00:34:07.865
<v Speaker 0>from. Let's scan it properly.

00:34:09.625 --> 00:34:10.425
<v Speaker 0>Let me use this one.

00:34:13.150 --> 00:34:14.190
<v Speaker 0>Okay. So,

00:34:14.590 --> 00:34:16.670
<v Speaker 0>that first Teleport install that we did, you

00:34:16.670 --> 00:34:18.510
<v Speaker 0>see that there's no server access.

00:34:18.670 --> 00:34:20.750
<v Speaker 0>There's no applications of course, but we do

00:34:20.750 --> 00:34:23.150
<v Speaker 0>have access to the Kubernetes cluster. So, I

00:34:23.150 --> 00:34:23.790
<v Speaker 0>could

00:34:24.030 --> 00:34:25.150
<v Speaker 0>run through

00:34:26.205 --> 00:34:28.125
<v Speaker 0>these commands to do that.

00:34:29.725 --> 00:34:33.005
<v Speaker 0>But we probably, depending on your Kubernetes setup,

00:34:33.005 --> 00:34:35.325
<v Speaker 0>is that you probably still want that server

00:34:35.325 --> 00:34:37.645
<v Speaker 0>access or at least the ability to SSH

00:34:37.645 --> 00:34:40.120
<v Speaker 0>onto your node, your nodes within your node

00:34:40.120 --> 00:34:41.640
<v Speaker 0>pools, node groups, etcetera,

00:34:42.520 --> 00:34:43.719
<v Speaker 0>for any sort

00:34:45.880 --> 00:34:47.400
<v Speaker 0>of debugging or

00:34:47.719 --> 00:34:49.320
<v Speaker 0>manual commands, of course, that you want to

00:34:49.320 --> 00:34:49.880
<v Speaker 0>run.

00:34:50.360 --> 00:34:51.320
<v Speaker 0>Of course, we want to be in a

00:34:51.320 --> 00:34:52.520
<v Speaker 0>world where we never need to be able

00:34:52.520 --> 00:34:54.520
<v Speaker 0>to do that, but we're not quite there

00:34:54.520 --> 00:34:54.760
<v Speaker 0>yet.

00:34:56.735 --> 00:34:57.455
<v Speaker 0>And

00:34:58.415 --> 00:35:01.375
<v Speaker 0>Teleport did at one point support the daemon

00:35:01.375 --> 00:35:02.575
<v Speaker 0>set chart,

00:35:02.975 --> 00:35:04.975
<v Speaker 0>which of course is gonna run some extremely

00:35:04.975 --> 00:35:07.935
<v Speaker 0>privileged pods inside of your cluster to expose

00:35:07.935 --> 00:35:09.935
<v Speaker 0>that host through Teleport.

00:35:11.100 --> 00:35:12.940
<v Speaker 0>I couldn't get the daemon set chart to

00:35:12.940 --> 00:35:14.540
<v Speaker 0>work. And plus, I didn't really like what

00:35:14.540 --> 00:35:16.060
<v Speaker 0>the daemon set chart was doing.

00:35:16.620 --> 00:35:18.300
<v Speaker 0>Now, understand why it was doing it, but

00:35:18.300 --> 00:35:20.140
<v Speaker 0>it was just dreadful. It was actually running

00:35:20.140 --> 00:35:21.340
<v Speaker 0>a privileged pod,

00:35:21.820 --> 00:35:25.035
<v Speaker 0>installing Teleport onto the nodes, configuring a systemd

00:35:25.035 --> 00:35:27.115
<v Speaker 0>service, and then starting the systemd service.

00:35:27.915 --> 00:35:29.755
<v Speaker 0>At which point, the daemon set chart itself

00:35:29.755 --> 00:35:31.595
<v Speaker 0>becomes completely irrelevant. So, it was just like

00:35:31.595 --> 00:35:34.075
<v Speaker 0>a really hacky way to get Teleport running.

00:35:35.115 --> 00:35:37.410
<v Speaker 0>So, I decided, well, let's just try and

00:35:37.410 --> 00:35:40.210
<v Speaker 0>do this as Kubernetes as we can by

00:35:40.210 --> 00:35:42.210
<v Speaker 0>using a daemon set that just runs the

00:35:42.210 --> 00:35:43.490
<v Speaker 0>SSH proxy

00:35:44.770 --> 00:35:46.770
<v Speaker 0>and see how far we can get. So

00:35:46.770 --> 00:35:48.530
<v Speaker 0>we are doing things like hostpads and I'll

00:35:48.530 --> 00:35:50.450
<v Speaker 0>talk about some of those annoying hacks, but

00:35:51.105 --> 00:35:52.785
<v Speaker 0>for the most part it kind of works.

00:35:52.785 --> 00:35:53.425
<v Speaker 0>So,

00:35:53.905 --> 00:35:55.585
<v Speaker 0>the first thing we need to do,

00:35:57.025 --> 00:35:58.545
<v Speaker 0>and I haven't done this on the JKE

00:35:58.545 --> 00:36:00.225
<v Speaker 0>one, so I'm gonna get myself into trouble

00:36:00.225 --> 00:36:01.665
<v Speaker 0>now, but we don't have a working Cboe

00:36:01.665 --> 00:36:03.025
<v Speaker 0>cluster. So, what can I do?

00:36:05.369 --> 00:36:08.250
<v Speaker 0>You'll see there is a lovely warning here.

00:36:08.250 --> 00:36:08.970
<v Speaker 0>Teleport

00:36:09.210 --> 00:36:12.170
<v Speaker 0>definitely do not endorse this approach,

00:36:12.490 --> 00:36:13.290
<v Speaker 0>but it's

00:36:13.530 --> 00:36:15.369
<v Speaker 0>a good experiment, right, to see how things

00:36:15.369 --> 00:36:15.930
<v Speaker 0>work.

00:36:16.810 --> 00:36:17.965
<v Speaker 0>So, the first thing we need to do

00:36:17.965 --> 00:36:20.205
<v Speaker 0>is modify the config map that the Teleport

00:36:20.205 --> 00:36:21.485
<v Speaker 0>cluster chart deployed.

00:36:21.565 --> 00:36:22.925
<v Speaker 0>The reason why is that we need to

00:36:22.925 --> 00:36:25.165
<v Speaker 0>be able to provide some static authentication

00:36:25.165 --> 00:36:27.565
<v Speaker 0>so that when we deploy our daemon set,

00:36:27.565 --> 00:36:29.165
<v Speaker 0>is that it can speak to the Teleport

00:36:29.165 --> 00:36:29.805
<v Speaker 0>control plane.

00:36:30.980 --> 00:36:32.180
<v Speaker 0>The way that we do that is just

00:36:32.180 --> 00:36:33.860
<v Speaker 0>by adding a token. So

00:36:34.740 --> 00:36:36.580
<v Speaker 0>let's do it out of our container,

00:36:36.819 --> 00:36:37.700
<v Speaker 0>Teleport

00:36:37.700 --> 00:36:38.500
<v Speaker 0>cluster,

00:36:38.819 --> 00:36:40.020
<v Speaker 0>get pods,

00:36:40.740 --> 00:36:42.099
<v Speaker 0>and get config maps.

00:36:42.755 --> 00:36:43.795
<v Speaker 0>So our

00:36:44.275 --> 00:36:45.875
<v Speaker 0>Helm chart deployed

00:36:46.035 --> 00:36:47.315
<v Speaker 0>the Teleport

00:36:47.395 --> 00:36:48.115
<v Speaker 0>cluster

00:36:49.475 --> 00:36:50.355
<v Speaker 0>config map.

00:36:50.755 --> 00:36:52.115
<v Speaker 0>We can go down to the off service

00:36:52.115 --> 00:36:52.755
<v Speaker 0>here.

00:36:52.915 --> 00:36:54.595
<v Speaker 0>You can see the domain name. You can

00:36:54.595 --> 00:36:56.515
<v Speaker 0>see the authentication is type local.

00:36:57.155 --> 00:36:59.290
<v Speaker 0>We're gonna add tokens.

00:36:59.530 --> 00:37:00.970
<v Speaker 0>Now you can add tokens for a variety

00:37:00.970 --> 00:37:02.410
<v Speaker 0>of purposes in Teleport.

00:37:02.890 --> 00:37:04.730
<v Speaker 0>You you could add coop tokens, you could

00:37:04.730 --> 00:37:06.170
<v Speaker 0>add an app token, you could add a

00:37:06.170 --> 00:37:07.609
<v Speaker 0>DB token, depending on what you want to

00:37:07.609 --> 00:37:08.250
<v Speaker 0>expose.

00:37:08.490 --> 00:37:10.730
<v Speaker 0>We want to expose nodes. So this is

00:37:10.730 --> 00:37:11.930
<v Speaker 0>a token

00:37:12.155 --> 00:37:13.595
<v Speaker 0>that anyone,

00:37:14.075 --> 00:37:15.835
<v Speaker 0>anyone with that token

00:37:15.915 --> 00:37:18.635
<v Speaker 0>can join your Teleport cluster as a node,

00:37:18.635 --> 00:37:20.875
<v Speaker 0>which means exposing server access.

00:37:23.435 --> 00:37:25.675
<v Speaker 0>You can set the string to anything you

00:37:25.675 --> 00:37:28.750
<v Speaker 0>want. I am going to go with random.

00:37:29.150 --> 00:37:30.510
<v Speaker 0>And I'll just quote this because I have

00:37:30.510 --> 00:37:32.190
<v Speaker 0>no idea if that space would be included.

00:37:32.190 --> 00:37:33.550
<v Speaker 0>I actually think it would be.

00:37:34.350 --> 00:37:36.590
<v Speaker 0>And I'm not even sure that this is

00:37:36.590 --> 00:37:37.150
<v Speaker 0>all this is

00:37:38.350 --> 00:37:40.750
<v Speaker 0>this isn't a re this is one string.

00:37:41.985 --> 00:37:44.785
<v Speaker 0>I'm just I'm yeah. I'm gonna do this.

00:37:45.265 --> 00:37:46.945
<v Speaker 0>So, now this is a node token with

00:37:46.945 --> 00:37:48.785
<v Speaker 0>the string random, not space random.

00:37:49.665 --> 00:37:51.585
<v Speaker 0>And because this is Kubernetes,

00:37:51.985 --> 00:37:53.585
<v Speaker 0>that means that the pod,

00:37:54.410 --> 00:37:56.970
<v Speaker 0>even though it is mounting this config map,

00:37:57.210 --> 00:37:59.130
<v Speaker 0>has no idea that really it's changed, and

00:37:59.130 --> 00:38:01.210
<v Speaker 0>I don't think Teleport is monitoring it

00:38:01.770 --> 00:38:03.610
<v Speaker 0>using I'm notifier or anything like that. So

00:38:03.610 --> 00:38:05.130
<v Speaker 0>we're going to delete the pod

00:38:05.450 --> 00:38:08.890
<v Speaker 0>to force Teleport to detect that change and

00:38:08.890 --> 00:38:09.930
<v Speaker 0>restart its server.

00:38:13.655 --> 00:38:14.295
<v Speaker 0>Okay.

00:38:14.695 --> 00:38:16.855
<v Speaker 0>So, if we run get pods, we are

00:38:16.855 --> 00:38:19.335
<v Speaker 0>running, not quite healthy, but we are running.

00:38:20.215 --> 00:38:21.335
<v Speaker 0>So, we can move on to the next

00:38:21.335 --> 00:38:21.975
<v Speaker 0>step.

00:38:22.535 --> 00:38:25.415
<v Speaker 0>So, I talk about deleting the pod here.

00:38:25.980 --> 00:38:27.580
<v Speaker 0>You can use a label selector if you

00:38:27.580 --> 00:38:28.060
<v Speaker 0>want.

00:38:28.940 --> 00:38:31.500
<v Speaker 0>We're going to deploy a new config map.

00:38:31.500 --> 00:38:33.740
<v Speaker 0>So, this is to provide a Teleport config

00:38:33.740 --> 00:38:35.900
<v Speaker 0>where the off service is disabled, the proxy

00:38:35.900 --> 00:38:37.980
<v Speaker 0>service is disabled, but we do enable the

00:38:37.980 --> 00:38:38.780
<v Speaker 0>SSH service.

00:38:39.645 --> 00:38:41.405
<v Speaker 0>We're just adding some labels so that we

00:38:41.405 --> 00:38:43.405
<v Speaker 0>know this is a Kubernetes worker node, and

00:38:43.405 --> 00:38:45.725
<v Speaker 0>then we configure it to speak back to

00:38:45.725 --> 00:38:49.805
<v Speaker 0>our auth server, which is on Teleport.Rawkode.sh,

00:38:50.445 --> 00:38:52.205
<v Speaker 0>with the auth token that we created.

00:38:52.685 --> 00:38:54.125
<v Speaker 0>And then we have a daemon set,

00:38:54.630 --> 00:38:56.310
<v Speaker 0>which is host PID,

00:38:56.549 --> 00:38:57.830
<v Speaker 0>host IPC,

00:38:57.990 --> 00:39:00.470
<v Speaker 0>and host network. So we want this pod

00:39:00.470 --> 00:39:02.470
<v Speaker 0>to feel like it's the host

00:39:02.630 --> 00:39:06.549
<v Speaker 0>from the Teleport Connect SSH. We're

00:39:06.549 --> 00:39:08.630
<v Speaker 0>not I'm not doing anything with a fail

00:39:08.630 --> 00:39:08.950
<v Speaker 0>system.

00:39:10.085 --> 00:39:11.845
<v Speaker 0>If you really need to be able to

00:39:11.845 --> 00:39:13.525
<v Speaker 0>do that, of course you can go ahead

00:39:13.525 --> 00:39:14.325
<v Speaker 0>and do that.

00:39:14.805 --> 00:39:16.325
<v Speaker 0>But really I just wanted to do some

00:39:16.325 --> 00:39:18.565
<v Speaker 0>simple process exploration to see what's running on

00:39:18.565 --> 00:39:20.805
<v Speaker 0>the machine and look at stats,

00:39:20.885 --> 00:39:22.724
<v Speaker 0>CPU utilization, etcetera.

00:39:23.540 --> 00:39:25.780
<v Speaker 0>So, you can extend this further. Maybe I'll

00:39:25.780 --> 00:39:28.340
<v Speaker 0>update that with some more hacky mount stuff.

00:39:29.140 --> 00:39:30.980
<v Speaker 0>For these kind of privileged pods,

00:39:31.540 --> 00:39:33.540
<v Speaker 0>what we would do is mount the entire

00:39:33.540 --> 00:39:36.065
<v Speaker 0>host file system onto slash host. You could

00:39:36.065 --> 00:39:37.904
<v Speaker 0>definitely do that here and then you could

00:39:37.904 --> 00:39:39.744
<v Speaker 0>share route if you needed to. Of course,

00:39:39.744 --> 00:39:40.944
<v Speaker 0>I don't think you should have to be

00:39:40.944 --> 00:39:42.785
<v Speaker 0>able to do that. That doesn't work to

00:39:42.785 --> 00:39:44.224
<v Speaker 0>what I'm doing, but still.

00:39:44.944 --> 00:39:46.305
<v Speaker 0>Let's copy this

00:39:47.424 --> 00:39:49.744
<v Speaker 0>and we'll call this ds. Yaml,

00:39:50.160 --> 00:39:51.440
<v Speaker 0>Drop this in.

00:39:52.640 --> 00:39:54.240
<v Speaker 0>Where's my token?

00:39:58.880 --> 00:40:00.720
<v Speaker 0>And this is normal YAML, so the space

00:40:00.720 --> 00:40:02.960
<v Speaker 0>doesn't matter. And I actually think I've done

00:40:02.960 --> 00:40:04.240
<v Speaker 0>this in a way that I don't need

00:40:04.240 --> 00:40:04.960
<v Speaker 0>to modify anything.

00:40:06.505 --> 00:40:07.625
<v Speaker 0>We can now

00:40:07.785 --> 00:40:08.585
<v Speaker 0>apply

00:40:08.665 --> 00:40:09.865
<v Speaker 0>dash f

00:40:09.945 --> 00:40:11.065
<v Speaker 0>d s.

00:40:13.465 --> 00:40:15.145
<v Speaker 0>If we run get pods,

00:40:16.745 --> 00:40:19.385
<v Speaker 0>this is just a one node JKE cluster

00:40:19.385 --> 00:40:20.105
<v Speaker 0>because I'm cheap.

00:40:20.890 --> 00:40:22.330
<v Speaker 0>But you can see that we now have

00:40:22.330 --> 00:40:24.570
<v Speaker 0>our pod running. Now we can take a

00:40:24.570 --> 00:40:26.490
<v Speaker 0>look at the logs. What we expect to

00:40:26.490 --> 00:40:28.650
<v Speaker 0>see is that it is attempting

00:40:29.450 --> 00:40:31.450
<v Speaker 0>to speak to our Teleport cluster, and the

00:40:31.450 --> 00:40:33.369
<v Speaker 0>join token should be accepted.

00:40:37.815 --> 00:40:38.935
<v Speaker 0>There

00:40:39.335 --> 00:40:41.575
<v Speaker 0>are no logs because I've just realised

00:40:42.295 --> 00:40:44.055
<v Speaker 0>I'm telling it to go to a file.

00:40:44.375 --> 00:40:45.335
<v Speaker 0>No big deal.

00:40:46.135 --> 00:40:47.895
<v Speaker 0>If we hit refresh on this page, I'm

00:40:47.895 --> 00:40:48.295
<v Speaker 0>hoping,

00:40:49.700 --> 00:40:50.580
<v Speaker 0>there we go,

00:40:51.460 --> 00:40:53.619
<v Speaker 0>that this now shows up. So, we've now

00:40:53.619 --> 00:40:55.140
<v Speaker 0>enabled server access

00:40:57.059 --> 00:40:57.700
<v Speaker 0>with

00:40:58.980 --> 00:41:02.420
<v Speaker 0>DaemonSet running in an extremely privileged fashion.

00:41:04.585 --> 00:41:06.265
<v Speaker 0>Carlos asking a question.

00:41:08.265 --> 00:41:10.585
<v Speaker 0>That's the minimum, host pad needed.

00:41:11.065 --> 00:41:11.705
<v Speaker 0>So,

00:41:12.505 --> 00:41:15.305
<v Speaker 0>you can actually run this daemon set without

00:41:15.305 --> 00:41:17.385
<v Speaker 0>host pad, without host IPC,

00:41:17.465 --> 00:41:18.665
<v Speaker 0>without host networking,

00:41:19.470 --> 00:41:21.230
<v Speaker 0>and it will still work. But you're gonna

00:41:21.230 --> 00:41:23.950
<v Speaker 0>get server access to the pod.

00:41:25.070 --> 00:41:27.150
<v Speaker 0>I'm just trying to make that slightly more

00:41:27.150 --> 00:41:29.470
<v Speaker 0>useful for its intended purpose, which is host

00:41:29.470 --> 00:41:30.270
<v Speaker 0>access.

00:41:31.310 --> 00:41:33.150
<v Speaker 0>Going so far, it's just not to mount

00:41:33.150 --> 00:41:34.030
<v Speaker 0>the host file system.

00:41:34.565 --> 00:41:36.405
<v Speaker 0>What that means is if I click root

00:41:36.405 --> 00:41:37.205
<v Speaker 0>here,

00:41:39.605 --> 00:41:41.605
<v Speaker 0>I can see everything that's running on this

00:41:41.605 --> 00:41:42.245
<v Speaker 0>machine.

00:41:43.045 --> 00:41:45.205
<v Speaker 0>Like I said, you could easily mount it

00:41:45.205 --> 00:41:47.365
<v Speaker 0>to our host file system to slash host,

00:41:49.070 --> 00:41:51.230
<v Speaker 0>But it's just not needed. We can run

00:41:51.230 --> 00:41:52.670
<v Speaker 0>top, we can see what's going on in

00:41:52.670 --> 00:41:53.470
<v Speaker 0>this machine.

00:41:53.630 --> 00:41:55.550
<v Speaker 0>Really, I'm just exposing enough that I feel

00:41:55.550 --> 00:41:57.550
<v Speaker 0>I can debug something that's wrong with this

00:41:57.550 --> 00:41:58.110
<v Speaker 0>machine.

00:41:58.430 --> 00:42:00.350
<v Speaker 0>In fact, with the permissions I have now,

00:42:00.350 --> 00:42:02.990
<v Speaker 0>I could from here mount the host file

00:42:02.990 --> 00:42:03.310
<v Speaker 0>system.

00:42:04.665 --> 00:42:07.305
<v Speaker 0>We have complete access to the blocked devices.

00:42:07.545 --> 00:42:09.785
<v Speaker 0>So, you can do anything you want.

00:42:13.065 --> 00:42:14.265
<v Speaker 0>I think that would work.

00:42:16.900 --> 00:42:18.580
<v Speaker 0>Dev SD

00:42:22.980 --> 00:42:23.620
<v Speaker 0>one.

00:42:26.580 --> 00:42:27.700
<v Speaker 0>Yeah. There we go.

00:42:28.515 --> 00:42:29.795
<v Speaker 0>But we don't wanna do that.

00:42:31.395 --> 00:42:32.915
<v Speaker 0>So, there's no

00:42:33.315 --> 00:42:36.835
<v Speaker 0>let me recap. There's no supported way from

00:42:36.835 --> 00:42:39.555
<v Speaker 0>Teleport yet to really run-in this configuration.

00:42:39.555 --> 00:42:39.954
<v Speaker 0>The idea,

00:42:40.670 --> 00:42:42.110
<v Speaker 0>I'm going to speak for Teleport, what I

00:42:42.110 --> 00:42:43.550
<v Speaker 0>think they're going for here. They're a very

00:42:43.550 --> 00:42:44.990
<v Speaker 0>security conscious company.

00:42:45.870 --> 00:42:48.110
<v Speaker 0>I don't think they would encourage running privileged

00:42:48.110 --> 00:42:49.310
<v Speaker 0>pods in this fashion.

00:42:50.670 --> 00:42:53.635
<v Speaker 0>You'd probably, as you configure your nodes, would

00:42:53.635 --> 00:42:55.955
<v Speaker 0>run the Teleport agent from there and keep

00:42:55.955 --> 00:42:58.115
<v Speaker 0>it out of the Kubernetes system altogether, only

00:42:58.115 --> 00:43:00.515
<v Speaker 0>running the kube proxy inside of the cluster.

00:43:00.515 --> 00:43:02.195
<v Speaker 0>I think that's the ideal way.

00:43:02.755 --> 00:43:05.155
<v Speaker 0>You can do it this way though. I've

00:43:05.155 --> 00:43:07.235
<v Speaker 0>ran this as an example. Use it as

00:43:07.235 --> 00:43:07.635
<v Speaker 0>you wish.

00:43:08.900 --> 00:43:09.620
<v Speaker 0>Okay.

00:43:10.900 --> 00:43:13.940
<v Speaker 0>Yeah, Mollis, you're 100% right. The security people

00:43:13.940 --> 00:43:15.620
<v Speaker 0>would just not be happy with running the

00:43:15.620 --> 00:43:16.980
<v Speaker 0>pods with these privileges.

00:43:17.860 --> 00:43:18.420
<v Speaker 0>Really,

00:43:19.700 --> 00:43:20.660
<v Speaker 0>as an example,

00:43:20.820 --> 00:43:21.860
<v Speaker 0>you can do it

00:43:22.295 --> 00:43:24.295
<v Speaker 0>and only you will know what you need

00:43:24.295 --> 00:43:26.455
<v Speaker 0>to expose from server access at this level.

00:43:26.455 --> 00:43:27.975
<v Speaker 0>So just give yourself enough to be able

00:43:27.975 --> 00:43:29.895
<v Speaker 0>to get SREs or ops people to do

00:43:29.895 --> 00:43:31.815
<v Speaker 0>the jobs. They probably have SSH access to

00:43:31.815 --> 00:43:32.935
<v Speaker 0>the servers anyway,

00:43:33.575 --> 00:43:35.655
<v Speaker 0>but I don't run SSH in production. So

00:43:35.655 --> 00:43:38.010
<v Speaker 0>I would probably give them best route because

00:43:38.010 --> 00:43:39.130
<v Speaker 0>it's just all

00:43:39.610 --> 00:43:40.330
<v Speaker 0>audited.

00:43:42.090 --> 00:43:44.570
<v Speaker 0>Although I'd probably run Teleport through node provisioning

00:43:44.570 --> 00:43:47.050
<v Speaker 0>rather than Kubernetes with a daemon set. But,

00:43:47.050 --> 00:43:48.410
<v Speaker 0>you know, we don't always get to pick

00:43:48.410 --> 00:43:48.730
<v Speaker 0>and choose.

00:43:50.855 --> 00:43:52.935
<v Speaker 0>And Carlos, yeah, got it. It's just so

00:43:52.935 --> 00:43:54.535
<v Speaker 0>that when you SSH in, you have visibility

00:43:54.535 --> 00:43:55.974
<v Speaker 0>to other bits here. That's the only reason

00:43:55.974 --> 00:43:57.335
<v Speaker 0>I gave it up, is so you can

00:43:57.335 --> 00:43:59.655
<v Speaker 0>run it like debugging that 101, right? It's

00:43:59.655 --> 00:44:00.935
<v Speaker 0>to run PS and see what's going on

00:44:00.935 --> 00:44:02.935
<v Speaker 0>with the system and then probably followed by

00:44:02.935 --> 00:44:04.694
<v Speaker 0>talk to see what's using resources.

00:44:05.330 --> 00:44:06.930
<v Speaker 0>So, I just wanted to enable that use

00:44:06.930 --> 00:44:08.130
<v Speaker 0>case and that was all.

00:44:10.210 --> 00:44:11.570
<v Speaker 0>Okay, so we're gonna take a look at

00:44:11.570 --> 00:44:12.770
<v Speaker 0>our last step now,

00:44:13.970 --> 00:44:15.730
<v Speaker 0>which is we

00:44:15.970 --> 00:44:17.330
<v Speaker 0>have this other

00:44:18.450 --> 00:44:19.250
<v Speaker 0>Kubernetes

00:44:19.250 --> 00:44:19.730
<v Speaker 0>cluster

00:44:21.095 --> 00:44:22.215
<v Speaker 0>Pop down here.

00:44:22.775 --> 00:44:23.815
<v Speaker 0>Oh, I need to be in the same

00:44:23.815 --> 00:44:25.734
<v Speaker 0>folder because that's where I stored

00:44:27.414 --> 00:44:30.375
<v Speaker 0>my context. So this shell is now going

00:44:30.375 --> 00:44:31.974
<v Speaker 0>to be Teleport three,

00:44:33.494 --> 00:44:35.015
<v Speaker 0>which is another SQL cluster.

00:44:35.870 --> 00:44:38.270
<v Speaker 0>We still have our JKE one on the

00:44:38.270 --> 00:44:38.830
<v Speaker 0>top.

00:44:40.190 --> 00:44:41.150
<v Speaker 0>There we go.

00:44:41.710 --> 00:44:44.350
<v Speaker 0>So, can we run the other Helm chart

00:44:44.350 --> 00:44:47.390
<v Speaker 0>that Teleport does support, the KubeAgent one, to

00:44:47.390 --> 00:44:50.615
<v Speaker 0>give access to this cluster from anyone authenticated

00:44:50.615 --> 00:44:51.815
<v Speaker 0>against this cluster.

00:44:53.815 --> 00:44:54.455
<v Speaker 0>So,

00:44:55.415 --> 00:44:56.775
<v Speaker 0>the first thing we need to do is

00:44:56.775 --> 00:44:58.855
<v Speaker 0>create a token. So this is very similar

00:44:58.855 --> 00:45:01.255
<v Speaker 0>to the static one that we just created,

00:45:01.415 --> 00:45:03.494
<v Speaker 0>only this is the slightly nicer way of

00:45:03.494 --> 00:45:03.815
<v Speaker 0>doing it.

00:45:05.500 --> 00:45:07.099
<v Speaker 0>I can do this from

00:45:09.900 --> 00:45:10.859
<v Speaker 0>t c t

00:45:11.500 --> 00:45:14.619
<v Speaker 0>no. Because I'm not authenticated. I'm

00:45:14.619 --> 00:45:17.339
<v Speaker 0>not authenticated against this cluster on the command

00:45:17.235 --> 00:45:18.995
<v Speaker 0>with TSH login.

00:45:19.155 --> 00:45:20.675
<v Speaker 0>Although I could be, right?

00:45:20.915 --> 00:45:22.435
<v Speaker 0>Yeah. Okay. Let's do it.

00:45:22.755 --> 00:45:24.995
<v Speaker 0>TSH login proxy,

00:45:25.315 --> 00:45:26.355
<v Speaker 0>and this is

00:45:27.075 --> 00:45:28.435
<v Speaker 0>not my Teleport Cloud.

00:45:30.790 --> 00:45:31.510
<v Speaker 0>User

00:45:31.829 --> 00:45:32.790
<v Speaker 0>Rawkode.

00:45:34.390 --> 00:45:36.869
<v Speaker 0>So, there I can get CLI access to

00:45:36.869 --> 00:45:38.950
<v Speaker 0>this Teleport cluster. Provided

00:45:38.950 --> 00:45:39.830
<v Speaker 0>I have

00:45:40.869 --> 00:45:41.590
<v Speaker 0>this,

00:45:41.750 --> 00:45:43.030
<v Speaker 0>my password

00:45:43.750 --> 00:45:45.109
<v Speaker 0>and my OTP,

00:45:45.485 --> 00:45:47.245
<v Speaker 0>which is the bottom one.

00:45:49.325 --> 00:45:50.765
<v Speaker 0>Okay.

00:45:50.765 --> 00:45:52.525
<v Speaker 0>So now we should be able to do

00:45:53.485 --> 00:45:54.845
<v Speaker 0>TSHQLS,

00:45:54.845 --> 00:45:55.965
<v Speaker 0>certify cluster.

00:45:56.525 --> 00:45:58.525
<v Speaker 0>We should be able to do server,

00:46:00.445 --> 00:46:01.085
<v Speaker 0>SSHLS.

00:46:04.970 --> 00:46:06.490
<v Speaker 0>Something wrong with that tunnel.

00:46:09.050 --> 00:46:11.370
<v Speaker 0>I'm just forgetting how Teleport works.

00:46:14.235 --> 00:46:16.395
<v Speaker 0>Yeah. SSH is actually SSH.

00:46:16.395 --> 00:46:18.155
<v Speaker 0>How do you list the servers again?

00:46:25.515 --> 00:46:27.835
<v Speaker 0>Nodes LS. Okay. So TCTL.

00:46:29.790 --> 00:46:31.950
<v Speaker 0>There we go. So, I now have command

00:46:31.950 --> 00:46:34.510
<v Speaker 0>line access to my JKE

00:46:34.670 --> 00:46:35.550
<v Speaker 0>Teleport,

00:46:35.950 --> 00:46:37.310
<v Speaker 0>which is where we wanna be.

00:46:37.710 --> 00:46:39.550
<v Speaker 0>I'm gonna create this token,

00:46:41.325 --> 00:46:43.484
<v Speaker 0>which is the type cube. So remember when

00:46:43.484 --> 00:46:45.484
<v Speaker 0>we added one to the actual configuration file

00:46:45.484 --> 00:46:47.405
<v Speaker 0>in the config map, we added a static

00:46:47.405 --> 00:46:49.645
<v Speaker 0>token. This is a dynamic token, which will

00:46:49.645 --> 00:46:51.325
<v Speaker 0>expire in forty eight hours.

00:46:54.045 --> 00:46:55.244
<v Speaker 0>And it's basically one.

00:47:01.300 --> 00:47:02.180
<v Speaker 0>There we go.

00:47:04.420 --> 00:47:05.860
<v Speaker 0>So we can now

00:47:05.940 --> 00:47:07.940
<v Speaker 0>use this token for the next two thousand

00:47:07.940 --> 00:47:10.454
<v Speaker 0>eight hundred and eighty minutes to register a

00:47:10.454 --> 00:47:12.775
<v Speaker 0>Kubernetes cluster with this cluster.

00:47:13.174 --> 00:47:14.055
<v Speaker 0>Got it.

00:47:14.694 --> 00:47:17.015
<v Speaker 0>Let's copy the fact. Let's get the command

00:47:17.015 --> 00:47:19.255
<v Speaker 0>first. So this is the Helm

00:47:19.654 --> 00:47:21.015
<v Speaker 0>chart that we're using now.

00:47:23.140 --> 00:47:25.620
<v Speaker 0>So, we're sending it to I'm getting myself

00:47:25.620 --> 00:47:27.300
<v Speaker 0>confused. That means you must be confused as

00:47:27.300 --> 00:47:29.540
<v Speaker 0>well, but I'll I'm gonna slow down.

00:47:29.860 --> 00:47:31.620
<v Speaker 0>So, on our Civo cluster, we want to

00:47:31.620 --> 00:47:33.540
<v Speaker 0>deploy a new Helm chart called Teleport Kube

00:47:33.540 --> 00:47:35.540
<v Speaker 0>Agent. We're gonna create a namespace that's gonna

00:47:35.540 --> 00:47:36.340
<v Speaker 0>be called Teleport.

00:47:36.744 --> 00:47:38.265
<v Speaker 0>This time we're setting the roles to be

00:47:38.265 --> 00:47:39.145
<v Speaker 0>Kubernetes.

00:47:39.305 --> 00:47:40.665
<v Speaker 0>This deployment

00:47:40.665 --> 00:47:42.825
<v Speaker 0>is only going to expose

00:47:42.825 --> 00:47:44.905
<v Speaker 0>our be a Kube proxy.

00:47:45.464 --> 00:47:47.945
<v Speaker 0>We could also do DB

00:47:47.945 --> 00:47:50.210
<v Speaker 0>and app. So, if there were databases and

00:47:50.210 --> 00:47:51.810
<v Speaker 0>applications that we wanted to expose, we could

00:47:51.810 --> 00:47:53.170
<v Speaker 0>do them in this fashion. But right now,

00:47:53.170 --> 00:47:54.290
<v Speaker 0>we're just focused on Kube.

00:47:54.770 --> 00:47:56.369
<v Speaker 0>Our proxy address is not gonna be my

00:47:56.369 --> 00:47:58.690
<v Speaker 0>Teleport cloud account. It's gonna be our JKE

00:47:58.690 --> 00:48:01.730
<v Speaker 0>cluster. So, we're gonna use teleport.rockwood.sh

00:48:01.730 --> 00:48:02.849
<v Speaker 0>on port four forty three.

00:48:03.654 --> 00:48:05.575
<v Speaker 0>We then need to provide our auth token,

00:48:05.575 --> 00:48:07.494
<v Speaker 0>which we have access to here. We just

00:48:07.494 --> 00:48:08.455
<v Speaker 0>created this.

00:48:10.375 --> 00:48:11.655
<v Speaker 0>Delete the dot.

00:48:12.535 --> 00:48:14.375
<v Speaker 0>And we give this cluster a name, which

00:48:14.375 --> 00:48:15.174
<v Speaker 0>is CVo3,

00:48:15.970 --> 00:48:19.410
<v Speaker 0>and then we're specifically deploying the Teleport KubeAgent

00:48:19.410 --> 00:48:20.050
<v Speaker 0>chart.

00:48:21.250 --> 00:48:21.970
<v Speaker 0>Cool.

00:48:24.450 --> 00:48:25.330
<v Speaker 0>Alright.

00:48:26.130 --> 00:48:28.130
<v Speaker 0>So, now we can take a look at

00:48:28.130 --> 00:48:30.125
<v Speaker 0>the Teleport namespace. We can see the pod

00:48:30.125 --> 00:48:31.244
<v Speaker 0>is pulling. We're gonna have to wait for

00:48:31.244 --> 00:48:32.605
<v Speaker 0>that image one more time on a fresh

00:48:32.605 --> 00:48:33.885
<v Speaker 0>cluster, unfortunately.

00:48:34.285 --> 00:48:36.685
<v Speaker 0>But if we wait ten to twenty seconds,

00:48:37.244 --> 00:48:39.244
<v Speaker 0>what we are going to see is that

00:48:39.244 --> 00:48:42.045
<v Speaker 0>this proxy registers with our primary cluster, which

00:48:42.045 --> 00:48:42.925
<v Speaker 0>is available here.

00:48:43.890 --> 00:48:46.529
<v Speaker 0>And in fact, it's already there. There we

00:48:46.529 --> 00:48:47.010
<v Speaker 0>go.

00:48:47.730 --> 00:48:48.609
<v Speaker 0>So now,

00:48:48.930 --> 00:48:52.049
<v Speaker 0>even though I'm authenticated against my Teleport JKE,

00:48:52.049 --> 00:48:54.049
<v Speaker 0>I can use that to query any other

00:48:54.049 --> 00:48:56.049
<v Speaker 0>Kubernetes cluster within my infrastructure.

00:48:57.425 --> 00:48:59.025
<v Speaker 0>I don't even think that was running yet,

00:48:59.025 --> 00:48:59.825
<v Speaker 0>but it is.

00:49:01.025 --> 00:49:02.625
<v Speaker 0>So, we can pop over here.

00:49:02.945 --> 00:49:04.785
<v Speaker 0>And what I'm gonna do is, you know,

00:49:04.785 --> 00:49:06.625
<v Speaker 0>if I run kubi,

00:49:08.225 --> 00:49:09.105
<v Speaker 0>kubi

00:49:09.640 --> 00:49:10.680
<v Speaker 0>ctx.

00:49:10.680 --> 00:49:12.440
<v Speaker 0>You know, I do have access to all

00:49:12.440 --> 00:49:14.520
<v Speaker 0>all these clusters just because of the directory

00:49:14.520 --> 00:49:15.960
<v Speaker 0>that I'm in. I'm gonna go to the

00:49:15.960 --> 00:49:16.840
<v Speaker 0>temp directory.

00:49:17.640 --> 00:49:19.320
<v Speaker 0>And if I run kubi ctx,

00:49:19.720 --> 00:49:21.560
<v Speaker 0>we don't have anything. We have no access

00:49:21.560 --> 00:49:23.080
<v Speaker 0>because we're not in the right directory anymore.

00:49:24.895 --> 00:49:27.375
<v Speaker 0>In fact, I don't think I can even

00:49:27.375 --> 00:49:28.015
<v Speaker 0>run.

00:49:29.214 --> 00:49:31.295
<v Speaker 0>Although that may still be configured for the

00:49:31.295 --> 00:49:31.934
<v Speaker 0>JKE one.

00:49:35.950 --> 00:49:37.630
<v Speaker 0>But that's okay. It's the JKE one. We're

00:49:37.630 --> 00:49:39.150
<v Speaker 0>gonna try and preview the other one.

00:49:40.110 --> 00:49:41.790
<v Speaker 0>Maybe I should just unset all of this.

00:49:50.145 --> 00:49:52.225
<v Speaker 0>Was that too bold? Where? What?

00:50:00.225 --> 00:50:01.985
<v Speaker 0>Where are those two times coming from?

00:50:26.595 --> 00:50:29.234
<v Speaker 0>Okay. That should definitely feel alright. Yeah.

00:50:31.140 --> 00:50:32.180
<v Speaker 0>Okay.

00:50:32.180 --> 00:50:33.779
<v Speaker 0>So now we have access to no Kubernetes

00:50:33.779 --> 00:50:34.420
<v Speaker 0>cluster.

00:50:34.900 --> 00:50:36.900
<v Speaker 0>So we're gonna click connect on this.

00:50:37.299 --> 00:50:38.900
<v Speaker 0>We don't need to log in. We've already

00:50:38.900 --> 00:50:40.900
<v Speaker 0>logged on to our Teleport cluster.

00:50:42.420 --> 00:50:45.140
<v Speaker 0>We do a TSH kube login to c

00:50:45.140 --> 00:50:45.619
<v Speaker 0>v three.

00:50:48.865 --> 00:50:49.585
<v Speaker 0>And

00:50:49.665 --> 00:50:50.785
<v Speaker 0>kubectl

00:50:50.785 --> 00:50:51.665
<v Speaker 0>get

00:50:51.744 --> 00:50:52.065
<v Speaker 0>notes.

00:51:00.819 --> 00:51:02.260
<v Speaker 0>This worked last time.

00:51:05.859 --> 00:51:08.260
<v Speaker 0>Yeah, Russell. It was. It was my QConfig

00:51:08.260 --> 00:51:09.780
<v Speaker 0>was pointing to that local file,

00:51:09.940 --> 00:51:11.380
<v Speaker 0>which is why I was so confused because

00:51:11.380 --> 00:51:13.859
<v Speaker 0>I had dropped out my QBContext.

00:51:13.859 --> 00:51:15.940
<v Speaker 0>Qb is a command I just discovered today.

00:51:16.775 --> 00:51:17.895
<v Speaker 0>Really cool though.

00:51:19.975 --> 00:51:20.695
<v Speaker 0>Okay.

00:51:21.335 --> 00:51:24.535
<v Speaker 0>Ten minutes to debug. Why that authentication failed?

00:51:24.615 --> 00:51:26.455
<v Speaker 0>Do we wanna try that or no?

00:51:27.575 --> 00:51:28.695
<v Speaker 0>During my tests,

00:51:29.175 --> 00:51:30.855
<v Speaker 0>this just worked. Right? So

00:51:31.500 --> 00:51:33.900
<v Speaker 0>when you do a TSH kube login,

00:51:34.060 --> 00:51:35.580
<v Speaker 0>what that does

00:51:36.220 --> 00:51:36.940
<v Speaker 0>is

00:51:37.100 --> 00:51:38.700
<v Speaker 0>pull down some Kubernetes.

00:51:43.914 --> 00:51:46.075
<v Speaker 0>Okay. Let's do config view.

00:51:46.714 --> 00:51:47.355
<v Speaker 0>Yeah.

00:51:48.555 --> 00:51:49.195
<v Speaker 0>When

00:51:49.434 --> 00:51:52.234
<v Speaker 0>you do the TSH kube login, it configures

00:51:52.234 --> 00:51:53.595
<v Speaker 0>you a kube config.

00:51:54.875 --> 00:51:57.115
<v Speaker 0>It sets up the certificates,

00:51:58.569 --> 00:51:59.690
<v Speaker 0>points it to the cross

00:52:00.170 --> 00:52:01.690
<v Speaker 0>points it to the cluster.

00:52:02.890 --> 00:52:04.650
<v Speaker 0>And then you've got some

00:52:04.650 --> 00:52:07.530
<v Speaker 0>exec helpers where it's using TSH just to

00:52:07.530 --> 00:52:09.690
<v Speaker 0>validate your config and stuff like that, your

00:52:09.690 --> 00:52:10.490
<v Speaker 0>your credentials.

00:52:11.885 --> 00:52:14.125
<v Speaker 0>And then normally when I do get

00:52:14.365 --> 00:52:16.845
<v Speaker 0>pods, it works. However, this is telling me

00:52:16.845 --> 00:52:19.245
<v Speaker 0>that the user cannot request Kubernetes access,

00:52:19.325 --> 00:52:21.245
<v Speaker 0>has no assigned groups or users.

00:52:22.525 --> 00:52:23.965
<v Speaker 0>Now what that means

00:52:24.609 --> 00:52:25.330
<v Speaker 0>is

00:52:33.410 --> 00:52:36.290
<v Speaker 0>what this means is that my user here

00:52:37.145 --> 00:52:38.585
<v Speaker 0>doesn't have permissions

00:52:38.585 --> 00:52:39.385
<v Speaker 0>to

00:52:39.385 --> 00:52:41.705
<v Speaker 0>be part of that Kubernetes cluster.

00:52:42.585 --> 00:52:44.505
<v Speaker 0>So I could come in and take a

00:52:44.505 --> 00:52:46.105
<v Speaker 0>look at the rules here.

00:52:48.425 --> 00:52:49.545
<v Speaker 0>And we can see,

00:52:53.520 --> 00:52:56.000
<v Speaker 0>and that should be okay. I actually don't

00:52:56.000 --> 00:52:57.680
<v Speaker 0>have access to the Kubernetes cluster.

00:52:58.240 --> 00:52:59.520
<v Speaker 0>This must be a Teleport bug.

00:53:04.075 --> 00:53:05.755
<v Speaker 0>Alright, I'm gonna try and fix it.

00:53:07.595 --> 00:53:09.035
<v Speaker 0>I will reach out to the Teleport team

00:53:09.035 --> 00:53:10.635
<v Speaker 0>and see what happens. However,

00:53:10.875 --> 00:53:12.955
<v Speaker 0>what's important from this final

00:53:13.195 --> 00:53:15.035
<v Speaker 0>update the access rule for Kubernetes.

00:53:16.555 --> 00:53:17.675
<v Speaker 0>Yeah, nice one, Miles.

00:53:20.500 --> 00:53:21.300
<v Speaker 0>Carlos

00:53:21.300 --> 00:53:24.420
<v Speaker 0>saying Rawkode is missing. Moz is just telling

00:53:24.420 --> 00:53:25.300
<v Speaker 0>me to go

00:53:26.579 --> 00:53:28.660
<v Speaker 0>all smashing on it and give myself everything.

00:53:31.385 --> 00:53:33.385
<v Speaker 0>So, this is filling at the Teleport level,

00:53:33.385 --> 00:53:35.865
<v Speaker 0>not the Kubernetes level. In fact, we

00:53:35.945 --> 00:53:38.025
<v Speaker 0>can prove that. We can

00:53:40.185 --> 00:53:41.705
<v Speaker 0>connect to my GKE cluster.

00:53:45.620 --> 00:53:47.220
<v Speaker 0>Run get pods here.

00:53:52.180 --> 00:53:53.780
<v Speaker 0>No. We wanna speak to the

00:53:56.420 --> 00:53:57.860
<v Speaker 0>We wanna speak to the SIBO where the

00:53:57.860 --> 00:53:59.060
<v Speaker 0>the proxy is.

00:54:01.265 --> 00:54:03.025
<v Speaker 0>I'm only gonna spend a minute

00:54:03.425 --> 00:54:04.305
<v Speaker 0>on this.

00:54:05.745 --> 00:54:08.145
<v Speaker 0>So let's export.

00:54:13.745 --> 00:54:15.265
<v Speaker 0>Where's my SQL three?

00:54:20.119 --> 00:54:21.320
<v Speaker 0>Teleport three.

00:54:22.599 --> 00:54:23.560
<v Speaker 0>Teleport

00:54:23.560 --> 00:54:24.680
<v Speaker 0>get pods.

00:54:25.400 --> 00:54:26.520
<v Speaker 0>Log slash s.

00:54:29.335 --> 00:54:30.535
<v Speaker 0>There we go.

00:54:31.335 --> 00:54:31.975
<v Speaker 0>So,

00:54:32.615 --> 00:54:34.535
<v Speaker 0>this is showing us, this is the Kubernetes

00:54:34.535 --> 00:54:36.215
<v Speaker 0>proxy on CvO3,

00:54:36.855 --> 00:54:39.655
<v Speaker 0>which is actually telling us that a client

00:54:39.655 --> 00:54:42.650
<v Speaker 0>connected. So this is, this was my request

00:54:42.650 --> 00:54:43.609
<v Speaker 0>coming through.

00:54:45.529 --> 00:54:46.490
<v Speaker 0>If we do

00:54:48.089 --> 00:54:49.609
<v Speaker 0>Is that gonna do it? No.

00:54:50.250 --> 00:54:52.250
<v Speaker 0>I guess because I already had the session.

00:54:56.214 --> 00:54:57.895
<v Speaker 0>It'll only log in and log out.

00:54:58.615 --> 00:55:00.215
<v Speaker 0>It looks like I am

00:55:00.615 --> 00:55:03.175
<v Speaker 0>speaking to the proxy and that's going okay,

00:55:03.175 --> 00:55:05.175
<v Speaker 0>but then Teleport itself is saying that I

00:55:05.175 --> 00:55:06.375
<v Speaker 0>don't have the permissions to do what I

00:55:06.375 --> 00:55:07.095
<v Speaker 0>wanna do

00:55:07.494 --> 00:55:09.335
<v Speaker 0>when we run get pods.

00:55:10.700 --> 00:55:13.579
<v Speaker 0>This user cannot request Kubernetes access. So my

00:55:13.579 --> 00:55:15.500
<v Speaker 0>Teleport permissions don't really allow me to do

00:55:15.500 --> 00:55:16.619
<v Speaker 0>what I wanna do, and it's telling me

00:55:16.619 --> 00:55:18.220
<v Speaker 0>that because it has no assigned groups or

00:55:18.220 --> 00:55:18.539
<v Speaker 0>users.

00:55:24.974 --> 00:55:26.975
<v Speaker 0>I haven't modified this before.

00:55:28.335 --> 00:55:30.815
<v Speaker 0>If we modify the access one here

00:55:32.815 --> 00:55:34.255
<v Speaker 0>maybe Moz is right.

00:55:34.974 --> 00:55:37.214
<v Speaker 0>Maybe we could do this, which would get

00:55:37.214 --> 00:55:38.175
<v Speaker 0>me root in a cluster.

00:55:39.450 --> 00:55:41.690
<v Speaker 0>So on a Kubernetes cluster, this is my

00:55:41.690 --> 00:55:44.810
<v Speaker 0>JKE one. We can run Kubernetes get

00:55:49.130 --> 00:55:49.930
<v Speaker 0>cluster

00:55:50.330 --> 00:55:50.810
<v Speaker 0>roles.

00:55:52.925 --> 00:55:54.365
<v Speaker 0>And there's admin.

00:55:54.525 --> 00:55:56.605
<v Speaker 0>It's not system master though, is it?

00:56:00.285 --> 00:56:01.165
<v Speaker 0>Grap.

00:56:04.845 --> 00:56:05.405
<v Speaker 0>Yeah.

00:56:06.339 --> 00:56:07.140
<v Speaker 0>System.

00:56:07.140 --> 00:56:09.060
<v Speaker 0>I guess I could just do admin.

00:56:16.980 --> 00:56:18.740
<v Speaker 0>Basic user may be healthy.

00:56:20.184 --> 00:56:21.385
<v Speaker 0>Let's try admin.

00:56:28.424 --> 00:56:29.944
<v Speaker 0>My service accounts.

00:56:33.810 --> 00:56:35.170
<v Speaker 0>I feel like I'm going a bit rogue

00:56:35.170 --> 00:56:35.730
<v Speaker 0>here.

00:56:46.290 --> 00:56:47.424
<v Speaker 0>Grap system.

00:57:09.850 --> 00:57:12.410
<v Speaker 0>I don't know what service account we'd wanna

00:57:12.410 --> 00:57:13.450
<v Speaker 0>try and be.

00:57:15.530 --> 00:57:17.735
<v Speaker 0>Let's just try the group. I'm gonna save

00:57:17.735 --> 00:57:18.375
<v Speaker 0>that.

00:57:19.175 --> 00:57:21.015
<v Speaker 0>Now the next thing I need to do

00:57:21.015 --> 00:57:21.735
<v Speaker 0>is

00:57:22.055 --> 00:57:23.255
<v Speaker 0>TSH

00:57:23.335 --> 00:57:24.295
<v Speaker 0>log out.

00:57:25.815 --> 00:57:28.695
<v Speaker 0>Log in because you need to log out

00:57:28.695 --> 00:57:30.295
<v Speaker 0>and log back in to refresh your permissions.

00:57:31.380 --> 00:57:34.660
<v Speaker 0>And this is going to be TeleportRawkode.s

00:57:34.660 --> 00:57:37.060
<v Speaker 0>h user Rawkode.

00:57:39.859 --> 00:57:40.660
<v Speaker 0>I need port.

00:57:47.994 --> 00:57:48.955
<v Speaker 0>Password

00:57:49.195 --> 00:57:49.915
<v Speaker 0>and

00:57:50.075 --> 00:57:50.795
<v Speaker 0>token.

00:57:55.035 --> 00:57:56.075
<v Speaker 0>Kube

00:57:56.315 --> 00:57:56.875
<v Speaker 0>login.

00:58:06.980 --> 00:58:08.820
<v Speaker 0>We got a little bit further there. So

00:58:08.820 --> 00:58:11.380
<v Speaker 0>now I'm getting user Rawkode cannot less resources

00:58:11.380 --> 00:58:12.980
<v Speaker 0>pods in API group.

00:58:14.260 --> 00:58:15.060
<v Speaker 0>So

00:58:15.795 --> 00:58:17.075
<v Speaker 0>that

00:58:17.234 --> 00:58:19.395
<v Speaker 0>horrible little hack half worked. Like, I now

00:58:19.395 --> 00:58:20.755
<v Speaker 0>have convinced

00:58:20.755 --> 00:58:23.315
<v Speaker 0>Teleport that I have access to this cluster.

00:58:23.315 --> 00:58:24.755
<v Speaker 0>We're now querying

00:58:24.915 --> 00:58:26.675
<v Speaker 0>the Kubernetes API.

00:58:26.675 --> 00:58:29.234
<v Speaker 0>However, have now broken the authentication and let

00:58:29.234 --> 00:58:31.474
<v Speaker 0>things in the user Rawkode

00:58:31.930 --> 00:58:34.330
<v Speaker 0>rather than something else. Now,

00:58:35.210 --> 00:58:36.730
<v Speaker 0>I mean, I could just go down the

00:58:36.730 --> 00:58:38.810
<v Speaker 0>road here of creating a service account called

00:58:38.810 --> 00:58:41.690
<v Speaker 0>Rawkode and giving it whatever cluster pending I

00:58:41.690 --> 00:58:43.050
<v Speaker 0>want, but I'm not gonna do that because

00:58:43.050 --> 00:58:44.885
<v Speaker 0>I am out of time and I'm just

00:58:44.885 --> 00:58:46.645
<v Speaker 0>going down a really horrible path of showing

00:58:46.645 --> 00:58:49.045
<v Speaker 0>people things that we shouldn't be doing. So

00:58:49.285 --> 00:58:50.645
<v Speaker 0>what I'm gonna do is I'll reach out

00:58:50.645 --> 00:58:52.885
<v Speaker 0>to Teleport, I'll work out why this doesn't

00:58:52.885 --> 00:58:54.645
<v Speaker 0>work out of the box, but it has

00:58:54.645 --> 00:58:56.885
<v Speaker 0>previously with Teleport seven. So I think this

00:58:56.885 --> 00:58:58.930
<v Speaker 0>is a change in Teleport eight and we'll

00:58:58.930 --> 00:59:01.090
<v Speaker 0>try and get that bug report logged and

00:59:01.090 --> 00:59:01.970
<v Speaker 0>resolved.

00:59:03.490 --> 00:59:04.290
<v Speaker 0>Phew.

00:59:04.450 --> 00:59:06.770
<v Speaker 0>That's quite a lot for one hour.

00:59:08.770 --> 00:59:11.250
<v Speaker 0>So, yeah, a few comments. Carlos is asking,

00:59:11.250 --> 00:59:13.090
<v Speaker 0>am I impersonate in the service account being

00:59:13.090 --> 00:59:13.970
<v Speaker 0>used by Teleport?

00:59:15.385 --> 00:59:18.424
<v Speaker 0>Kind of. Your Teleport user is getting mapped

00:59:18.424 --> 00:59:20.585
<v Speaker 0>to a service account with some rule bindings

00:59:20.585 --> 00:59:22.825
<v Speaker 0>in the cluster. You get to configure all

00:59:22.825 --> 00:59:23.464
<v Speaker 0>of that.

00:59:23.785 --> 00:59:24.585
<v Speaker 0>By default,

00:59:25.305 --> 00:59:28.025
<v Speaker 0>it just can't work. I'm not really sure

00:59:28.025 --> 00:59:28.744
<v Speaker 0>what's happened there.

00:59:30.680 --> 00:59:32.200
<v Speaker 0>Russell is asking, if I only have to

00:59:32.200 --> 00:59:33.799
<v Speaker 0>log out if you add new rules and

00:59:33.799 --> 00:59:35.320
<v Speaker 0>not change prefs.

00:59:36.599 --> 00:59:38.520
<v Speaker 0>You're right. I didn't have to log out.

00:59:38.920 --> 00:59:41.319
<v Speaker 0>Good catch. In fact, is right there behind

00:59:41.319 --> 00:59:42.359
<v Speaker 0>you. No need to log out.

00:59:44.375 --> 00:59:45.575
<v Speaker 0>Okay.

00:59:45.655 --> 00:59:47.175
<v Speaker 0>As Carlos says,

00:59:47.655 --> 00:59:48.535
<v Speaker 0>thank you.

00:59:49.734 --> 00:59:51.895
<v Speaker 0>On how to hack yourself. Yeah, there was

00:59:51.895 --> 00:59:54.454
<v Speaker 0>some terrible advice in today's workshop with regards

00:59:54.454 --> 00:59:55.095
<v Speaker 0>to

00:59:55.335 --> 00:59:56.775
<v Speaker 0>running

00:59:56.330 --> 00:59:59.930
<v Speaker 0>privileged daemon sets and modifying permissions forever.

01:00:01.130 --> 01:00:02.890
<v Speaker 0>Yeah, Moj, I could create

01:00:03.370 --> 01:00:04.970
<v Speaker 0>a service code called Rawkode and give it

01:00:04.970 --> 01:00:06.650
<v Speaker 0>cluster admin in the cluster. But

01:00:07.050 --> 01:00:09.450
<v Speaker 0>that shouldn't be the approach of what people

01:00:09.450 --> 01:00:12.155
<v Speaker 0>take home from this workshop. So,

01:00:13.275 --> 01:00:14.795
<v Speaker 0>will log the bug. We will get it

01:00:14.795 --> 01:00:16.555
<v Speaker 0>fixed. We'll do every follow-up in a week

01:00:16.555 --> 01:00:18.075
<v Speaker 0>or two whenever it's ready.

01:00:18.315 --> 01:00:20.315
<v Speaker 0>But thank you for joining me. Had a

01:00:20.315 --> 01:00:22.075
<v Speaker 0>lot of fun running through this. It's on

01:00:22.075 --> 01:00:23.835
<v Speaker 0>GitHub. Feel free to do it yourself. If

01:00:23.835 --> 01:00:24.955
<v Speaker 0>you have any issues

01:00:25.220 --> 01:00:27.859
<v Speaker 0>then you can just open them on the

01:00:27.859 --> 01:00:29.299
<v Speaker 0>repository and I'll do my best to get

01:00:29.299 --> 01:00:30.020
<v Speaker 0>them fixed.

01:00:30.339 --> 01:00:31.859
<v Speaker 0>Nice little laughter there.

01:00:34.980 --> 01:00:37.059
<v Speaker 0>Yeah. Carlos is saying, don't forget to join

01:00:37.059 --> 01:00:38.660
<v Speaker 0>the Kubernetes happy hour this week.

01:00:39.395 --> 01:00:41.875
<v Speaker 0>Carlos and I are hosting the Kubernetes office

01:00:41.875 --> 01:00:42.915
<v Speaker 0>hours tomorrow.

01:00:43.315 --> 01:00:46.515
<v Speaker 0>That is at two p. M. GMT.

01:00:46.515 --> 01:00:48.115
<v Speaker 0>So, come and join us for that. And

01:00:48.115 --> 01:00:50.435
<v Speaker 0>Russell, you're not getting admin. Although maybe I

01:00:50.435 --> 01:00:53.075
<v Speaker 0>will federate some Teleport access. It'd be a

01:00:53.075 --> 01:00:53.795
<v Speaker 0>bit of fun one day.

01:00:54.600 --> 01:00:56.760
<v Speaker 0>Alright. I'm logging off for today. Thanks for

01:00:56.760 --> 01:00:58.120
<v Speaker 0>joining me. Have a good one, and I'll

01:00:58.120 --> 01:00:59.240
<v Speaker 0>see you all soon. Bye.

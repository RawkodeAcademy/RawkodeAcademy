WEBVTT

NOTE
Transcription provided by Deepgram
Request Id: a33fd7ab-dbe2-4e6b-995a-249dee1a0607
Created: 2025-04-29T17:11:09.115Z
Duration: 3954.1326
Channels: 1

00:00:24.769 --> 00:00:28.449
<v Speaker 0>Hello, and welcome back to the Rawkode Academy.

00:00:28.529 --> 00:00:32.049
<v Speaker 0>This is the complete gate to Teleport, and

00:00:32.049 --> 00:00:34.769
<v Speaker 0>this is a workshop number two.

00:00:35.489 --> 00:00:38.195
<v Speaker 0>That means that for the next forty minutes,

00:00:38.274 --> 00:00:40.195
<v Speaker 0>roughly, we will be taking a look at

00:00:40.195 --> 00:00:40.754
<v Speaker 0>me,

00:00:41.074 --> 00:00:44.114
<v Speaker 0>work through a GitHub document as available to

00:00:44.114 --> 00:00:45.875
<v Speaker 0>everyone to work through in their own time

00:00:45.875 --> 00:00:48.195
<v Speaker 0>to show and share

00:00:48.515 --> 00:00:51.155
<v Speaker 0>some of the cool features of Teleport. Today,

00:00:51.155 --> 00:00:55.430
<v Speaker 0>we are focused specifically on application access. We'll

00:00:55.430 --> 00:00:57.430
<v Speaker 0>cover what that means as we work through

00:00:57.430 --> 00:00:58.470
<v Speaker 0>scenarios.

00:00:58.870 --> 00:01:01.030
<v Speaker 0>But first, I really just want to get

00:01:01.030 --> 00:01:03.430
<v Speaker 0>started, show you what we're working with today,

00:01:03.590 --> 00:01:05.349
<v Speaker 0>and get started with the first task.

00:01:06.305 --> 00:01:09.265
<v Speaker 0>These are live workshops. That means you're more

00:01:09.265 --> 00:01:11.025
<v Speaker 0>than welcome if you're watching us live to

00:01:11.025 --> 00:01:13.825
<v Speaker 0>put questions into the chat, say hello,

00:01:14.065 --> 00:01:16.385
<v Speaker 0>anything you want. Just reach out and we'll

00:01:16.385 --> 00:01:17.985
<v Speaker 0>do our best to get to that as

00:01:17.985 --> 00:01:18.865
<v Speaker 0>quickly as possible.

00:01:20.270 --> 00:01:23.070
<v Speaker 0>Now let's get my screen shared.

00:01:25.950 --> 00:01:27.950
<v Speaker 0>If this is your first workshop, you can

00:01:27.950 --> 00:01:32.990
<v Speaker 0>find all of these courses at github.com/rawcodeacademy/courses.

00:01:33.595 --> 00:01:36.155
<v Speaker 0>You will find a directory there called teleport

00:01:36.155 --> 00:01:37.674
<v Speaker 0>complete guide,

00:01:37.674 --> 00:01:40.475
<v Speaker 0>and this is six application access

00:01:40.475 --> 00:01:42.795
<v Speaker 0>because this is part six of the Teleport

00:01:42.795 --> 00:01:43.515
<v Speaker 0>course.

00:01:45.274 --> 00:01:46.235
<v Speaker 0>Let's

00:01:46.235 --> 00:01:47.195
<v Speaker 0>scroll down.

00:01:49.540 --> 00:01:50.900
<v Speaker 0>So I am,

00:01:51.620 --> 00:01:53.620
<v Speaker 0>for this workshop, and I I guess probably

00:01:53.620 --> 00:01:55.860
<v Speaker 0>for all future workshops, going to be using

00:01:55.940 --> 00:01:59.300
<v Speaker 0>the Acme slash less encrypt certificates with Teleport,

00:01:59.300 --> 00:02:01.460
<v Speaker 0>which means there are domains and DNS records

00:02:01.460 --> 00:02:01.860
<v Speaker 0>configured.

00:02:02.545 --> 00:02:03.985
<v Speaker 0>I have done my best at the top

00:02:03.985 --> 00:02:05.745
<v Speaker 0>of this README document just to tell you

00:02:05.745 --> 00:02:07.505
<v Speaker 0>what those are so that you can replicate

00:02:07.505 --> 00:02:08.785
<v Speaker 0>this in your own setup.

00:02:09.505 --> 00:02:11.665
<v Speaker 0>If you are calling us directly locally and

00:02:11.665 --> 00:02:12.945
<v Speaker 0>working through it in your own time, I

00:02:12.945 --> 00:02:14.385
<v Speaker 0>would encourage you to do a search and

00:02:14.385 --> 00:02:16.305
<v Speaker 0>replace for Rawkode.sh

00:02:16.360 --> 00:02:17.879
<v Speaker 0>replace it with a domain that you have

00:02:17.879 --> 00:02:20.120
<v Speaker 0>access to the DNS records for,

00:02:20.440 --> 00:02:22.920
<v Speaker 0>just to avoid any strange errors as you

00:02:22.920 --> 00:02:23.720
<v Speaker 0>continue.

00:02:25.160 --> 00:02:29.239
<v Speaker 0>I am using Linode for today's virtual machines.

00:02:29.239 --> 00:02:30.840
<v Speaker 0>So there is a Pulumi,

00:02:32.065 --> 00:02:35.745
<v Speaker 0>small Pulumi project available here in the directory.

00:02:35.905 --> 00:02:37.425
<v Speaker 0>So you can just run Pulumi up as

00:02:37.425 --> 00:02:39.105
<v Speaker 0>long as you've got the right credentials for

00:02:39.105 --> 00:02:41.985
<v Speaker 0>the node exported in your environment. And that's

00:02:41.985 --> 00:02:43.905
<v Speaker 0>it's gonna spin up a two node setup

00:02:43.905 --> 00:02:45.905
<v Speaker 0>with just Ubuntu 20.4.

00:02:48.660 --> 00:02:49.460
<v Speaker 0>Alright.

00:02:49.540 --> 00:02:51.860
<v Speaker 0>My DNS records are all created. I'm not

00:02:51.860 --> 00:02:54.100
<v Speaker 0>going to run through exercise one,

00:02:54.340 --> 00:02:56.580
<v Speaker 0>but I will confirm that they do exist

00:02:56.580 --> 00:03:00.100
<v Speaker 0>by running a dig t dot Rawkode

00:03:00.885 --> 00:03:01.925
<v Speaker 0>dot SH.

00:03:02.005 --> 00:03:04.805
<v Speaker 0>I have a wildcard configured, so I can,

00:03:04.805 --> 00:03:06.725
<v Speaker 0>and hopefully it can do anything.

00:03:08.165 --> 00:03:10.085
<v Speaker 0>We get the same IP address

00:03:10.405 --> 00:03:13.205
<v Speaker 0>and I set up for my worker

00:03:13.205 --> 00:03:14.085
<v Speaker 0>node

00:03:14.700 --> 00:03:17.020
<v Speaker 0>w one, which has a different IP address.

00:03:17.020 --> 00:03:19.180
<v Speaker 0>That looks exactly like I expect.

00:03:19.420 --> 00:03:21.340
<v Speaker 0>That means that when we install Teleport to

00:03:21.340 --> 00:03:23.100
<v Speaker 0>these machines, it's going to pull in the

00:03:23.100 --> 00:03:24.060
<v Speaker 0>ACME certificate.

00:03:27.245 --> 00:03:29.245
<v Speaker 0>Now all of these workshops are standalone, so

00:03:29.245 --> 00:03:31.485
<v Speaker 0>we're gonna kinda quickly fly through just the

00:03:31.485 --> 00:03:33.245
<v Speaker 0>creation aspect. And again, just to make sure

00:03:33.245 --> 00:03:34.845
<v Speaker 0>that everyone is comfortable with this and you

00:03:34.845 --> 00:03:36.365
<v Speaker 0>know what you're doing, it does not hurt

00:03:36.365 --> 00:03:38.365
<v Speaker 0>to run through the setup a couple more

00:03:38.365 --> 00:03:38.685
<v Speaker 0>times.

00:03:41.019 --> 00:03:43.739
<v Speaker 0>I'm gonna start with SSH ing to my

00:03:43.739 --> 00:03:45.020
<v Speaker 0>control plane node.

00:03:47.659 --> 00:03:49.819
<v Speaker 0>There we go. And we shouldn't have Teleport

00:03:49.819 --> 00:03:51.500
<v Speaker 0>here. This machine has only been spun up

00:03:51.500 --> 00:03:53.420
<v Speaker 0>around thirty minutes ago. There's nothing on it.

00:03:53.420 --> 00:03:56.595
<v Speaker 0>This is a very generic and boring Ubuntu

00:03:56.595 --> 00:03:57.315
<v Speaker 0>machine.

00:04:00.035 --> 00:04:02.195
<v Speaker 0>We're just gonna follow all the commands. So

00:04:02.195 --> 00:04:03.555
<v Speaker 0>the first thing I'm doing is I got

00:04:03.555 --> 00:04:05.875
<v Speaker 0>better with us in the first Teleport workshop

00:04:05.875 --> 00:04:08.755
<v Speaker 0>by not setting the host name. I expected

00:04:08.755 --> 00:04:10.115
<v Speaker 0>the node to do this

00:04:10.640 --> 00:04:12.000
<v Speaker 0>through the labeling.

00:04:12.319 --> 00:04:14.160
<v Speaker 0>If we take a look at the

00:04:14.560 --> 00:04:17.040
<v Speaker 0>automation here, we do add a label,

00:04:17.279 --> 00:04:18.959
<v Speaker 0>which seems to set it on the backend

00:04:18.959 --> 00:04:21.519
<v Speaker 0>for the Linode portal, but doesn't set the

00:04:21.519 --> 00:04:23.845
<v Speaker 0>host name of the machine in the SSH.

00:04:23.845 --> 00:04:24.885
<v Speaker 0>And then the host name, which is a

00:04:24.885 --> 00:04:27.525
<v Speaker 0>local host, and it looks really crap when

00:04:27.525 --> 00:04:29.925
<v Speaker 0>you start trying to explore Teleport for the

00:04:29.925 --> 00:04:31.525
<v Speaker 0>UI or for the CLI.

00:04:31.845 --> 00:04:33.845
<v Speaker 0>So we're fixing that today. The first thing

00:04:33.845 --> 00:04:35.525
<v Speaker 0>we do is set the host name that

00:04:35.525 --> 00:04:36.245
<v Speaker 0>we want it to be.

00:04:37.229 --> 00:04:39.229
<v Speaker 0>I'm gonna copy and paste all the boring

00:04:39.229 --> 00:04:40.669
<v Speaker 0>stuff. We're using

00:04:40.910 --> 00:04:41.550
<v Speaker 0>the

00:04:41.789 --> 00:04:42.750
<v Speaker 0>Teleport

00:04:43.470 --> 00:04:46.430
<v Speaker 0>Debian and Ubuntu package repository.

00:04:47.310 --> 00:04:48.669
<v Speaker 0>What confused

00:04:48.669 --> 00:04:49.949
<v Speaker 0>me and scared me

00:04:50.405 --> 00:04:53.525
<v Speaker 0>prior to jumping onto this livestream not recording

00:04:53.925 --> 00:04:56.965
<v Speaker 0>was that Teleport 8.0.0

00:04:56.965 --> 00:04:58.085
<v Speaker 0>has been released.

00:04:58.805 --> 00:05:00.485
<v Speaker 0>It seems to be pretty new,

00:05:00.805 --> 00:05:02.885
<v Speaker 0>but I don't think based on what I've

00:05:02.885 --> 00:05:05.045
<v Speaker 0>seen in the release notes, should run into

00:05:05.045 --> 00:05:06.005
<v Speaker 0>any problems today.

00:05:07.659 --> 00:05:08.780
<v Speaker 0>Fingers crossed.

00:05:10.460 --> 00:05:12.300
<v Speaker 0>Let's give that a second. The next thing

00:05:12.300 --> 00:05:14.620
<v Speaker 0>we wanna do is configure this.

00:05:15.340 --> 00:05:17.659
<v Speaker 0>So on the first workshop, we ran into

00:05:17.659 --> 00:05:20.095
<v Speaker 0>a little issue around the secure certificate. Now

00:05:20.095 --> 00:05:21.615
<v Speaker 0>I'm not gonna go into it in detail,

00:05:21.615 --> 00:05:23.295
<v Speaker 0>but what the problem was because I decided

00:05:23.295 --> 00:05:24.895
<v Speaker 0>just to record a tutorial,

00:05:25.135 --> 00:05:26.655
<v Speaker 0>which should drop

00:05:26.655 --> 00:05:28.255
<v Speaker 0>or be available by the time you watch

00:05:28.255 --> 00:05:29.775
<v Speaker 0>this. Fingers crossed.

00:05:30.335 --> 00:05:32.655
<v Speaker 0>And it's just because Teleport needs access to

00:05:32.655 --> 00:05:34.255
<v Speaker 0>the the root CA to be able to

00:05:34.255 --> 00:05:35.775
<v Speaker 0>trust those certificates

00:05:35.750 --> 00:05:37.750
<v Speaker 0>and they're shared. And most of my tests

00:05:37.750 --> 00:05:40.150
<v Speaker 0>were in containers or using Kubernetes where I

00:05:40.150 --> 00:05:42.310
<v Speaker 0>had volumes that shared those root certificates across

00:05:42.310 --> 00:05:44.230
<v Speaker 0>the different agents. But when I did the

00:05:44.230 --> 00:05:46.070
<v Speaker 0>workshop, I used Linode for the first time

00:05:46.070 --> 00:05:47.750
<v Speaker 0>and ran into some problems and that those

00:05:47.750 --> 00:05:50.950
<v Speaker 0>certificates weren't being shared across the different

00:05:51.055 --> 00:05:52.495
<v Speaker 0>VMs. Of course not.

00:05:53.455 --> 00:05:55.695
<v Speaker 0>We can just amend all of that and

00:05:55.695 --> 00:05:59.295
<v Speaker 0>use the public DNS records and real certificates

00:05:59.295 --> 00:06:01.615
<v Speaker 0>from Let's Encrypt. So what we do here

00:06:01.615 --> 00:06:03.135
<v Speaker 0>is we say Teleport configure,

00:06:03.640 --> 00:06:05.320
<v Speaker 0>which is just gonna tell Teleport to generate

00:06:05.320 --> 00:06:06.920
<v Speaker 0>base config. We did look at this in

00:06:06.920 --> 00:06:07.880
<v Speaker 0>the first workshop.

00:06:08.600 --> 00:06:10.360
<v Speaker 0>The parameters we can pass are just, hey,

00:06:10.360 --> 00:06:11.720
<v Speaker 0>let's enable Acme.

00:06:12.120 --> 00:06:14.440
<v Speaker 0>Here's the email address

00:06:14.600 --> 00:06:16.805
<v Speaker 0>for the account or the name that I

00:06:16.805 --> 00:06:18.805
<v Speaker 0>want associated with the certificates. Here's the name

00:06:18.805 --> 00:06:20.405
<v Speaker 0>that we rest to use and dash o

00:06:20.405 --> 00:06:21.764
<v Speaker 0>just tells it to save it to a

00:06:21.764 --> 00:06:22.405
<v Speaker 0>fail.

00:06:23.044 --> 00:06:25.285
<v Speaker 0>If we pop over here, we're not gonna

00:06:25.285 --> 00:06:26.805
<v Speaker 0>return on the last one, so let's just

00:06:26.805 --> 00:06:28.485
<v Speaker 0>do that quickly. And we are getting eight

00:06:28.485 --> 00:06:30.960
<v Speaker 0>point zero dot eight zero again. That wasn't

00:06:30.960 --> 00:06:31.919
<v Speaker 0>an accident.

00:06:32.160 --> 00:06:34.240
<v Speaker 0>No. Just a thing. And

00:06:35.680 --> 00:06:38.240
<v Speaker 0>we'll give that another moment. There we go.

00:06:38.720 --> 00:06:41.039
<v Speaker 0>And we should have access to Teleport

00:06:41.039 --> 00:06:41.680
<v Speaker 0>version,

00:06:43.575 --> 00:06:44.695
<v Speaker 0>which we do.

00:06:45.335 --> 00:06:47.255
<v Speaker 0>So we run this configure command and we

00:06:47.255 --> 00:06:49.255
<v Speaker 0>can see that it has created a config

00:06:49.255 --> 00:06:51.095
<v Speaker 0>at the location we expect.

00:06:53.575 --> 00:06:55.975
<v Speaker 0>And this is a pretty standard Teleport config.

00:06:55.975 --> 00:06:57.735
<v Speaker 0>We've seen this now a few times.

00:06:58.750 --> 00:07:01.230
<v Speaker 0>What's important here is that our proxy service

00:07:01.230 --> 00:07:02.270
<v Speaker 0>has the ACME

00:07:03.550 --> 00:07:05.790
<v Speaker 0>The YAML has the ACME key with enabled

00:07:05.790 --> 00:07:07.790
<v Speaker 0>to yes as an email address to attach

00:07:07.790 --> 00:07:08.510
<v Speaker 0>that certificate.

00:07:10.794 --> 00:07:13.115
<v Speaker 0>Alright. Well, I'm happy with that. I'm just

00:07:13.115 --> 00:07:14.395
<v Speaker 0>going to go ahead

00:07:16.074 --> 00:07:17.275
<v Speaker 0>and start

00:07:17.914 --> 00:07:18.875
<v Speaker 0>Teleport.

00:07:19.914 --> 00:07:21.754
<v Speaker 0>And if we jump back to our instructions,

00:07:21.754 --> 00:07:22.634
<v Speaker 0>that was the next thing.

00:07:23.290 --> 00:07:25.050
<v Speaker 0>We've got the example configuration,

00:07:25.050 --> 00:07:26.170
<v Speaker 0>which you should see.

00:07:27.530 --> 00:07:30.170
<v Speaker 0>And now we are going to

00:07:30.570 --> 00:07:32.410
<v Speaker 0>continue on from what we also done to

00:07:32.410 --> 00:07:35.530
<v Speaker 0>workshop one, which is your static token authentication.

00:07:36.075 --> 00:07:38.235
<v Speaker 0>This is not something I will encourage in

00:07:38.235 --> 00:07:40.475
<v Speaker 0>a production environment, but for these workshops, that

00:07:40.475 --> 00:07:42.395
<v Speaker 0>is a great way to get started quickly.

00:07:42.875 --> 00:07:44.715
<v Speaker 0>We will have a best practice video where

00:07:44.715 --> 00:07:46.235
<v Speaker 0>we talk about doing this in a nice,

00:07:46.235 --> 00:07:47.435
<v Speaker 0>safer fashion.

00:07:47.755 --> 00:07:48.555
<v Speaker 0>However,

00:07:48.555 --> 00:07:51.595
<v Speaker 0>what we want to do is grab this

00:07:50.910 --> 00:07:51.790
<v Speaker 0>token

00:07:52.030 --> 00:07:53.950
<v Speaker 0>and add it to here on the off

00:07:53.950 --> 00:07:54.750
<v Speaker 0>service.

00:07:56.190 --> 00:07:58.510
<v Speaker 0>It affects the indentation because that's all we

00:07:58.510 --> 00:07:59.230
<v Speaker 0>ever do.

00:08:00.030 --> 00:08:01.950
<v Speaker 0>And what we're seeing here is that we

00:08:01.950 --> 00:08:04.190
<v Speaker 0>want to have a bunch of tokens available

00:08:04.190 --> 00:08:06.615
<v Speaker 0>and the off service that allow

00:08:06.855 --> 00:08:09.095
<v Speaker 0>anyone with access to that token

00:08:09.175 --> 00:08:12.375
<v Speaker 0>to authenticate on a proxy and node basis.

00:08:12.375 --> 00:08:14.535
<v Speaker 0>I'm gonna add one more and fix my

00:08:15.655 --> 00:08:16.775
<v Speaker 0>fix my

00:08:17.415 --> 00:08:18.535
<v Speaker 0>readme

00:08:21.210 --> 00:08:22.810
<v Speaker 0>because we're gonna need it later and it

00:08:22.810 --> 00:08:24.330
<v Speaker 0>says we're doing it there.

00:08:25.850 --> 00:08:28.250
<v Speaker 0>Here. Oh, proxy node. I have fixed it

00:08:28.250 --> 00:08:30.330
<v Speaker 0>locally. Just haven't pushed it. There we go.

00:08:30.330 --> 00:08:32.885
<v Speaker 0>Even better. The proxy app and node. We

00:08:32.885 --> 00:08:35.205
<v Speaker 0>wanna allow the proxy service to connect and

00:08:35.205 --> 00:08:36.885
<v Speaker 0>speak to the Teleport cluster. We also want

00:08:36.885 --> 00:08:38.164
<v Speaker 0>to allow the app service to connect and

00:08:38.164 --> 00:08:40.085
<v Speaker 0>speak to this cluster and the node service

00:08:40.085 --> 00:08:41.284
<v Speaker 0>we want to allow to speak to this

00:08:41.284 --> 00:08:41.684
<v Speaker 0>cluster.

00:08:46.580 --> 00:08:48.420
<v Speaker 0>And the token is

00:08:49.380 --> 00:08:50.260
<v Speaker 0>Rawkode

00:08:50.260 --> 00:08:51.540
<v Speaker 0>dash workshop.

00:08:52.420 --> 00:08:55.780
<v Speaker 0>I see Russell has joined us. Hey, mate.

00:08:56.020 --> 00:08:57.940
<v Speaker 0>Russell is on the Discord. I've been talking

00:08:57.940 --> 00:08:59.940
<v Speaker 0>about my audio and camera problems

00:09:00.785 --> 00:09:02.144
<v Speaker 0>that have been affecting me for a week,

00:09:02.144 --> 00:09:03.665
<v Speaker 0>but today we're really bad. So I'm hoping

00:09:03.665 --> 00:09:05.425
<v Speaker 0>that I look and send all right. Feel

00:09:05.425 --> 00:09:06.545
<v Speaker 0>free to give me a thumbs up if

00:09:06.545 --> 00:09:09.265
<v Speaker 0>you don't mind. I'm gonna continue regardless.

00:09:09.665 --> 00:09:12.065
<v Speaker 0>And so we have our Rawkode workshop static

00:09:12.065 --> 00:09:14.225
<v Speaker 0>token available, and we're gonna need that when

00:09:14.225 --> 00:09:16.370
<v Speaker 0>we make, when we have other virtual machines,

00:09:16.370 --> 00:09:18.690
<v Speaker 0>nodes, bare metal, whatever connector to our cluster.

00:09:20.450 --> 00:09:23.250
<v Speaker 0>So let's save that and jump back over

00:09:23.250 --> 00:09:24.450
<v Speaker 0>to our README.

00:09:27.089 --> 00:09:28.850
<v Speaker 0>It should look something like this, which we

00:09:28.850 --> 00:09:31.745
<v Speaker 0>now have. Oh, let me see through here.

00:09:31.745 --> 00:09:32.465
<v Speaker 0>There we go.

00:09:33.345 --> 00:09:36.465
<v Speaker 0>And now we can create our admin user.

00:09:38.305 --> 00:09:40.464
<v Speaker 0>This is the user that we are going

00:09:40.464 --> 00:09:41.105
<v Speaker 0>to

00:09:41.985 --> 00:09:43.585
<v Speaker 0>use initially to set a few things up

00:09:43.585 --> 00:09:45.880
<v Speaker 0>within our cluster. One thing that's different from

00:09:45.880 --> 00:09:47.880
<v Speaker 0>workshop one is that we no longer have

00:09:47.880 --> 00:09:52.120
<v Speaker 0>access to roles equals admin with Teleport 8.0.0.

00:09:52.520 --> 00:09:54.760
<v Speaker 0>And it's now broken down into you have

00:09:54.760 --> 00:09:56.280
<v Speaker 0>to use editor and access.

00:09:56.625 --> 00:09:58.945
<v Speaker 0>The roles admin is gone. You can have

00:09:58.945 --> 00:10:00.705
<v Speaker 0>to record that, rerecord

00:10:00.705 --> 00:10:02.865
<v Speaker 0>that entire workshop, but that's probably for the

00:10:02.865 --> 00:10:03.745
<v Speaker 0>best anyway.

00:10:04.225 --> 00:10:05.825
<v Speaker 0>And we're gonna add logins routes so that

00:10:05.825 --> 00:10:07.345
<v Speaker 0>I can have route access to each of

00:10:07.345 --> 00:10:09.105
<v Speaker 0>the nodes within the Teleport cluster.

00:10:09.970 --> 00:10:12.130
<v Speaker 0>And we click our link,

00:10:12.610 --> 00:10:14.690
<v Speaker 0>we're going to sign up. Now I have

00:10:14.690 --> 00:10:16.450
<v Speaker 0>done some tests on this domain, so I'm

00:10:16.450 --> 00:10:18.210
<v Speaker 0>gonna reuse my password.

00:10:19.250 --> 00:10:19.970
<v Speaker 0>There we go.

00:10:22.945 --> 00:10:25.425
<v Speaker 0>Password. And I'm gonna have to rescan

00:10:27.825 --> 00:10:29.345
<v Speaker 0>and get my second

00:10:29.505 --> 00:10:30.545
<v Speaker 0>OTP

00:10:31.745 --> 00:10:32.705
<v Speaker 0>down here.

00:10:33.985 --> 00:10:35.665
<v Speaker 0>And that should allow me to sign up.

00:10:35.665 --> 00:10:36.225
<v Speaker 0>There we go.

00:10:36.899 --> 00:10:38.660
<v Speaker 0>Now, we have a zoom in. We'll see

00:10:38.660 --> 00:10:40.740
<v Speaker 0>that we have access to the Teleport UI.

00:10:40.819 --> 00:10:42.899
<v Speaker 0>We have one node listed here. Things are

00:10:42.899 --> 00:10:43.699
<v Speaker 0>looking good.

00:10:44.259 --> 00:10:46.339
<v Speaker 0>Okay. Now we wanna join the cluster.

00:10:46.579 --> 00:10:49.860
<v Speaker 0>We can SSH onto the worker node. So

00:10:49.860 --> 00:10:51.220
<v Speaker 0>I'm just gonna spot this terminal.

00:10:52.345 --> 00:10:54.985
<v Speaker 0>H l root worker one

00:10:56.185 --> 00:10:58.105
<v Speaker 0>Rawkode. Sh and

00:10:59.465 --> 00:11:01.385
<v Speaker 0>we'll copy these commands

00:11:01.465 --> 00:11:03.625
<v Speaker 0>like so. So we're setting the host name

00:11:03.625 --> 00:11:06.425
<v Speaker 0>again, adding the Ubuntu or Debian repository and

00:11:06.425 --> 00:11:08.180
<v Speaker 0>then installing the Teleport package.

00:11:27.265 --> 00:11:28.305
<v Speaker 0>Alright. Install.

00:11:29.585 --> 00:11:32.465
<v Speaker 0>I am providing the the config for this,

00:11:32.465 --> 00:11:34.865
<v Speaker 0>but essentially, we're Teleport that we want to

00:11:34.865 --> 00:11:36.680
<v Speaker 0>go and speak to this off server, which

00:11:36.680 --> 00:11:39.640
<v Speaker 0>is our control play node, t. Rawkode. Sh.

00:11:39.720 --> 00:11:41.400
<v Speaker 0>There's the off token that we added as

00:11:41.400 --> 00:11:42.520
<v Speaker 0>a static token.

00:11:42.840 --> 00:11:45.240
<v Speaker 0>We don't need the off service on any

00:11:45.240 --> 00:11:46.120
<v Speaker 0>of the worker.

00:11:48.765 --> 00:11:50.925
<v Speaker 0>Russell, audio is fine for me and I

00:11:50.925 --> 00:11:52.285
<v Speaker 0>can see the difference between your t shirt

00:11:52.285 --> 00:11:54.205
<v Speaker 0>and hoodie size of the light. That's good.

00:11:54.605 --> 00:11:55.485
<v Speaker 0>Awesome.

00:11:55.805 --> 00:11:57.405
<v Speaker 0>That's a win. It's rare that I'm getting

00:11:57.405 --> 00:11:58.285
<v Speaker 0>them these days.

00:11:58.925 --> 00:12:00.845
<v Speaker 0>Okay. So we've the auth service disabled. We

00:12:00.845 --> 00:12:02.445
<v Speaker 0>don't need that for things that are joined

00:12:02.445 --> 00:12:04.125
<v Speaker 0>on the cluster. Auth service runs on the

00:12:04.125 --> 00:12:06.339
<v Speaker 0>first node. And then we enable the SSH

00:12:06.339 --> 00:12:07.620
<v Speaker 0>service because we do wanna be able to

00:12:07.620 --> 00:12:09.460
<v Speaker 0>SSH onto any of these machines.

00:12:09.620 --> 00:12:11.700
<v Speaker 0>So I'm just gonna copy these two commands,

00:12:13.300 --> 00:12:15.940
<v Speaker 0>drop them in, and we should now have,

00:12:15.940 --> 00:12:17.779
<v Speaker 0>if we browse back to Teleport

00:12:19.875 --> 00:12:21.395
<v Speaker 0>and hit refresh.

00:12:25.315 --> 00:12:26.275
<v Speaker 0>Correct.

00:12:26.835 --> 00:12:29.875
<v Speaker 0>Alright. Debug in issue number one. So what

00:12:29.875 --> 00:12:31.875
<v Speaker 0>we expected to see there was on our

00:12:31.875 --> 00:12:34.275
<v Speaker 0>Teleport UI is that we would have the

00:12:34.690 --> 00:12:37.250
<v Speaker 0>Control Blade node and one worker node. We

00:12:37.250 --> 00:12:39.170
<v Speaker 0>didn't get that. It means it's potentially a

00:12:39.170 --> 00:12:39.810
<v Speaker 0>problem.

00:12:45.170 --> 00:12:45.810
<v Speaker 0>Saying

00:12:46.050 --> 00:12:46.930
<v Speaker 0>that is

00:12:49.005 --> 00:12:50.205
<v Speaker 0>not again.

00:13:01.885 --> 00:13:02.925
<v Speaker 0>There you go. Okay.

00:13:14.139 --> 00:13:16.060
<v Speaker 0>Alright. I'm not going to pay this this

00:13:16.060 --> 00:13:17.100
<v Speaker 0>time. So

00:13:18.615 --> 00:13:20.615
<v Speaker 0>this did not happen during my tests.

00:13:21.095 --> 00:13:22.855
<v Speaker 0>I'm just going to fix it later.

00:13:26.615 --> 00:13:27.895
<v Speaker 0>It was the VIM.

00:13:30.215 --> 00:13:30.295
<v Speaker 0>Secure.

00:13:32.360 --> 00:13:33.640
<v Speaker 0>Restart. Oh,

00:13:35.480 --> 00:13:37.400
<v Speaker 0>yeah. That changed the unit fail, so we

00:13:37.400 --> 00:13:38.920
<v Speaker 0>will need to demon

00:13:39.080 --> 00:13:39.960
<v Speaker 0>reload.

00:13:41.480 --> 00:13:44.120
<v Speaker 0>Start Teleport or restart. Sorry.

00:13:46.445 --> 00:13:49.485
<v Speaker 0>If we do a journal flu yeah. No.

00:13:54.605 --> 00:13:56.845
<v Speaker 0>Okay. So my my certificate my certificate

00:13:57.325 --> 00:13:59.645
<v Speaker 0>I think, actually, we're fine. What's happening here

00:13:59.645 --> 00:14:00.285
<v Speaker 0>is

00:14:00.660 --> 00:14:02.980
<v Speaker 0>let's say my joint token is not valid.

00:14:11.139 --> 00:14:13.139
<v Speaker 0>So let's see what we're dealing with.

00:14:15.305 --> 00:14:16.904
<v Speaker 0>See, it doesn't matter how much you test

00:14:16.904 --> 00:14:18.105
<v Speaker 0>this stuff, does it?

00:14:20.105 --> 00:14:22.825
<v Speaker 0>I think it's cool. That's incorrect.

00:14:24.745 --> 00:14:25.464
<v Speaker 0>That's perfect.

00:14:32.470 --> 00:14:34.070
<v Speaker 0>Rawkode workshop.

00:14:37.990 --> 00:14:39.110
<v Speaker 0>Rawkode workshop.

00:14:50.505 --> 00:14:52.345
<v Speaker 0>Okay. Let's see if we have any logs

00:14:52.345 --> 00:14:52.665
<v Speaker 0>here.

00:14:55.210 --> 00:14:58.250
<v Speaker 0>Cannot join the cluster with role proxy token

00:14:58.250 --> 00:14:59.130
<v Speaker 0>error

00:14:59.850 --> 00:15:03.130
<v Speaker 0>not found off go. Okay. So I've configured.

00:15:03.130 --> 00:15:04.650
<v Speaker 0>Uh-huh. Right. Okay. Gotcha.

00:15:05.690 --> 00:15:07.529
<v Speaker 0>Let's stop Teleport.

00:15:08.514 --> 00:15:09.315
<v Speaker 0>And

00:15:11.875 --> 00:15:14.834
<v Speaker 0>this is blow away the Teleport directory

00:15:15.315 --> 00:15:16.035
<v Speaker 0>and

00:15:16.514 --> 00:15:18.915
<v Speaker 0>gonna remove that and secure because

00:15:20.435 --> 00:15:21.475
<v Speaker 0>hoping we don't need it.

00:15:23.300 --> 00:15:24.180
<v Speaker 0>I think

00:15:24.820 --> 00:15:26.339
<v Speaker 0>I didn't restart

00:15:27.620 --> 00:15:32.260
<v Speaker 0>Teleport after adding my token, my static token.

00:15:33.220 --> 00:15:33.940
<v Speaker 0>So

00:15:34.339 --> 00:15:35.300
<v Speaker 0>Teleport,

00:15:38.035 --> 00:15:40.835
<v Speaker 0>Make sure our Teleport service is still running.

00:15:42.595 --> 00:15:44.275
<v Speaker 0>And let's try

00:15:45.555 --> 00:15:46.515
<v Speaker 0>this again.

00:15:50.275 --> 00:15:50.915
<v Speaker 0>There we go.

00:15:53.050 --> 00:15:55.050
<v Speaker 0>It has joined the cluster.

00:15:56.410 --> 00:15:57.209
<v Speaker 0>Perfect.

00:15:58.490 --> 00:16:00.490
<v Speaker 0>I I was nearly about to go down

00:16:00.490 --> 00:16:02.329
<v Speaker 0>a rabbit hole of debugging that I had

00:16:02.329 --> 00:16:04.889
<v Speaker 0>absolutely no need to go down. However,

00:16:05.505 --> 00:16:08.145
<v Speaker 0>restart Teleport after you change the configuration. That's

00:16:08.145 --> 00:16:10.385
<v Speaker 0>very important. Don't make that mistake.

00:16:11.265 --> 00:16:12.065
<v Speaker 0>Phew.

00:16:12.465 --> 00:16:13.345
<v Speaker 0>Alright.

00:16:13.505 --> 00:16:15.905
<v Speaker 0>Now we're gonna move on to exercise five.

00:16:22.130 --> 00:16:24.370
<v Speaker 0>We're gonna take a look at the debugging

00:16:24.370 --> 00:16:25.250
<v Speaker 0>application.

00:16:25.490 --> 00:16:27.970
<v Speaker 0>This is just something that Teleport provides so

00:16:27.970 --> 00:16:29.250
<v Speaker 0>that you can understand

00:16:29.650 --> 00:16:32.715
<v Speaker 0>how their proxy service works, how it's

00:16:32.955 --> 00:16:35.355
<v Speaker 0>modifying or mutating the HTTP requests. So you

00:16:35.355 --> 00:16:36.475
<v Speaker 0>can see the headers.

00:16:37.275 --> 00:16:39.515
<v Speaker 0>And it also does some really cool stuff

00:16:39.515 --> 00:16:42.075
<v Speaker 0>with JSON web tokens and certificates that allows

00:16:42.075 --> 00:16:43.515
<v Speaker 0>you to be able to consume

00:16:44.740 --> 00:16:45.780
<v Speaker 0>the credentials

00:16:45.780 --> 00:16:47.860
<v Speaker 0>being passed through the proxy service

00:16:48.020 --> 00:16:49.460
<v Speaker 0>within your application.

00:16:49.860 --> 00:16:51.140
<v Speaker 0>And one of those are really cool use

00:16:51.140 --> 00:16:53.460
<v Speaker 0>cases here is if you're using Teleport

00:16:53.460 --> 00:16:56.340
<v Speaker 0>with a GitHub authentication provider or any of

00:16:56.340 --> 00:16:59.060
<v Speaker 0>the SAML based authentication providers like Google,

00:16:59.505 --> 00:17:03.025
<v Speaker 0>AWS, Microsoft, etcetera, is that you can pull

00:17:03.025 --> 00:17:05.505
<v Speaker 0>in that user data and the rules

00:17:05.665 --> 00:17:07.665
<v Speaker 0>so that you can then use that and

00:17:07.665 --> 00:17:09.425
<v Speaker 0>pass it on to all of your internal

00:17:09.425 --> 00:17:11.264
<v Speaker 0>administration or backend

00:17:11.505 --> 00:17:12.065
<v Speaker 0>applications.

00:17:12.970 --> 00:17:13.929
<v Speaker 0>And we're gonna see if we can take

00:17:13.929 --> 00:17:15.929
<v Speaker 0>a look at that. Something I've done different

00:17:15.929 --> 00:17:18.569
<v Speaker 0>this time with the workshop is just provide

00:17:18.569 --> 00:17:20.489
<v Speaker 0>the solutions for each of the exercises.

00:17:20.569 --> 00:17:21.769
<v Speaker 0>So if you just want to copy and

00:17:21.769 --> 00:17:23.289
<v Speaker 0>paste the code, you can. But what we're

00:17:23.289 --> 00:17:25.369
<v Speaker 0>gonna do on this workshop is gonna try

00:17:25.369 --> 00:17:27.724
<v Speaker 0>and find the answers, which is gonna be

00:17:27.724 --> 00:17:29.325
<v Speaker 0>weird because I kinda know them, but we're

00:17:29.325 --> 00:17:31.404
<v Speaker 0>gonna go through the documentation. I you to

00:17:31.404 --> 00:17:34.284
<v Speaker 0>walk away from this knowing that the documentation

00:17:34.284 --> 00:17:36.125
<v Speaker 0>is there, how to consume it, and the

00:17:36.125 --> 00:17:37.485
<v Speaker 0>way that you would find these answers in

00:17:37.485 --> 00:17:38.445
<v Speaker 0>a real world situation.

00:17:40.120 --> 00:17:41.880
<v Speaker 0>So what I've said here is that Teleport

00:17:41.880 --> 00:17:44.040
<v Speaker 0>ships with a debug application that dumps some

00:17:44.040 --> 00:17:46.200
<v Speaker 0>environment variables for you to inspect, and we

00:17:46.200 --> 00:17:48.120
<v Speaker 0>want to enable this application.

00:17:48.760 --> 00:17:50.600
<v Speaker 0>We're just gonna go to a Teleport doc,

00:17:54.585 --> 00:17:55.945
<v Speaker 0>then to debug.

00:17:59.544 --> 00:18:02.184
<v Speaker 0>That's not the right one, is it? Dumper.

00:18:02.184 --> 00:18:04.585
<v Speaker 0>Yeah. That's something else. Maybe that's later.

00:18:05.730 --> 00:18:06.850
<v Speaker 0>I do dumper,

00:18:07.730 --> 00:18:09.490
<v Speaker 0>you know what? It doesn't matter.

00:18:10.050 --> 00:18:12.130
<v Speaker 0>My favorite page is reference.

00:18:12.210 --> 00:18:15.090
<v Speaker 0>Go here, click and config fail. Everything you

00:18:15.090 --> 00:18:17.730
<v Speaker 0>can turn on is commented and documented on

00:18:17.730 --> 00:18:20.575
<v Speaker 0>this file. So there's no It would appear,

00:18:20.655 --> 00:18:22.415
<v Speaker 0>and I haven't really searched for it previously,

00:18:22.415 --> 00:18:24.815
<v Speaker 0>but there's nothing under documentations about

00:18:24.815 --> 00:18:26.255
<v Speaker 0>this debug application.

00:18:26.735 --> 00:18:28.015
<v Speaker 0>But I do know that it's there, we

00:18:28.015 --> 00:18:30.015
<v Speaker 0>wanna play with it. So we go to

00:18:30.015 --> 00:18:31.855
<v Speaker 0>the reference, we go to the config, we

00:18:31.855 --> 00:18:33.215
<v Speaker 0>can search for debug,

00:18:33.529 --> 00:18:34.729
<v Speaker 0>if I could spell.

00:18:35.610 --> 00:18:38.090
<v Speaker 0>And what we see here, and I'll zoom

00:18:38.090 --> 00:18:40.889
<v Speaker 0>in, is the first hit, which is great

00:18:41.769 --> 00:18:42.889
<v Speaker 0>as that.

00:18:43.850 --> 00:18:44.330
<v Speaker 0>Boom.

00:18:44.889 --> 00:18:46.730
<v Speaker 0>If I highlight it, you can't actually read

00:18:46.730 --> 00:18:47.210
<v Speaker 0>the comment.

00:18:48.105 --> 00:18:50.665
<v Speaker 0>Teleport contains a small debug app that can

00:18:50.665 --> 00:18:52.745
<v Speaker 0>be used to make sure application access is

00:18:52.745 --> 00:18:53.705
<v Speaker 0>working correctly.

00:18:53.945 --> 00:18:55.625
<v Speaker 0>The app outputs JWTs

00:18:55.625 --> 00:18:57.625
<v Speaker 0>or JWTs, I believe we're supposed to pronounce

00:18:57.625 --> 00:18:58.105
<v Speaker 0>them.

00:18:58.665 --> 00:19:00.585
<v Speaker 0>So it can be useful when extending your

00:19:00.585 --> 00:19:03.870
<v Speaker 0>application. That means consuming the authentication and not

00:19:03.870 --> 00:19:06.190
<v Speaker 0>rebuilding it into your application when something that's

00:19:06.190 --> 00:19:08.590
<v Speaker 0>already doing it. So what we wanna do

00:19:08.590 --> 00:19:10.110
<v Speaker 0>is to enable this, is find the app

00:19:10.110 --> 00:19:12.110
<v Speaker 0>service and our Teleport configuration

00:19:12.350 --> 00:19:14.990
<v Speaker 0>and add a debug app equals true.

00:19:16.795 --> 00:19:17.434
<v Speaker 0>So

00:19:17.915 --> 00:19:19.355
<v Speaker 0>that's just my

00:19:19.355 --> 00:19:21.835
<v Speaker 0>system d log. We're gonna go to our

00:19:21.835 --> 00:19:23.355
<v Speaker 0>Teleport.YAML.

00:19:23.595 --> 00:19:25.434
<v Speaker 0>We'll go to the app service,

00:19:25.755 --> 00:19:27.915
<v Speaker 0>which we don't have. Alright. Okay. We need

00:19:27.915 --> 00:19:29.435
<v Speaker 0>to configure the app service.

00:19:30.780 --> 00:19:32.700
<v Speaker 0>So we can just come in here to

00:19:32.700 --> 00:19:34.380
<v Speaker 0>app service

00:19:35.900 --> 00:19:36.860
<v Speaker 0>enabled,

00:19:37.660 --> 00:19:38.300
<v Speaker 0>true.

00:19:38.700 --> 00:19:41.180
<v Speaker 0>And we know that we want debug app

00:19:41.180 --> 00:19:42.460
<v Speaker 0>equals true as well.

00:19:43.955 --> 00:19:45.715
<v Speaker 0>We can save that and I'm just gonna

00:19:45.715 --> 00:19:47.475
<v Speaker 0>cat it and we'll compare it to what

00:19:47.475 --> 00:19:48.995
<v Speaker 0>was in the documentation to make sure we

00:19:48.995 --> 00:19:50.115
<v Speaker 0>get what we expect.

00:19:50.515 --> 00:19:53.475
<v Speaker 0>App service enabled and debug app true.

00:19:54.195 --> 00:19:57.075
<v Speaker 0>App service enabled, yes, true, I think.

00:19:57.929 --> 00:19:59.850
<v Speaker 0>I believe both work. We're about to find

00:19:59.850 --> 00:20:00.409
<v Speaker 0>out.

00:20:00.730 --> 00:20:02.089
<v Speaker 0>And debug app. True.

00:20:03.049 --> 00:20:04.649
<v Speaker 0>What we can do now,

00:20:05.210 --> 00:20:05.929
<v Speaker 0>restart

00:20:07.370 --> 00:20:08.249
<v Speaker 0>Teleport.

00:20:09.129 --> 00:20:10.570
<v Speaker 0>Make sure that we have no errors by

00:20:10.570 --> 00:20:12.414
<v Speaker 0>popping into here. It doesn't look like we

00:20:12.414 --> 00:20:14.414
<v Speaker 0>have anything. If it fails to parse the

00:20:14.414 --> 00:20:16.254
<v Speaker 0>config, in fact, you get a pretty quick

00:20:16.254 --> 00:20:17.934
<v Speaker 0>warning about it. And in fact, why not

00:20:17.934 --> 00:20:19.214
<v Speaker 0>let us just break it?

00:20:19.615 --> 00:20:21.934
<v Speaker 0>Let's see. Enabled equals

00:20:21.934 --> 00:20:22.894
<v Speaker 0>fluffy kittens.

00:20:25.100 --> 00:20:26.940
<v Speaker 0>That doesn't break it. I'll be surprised, but

00:20:26.940 --> 00:20:27.979
<v Speaker 0>let's go for it.

00:20:30.220 --> 00:20:32.299
<v Speaker 0>Well, that's the YAML thing. Interpret that is

00:20:32.299 --> 00:20:33.899
<v Speaker 0>true, isn't

00:20:37.815 --> 00:20:38.695
<v Speaker 0>It's funny.

00:20:39.495 --> 00:20:41.015
<v Speaker 0>Yeah. Okay.

00:20:41.015 --> 00:20:43.174
<v Speaker 0>Let's leave that as true. Let's just add

00:20:43.174 --> 00:20:45.094
<v Speaker 0>a fake setting.

00:20:45.975 --> 00:20:46.455
<v Speaker 0>Sure.

00:20:47.735 --> 00:20:49.654
<v Speaker 0>Restart journal.

00:20:49.735 --> 00:20:50.375
<v Speaker 0>There we go.

00:20:51.860 --> 00:20:53.380
<v Speaker 0>Pails parsing the config

00:20:54.980 --> 00:20:57.540
<v Speaker 0>fail. YAML on marshall errors, lane 40 field

00:20:57.540 --> 00:20:59.940
<v Speaker 0>fit setting, not found in the type. So

00:21:01.380 --> 00:21:03.780
<v Speaker 0>on messing the weird YAML except in any

00:21:03.780 --> 00:21:05.700
<v Speaker 0>value as a true or trippy value,

00:21:06.835 --> 00:21:09.155
<v Speaker 0>you get really good feedback when Teleport is

00:21:09.155 --> 00:21:10.515
<v Speaker 0>not happy with your config.

00:21:10.755 --> 00:21:12.275
<v Speaker 0>So we'll just restart that.

00:21:12.595 --> 00:21:14.835
<v Speaker 0>What should happen now, in fact, do we

00:21:14.835 --> 00:21:16.195
<v Speaker 0>talk about it here,

00:21:16.915 --> 00:21:19.075
<v Speaker 0>is browse to the debug application. So we

00:21:19.075 --> 00:21:20.980
<v Speaker 0>believe we've enabled it. And the way that

00:21:20.980 --> 00:21:22.260
<v Speaker 0>we can confirm that is to come back

00:21:22.260 --> 00:21:23.619
<v Speaker 0>to the portal

00:21:25.620 --> 00:21:27.220
<v Speaker 0>and click on applications.

00:21:27.220 --> 00:21:28.580
<v Speaker 0>And you'll see that we now have access

00:21:28.580 --> 00:21:30.340
<v Speaker 0>to the dumper application.

00:21:30.740 --> 00:21:33.674
<v Speaker 0>So what I like about application access on

00:21:33.674 --> 00:21:36.394
<v Speaker 0>Teleport is that when we set the

00:21:36.554 --> 00:21:37.674
<v Speaker 0>app service

00:21:38.394 --> 00:21:39.034
<v Speaker 0>up

00:21:39.195 --> 00:21:42.235
<v Speaker 0>is that it uses wildcard DNS to actually

00:21:42.235 --> 00:21:43.594
<v Speaker 0>give resolvable

00:21:43.595 --> 00:21:45.514
<v Speaker 0>names to all of your applications. You can

00:21:45.514 --> 00:21:48.075
<v Speaker 0>see we can use dumper. T. Rawkode. Sh

00:21:48.180 --> 00:21:50.020
<v Speaker 0>actually just browse to this application.

00:21:50.580 --> 00:21:52.500
<v Speaker 0>So if I just did dumper.t.

00:22:01.495 --> 00:22:03.495
<v Speaker 0>You're seeing there was a whole bunch of

00:22:03.495 --> 00:22:04.534
<v Speaker 0>redirects there.

00:22:05.015 --> 00:22:06.855
<v Speaker 0>So what happens is when we go to

00:22:06.855 --> 00:22:08.054
<v Speaker 0>that webpage,

00:22:08.135 --> 00:22:09.575
<v Speaker 0>it's checking to see if we're logged into

00:22:09.575 --> 00:22:12.534
<v Speaker 0>Teleport, makes a few calls, gets the certificates,

00:22:12.534 --> 00:22:15.059
<v Speaker 0>approves them. And then when it's happy,

00:22:15.540 --> 00:22:17.140
<v Speaker 0>that should back out to the application that

00:22:17.140 --> 00:22:19.700
<v Speaker 0>you actually want to see. The Dumper application

00:22:19.700 --> 00:22:21.540
<v Speaker 0>here is just showing us the HTTP request

00:22:21.540 --> 00:22:22.740
<v Speaker 0>stuff. So we can see,

00:22:23.380 --> 00:22:25.380
<v Speaker 0>we have a GET request, we can see

00:22:25.380 --> 00:22:26.100
<v Speaker 0>the host.

00:22:26.644 --> 00:22:29.684
<v Speaker 0>And this is the proxy host. You know,

00:22:29.684 --> 00:22:32.005
<v Speaker 0>we do have the x forwarded for information

00:22:32.005 --> 00:22:34.485
<v Speaker 0>down here. So if you've worked with HAProxy

00:22:34.485 --> 00:22:36.565
<v Speaker 0>or NGINX in this configuration, you should be

00:22:36.565 --> 00:22:38.885
<v Speaker 0>relatively familiar with these headers or I guess

00:22:38.885 --> 00:22:40.245
<v Speaker 0>most of the buzzers as well.

00:22:41.380 --> 00:22:44.899
<v Speaker 0>We have accept stuff, which is pretty common.

00:22:45.059 --> 00:22:46.820
<v Speaker 0>We've got access

00:22:46.820 --> 00:22:47.860
<v Speaker 0>token here

00:22:48.100 --> 00:22:51.059
<v Speaker 0>and we've got our Teleport assertion here.

00:22:51.620 --> 00:22:53.059
<v Speaker 0>There is a whole bunch of stuff here.

00:22:54.185 --> 00:22:55.544
<v Speaker 0>Let's jump back over here.

00:22:55.785 --> 00:22:57.225
<v Speaker 0>So the last thing we want to do

00:22:57.225 --> 00:22:59.145
<v Speaker 0>here is just we want to decode this

00:22:59.145 --> 00:23:02.585
<v Speaker 0>token. Actually, I want to dissect and understand

00:23:02.585 --> 00:23:04.105
<v Speaker 0>what I have access to. No.

00:23:05.730 --> 00:23:08.850
<v Speaker 0>We haven't configured this Teleport with any

00:23:09.650 --> 00:23:11.490
<v Speaker 0>enterprise level authentication,

00:23:11.490 --> 00:23:14.210
<v Speaker 0>right, GitHub, Google, etcetera. So I'm not gonna

00:23:14.210 --> 00:23:15.970
<v Speaker 0>get a whole lot back out. You can

00:23:15.970 --> 00:23:17.250
<v Speaker 0>imagine how that would be consumed.

00:23:17.845 --> 00:23:20.805
<v Speaker 0>Next week, we do have a tutorial on

00:23:21.205 --> 00:23:24.085
<v Speaker 0>configuring Teleport. So in Teleport open source, you

00:23:24.085 --> 00:23:26.725
<v Speaker 0>get the GitHub authentication module for free. So

00:23:26.725 --> 00:23:28.325
<v Speaker 0>as long as you have a GitHub organization

00:23:28.325 --> 00:23:30.645
<v Speaker 0>with some teams, you can use that to

00:23:30.645 --> 00:23:32.725
<v Speaker 0>integrate and log in to your Teleport instance.

00:23:34.160 --> 00:23:36.480
<v Speaker 0>But for today, we're using local user. So

00:23:36.480 --> 00:23:40.159
<v Speaker 0>I'm gonna copy my Teleport JWT assertion,

00:23:41.520 --> 00:23:43.360
<v Speaker 0>which is just the same as the access

00:23:43.360 --> 00:23:45.535
<v Speaker 0>token up here for the record. We're gonna

00:23:45.535 --> 00:23:47.055
<v Speaker 0>go to jwt.io.

00:23:47.055 --> 00:23:48.975
<v Speaker 0>This is like the de facto say if

00:23:48.975 --> 00:23:50.815
<v Speaker 0>you're ever doing JWT stuff and you just

00:23:50.815 --> 00:23:52.575
<v Speaker 0>be able to debug why it's not working,

00:23:52.575 --> 00:23:54.415
<v Speaker 0>just go here because it has this thing

00:23:54.415 --> 00:23:55.855
<v Speaker 0>where you paste it in

00:23:56.415 --> 00:23:57.775
<v Speaker 0>and it will give you all the decoded

00:23:57.775 --> 00:24:00.240
<v Speaker 0>headers, payloads, and signatures. Now, if we know

00:24:00.240 --> 00:24:01.760
<v Speaker 0>the private key, we can drop it in

00:24:01.760 --> 00:24:03.280
<v Speaker 0>and it'll tell us whether this is synced

00:24:03.280 --> 00:24:04.559
<v Speaker 0>correctly or incorrectly.

00:24:04.880 --> 00:24:06.800
<v Speaker 0>Not really worried about that right now. What

00:24:06.800 --> 00:24:07.600
<v Speaker 0>I really

00:24:07.920 --> 00:24:10.240
<v Speaker 0>want to emphasize and show you is that

00:24:10.240 --> 00:24:13.335
<v Speaker 0>we have the expiration time, we have the

00:24:13.335 --> 00:24:17.174
<v Speaker 0>issuer, which is just our Teleport here, p.rawkode.sh,

00:24:17.175 --> 00:24:17.575
<v Speaker 0>and

00:24:18.295 --> 00:24:20.295
<v Speaker 0>we have the roles, the username, and the

00:24:20.295 --> 00:24:22.455
<v Speaker 0>subject is the same in Jotlin. So you'll

00:24:22.455 --> 00:24:24.935
<v Speaker 0>often see sub and username together

00:24:24.935 --> 00:24:26.950
<v Speaker 0>and the same value. But we can see

00:24:26.950 --> 00:24:28.230
<v Speaker 0>the roles. We can see I'm an editor

00:24:28.230 --> 00:24:30.630
<v Speaker 0>and I have access permission. These are the

00:24:30.630 --> 00:24:32.550
<v Speaker 0>roles that when I did the T control,

00:24:32.550 --> 00:24:33.990
<v Speaker 0>Teleport control, I don't know how to say

00:24:33.990 --> 00:24:34.470
<v Speaker 0>that,

00:24:34.950 --> 00:24:36.710
<v Speaker 0>users add, we said these are the roles

00:24:36.710 --> 00:24:38.470
<v Speaker 0>we want to help these users do.

00:24:39.065 --> 00:24:40.905
<v Speaker 0>The Teleport allows you to define your own

00:24:40.905 --> 00:24:43.545
<v Speaker 0>roles and throw in more metadata there. We

00:24:43.545 --> 00:24:45.705
<v Speaker 0>will have an episode, we'll have a workshop

00:24:46.105 --> 00:24:48.425
<v Speaker 0>and a deep dive into RBAC in a

00:24:48.425 --> 00:24:50.265
<v Speaker 0>couple of weeks time, but you can see

00:24:50.265 --> 00:24:51.785
<v Speaker 0>how we're getting this information. So

00:24:52.519 --> 00:24:54.839
<v Speaker 0>if you can validate the JWT

00:24:55.000 --> 00:24:56.199
<v Speaker 0>and the signature,

00:24:56.200 --> 00:24:58.120
<v Speaker 0>you can trust that the information you're getting

00:24:58.120 --> 00:25:00.679
<v Speaker 0>back in this JWT payload can be carried

00:25:00.679 --> 00:25:02.359
<v Speaker 0>and passed onto your application

00:25:02.440 --> 00:25:03.959
<v Speaker 0>and you can have

00:25:04.279 --> 00:25:06.759
<v Speaker 0>a really cool authentication model integrated with Teleport.

00:25:09.215 --> 00:25:09.854
<v Speaker 0>Sweet.

00:25:10.654 --> 00:25:12.494
<v Speaker 0>That was relatively

00:25:12.735 --> 00:25:13.934
<v Speaker 0>without hiccups.

00:25:16.015 --> 00:25:16.975
<v Speaker 0>Now, if you take a look at our

00:25:16.975 --> 00:25:19.294
<v Speaker 0>solution, that's exactly what we did. So on

00:25:19.294 --> 00:25:21.615
<v Speaker 0>the Teleport server, we modified the Teleport. Yaml

00:25:21.615 --> 00:25:24.230
<v Speaker 0>file. We added debug app true under app

00:25:24.230 --> 00:25:26.149
<v Speaker 0>service, which looked like this.

00:25:27.110 --> 00:25:28.709
<v Speaker 0>We restarted Teleport

00:25:28.710 --> 00:25:29.989
<v Speaker 0>and we are done.

00:25:30.230 --> 00:25:32.070
<v Speaker 0>So let's try and do something

00:25:32.309 --> 00:25:34.149
<v Speaker 0>little bit more interesting.

00:25:35.029 --> 00:25:37.830
<v Speaker 0>Let's install NGINX onto our Teleport server.

00:25:38.505 --> 00:25:40.905
<v Speaker 0>We'll add NGINX as an application to the

00:25:40.905 --> 00:25:42.024
<v Speaker 0>Teleport cluster.

00:25:42.505 --> 00:25:44.425
<v Speaker 0>We're then going to go in and modify

00:25:44.425 --> 00:25:46.985
<v Speaker 0>NGINX to only respond to requests on the

00:25:46.985 --> 00:25:49.625
<v Speaker 0>private IPv4 address for the server, or even

00:25:49.625 --> 00:25:51.305
<v Speaker 0>just onto 7001,

00:25:51.305 --> 00:25:52.505
<v Speaker 0>whatever, entirely up to you.

00:25:53.280 --> 00:25:54.400
<v Speaker 0>And what we should be able to do

00:25:54.400 --> 00:25:56.000
<v Speaker 0>is actually just confirm

00:25:56.160 --> 00:25:59.120
<v Speaker 0>the NGINX still works through the application access,

00:25:59.120 --> 00:26:00.320
<v Speaker 0>but will not work

00:26:00.480 --> 00:26:02.559
<v Speaker 0>through the nodes public IP address.

00:26:03.600 --> 00:26:04.000
<v Speaker 0>Cool.

00:26:05.715 --> 00:26:07.794
<v Speaker 0>So let's do an apt

00:26:07.955 --> 00:26:08.914
<v Speaker 0>install

00:26:08.915 --> 00:26:09.874
<v Speaker 0>NGINX.

00:26:13.395 --> 00:26:14.674
<v Speaker 0>If we browse,

00:26:14.995 --> 00:26:16.434
<v Speaker 0>we'll give this a couple of seconds to

00:26:16.434 --> 00:26:17.235
<v Speaker 0>finish first.

00:26:22.220 --> 00:26:23.500
<v Speaker 0>Ninety nine percent. Come on.

00:26:39.195 --> 00:26:41.195
<v Speaker 0>It's like a software developer project where my

00:26:41.195 --> 00:26:42.795
<v Speaker 0>teammates says it will take an hour.

00:26:43.675 --> 00:26:44.395
<v Speaker 0>Be clear.

00:26:46.760 --> 00:26:48.519
<v Speaker 0>I'm guilty of that too, actually.

00:26:51.720 --> 00:26:53.239
<v Speaker 0>There we go. So

00:26:53.720 --> 00:26:57.159
<v Speaker 0>now we installed NGINX on the

00:26:57.975 --> 00:26:59.015
<v Speaker 0>control

00:26:59.015 --> 00:26:59.894
<v Speaker 0>plane,

00:27:00.295 --> 00:27:02.775
<v Speaker 0>but we can't actually browse to it right

00:27:02.775 --> 00:27:05.414
<v Speaker 0>away because this is our Teleport server.

00:27:05.655 --> 00:27:07.415
<v Speaker 0>So what we're gonna have to do is

00:27:07.415 --> 00:27:11.254
<v Speaker 0>come into our NGINXconfiguration.conf,

00:27:11.575 --> 00:27:12.934
<v Speaker 0>find the server block.

00:27:14.110 --> 00:27:16.349
<v Speaker 0>Oh, it's gonna be in sites available perhaps.

00:27:16.909 --> 00:27:17.869
<v Speaker 0>Yeah. Okay.

00:27:18.590 --> 00:27:22.590
<v Speaker 0>Engine x, sites enabled, find default,

00:27:23.309 --> 00:27:24.349
<v Speaker 0>opt down.

00:27:24.669 --> 00:27:26.590
<v Speaker 0>And I'm just gonna modify this to run

00:27:26.590 --> 00:27:28.190
<v Speaker 0>on port eighty eighty

00:27:28.665 --> 00:27:29.945
<v Speaker 0>on 8,080.

00:27:31.145 --> 00:27:32.505
<v Speaker 0>I would suspect

00:27:33.385 --> 00:27:35.145
<v Speaker 0>NGINX hasn't started yet, so we don't have

00:27:35.145 --> 00:27:36.025
<v Speaker 0>any logs.

00:27:36.425 --> 00:27:37.065
<v Speaker 0>But

00:27:39.305 --> 00:27:41.225
<v Speaker 0>let's just do a restart

00:27:41.705 --> 00:27:42.345
<v Speaker 0>NGINX.

00:27:44.900 --> 00:27:46.419
<v Speaker 0>And hopefully now

00:27:46.740 --> 00:27:48.820
<v Speaker 0>we can do a t.Rawkode.s

00:27:48.820 --> 00:27:50.340
<v Speaker 0>h port 88.

00:27:54.740 --> 00:27:56.020
<v Speaker 0>No. HTTP.

00:28:08.395 --> 00:28:09.755
<v Speaker 0>That time something went wrong.

00:28:12.190 --> 00:28:14.510
<v Speaker 0>I think that's just been silly.

00:28:15.310 --> 00:28:16.910
<v Speaker 0>Let me grab the IP address of this

00:28:16.910 --> 00:28:17.310
<v Speaker 0>machine.

00:28:31.885 --> 00:28:34.205
<v Speaker 0>What was happening with the t. Rocket. Is

00:28:34.205 --> 00:28:34.684
<v Speaker 0>it?

00:28:35.725 --> 00:28:36.765
<v Speaker 0>Not important.

00:28:37.005 --> 00:28:38.845
<v Speaker 0>We have an NGINX page here.

00:28:39.900 --> 00:28:41.020
<v Speaker 0>So our

00:28:41.340 --> 00:28:44.060
<v Speaker 0>mission is to add NGINX as an application

00:28:44.060 --> 00:28:45.580
<v Speaker 0>to the Teleport cluster.

00:28:46.700 --> 00:28:48.860
<v Speaker 0>So we're gonna go to the documentation

00:28:49.180 --> 00:28:50.460
<v Speaker 0>and we're gonna try and work out how

00:28:50.460 --> 00:28:50.940
<v Speaker 0>to do that.

00:28:51.865 --> 00:28:54.585
<v Speaker 0>So we can click on application

00:28:54.664 --> 00:28:56.104
<v Speaker 0>access gates,

00:28:58.585 --> 00:28:59.864
<v Speaker 0>connect applications.

00:28:59.945 --> 00:29:01.945
<v Speaker 0>And if we pop down here, it's gonna

00:29:01.945 --> 00:29:03.304
<v Speaker 0>walk through some of the stuff that we've

00:29:03.304 --> 00:29:06.200
<v Speaker 0>already done for today, you know, adding tokens.

00:29:06.200 --> 00:29:07.960
<v Speaker 0>Now you can use short lived tokens for

00:29:07.960 --> 00:29:08.920
<v Speaker 0>the application

00:29:10.440 --> 00:29:12.440
<v Speaker 0>proxy process that you can run.

00:29:12.920 --> 00:29:15.000
<v Speaker 0>We're gonna configure it straight into the Teleport.

00:29:15.000 --> 00:29:16.760
<v Speaker 0>Yaml for now, we don't have to worry

00:29:16.760 --> 00:29:17.320
<v Speaker 0>about that.

00:29:19.765 --> 00:29:22.005
<v Speaker 0>If we come down to start an application

00:29:22.005 --> 00:29:23.765
<v Speaker 0>with a conflict now, because

00:29:23.925 --> 00:29:25.925
<v Speaker 0>this is a server process and we have

00:29:25.925 --> 00:29:28.405
<v Speaker 0>all of this stuff available, we've

00:29:28.405 --> 00:29:31.045
<v Speaker 0>already added app service ID bug true, is

00:29:31.045 --> 00:29:33.445
<v Speaker 0>that we could just grab this syntax here

00:29:34.080 --> 00:29:36.559
<v Speaker 0>for providing a list of applications to expose

00:29:36.559 --> 00:29:37.759
<v Speaker 0>from this machine

00:29:38.000 --> 00:29:40.399
<v Speaker 0>and modify it to suit our needs.

00:29:41.039 --> 00:29:43.359
<v Speaker 0>So we can modify our Teleport. Yaml.

00:29:44.000 --> 00:29:46.480
<v Speaker 0>We're have to do so much reinventing here.

00:29:49.285 --> 00:29:50.725
<v Speaker 0>So we've got apps.

00:29:51.365 --> 00:29:52.485
<v Speaker 0>Let's try and get rid of some of

00:29:52.485 --> 00:29:54.805
<v Speaker 0>the comments from there. I'm gonna remove anything

00:29:54.805 --> 00:29:55.845
<v Speaker 0>that's optional.

00:29:57.445 --> 00:29:59.764
<v Speaker 0>It's all optional. This is all you need.

00:30:00.165 --> 00:30:02.565
<v Speaker 0>So we need that to align. There we

00:30:02.565 --> 00:30:05.059
<v Speaker 0>go. So we say apps, we give it

00:30:05.059 --> 00:30:05.700
<v Speaker 0>a name.

00:30:06.179 --> 00:30:08.179
<v Speaker 0>I think it would be fair to call

00:30:08.179 --> 00:30:09.299
<v Speaker 0>this one NGINX,

00:30:09.539 --> 00:30:11.700
<v Speaker 0>which is available on this local machine

00:30:11.940 --> 00:30:13.459
<v Speaker 0>on port 8080.

00:30:13.539 --> 00:30:15.779
<v Speaker 0>So we can just use local as 8080

00:30:16.340 --> 00:30:17.059
<v Speaker 0>we save this.

00:30:19.195 --> 00:30:21.915
<v Speaker 0>You haven't seen it working yet, but being

00:30:21.915 --> 00:30:23.995
<v Speaker 0>able to expose things from the machine through

00:30:23.995 --> 00:30:26.315
<v Speaker 0>the config is really, really easy. Just needs

00:30:26.315 --> 00:30:28.475
<v Speaker 0>the name and then GRI and Teleport will

00:30:28.475 --> 00:30:29.515
<v Speaker 0>handle the rest.

00:30:30.155 --> 00:30:32.155
<v Speaker 0>We can do a system control,

00:30:32.235 --> 00:30:32.875
<v Speaker 0>restart,

00:30:33.675 --> 00:30:33.995
<v Speaker 0>Teleport.

00:30:35.290 --> 00:30:36.570
<v Speaker 0>And if we take a look at the

00:30:36.570 --> 00:30:39.130
<v Speaker 0>logs, we should see things are still happy.

00:30:39.530 --> 00:30:42.010
<v Speaker 0>We've got our Oh, I kinda missed it.

00:30:47.050 --> 00:30:47.770
<v Speaker 0>Where'd it go?

00:30:53.655 --> 00:30:54.534
<v Speaker 0>There we go.

00:30:54.934 --> 00:30:57.095
<v Speaker 0>This info lane here, apps first down as

00:30:57.095 --> 00:30:58.855
<v Speaker 0>sixty days. So we're now running an app

00:30:58.855 --> 00:31:00.215
<v Speaker 0>proxy server here.

00:31:00.535 --> 00:31:03.415
<v Speaker 0>And if we pop over to this

00:31:04.000 --> 00:31:05.279
<v Speaker 0>and hit refresh,

00:31:05.679 --> 00:31:09.200
<v Speaker 0>we now have our NGINX application here. You

00:31:09.200 --> 00:31:11.200
<v Speaker 0>can see the DNS name has been generated

00:31:11.200 --> 00:31:13.840
<v Speaker 0>for us, NGINX. T. Rawkode. S h,

00:31:14.640 --> 00:31:15.360
<v Speaker 0>and the labels.

00:31:16.174 --> 00:31:18.095
<v Speaker 0>These are added by Teleport to seeing how

00:31:18.095 --> 00:31:20.735
<v Speaker 0>does this application get added to the configuration.

00:31:21.855 --> 00:31:23.375
<v Speaker 0>So let's just copy and paste this. We

00:31:23.375 --> 00:31:24.735
<v Speaker 0>can also have launch, I guess it doesn't

00:31:24.735 --> 00:31:25.534
<v Speaker 0>really matter.

00:31:26.335 --> 00:31:28.174
<v Speaker 0>It's gonna do the authentication dance to make

00:31:28.174 --> 00:31:30.495
<v Speaker 0>sure that we have access to this application

00:31:30.799 --> 00:31:32.400
<v Speaker 0>and now we can browse to it via

00:31:32.400 --> 00:31:35.119
<v Speaker 0>nginx.t.rokode.sh.

00:31:36.320 --> 00:31:39.679
<v Speaker 0>Now, something I haven't shown yet is what

00:31:39.679 --> 00:31:41.280
<v Speaker 0>happens if we do that at a private

00:31:41.280 --> 00:31:43.360
<v Speaker 0>tab? Well, what should happen is we get

00:31:43.360 --> 00:31:44.320
<v Speaker 0>the Teleport login.

00:31:44.865 --> 00:31:47.425
<v Speaker 0>We cannot use that name. We cannot go

00:31:47.425 --> 00:31:50.225
<v Speaker 0>through the application proxy service without being an

00:31:50.225 --> 00:31:51.985
<v Speaker 0>authenticated Teleport user.

00:31:52.385 --> 00:31:53.345
<v Speaker 0>Very cool.

00:31:55.025 --> 00:31:57.425
<v Speaker 0>Okay. The last part of this exercise as

00:31:57.425 --> 00:31:58.385
<v Speaker 0>well. Okay.

00:31:59.210 --> 00:32:01.049
<v Speaker 0>Sorry. The second last part

00:32:01.450 --> 00:32:03.130
<v Speaker 0>is Okay. We don't want the

00:32:03.450 --> 00:32:04.890
<v Speaker 0>public to have access

00:32:05.210 --> 00:32:07.210
<v Speaker 0>to this. So you can see here we

00:32:07.210 --> 00:32:08.890
<v Speaker 0>go through the Teleport service,

00:32:10.090 --> 00:32:12.170
<v Speaker 0>but let's go through the node IP.

00:32:14.155 --> 00:32:16.395
<v Speaker 0>There's the node IP. Yeah. We did open

00:32:16.395 --> 00:32:18.235
<v Speaker 0>that. And I can close this one.

00:32:19.035 --> 00:32:21.195
<v Speaker 0>And we don't want this available. Anyone has

00:32:21.195 --> 00:32:23.115
<v Speaker 0>it, the node IP can browse their application.

00:32:23.115 --> 00:32:25.195
<v Speaker 0>We're considering it relatively sensitive at this point

00:32:25.195 --> 00:32:26.395
<v Speaker 0>in time, so we don't want that to

00:32:26.395 --> 00:32:26.555
<v Speaker 0>work.

00:32:27.280 --> 00:32:29.920
<v Speaker 0>Okay. So we can modify our default engine

00:32:29.920 --> 00:32:31.120
<v Speaker 0>next thing here.

00:32:31.680 --> 00:32:34.080
<v Speaker 0>What we can say is listen

00:32:39.385 --> 00:32:41.625
<v Speaker 0>One. And I can just remove that. Right?

00:32:41.625 --> 00:32:43.945
<v Speaker 0>Who's actually doing IPv six anyway?

00:32:44.664 --> 00:32:46.664
<v Speaker 0>But now we can say lesson on local

00:32:46.664 --> 00:32:47.705
<v Speaker 0>was only

00:32:48.905 --> 00:32:52.424
<v Speaker 0>hopefully oh, top 400 x. Hopefully, I haven't

00:32:52.424 --> 00:32:53.065
<v Speaker 0>broken this.

00:32:55.490 --> 00:32:56.609
<v Speaker 0>Looks alright.

00:32:56.769 --> 00:32:59.329
<v Speaker 0>And if we do a curl localhost

00:32:59.730 --> 00:33:00.769
<v Speaker 0>eighty eighty,

00:33:01.250 --> 00:33:02.849
<v Speaker 0>we get a response.

00:33:03.570 --> 00:33:05.250
<v Speaker 0>If we pop over to here, the IP

00:33:05.250 --> 00:33:06.209
<v Speaker 0>address one,

00:33:06.610 --> 00:33:09.545
<v Speaker 0>we have lost it. Right? This NGINX application

00:33:09.545 --> 00:33:12.105
<v Speaker 0>is no longer publicly available.

00:33:12.505 --> 00:33:14.905
<v Speaker 0>And the last part of this exercise is,

00:33:15.465 --> 00:33:18.505
<v Speaker 0>well, is it available via the Teleport proxy?

00:33:18.825 --> 00:33:20.665
<v Speaker 0>And the answer is yes.

00:33:22.070 --> 00:33:22.789
<v Speaker 0>Perfect.

00:33:23.270 --> 00:33:25.669
<v Speaker 0>So that is how you take

00:33:25.830 --> 00:33:28.710
<v Speaker 0>a application running within your infrastructure.

00:33:28.950 --> 00:33:30.870
<v Speaker 0>You bind it to a private interface. You

00:33:30.870 --> 00:33:32.790
<v Speaker 0>just remove it from the Internet and expose

00:33:32.790 --> 00:33:34.789
<v Speaker 0>it through Teleport using

00:33:34.790 --> 00:33:37.030
<v Speaker 0>the really great

00:33:36.455 --> 00:33:38.055
<v Speaker 0>application authentication

00:33:38.055 --> 00:33:39.014
<v Speaker 0>proxy.

00:33:40.135 --> 00:33:40.774
<v Speaker 0>Russell,

00:33:42.855 --> 00:33:44.535
<v Speaker 0>I just tried that. Cool. I hope it

00:33:44.535 --> 00:33:45.095
<v Speaker 0>worked.

00:33:46.775 --> 00:33:48.695
<v Speaker 0>All right, exercise seven. So

00:33:50.420 --> 00:33:53.380
<v Speaker 0>let's do this. So definitely let's try and

00:33:53.380 --> 00:33:55.460
<v Speaker 0>take, you know, NGINX is great, but you

00:33:55.460 --> 00:33:57.059
<v Speaker 0>know, one of the most

00:33:59.059 --> 00:34:01.460
<v Speaker 0>common use cases I have to use this

00:34:01.460 --> 00:34:03.860
<v Speaker 0>specifically, and I'm assuming everyone is the same

00:34:03.860 --> 00:34:05.715
<v Speaker 0>is that Grafana

00:34:06.115 --> 00:34:08.114
<v Speaker 0>is something that usually has access to a

00:34:08.114 --> 00:34:10.355
<v Speaker 0>lot of monitoring and observability data.

00:34:10.835 --> 00:34:12.835
<v Speaker 0>We run it on public interfaces because it's

00:34:12.835 --> 00:34:15.155
<v Speaker 0>easy, but at the same time, we

00:34:15.795 --> 00:34:18.195
<v Speaker 0>probably wanna restrict access to it depending on

00:34:18.195 --> 00:34:19.930
<v Speaker 0>what we have there. So we

00:34:20.410 --> 00:34:22.890
<v Speaker 0>are going to install Docker on the server

00:34:22.890 --> 00:34:24.810
<v Speaker 0>and then pull the image and run it.

00:34:24.810 --> 00:34:26.650
<v Speaker 0>And we're gonna use Docker

00:34:26.810 --> 00:34:29.610
<v Speaker 0>port publishing that is bound to

00:34:29.929 --> 00:34:31.770
<v Speaker 0>the private IPv4

00:34:31.770 --> 00:34:33.770
<v Speaker 0>or the local host address.

00:34:34.554 --> 00:34:36.635
<v Speaker 0>And then we'll add this to Teleport.

00:34:36.955 --> 00:34:38.715
<v Speaker 0>And the one twist we're doing with this

00:34:38.715 --> 00:34:39.915
<v Speaker 0>one is just to show off some more

00:34:39.915 --> 00:34:42.395
<v Speaker 0>application features is that we can modify that

00:34:42.395 --> 00:34:44.635
<v Speaker 0>DNS name that has been generated for us

00:34:44.635 --> 00:34:45.835
<v Speaker 0>whenever we add the application.

00:34:46.510 --> 00:34:48.510
<v Speaker 0>But here I'm doing gnt.

00:34:48.670 --> 00:34:51.550
<v Speaker 0>Rockode. Sh or g. T. Rockode. Sh.

00:34:52.830 --> 00:34:54.830
<v Speaker 0>Now, whenever I need to install Docker, I

00:34:54.830 --> 00:34:56.830
<v Speaker 0>go to get. Docker.io

00:34:57.230 --> 00:34:58.830
<v Speaker 0>and I grab this.

00:35:01.585 --> 00:35:04.225
<v Speaker 0>So we take off the dash o and

00:35:04.225 --> 00:35:05.825
<v Speaker 0>just paper straight to bash.

00:35:07.665 --> 00:35:09.345
<v Speaker 0>I think we just need to give this

00:35:09.345 --> 00:35:11.025
<v Speaker 0>thirty seconds and then I'll be able to

00:35:11.025 --> 00:35:12.865
<v Speaker 0>pull the Grafana image.

00:35:13.910 --> 00:35:15.590
<v Speaker 0>We look at the solution

00:35:15.590 --> 00:35:17.030
<v Speaker 0>for the last one.

00:35:19.190 --> 00:35:21.830
<v Speaker 0>There we go. For the solution, we pretty

00:35:21.830 --> 00:35:23.350
<v Speaker 0>much did exactly the last we just announced

00:35:23.350 --> 00:35:25.830
<v Speaker 0>install engine x. We added engine x with

00:35:25.830 --> 00:35:27.830
<v Speaker 0>the URI here, although I was actually using

00:35:27.830 --> 00:35:29.190
<v Speaker 0>port 80, not important.

00:35:30.045 --> 00:35:32.605
<v Speaker 0>And then we listen on the private IPv4.

00:35:34.204 --> 00:35:35.645
<v Speaker 0>Or you oh, actually, I used one two

00:35:35.645 --> 00:35:36.925
<v Speaker 0>seven, but I could have used the private

00:35:36.925 --> 00:35:37.805
<v Speaker 0>IPv.

00:35:38.285 --> 00:35:39.885
<v Speaker 0>And then we did confirm that it still

00:35:39.885 --> 00:35:40.605
<v Speaker 0>works. Perfect.

00:35:43.920 --> 00:35:46.480
<v Speaker 0>We're still waiting on Docker just now. Won't

00:35:46.480 --> 00:35:47.760
<v Speaker 0>be too long.

00:35:53.200 --> 00:35:54.880
<v Speaker 0>Oh, and my ferret is awake.

00:35:56.975 --> 00:35:59.535
<v Speaker 0>Okay. Cool. We have Docker. So let's do

00:35:59.535 --> 00:36:00.415
<v Speaker 0>Docker

00:36:00.735 --> 00:36:01.775
<v Speaker 0>container

00:36:02.095 --> 00:36:03.055
<v Speaker 0>run

00:36:03.375 --> 00:36:05.935
<v Speaker 0>dash r m dash background

00:36:06.495 --> 00:36:07.295
<v Speaker 0>dash

00:36:07.455 --> 00:36:08.655
<v Speaker 0>publish port.

00:36:08.655 --> 00:36:10.575
<v Speaker 0>And I'm gonna be very specific here.

00:36:12.900 --> 00:36:14.900
<v Speaker 0>And when we use the port syntax with

00:36:14.900 --> 00:36:16.580
<v Speaker 0>the IP address, it's just telling the interface

00:36:16.580 --> 00:36:17.620
<v Speaker 0>to listen on.

00:36:18.500 --> 00:36:20.500
<v Speaker 0>We also want to run,

00:36:22.500 --> 00:36:23.859
<v Speaker 0>is it just called Grafana?

00:36:26.395 --> 00:36:27.355
<v Speaker 0>Or

00:36:27.355 --> 00:36:28.875
<v Speaker 0>is it Grafana Grafana?

00:36:31.755 --> 00:36:33.835
<v Speaker 0>Yeah. I think it's Grafana Grafana.

00:36:36.715 --> 00:36:38.475
<v Speaker 0>I could've looked at the solution, but I'm

00:36:38.475 --> 00:36:40.315
<v Speaker 0>trying not to. Yeah. There we go. Grafana

00:36:40.315 --> 00:36:41.035
<v Speaker 0>Grafana

00:36:41.675 --> 00:36:42.740
<v Speaker 0>Grafana. Grafana, Grafana,

00:36:43.060 --> 00:36:44.180
<v Speaker 0>Grafana.

00:36:49.460 --> 00:36:50.900
<v Speaker 0>I think it's just that. Let's see.

00:36:55.315 --> 00:36:57.394
<v Speaker 0>So what we're gonna do is we'll pop

00:36:57.394 --> 00:36:58.115
<v Speaker 0>over

00:36:59.234 --> 00:37:00.595
<v Speaker 0>to the

00:37:01.474 --> 00:37:02.675
<v Speaker 0>oh, I closed it.

00:37:06.275 --> 00:37:08.194
<v Speaker 0>Grab the IP address again

00:37:10.070 --> 00:37:11.590
<v Speaker 0>On port three thousand.

00:37:13.030 --> 00:37:14.790
<v Speaker 0>And nothing works. Good.

00:37:16.230 --> 00:37:18.070
<v Speaker 0>If we do a container l s, we

00:37:18.070 --> 00:37:20.070
<v Speaker 0>should hopefully see a happy container. We do

00:37:20.070 --> 00:37:21.190
<v Speaker 0>it up for nineteen seconds.

00:37:22.515 --> 00:37:23.635
<v Speaker 0>Compassionate

00:37:23.635 --> 00:37:24.435
<v Speaker 0>swaddles.

00:37:24.515 --> 00:37:25.795
<v Speaker 0>Cool. I'll take it.

00:37:26.355 --> 00:37:27.795
<v Speaker 0>If we do a curl

00:37:27.795 --> 00:37:29.315
<v Speaker 0>on local host,

00:37:31.075 --> 00:37:32.515
<v Speaker 0>let me see if we actually get a

00:37:32.515 --> 00:37:35.395
<v Speaker 0>response. So Grafana is running in a container

00:37:35.555 --> 00:37:36.835
<v Speaker 0>with a very specific

00:37:37.320 --> 00:37:39.960
<v Speaker 0>published port to the local interface

00:37:40.040 --> 00:37:42.280
<v Speaker 0>that is not available to the external world,

00:37:42.440 --> 00:37:45.080
<v Speaker 0>but we want people that we have trust

00:37:45.080 --> 00:37:47.080
<v Speaker 0>with, that are authenticated with Teleport to have

00:37:47.080 --> 00:37:48.440
<v Speaker 0>access to this application.

00:37:49.320 --> 00:37:51.595
<v Speaker 0>So we're gonna continue as we did with

00:37:51.595 --> 00:37:53.835
<v Speaker 0>NGINX and we're gonna go into our application

00:37:53.835 --> 00:37:54.714
<v Speaker 0>config.

00:37:55.115 --> 00:37:56.795
<v Speaker 0>We're gonna add a new app,

00:37:57.595 --> 00:37:59.675
<v Speaker 0>call this Grafana,

00:38:00.795 --> 00:38:02.394
<v Speaker 0>the URI

00:38:05.010 --> 00:38:06.450
<v Speaker 0>local host

00:38:06.450 --> 00:38:07.490
<v Speaker 0>3,000.

00:38:07.970 --> 00:38:10.450
<v Speaker 0>Now what we said well, in fact, let's

00:38:10.450 --> 00:38:11.730
<v Speaker 0>just get it running first and then we'll

00:38:11.730 --> 00:38:12.450
<v Speaker 0>change it.

00:38:12.850 --> 00:38:14.290
<v Speaker 0>Restart Teleport.

00:38:14.530 --> 00:38:16.050
<v Speaker 0>So what should happen now

00:38:16.555 --> 00:38:18.315
<v Speaker 0>is I should be able to because I

00:38:18.315 --> 00:38:20.315
<v Speaker 0>know how the naming structure works. It's pressed

00:38:20.315 --> 00:38:20.955
<v Speaker 0>to

00:38:21.115 --> 00:38:25.755
<v Speaker 0>httpsgrafana.t.rockode.sh.

00:38:26.875 --> 00:38:28.715
<v Speaker 0>And after a little bit of an authentication

00:38:28.715 --> 00:38:31.195
<v Speaker 0>dance, we should get the login page for

00:38:31.275 --> 00:38:31.835
<v Speaker 0>Grafana.

00:38:34.290 --> 00:38:35.250
<v Speaker 0>Looks good.

00:38:35.970 --> 00:38:37.650
<v Speaker 0>Well, the exercise said, look, we don't want

00:38:37.650 --> 00:38:40.370
<v Speaker 0>it available on grafana.t.rawkode.sh.

00:38:41.410 --> 00:38:43.490
<v Speaker 0>Perhaps people know to check for Grafana on

00:38:43.490 --> 00:38:45.650
<v Speaker 0>sub domains, or we just have another reason

00:38:45.650 --> 00:38:48.055
<v Speaker 0>for one not available elsewhere. So how do

00:38:48.055 --> 00:38:49.575
<v Speaker 0>we control this DNS?

00:38:51.335 --> 00:38:53.895
<v Speaker 0>Well, let's go back to my favorite page

00:38:53.895 --> 00:38:55.415
<v Speaker 0>and the documentation,

00:38:55.975 --> 00:38:56.615
<v Speaker 0>reference,

00:38:57.095 --> 00:38:57.495
<v Speaker 0>no,

00:38:59.255 --> 00:39:00.375
<v Speaker 0>setup reference,

00:39:00.455 --> 00:39:03.010
<v Speaker 0>contact fail. We can pop down to the

00:39:03.010 --> 00:39:04.050
<v Speaker 0>app service,

00:39:05.089 --> 00:39:08.050
<v Speaker 0>and we'll see that we actually have

00:39:09.490 --> 00:39:11.089
<v Speaker 0>all of the fields that we are not

00:39:11.089 --> 00:39:12.530
<v Speaker 0>using being

00:39:12.530 --> 00:39:14.130
<v Speaker 0>commented on to tell us what to do.

00:39:15.335 --> 00:39:17.335
<v Speaker 0>We can tell it to escape and secure

00:39:17.335 --> 00:39:19.095
<v Speaker 0>certificates if we want. If we're running something

00:39:19.095 --> 00:39:20.934
<v Speaker 0>that has self signed certificates on our server,

00:39:20.934 --> 00:39:23.095
<v Speaker 0>which is quite common for private stuff, especially

00:39:23.095 --> 00:39:25.015
<v Speaker 0>if it can't pass any of the ACME

00:39:25.015 --> 00:39:25.974
<v Speaker 0>certificate

00:39:25.974 --> 00:39:27.255
<v Speaker 0>requests or

00:39:27.655 --> 00:39:27.974
<v Speaker 0>process.

00:39:28.920 --> 00:39:30.760
<v Speaker 0>We can modify the public address, which we

00:39:30.760 --> 00:39:31.640
<v Speaker 0>are going to do.

00:39:32.119 --> 00:39:34.040
<v Speaker 0>Labels and commands, we can obviously play with

00:39:34.040 --> 00:39:35.720
<v Speaker 0>later, and there's some redirect stuff that we

00:39:35.720 --> 00:39:37.559
<v Speaker 0>can talk about for applications such as, like,

00:39:37.559 --> 00:39:39.880
<v Speaker 0>WordPress that do a whole bunch of redirecting

00:39:39.880 --> 00:39:41.480
<v Speaker 0>based on whether you authenticate to trying to

00:39:41.480 --> 00:39:42.840
<v Speaker 0>get to the admin portal,

00:39:43.000 --> 00:39:44.200
<v Speaker 0>some of the assets or

00:39:45.115 --> 00:39:47.435
<v Speaker 0>doing internal redirects to, you can handle all

00:39:47.435 --> 00:39:48.075
<v Speaker 0>of that.

00:39:48.955 --> 00:39:50.875
<v Speaker 0>But right now, all we want to do

00:39:50.955 --> 00:39:51.675
<v Speaker 0>is

00:39:51.915 --> 00:39:53.915
<v Speaker 0>modify our Teleport. Yaml,

00:39:54.315 --> 00:39:55.915
<v Speaker 0>change the public address

00:39:57.110 --> 00:40:00.070
<v Speaker 0>to g.t.Rawkode.sh.

00:40:01.190 --> 00:40:02.550
<v Speaker 0>Restart Teleport.

00:40:07.110 --> 00:40:11.190
<v Speaker 0>Pop over here. We'll change this g

00:40:10.285 --> 00:40:11.405
<v Speaker 0>to a t.

00:40:18.125 --> 00:40:19.725
<v Speaker 0>There we go. Oh,

00:40:21.805 --> 00:40:22.445
<v Speaker 0>again.

00:40:27.060 --> 00:40:27.940
<v Speaker 0>There we go.

00:40:29.300 --> 00:40:31.620
<v Speaker 0>I think it's admin admin. Right?

00:40:31.940 --> 00:40:33.220
<v Speaker 0>Yeah. New password.

00:40:33.619 --> 00:40:34.900
<v Speaker 0>I don't know if you can figure that.

00:40:34.900 --> 00:40:35.460
<v Speaker 0>It worked.

00:40:37.335 --> 00:40:39.575
<v Speaker 0>Okay. Let's pop open a solution, make sure

00:40:39.575 --> 00:40:40.855
<v Speaker 0>we haven't missed anything.

00:40:41.095 --> 00:40:43.335
<v Speaker 0>So I did install Docker with

00:40:43.495 --> 00:40:44.615
<v Speaker 0>Kernel Bash.

00:40:44.855 --> 00:40:47.335
<v Speaker 0>My run command was pretty identical to that,

00:40:47.335 --> 00:40:48.215
<v Speaker 0>which is good.

00:40:48.535 --> 00:40:50.935
<v Speaker 0>And we use the public ADDR to make

00:40:50.935 --> 00:40:51.095
<v Speaker 0>sure

00:40:51.789 --> 00:40:55.790
<v Speaker 0>that we can control naming of our application.

00:40:57.150 --> 00:40:59.069
<v Speaker 0>Okay. We've got a couple more things to

00:40:59.069 --> 00:40:59.630
<v Speaker 0>do.

00:41:02.349 --> 00:41:03.710
<v Speaker 0>What if we want

00:41:04.750 --> 00:41:06.029
<v Speaker 0>semi public access?

00:41:06.725 --> 00:41:09.125
<v Speaker 0>This is an extremely contrived

00:41:09.205 --> 00:41:10.245
<v Speaker 0>scenario

00:41:11.365 --> 00:41:13.685
<v Speaker 0>that I'm gonna reuse on gitx and

00:41:13.925 --> 00:41:14.885
<v Speaker 0>admin

00:41:14.885 --> 00:41:15.925
<v Speaker 0>page, but

00:41:17.125 --> 00:41:19.470
<v Speaker 0>you can use Teleport

00:41:19.470 --> 00:41:21.470
<v Speaker 0>and, you know, your web server to restrict

00:41:21.470 --> 00:41:23.550
<v Speaker 0>access. You know, we got with Apache, we

00:41:23.550 --> 00:41:25.390
<v Speaker 0>have HD access. Within the next, we can

00:41:25.390 --> 00:41:28.270
<v Speaker 0>add location blocks where we can just say,

00:41:28.270 --> 00:41:30.190
<v Speaker 0>actually, you don't have access to this from

00:41:30.190 --> 00:41:32.750
<v Speaker 0>certain IPs or without certain headers authentication,

00:41:33.125 --> 00:41:34.885
<v Speaker 0>etcetera. So we're gonna try and set that

00:41:34.885 --> 00:41:37.845
<v Speaker 0>up. It won't take us too long, but

00:41:37.845 --> 00:41:40.405
<v Speaker 0>our secret application is that we'll we need

00:41:40.405 --> 00:41:41.845
<v Speaker 0>NGINX installed first.

00:41:42.005 --> 00:41:42.965
<v Speaker 0>Oh, fat.

00:41:44.085 --> 00:41:44.964
<v Speaker 0>I see.

00:42:00.165 --> 00:42:01.445
<v Speaker 0>We're gonna do this one on the worker

00:42:01.445 --> 00:42:02.965
<v Speaker 0>node this time. Okay.

00:42:03.925 --> 00:42:07.045
<v Speaker 0>I I haven't mentioned it in the exercise,

00:42:08.165 --> 00:42:10.005
<v Speaker 0>but I'm pretty sure I meant to. So

00:42:10.005 --> 00:42:11.685
<v Speaker 0>I will update that. And I'm sure the

00:42:11.685 --> 00:42:13.605
<v Speaker 0>solution has a quirk that I want to

00:42:13.605 --> 00:42:15.045
<v Speaker 0>cover. So we're gonna do it this way.

00:42:15.660 --> 00:42:18.780
<v Speaker 0>Okay. So let's jump over here. We're on

00:42:18.780 --> 00:42:19.420
<v Speaker 0>our

00:42:19.980 --> 00:42:22.140
<v Speaker 0>worker. We don't have NGINX. So I'm going

00:42:22.140 --> 00:42:22.780
<v Speaker 0>to do

00:42:23.180 --> 00:42:24.700
<v Speaker 0>I have to install NGINX.

00:42:27.420 --> 00:42:29.180
<v Speaker 0>The next part of this is that we

00:42:29.180 --> 00:42:31.935
<v Speaker 0>want to set up our secret admin page,

00:42:31.935 --> 00:42:33.455
<v Speaker 0>which I'm just going to create an HTML

00:42:33.455 --> 00:42:34.815
<v Speaker 0>file in the web root.

00:42:36.415 --> 00:42:38.895
<v Speaker 0>We're waiting for that 1% again, aren't we?

00:42:58.875 --> 00:43:01.035
<v Speaker 0>I wonder what it's doing. I think of

00:43:01.035 --> 00:43:03.275
<v Speaker 0>the man pages for engineering, if that's what's

00:43:03.275 --> 00:43:03.915
<v Speaker 0>actually

00:43:04.155 --> 00:43:05.435
<v Speaker 0>installing it.

00:43:08.795 --> 00:43:10.715
<v Speaker 0>Although I must also say these are really

00:43:10.715 --> 00:43:11.755
<v Speaker 0>small nodes.

00:43:12.250 --> 00:43:14.410
<v Speaker 0>These are the nano core ones. So I'm

00:43:14.410 --> 00:43:16.250
<v Speaker 0>actually not throwing too much power at this,

00:43:16.250 --> 00:43:17.530
<v Speaker 0>which is probably why it's taking a little

00:43:17.530 --> 00:43:18.250
<v Speaker 0>bit longer.

00:43:20.810 --> 00:43:22.570
<v Speaker 0>Alright. There we go. So here is my

00:43:22.570 --> 00:43:24.490
<v Speaker 0>admin page. With that, let's go to our

00:43:24.490 --> 00:43:25.690
<v Speaker 0>www HTML,

00:43:26.415 --> 00:43:27.775
<v Speaker 0>Cat admin.

00:43:27.855 --> 00:43:29.855
<v Speaker 0>There we go. Wonderful stuff.

00:43:32.255 --> 00:43:33.055
<v Speaker 0>Restart.

00:43:37.055 --> 00:43:38.735
<v Speaker 0>If it doesn't start automatically,

00:43:38.735 --> 00:43:39.135
<v Speaker 0>for sure.

00:43:40.089 --> 00:43:40.730
<v Speaker 0>Okay.

00:43:40.890 --> 00:43:42.970
<v Speaker 0>So let's confirm

00:43:43.450 --> 00:43:44.650
<v Speaker 0>w one

00:43:45.050 --> 00:43:46.010
<v Speaker 0>Rawkode.

00:43:46.010 --> 00:43:46.570
<v Speaker 0>H.

00:43:48.010 --> 00:43:50.089
<v Speaker 0>There's no yep. There we go. There's a

00:43:50.089 --> 00:43:53.210
<v Speaker 0>page. And we can just browse to admin.HTML

00:43:53.595 --> 00:43:55.915
<v Speaker 0>and we get our really secure

00:43:55.994 --> 00:43:57.195
<v Speaker 0>admin page.

00:43:57.595 --> 00:43:59.035
<v Speaker 0>This is not what we want.

00:44:00.955 --> 00:44:02.715
<v Speaker 0>Okay. Where's my

00:44:03.115 --> 00:44:05.675
<v Speaker 0>to do list? So we want to modify

00:44:05.675 --> 00:44:08.170
<v Speaker 0>the NGINX virtual host or site, whatever you

00:44:08.170 --> 00:44:10.090
<v Speaker 0>wanna call to block non local traffic to

00:44:10.090 --> 00:44:11.290
<v Speaker 0>the admin page.

00:44:12.650 --> 00:44:14.250
<v Speaker 0>Okay. Let's do that.

00:44:15.450 --> 00:44:16.410
<v Speaker 0>Enabled.

00:44:16.570 --> 00:44:18.010
<v Speaker 0>Here's our default.

00:44:18.570 --> 00:44:19.690
<v Speaker 0>Pop down here.

00:44:22.475 --> 00:44:23.995
<v Speaker 0>And we can do

00:44:26.555 --> 00:44:27.515
<v Speaker 0>location

00:44:28.075 --> 00:44:29.435
<v Speaker 0>admin dot HTML.

00:44:49.985 --> 00:44:51.825
<v Speaker 0>Rather than look at my solution, I'm going

00:44:51.825 --> 00:44:52.465
<v Speaker 0>to

00:44:53.185 --> 00:44:54.305
<v Speaker 0>Google it.

00:44:55.105 --> 00:44:56.865
<v Speaker 0>Well, yeah, there's my search from there. There

00:44:56.865 --> 00:44:57.265
<v Speaker 0>we go.

00:45:04.240 --> 00:45:05.519
<v Speaker 0>Because this this is this is how you

00:45:05.519 --> 00:45:06.799
<v Speaker 0>find the answers to stuff. Mean, you don't

00:45:06.799 --> 00:45:08.320
<v Speaker 0>remember off the top of your head.

00:45:09.039 --> 00:45:10.320
<v Speaker 0>We go to Google.

00:45:10.400 --> 00:45:12.400
<v Speaker 0>And I'm pretty sure it's just allow

00:45:12.480 --> 00:45:13.920
<v Speaker 0>and then the

00:45:13.920 --> 00:45:14.400
<v Speaker 0>cider.

00:45:18.785 --> 00:45:19.665
<v Speaker 0>Hello.

00:45:31.585 --> 00:45:32.384
<v Speaker 0>Let's just try.

00:45:34.570 --> 00:45:36.410
<v Speaker 0>That's the only one I clicked on. Alright.

00:45:36.410 --> 00:45:36.970
<v Speaker 0>Okay.

00:45:38.890 --> 00:45:39.930
<v Speaker 0>Hello.

00:45:41.930 --> 00:45:43.290
<v Speaker 0>+1 27.

00:45:44.490 --> 00:45:45.210
<v Speaker 0>Not 1.

00:45:47.355 --> 00:45:49.115
<v Speaker 0>Yeah. I think that's it.

00:45:53.435 --> 00:45:54.315
<v Speaker 0>Restart

00:45:54.315 --> 00:45:54.555
<v Speaker 0>it.

00:45:58.650 --> 00:46:00.090
<v Speaker 0>Not yelling at me.

00:46:05.849 --> 00:46:07.050
<v Speaker 0>Yeah. Okay.

00:46:08.970 --> 00:46:10.250
<v Speaker 0>Let's have a look.

00:46:14.245 --> 00:46:15.765
<v Speaker 0>It didn't work. Alright. We're looking at my

00:46:15.765 --> 00:46:16.565
<v Speaker 0>solution.

00:46:20.085 --> 00:46:21.685
<v Speaker 0>I forgot that denial.

00:46:23.205 --> 00:46:24.565
<v Speaker 0>Is this middleware?

00:46:24.565 --> 00:46:25.285
<v Speaker 0>Alright.

00:46:25.365 --> 00:46:26.725
<v Speaker 0>So then

00:46:26.725 --> 00:46:28.780
<v Speaker 0>nginx place enabled

00:46:28.780 --> 00:46:29.820
<v Speaker 0>default

00:46:29.900 --> 00:46:30.780
<v Speaker 0>local.

00:46:34.540 --> 00:46:35.500
<v Speaker 0>Restart.

00:46:35.500 --> 00:46:37.500
<v Speaker 0>Alright. So let's

00:46:38.859 --> 00:46:39.900
<v Speaker 0>there. Perfect.

00:46:41.325 --> 00:46:43.085
<v Speaker 0>So we've blocked

00:46:43.085 --> 00:46:44.445
<v Speaker 0>admin.HTML.

00:46:44.525 --> 00:46:46.685
<v Speaker 0>We still have access to the homepage.

00:46:46.765 --> 00:46:49.484
<v Speaker 0>Now we're doing this for a very superficial.

00:46:49.484 --> 00:46:51.005
<v Speaker 0>We expect the request to come from the

00:46:51.005 --> 00:46:52.045
<v Speaker 0>local machine.

00:46:52.445 --> 00:46:54.525
<v Speaker 0>And that works all right in this scenario.

00:46:59.150 --> 00:47:01.710
<v Speaker 0>Russell has lost access to his admin page.

00:47:01.710 --> 00:47:02.829
<v Speaker 0>We're

00:47:02.829 --> 00:47:03.710
<v Speaker 0>gonna fix it.

00:47:04.430 --> 00:47:05.070
<v Speaker 0>So,

00:47:05.869 --> 00:47:07.390
<v Speaker 0>yeah, this works really well.

00:47:08.265 --> 00:47:09.945
<v Speaker 0>Having that denied there,

00:47:10.105 --> 00:47:12.105
<v Speaker 0>it's just a really simple way of protecting

00:47:12.105 --> 00:47:13.785
<v Speaker 0>access to certain components.

00:47:13.944 --> 00:47:16.265
<v Speaker 0>Wirecards work really well for NGINX and the

00:47:16.265 --> 00:47:18.105
<v Speaker 0>patches where you can really make this work,

00:47:18.105 --> 00:47:20.184
<v Speaker 0>where you have something that as public,

00:47:20.184 --> 00:47:22.970
<v Speaker 0>90% of it, maybe 50% of it. But

00:47:22.970 --> 00:47:24.569
<v Speaker 0>there are components of it. You're like, gosh,

00:47:24.569 --> 00:47:26.650
<v Speaker 0>I really don't want that exposed. Maybe there

00:47:26.650 --> 00:47:28.650
<v Speaker 0>is legacy application. You don't want to extract

00:47:28.650 --> 00:47:29.849
<v Speaker 0>it out to a new thing yet. Like

00:47:29.849 --> 00:47:31.530
<v Speaker 0>whatever your scenarios are,

00:47:31.770 --> 00:47:33.289
<v Speaker 0>this works really well. And you can do

00:47:33.289 --> 00:47:35.609
<v Speaker 0>this through anything that has layer seven visibility.

00:47:35.609 --> 00:47:37.875
<v Speaker 0>So even if this was in Kubernetes, you

00:47:37.875 --> 00:47:40.115
<v Speaker 0>know, rather than like an NGINX, then I

00:47:40.355 --> 00:47:42.035
<v Speaker 0>you could build this up to

00:47:42.195 --> 00:47:45.075
<v Speaker 0>you know, Selim network policy or whatever. So

00:47:45.075 --> 00:47:46.515
<v Speaker 0>lots of different ways you can do this,

00:47:46.515 --> 00:47:47.955
<v Speaker 0>but now what we want to do is

00:47:47.955 --> 00:47:49.395
<v Speaker 0>regain access

00:47:49.635 --> 00:47:50.435
<v Speaker 0>to the service.

00:47:50.859 --> 00:47:51.580
<v Speaker 0>So,

00:47:55.900 --> 00:47:58.380
<v Speaker 0>hello, welcome. Thank you for joining the workshop

00:47:58.380 --> 00:47:59.020
<v Speaker 0>today.

00:48:00.700 --> 00:48:02.620
<v Speaker 0>Okay. So now we need access back.

00:48:02.780 --> 00:48:03.180
<v Speaker 0>Now,

00:48:04.865 --> 00:48:06.704
<v Speaker 0>I'm gonna show you how it doesn't work

00:48:06.704 --> 00:48:07.505
<v Speaker 0>first.

00:48:08.944 --> 00:48:11.585
<v Speaker 0>And that you'd be very tempted to come

00:48:11.585 --> 00:48:12.465
<v Speaker 0>into this

00:48:13.984 --> 00:48:15.825
<v Speaker 0>and add our app service.

00:48:21.019 --> 00:48:21.820
<v Speaker 0>Enabled,

00:48:22.220 --> 00:48:22.859
<v Speaker 0>true.

00:48:23.500 --> 00:48:25.180
<v Speaker 0>And you'd say we we have an app

00:48:25.180 --> 00:48:27.420
<v Speaker 0>that we want to expose through the Teleport

00:48:27.420 --> 00:48:30.220
<v Speaker 0>cluster, which has a name of admin

00:48:30.675 --> 00:48:32.195
<v Speaker 0>with a URI

00:48:33.875 --> 00:48:35.155
<v Speaker 0>of HTTPS.

00:48:35.155 --> 00:48:36.275
<v Speaker 0>Oh no, sorry.

00:48:36.675 --> 00:48:37.555
<v Speaker 0>HTTP

00:48:37.555 --> 00:48:38.675
<v Speaker 0>localhost.

00:48:40.275 --> 00:48:42.115
<v Speaker 0>Then change the ports that this session is

00:48:42.115 --> 00:48:44.515
<v Speaker 0>running on port 80 and saving that. Now,

00:48:45.339 --> 00:48:47.819
<v Speaker 0>of course I even attempted this the first

00:48:47.819 --> 00:48:50.220
<v Speaker 0>time. However, there's a bit of a situation

00:48:50.380 --> 00:48:52.619
<v Speaker 0>and that if we do a system control,

00:48:52.619 --> 00:48:54.140
<v Speaker 0>we start Teleport.

00:48:57.260 --> 00:48:58.220
<v Speaker 0>Teleport

00:49:00.155 --> 00:49:02.315
<v Speaker 0>is that it crashes and we get some

00:49:02.315 --> 00:49:03.275
<v Speaker 0>errors there.

00:49:03.515 --> 00:49:05.595
<v Speaker 0>But it turns out that we can't

00:49:06.235 --> 00:49:08.875
<v Speaker 0>expose applications in this way,

00:49:09.515 --> 00:49:11.835
<v Speaker 0>with this node configuration.

00:49:13.850 --> 00:49:14.890
<v Speaker 0>Teleport,

00:49:14.890 --> 00:49:16.810
<v Speaker 0>if it's not running the auth service and

00:49:16.810 --> 00:49:19.370
<v Speaker 0>the proxy service cannot run the application service

00:49:19.370 --> 00:49:21.290
<v Speaker 0>on the node, you actually have to go

00:49:21.290 --> 00:49:23.210
<v Speaker 0>a slightly different route, which is to use

00:49:23.210 --> 00:49:24.410
<v Speaker 0>the teleport

00:49:24.730 --> 00:49:25.770
<v Speaker 0>app start

00:49:26.010 --> 00:49:26.330
<v Speaker 0>command,

00:49:26.925 --> 00:49:27.805
<v Speaker 0>like so.

00:49:28.125 --> 00:49:29.325
<v Speaker 0>So this runs

00:49:29.885 --> 00:49:33.085
<v Speaker 0>application proxy that works in just this mode

00:49:33.405 --> 00:49:35.645
<v Speaker 0>and allows you to export your applications and

00:49:35.645 --> 00:49:37.165
<v Speaker 0>you would run one of these for each

00:49:37.165 --> 00:49:38.765
<v Speaker 0>of your applications you want to do. I'm

00:49:38.765 --> 00:49:39.805
<v Speaker 0>not gonna do it just now and create

00:49:39.805 --> 00:49:41.085
<v Speaker 0>a unit fail and all that. We just

00:49:41.085 --> 00:49:42.205
<v Speaker 0>kinda wanna get this working,

00:49:42.740 --> 00:49:44.819
<v Speaker 0>but we could do an app start and

00:49:44.819 --> 00:49:47.460
<v Speaker 0>we know our token is Rawkode workshop.

00:49:47.460 --> 00:49:49.300
<v Speaker 0>And we know that our auth server

00:49:49.700 --> 00:49:51.780
<v Speaker 0>is t.rawkode.sh.

00:49:52.740 --> 00:49:54.339
<v Speaker 0>And now we just need to name, which

00:49:54.339 --> 00:49:56.099
<v Speaker 0>is admin and a URI,

00:49:56.785 --> 00:49:58.305
<v Speaker 0>which is http

00:49:59.185 --> 00:50:00.305
<v Speaker 0>localhost.

00:50:06.385 --> 00:50:07.825
<v Speaker 0>What did I get wrong?

00:50:08.225 --> 00:50:09.585
<v Speaker 0>Maybe I don't need the 38.

00:50:11.550 --> 00:50:13.550
<v Speaker 0>Maybe I do. Oh, no. I've I've broken

00:50:13.550 --> 00:50:14.350
<v Speaker 0>Teleport.

00:50:14.990 --> 00:50:16.590
<v Speaker 0>Which need we need for the tunnel.

00:50:18.750 --> 00:50:21.710
<v Speaker 0>Teleport happy. Teleport is happy. Okay. So let's

00:50:21.710 --> 00:50:22.830
<v Speaker 0>come back to this.

00:50:26.145 --> 00:50:27.345
<v Speaker 0>Maybe that's.

00:50:29.905 --> 00:50:31.265
<v Speaker 0>You're very very We're look at the solution

00:50:31.265 --> 00:50:32.385
<v Speaker 0>again, aren't you?

00:50:35.265 --> 00:50:36.545
<v Speaker 0>Oh, then

00:50:36.545 --> 00:50:38.145
<v Speaker 0>they can't have my tunnel.

00:50:38.770 --> 00:50:40.450
<v Speaker 0>It's my teleport running.

00:50:42.610 --> 00:50:42.930
<v Speaker 0>Yeah.

00:50:52.705 --> 00:50:54.225
<v Speaker 0>Alright. Let's just look.

00:50:55.905 --> 00:50:58.225
<v Speaker 0>I did document this here that when running

00:50:58.225 --> 00:51:00.465
<v Speaker 0>Teleport process as an application proxy,

00:51:01.105 --> 00:51:02.545
<v Speaker 0>it's much easier to create a unit file,

00:51:02.545 --> 00:51:03.665
<v Speaker 0>which I would encourage you to do.

00:51:04.340 --> 00:51:05.780
<v Speaker 0>The issue for the

00:51:06.100 --> 00:51:07.860
<v Speaker 0>thing that I mentioned is here.

00:51:08.500 --> 00:51:10.820
<v Speaker 0>So at the start has exit and

00:51:11.780 --> 00:51:13.460
<v Speaker 0>someone from Teleport has

00:51:14.180 --> 00:51:16.420
<v Speaker 0>turned in to say that this doesn't work

00:51:16.455 --> 00:51:19.255
<v Speaker 0>and you need to run proxy service and

00:51:19.255 --> 00:51:21.015
<v Speaker 0>app service in separate processes,

00:51:21.655 --> 00:51:22.775
<v Speaker 0>which is fine.

00:51:24.135 --> 00:51:25.735
<v Speaker 0>You can see that they have off service

00:51:25.735 --> 00:51:26.615
<v Speaker 0>null here.

00:51:27.655 --> 00:51:29.255
<v Speaker 0>So now we just do a little

00:51:29.735 --> 00:51:31.255
<v Speaker 0>bit of tidying up.

00:51:33.710 --> 00:51:35.950
<v Speaker 0>I pop over here, here's my start command.

00:51:35.950 --> 00:51:37.470
<v Speaker 0>Did I get something wrong?

00:51:38.030 --> 00:51:40.430
<v Speaker 0>Oh yeah, four forty three, not 38.

00:51:41.070 --> 00:51:42.830
<v Speaker 0>Because we have a TLS

00:51:42.910 --> 00:51:43.790
<v Speaker 0>version

00:51:44.430 --> 00:51:46.030
<v Speaker 0>of our thingy running.

00:51:48.045 --> 00:51:49.805
<v Speaker 0>Okay. That worked better. Trying to change the

00:51:49.805 --> 00:51:51.325
<v Speaker 0>command. Nope.

00:51:51.725 --> 00:51:53.325
<v Speaker 0>Great thing about copy and paste. Okay. So

00:51:53.325 --> 00:51:54.925
<v Speaker 0>that was the exact same command.

00:51:55.085 --> 00:51:56.845
<v Speaker 0>I just got the port wrong.

00:51:57.645 --> 00:52:00.200
<v Speaker 0>So it's Teleport app start. We give the

00:52:00.200 --> 00:52:02.279
<v Speaker 0>application a name, the URI to find it,

00:52:02.279 --> 00:52:04.920
<v Speaker 0>token, and the off server. That's now running

00:52:04.920 --> 00:52:06.119
<v Speaker 0>as quite happy.

00:52:06.200 --> 00:52:07.800
<v Speaker 0>So we're gonna pop over

00:52:09.079 --> 00:52:09.880
<v Speaker 0>here.

00:52:11.559 --> 00:52:13.559
<v Speaker 0>You can see our Grafana and there we

00:52:13.559 --> 00:52:15.079
<v Speaker 0>have our admin

00:52:15.455 --> 00:52:16.575
<v Speaker 0>at launch.

00:52:28.335 --> 00:52:29.455
<v Speaker 0>Medication dance.

00:52:43.065 --> 00:52:45.385
<v Speaker 0>Oh, actually, I found this earlier. It doesn't

00:52:45.385 --> 00:52:46.345
<v Speaker 0>work it out.

00:52:47.625 --> 00:52:49.065
<v Speaker 0>Let's try one more time.

00:52:49.785 --> 00:52:51.625
<v Speaker 0>Admin.p.Rawkode.

00:52:54.360 --> 00:52:56.280
<v Speaker 0>Oh, no. It worked. Okay. I have trouble

00:52:56.280 --> 00:52:58.680
<v Speaker 0>with the admin prefix. It wasn't resolving. And

00:52:58.680 --> 00:53:00.200
<v Speaker 0>I could actually like, when I run deg

00:53:00.200 --> 00:53:01.720
<v Speaker 0>admin.t.rawkode.c,

00:53:01.720 --> 00:53:03.400
<v Speaker 0>it just wouldn't resolve at all, but only

00:53:03.400 --> 00:53:05.720
<v Speaker 0>admin dot that appears that was just a

00:53:05.720 --> 00:53:08.125
<v Speaker 0>temporary thing. So now we have our application

00:53:08.125 --> 00:53:08.845
<v Speaker 0>here.

00:53:09.085 --> 00:53:11.165
<v Speaker 0>And if we go to admin.HTML,

00:53:12.684 --> 00:53:14.125
<v Speaker 0>we have forbidden.

00:53:14.765 --> 00:53:16.765
<v Speaker 0>That wasn't expected. Let me make sure I

00:53:16.765 --> 00:53:17.724
<v Speaker 0>got my rule correct.

00:53:20.980 --> 00:53:23.220
<v Speaker 0>I'm just gonna open a new thing.

00:53:30.820 --> 00:53:31.540
<v Speaker 0>Mhmm. Internet.

00:53:32.340 --> 00:53:33.620
<v Speaker 0>It's enabled.

00:53:33.620 --> 00:53:34.180
<v Speaker 0>Default.

00:53:38.744 --> 00:53:39.465
<v Speaker 0>So

00:53:39.625 --> 00:53:40.265
<v Speaker 0>what's my

00:53:47.865 --> 00:53:50.585
<v Speaker 0>I just wanna make sure

00:53:49.730 --> 00:53:50.450
<v Speaker 0>that

00:53:52.130 --> 00:53:54.930
<v Speaker 0>dot 0 dot zero. We could be coming

00:53:54.930 --> 00:53:56.210
<v Speaker 0>across the network.

00:53:56.210 --> 00:53:57.330
<v Speaker 0>I'm gonna do this.

00:53:58.130 --> 00:54:00.050
<v Speaker 0>I'm gonna restart my application.

00:54:00.609 --> 00:54:01.010
<v Speaker 0>No.

00:54:02.895 --> 00:54:05.615
<v Speaker 0>I wanted to restart engine x.

00:54:06.975 --> 00:54:08.575
<v Speaker 0>That's the wrong course.

00:54:09.695 --> 00:54:10.575
<v Speaker 0>Restart

00:54:10.575 --> 00:54:11.375
<v Speaker 0>engine.

00:54:11.695 --> 00:54:12.655
<v Speaker 0>And

00:54:13.135 --> 00:54:14.975
<v Speaker 0>there's a really good way to debug this

00:54:14.975 --> 00:54:16.095
<v Speaker 0>if it doesn't work.

00:54:17.200 --> 00:54:18.640
<v Speaker 0>There is a.

00:54:22.560 --> 00:54:23.200
<v Speaker 0>Re

00:54:24.480 --> 00:54:25.200
<v Speaker 0>log.

00:54:31.995 --> 00:54:33.355
<v Speaker 0>Think that's right.

00:54:34.715 --> 00:54:35.355
<v Speaker 0>No.

00:54:35.995 --> 00:54:37.435
<v Speaker 0>Relate log.

00:54:39.035 --> 00:54:39.355
<v Speaker 0>Yes.

00:54:44.970 --> 00:54:46.490
<v Speaker 0>Internet rewrite

00:54:46.490 --> 00:54:47.610
<v Speaker 0>log

00:54:52.730 --> 00:54:53.450
<v Speaker 0>on.

00:54:57.744 --> 00:54:58.545
<v Speaker 0>There

00:54:59.105 --> 00:54:59.665
<v Speaker 0>we go.

00:55:00.305 --> 00:55:02.465
<v Speaker 0>If we can now come to here

00:55:03.825 --> 00:55:05.985
<v Speaker 0>monitor our error log,

00:55:07.984 --> 00:55:09.744
<v Speaker 0>we should see if we still get a

00:55:09.744 --> 00:55:11.105
<v Speaker 0>deny why we got the deny.

00:55:12.860 --> 00:55:15.420
<v Speaker 0>So let's force the deny through

00:55:19.580 --> 00:55:20.940
<v Speaker 0>w one.

00:55:21.820 --> 00:55:23.500
<v Speaker 0>Yeah. This is me going to the node

00:55:23.500 --> 00:55:24.140
<v Speaker 0>directly.

00:55:26.075 --> 00:55:28.474
<v Speaker 0>That should be from my public IP address.

00:55:28.474 --> 00:55:29.595
<v Speaker 0>We look here.

00:55:29.994 --> 00:55:31.915
<v Speaker 0>Our client 82

00:55:32.075 --> 00:55:34.555
<v Speaker 0>has been denied, which is what we expect.

00:55:35.674 --> 00:55:36.395
<v Speaker 0>And

00:55:36.474 --> 00:55:37.434
<v Speaker 0>if

00:55:37.434 --> 00:55:39.275
<v Speaker 0>we come through admin. T,

00:55:41.450 --> 00:55:42.970
<v Speaker 0>we're still being denied.

00:55:43.450 --> 00:55:44.490
<v Speaker 0>Ah, okay.

00:55:44.890 --> 00:55:48.250
<v Speaker 0>So it's coming over the IPv6

00:55:48.250 --> 00:55:48.890
<v Speaker 0>address.

00:55:49.690 --> 00:55:50.890
<v Speaker 0>We can fix that.

00:55:51.369 --> 00:55:54.010
<v Speaker 0>So let's just make one final modification

00:55:54.935 --> 00:55:55.735
<v Speaker 0>here.

00:55:55.895 --> 00:55:57.975
<v Speaker 0>We're actually going to allow

00:56:00.375 --> 00:56:01.015
<v Speaker 0>one

00:56:03.975 --> 00:56:04.295
<v Speaker 0>tail.

00:56:08.849 --> 00:56:09.730
<v Speaker 0>There we go.

00:56:10.450 --> 00:56:13.410
<v Speaker 0>Now coming through the Teleport

00:56:13.410 --> 00:56:14.210
<v Speaker 0>authenticated

00:56:14.210 --> 00:56:15.089
<v Speaker 0>proxy,

00:56:15.089 --> 00:56:17.490
<v Speaker 0>we have access to our admin page, but

00:56:17.650 --> 00:56:20.615
<v Speaker 0>the public world does not. I will update

00:56:20.615 --> 00:56:22.694
<v Speaker 0>the workshop with me just so that the

00:56:22.694 --> 00:56:25.575
<v Speaker 0>correct thing is there, and this already is.

00:56:27.015 --> 00:56:29.734
<v Speaker 0>No. Okay. Cool. And so I can get

00:56:29.734 --> 00:56:32.535
<v Speaker 0>that fixed. But that's a really cool application

00:56:32.535 --> 00:56:34.454
<v Speaker 0>and you'll see it for the Teleport application

00:56:34.310 --> 00:56:37.430
<v Speaker 0>I really love that semi private public thing,

00:56:37.510 --> 00:56:39.510
<v Speaker 0>just leveraging NGINX,

00:56:39.510 --> 00:56:41.510
<v Speaker 0>Apache, anything like that to block the things

00:56:41.510 --> 00:56:42.630
<v Speaker 0>that we don't want people to have access

00:56:42.630 --> 00:56:43.110
<v Speaker 0>to.

00:56:44.390 --> 00:56:45.750
<v Speaker 0>We're just gonna take a look at one

00:56:45.750 --> 00:56:47.510
<v Speaker 0>more thing and then we'll finish up today's

00:56:47.510 --> 00:56:49.430
<v Speaker 0>workshop, which is well, actually,

00:56:50.465 --> 00:56:52.225
<v Speaker 0>what if I need local access and I

00:56:52.225 --> 00:56:54.065
<v Speaker 0>don't wanna have to go through the Teleport

00:56:54.065 --> 00:56:56.385
<v Speaker 0>system? Can I use T control to build

00:56:56.385 --> 00:56:57.185
<v Speaker 0>to do this?

00:56:57.745 --> 00:56:59.665
<v Speaker 0>And the answer is yes.

00:57:01.025 --> 00:57:03.025
<v Speaker 0>So we can do a TCTL

00:57:03.025 --> 00:57:03.905
<v Speaker 0>auth

00:57:05.350 --> 00:57:06.150
<v Speaker 0>And

00:57:06.230 --> 00:57:09.110
<v Speaker 0>that was my old name from workshop one.

00:57:09.990 --> 00:57:12.230
<v Speaker 0>We're gonna authenticate against

00:57:18.414 --> 00:57:19.454
<v Speaker 0>ECCL

00:57:19.454 --> 00:57:20.255
<v Speaker 0>off

00:57:22.894 --> 00:57:24.415
<v Speaker 0>server. There we go.

00:57:27.775 --> 00:57:28.575
<v Speaker 0>I

00:57:28.575 --> 00:57:29.694
<v Speaker 0>think I got that wrong in the last

00:57:29.694 --> 00:57:30.335
<v Speaker 0>workshop too.

00:57:33.150 --> 00:57:34.910
<v Speaker 0>Oh, no. I'm using the wrong command, aren't

00:57:34.910 --> 00:57:35.070
<v Speaker 0>I?

00:57:49.655 --> 00:57:51.655
<v Speaker 0>Nope. I have no idea what I'm doing.

00:57:55.414 --> 00:57:56.775
<v Speaker 0>T s h

00:57:56.934 --> 00:57:57.255
<v Speaker 0>off.

00:57:59.900 --> 00:58:01.820
<v Speaker 0>Why can I not remember anything?

00:58:03.420 --> 00:58:04.940
<v Speaker 0>Log in. There we go.

00:58:05.340 --> 00:58:06.140
<v Speaker 0>Proxy.

00:58:07.980 --> 00:58:08.380
<v Speaker 0>Okay.

00:58:12.515 --> 00:58:14.275
<v Speaker 0>Dot s h. It's gonna ask me for

00:58:14.275 --> 00:58:16.755
<v Speaker 0>my username and my password. Sweet.

00:58:17.155 --> 00:58:18.595
<v Speaker 0>Grab that from here.

00:58:28.190 --> 00:58:29.870
<v Speaker 0>Rawkode Teleport.

00:58:31.230 --> 00:58:32.030
<v Speaker 0>Copy.

00:58:35.470 --> 00:58:36.510
<v Speaker 0>My OTP.

00:58:44.775 --> 00:58:46.215
<v Speaker 0>Back in oh,

00:58:49.095 --> 00:58:50.455
<v Speaker 0>think I one there. I'm gonna have to

00:58:50.455 --> 00:58:51.495
<v Speaker 0>grab it from this browser.

00:58:58.440 --> 00:58:59.320
<v Speaker 0>There we go.

00:59:02.359 --> 00:59:04.440
<v Speaker 0>And I probably copied the wrong password, that

00:59:04.440 --> 00:59:06.920
<v Speaker 0>thing, because I have issued the wrong one.

00:59:06.920 --> 00:59:07.160
<v Speaker 0>So

00:59:08.305 --> 00:59:09.185
<v Speaker 0>password.

00:59:11.745 --> 00:59:12.465
<v Speaker 0>OTP.

00:59:29.680 --> 00:59:30.799
<v Speaker 0>Haven't seen that before.

00:59:36.815 --> 00:59:38.015
<v Speaker 0>I am

00:59:40.095 --> 00:59:41.935
<v Speaker 0>I could delete all of that.

00:59:46.495 --> 00:59:47.775
<v Speaker 0>I'll try that one more time.

00:59:59.970 --> 01:00:01.170
<v Speaker 0>Do I need the whole thing?

01:00:01.865 --> 01:00:03.704
<v Speaker 0>I don't think you do. I think it

01:00:03.704 --> 01:00:05.385
<v Speaker 0>just wants the domain name.

01:00:05.545 --> 01:00:06.185
<v Speaker 0>Yeah.

01:00:06.984 --> 01:00:08.265
<v Speaker 0>Because I already add that.

01:00:18.250 --> 01:00:19.290
<v Speaker 0>Let's try again.

01:00:19.529 --> 01:00:20.810
<v Speaker 0>It won't let me down.

01:00:21.769 --> 01:00:22.650
<v Speaker 0>Password.

01:00:25.690 --> 01:00:25.930
<v Speaker 0>OTP.

01:00:44.339 --> 01:00:47.060
<v Speaker 0>Just in case we're going to add

01:00:48.900 --> 01:00:49.780
<v Speaker 0>and secure.

01:00:55.715 --> 01:00:58.595
<v Speaker 0>Because I I'm I'm not sure.

01:01:05.795 --> 01:01:07.395
<v Speaker 0>The joy of doing things live.

01:01:13.590 --> 01:01:14.550
<v Speaker 0>Address.

01:01:21.030 --> 01:01:21.510
<v Speaker 0>Okay.

01:01:23.685 --> 01:01:25.765
<v Speaker 0>We are running Teleport eight.

01:01:26.325 --> 01:01:27.605
<v Speaker 0>I wonder

01:01:30.085 --> 01:01:31.765
<v Speaker 0>if because my client is older.

01:01:39.940 --> 01:01:42.260
<v Speaker 0>Yeah. There's eight zero zero there. We'll try

01:01:42.260 --> 01:01:43.700
<v Speaker 0>this. If this doesn't work,

01:01:45.220 --> 01:01:46.020
<v Speaker 0>I'll

01:01:47.619 --> 01:01:49.539
<v Speaker 0>pretend to go through the process of what

01:01:49.539 --> 01:01:51.825
<v Speaker 0>should work. Again, we shouldn't need unsecure because

01:01:51.825 --> 01:01:54.065
<v Speaker 0>we're we're raising less encryption certificates here. Our

01:01:54.065 --> 01:01:55.985
<v Speaker 0>proxy is t dot Rawkode dot s h.

01:01:57.265 --> 01:01:58.865
<v Speaker 0>Let's grab this password again.

01:02:01.345 --> 01:02:01.665
<v Speaker 0>Copy.

01:02:05.400 --> 01:02:07.000
<v Speaker 0>Second to FE.

01:02:08.520 --> 01:02:09.400
<v Speaker 0>Paste.

01:02:13.240 --> 01:02:15.000
<v Speaker 0>Alright. We are now authenticated

01:02:15.000 --> 01:02:16.200
<v Speaker 0>with our

01:02:17.160 --> 01:02:18.279
<v Speaker 0>our Teleport cluster.

01:02:19.205 --> 01:02:21.845
<v Speaker 0>Now we can run ectl

01:02:21.845 --> 01:02:23.125
<v Speaker 0>apps ls,

01:02:24.725 --> 01:02:26.885
<v Speaker 0>and we can see each of our applications.

01:02:27.045 --> 01:02:28.565
<v Speaker 0>We take a look at that app sub

01:02:28.565 --> 01:02:29.285
<v Speaker 0>command.

01:02:31.045 --> 01:02:32.325
<v Speaker 0>No, that's not very one.

01:02:35.520 --> 01:02:37.440
<v Speaker 0>Maybe it's TSH app.

01:02:39.760 --> 01:02:41.920
<v Speaker 0>Yep. There we go. I never remember when

01:02:41.920 --> 01:02:43.920
<v Speaker 0>you're supposed to use TSH and T control.

01:02:44.960 --> 01:02:46.480
<v Speaker 0>But we can do an apps login.

01:02:48.125 --> 01:02:50.765
<v Speaker 0>We will log in to our let's look

01:02:50.765 --> 01:02:52.685
<v Speaker 0>at what does the thing tell me to

01:02:52.685 --> 01:02:53.245
<v Speaker 0>do?

01:02:54.204 --> 01:02:56.845
<v Speaker 0>Our seeker application first. Okay. So that's called

01:02:56.845 --> 01:02:57.405
<v Speaker 0>admin.

01:03:00.260 --> 01:03:02.340
<v Speaker 0>And you will see that what

01:03:02.500 --> 01:03:05.619
<v Speaker 0>TSH is now doing is pulling down this

01:03:05.619 --> 01:03:06.420
<v Speaker 0>certificate

01:03:06.420 --> 01:03:09.220
<v Speaker 0>information that we need to do the

01:03:09.700 --> 01:03:11.780
<v Speaker 0>the TLS handshake with the application, with the

01:03:11.780 --> 01:03:13.460
<v Speaker 0>Teleport Proxy Service to be able to browse

01:03:13.460 --> 01:03:14.180
<v Speaker 0>to that application.

01:03:15.015 --> 01:03:16.535
<v Speaker 0>And now if we copy and paste the

01:03:16.535 --> 01:03:17.255
<v Speaker 0>curl,

01:03:18.295 --> 01:03:19.415
<v Speaker 0>we should

01:03:19.575 --> 01:03:21.734
<v Speaker 0>be able to hit admin.

01:03:21.734 --> 01:03:22.535
<v Speaker 0>HTML,

01:03:22.694 --> 01:03:24.295
<v Speaker 0>and we get the admin page back.

01:03:24.694 --> 01:03:25.895
<v Speaker 0>The last thing we want to do is

01:03:25.895 --> 01:03:27.255
<v Speaker 0>just take a look at our dumper.

01:03:29.560 --> 01:03:31.880
<v Speaker 0>So that can just be our TSH apps

01:03:31.880 --> 01:03:33.000
<v Speaker 0>login again,

01:03:35.480 --> 01:03:36.280
<v Speaker 0>dumper,

01:03:36.839 --> 01:03:38.359
<v Speaker 0>and we're just gonna get the same information

01:03:38.359 --> 01:03:40.520
<v Speaker 0>back. Now you can imagine if this was

01:03:40.520 --> 01:03:42.520
<v Speaker 0>an API that you're working on a Kubernetes

01:03:42.520 --> 01:03:44.760
<v Speaker 0>cluster, you wanna be able to write tests

01:03:44.415 --> 01:03:45.855
<v Speaker 0>or something like that. This is a really

01:03:45.855 --> 01:03:47.295
<v Speaker 0>good way to get that configured.

01:03:48.095 --> 01:03:49.535
<v Speaker 0>And we can see all the same information

01:03:49.535 --> 01:03:50.495
<v Speaker 0>that we need to.

01:03:50.975 --> 01:03:53.135
<v Speaker 0>And we can also do an apps logo

01:03:53.135 --> 01:03:55.535
<v Speaker 0>dumper. It's just gonna remove our

01:03:56.015 --> 01:03:58.240
<v Speaker 0>certificates, our keys, and etcetera, and clean up

01:03:58.240 --> 01:03:59.840
<v Speaker 0>things up so we don't we no longer

01:03:59.840 --> 01:04:00.560
<v Speaker 0>have access

01:04:00.960 --> 01:04:01.760
<v Speaker 0>to it.

01:04:03.280 --> 01:04:05.120
<v Speaker 0>So Russell is asking,

01:04:08.080 --> 01:04:09.840
<v Speaker 0>is there a CLI command to check the

01:04:09.840 --> 01:04:11.520
<v Speaker 0>version of the client server? Like, you can

01:04:11.520 --> 01:04:13.224
<v Speaker 0>definitely do it to get the version and

01:04:13.224 --> 01:04:15.545
<v Speaker 0>check the client version. I wouldn't think there

01:04:15.545 --> 01:04:17.065
<v Speaker 0>is any way to get the server version

01:04:17.065 --> 01:04:19.145
<v Speaker 0>other than a TCL status,

01:04:20.585 --> 01:04:22.505
<v Speaker 0>which is gonna give you the version here.

01:04:23.785 --> 01:04:25.785
<v Speaker 0>But that would be great if I could

01:04:25.785 --> 01:04:27.839
<v Speaker 0>just run like a, I guess because you

01:04:27.839 --> 01:04:30.160
<v Speaker 0>can be authentic to against multiple clusters.

01:04:30.400 --> 01:04:31.040
<v Speaker 0>Yeah.

01:04:32.079 --> 01:04:34.000
<v Speaker 0>Definitely feedback for the Teleport team. It would

01:04:34.000 --> 01:04:35.519
<v Speaker 0>be nice to get a warning to see

01:04:35.519 --> 01:04:37.359
<v Speaker 0>in the client and server different versions before

01:04:37.359 --> 01:04:38.000
<v Speaker 0>getting really,

01:04:39.924 --> 01:04:41.845
<v Speaker 0>really bizarre messages that don't make a lot

01:04:41.845 --> 01:04:44.325
<v Speaker 0>of sense. Like, hey, failed to authenticate with

01:04:44.325 --> 01:04:46.565
<v Speaker 0>a handshake and a fail. Like, that doesn't

01:04:46.565 --> 01:04:47.845
<v Speaker 0>tell me anything.

01:04:47.845 --> 01:04:49.765
<v Speaker 0>It was just sheer chance that I remember

01:04:49.765 --> 01:04:51.365
<v Speaker 0>the versions were different. So,

01:04:51.924 --> 01:04:53.365
<v Speaker 0>yeah, room for improvement there.

01:04:54.069 --> 01:04:57.030
<v Speaker 0>But that's it. Thank you. Well, let me

01:04:57.030 --> 01:04:58.150
<v Speaker 0>pop back over.

01:04:58.789 --> 01:05:00.630
<v Speaker 0>I know. I had a repo.

01:05:01.349 --> 01:05:02.230
<v Speaker 0>But, yeah.

01:05:02.630 --> 01:05:04.390
<v Speaker 0>Hopefully you enjoy

01:05:04.710 --> 01:05:06.950
<v Speaker 0>this workshop and we've got another one coming

01:05:06.950 --> 01:05:07.990
<v Speaker 0>on Kubernetes.

01:05:08.069 --> 01:05:09.030
<v Speaker 0>Stay tuned for that.

01:05:09.785 --> 01:05:10.985
<v Speaker 0>Check it out. Run through it in your

01:05:10.985 --> 01:05:13.625
<v Speaker 0>own pace. I will get the typos and

01:05:13.625 --> 01:05:15.625
<v Speaker 0>random things that were messy today, especially the

01:05:15.625 --> 01:05:16.665
<v Speaker 0>IPv6

01:05:16.745 --> 01:05:19.305
<v Speaker 0>on the deny block for NGINX fixed.

01:05:19.465 --> 01:05:20.825
<v Speaker 0>No one else has to run into that.

01:05:21.480 --> 01:05:23.480
<v Speaker 0>I hope you found that enjoyable. Teleport is

01:05:23.480 --> 01:05:24.760
<v Speaker 0>a wonderful application.

01:05:24.840 --> 01:05:28.040
<v Speaker 0>App access has so many different potentials that

01:05:28.040 --> 01:05:30.359
<v Speaker 0>make it just wonderful for exposing things like

01:05:30.359 --> 01:05:31.240
<v Speaker 0>Grafana,

01:05:31.400 --> 01:05:34.440
<v Speaker 0>backend portals, admin portals, etcetera, from your infrastructure

01:05:34.440 --> 01:05:35.560
<v Speaker 0>in a secure fashion.

01:05:36.345 --> 01:05:38.025
<v Speaker 0>So thanks for joining me today. I hope

01:05:38.025 --> 01:05:39.065
<v Speaker 0>you have a good one, and I will

01:05:39.065 --> 01:05:40.905
<v Speaker 0>see you all soon. Thanks a lot. Bye.

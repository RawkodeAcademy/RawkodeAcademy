---
import AppLayout from "../../components/AppLayout.astro";
import { getCollection } from "astro:content";

const adrs = await getCollection("adrs");

const sortedAdrs = adrs.sort((a, b) => {
	return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});

const statusColors = {
	proposed: "status-proposed",
	accepted: "status-accepted",
	completed: "status-completed",
	deprecated: "status-deprecated",
	superseded: "status-superseded",
};

const statusIcons = {
	proposed: "?",
	accepted: "✓",
	completed: "✓",
	deprecated: "✗",
	superseded: "→",
};

const formatDate = (date: Date) => {
	return new Date(date).toLocaleDateString("en-US", {
		year: "numeric",
		month: "long",
		day: "numeric",
	});
};
---

<AppLayout title="ADRs - ForgePoint">
	<style>
		.adrs-list {
			max-width: 1000px;
			margin: 0 auto;
		}

		.page-header {
			margin-bottom: 32px;
		}

		.page-title {
			font-size: 24px;
			font-weight: 600;
			color: #fff;
			margin-bottom: 8px;
		}

		.page-subtitle {
			font-size: 14px;
			color: #8b8b8d;
		}

		.adr-item {
			display: block;
			background-color: #0e0e10;
			border: 1px solid #1f1f23;
			border-radius: 8px;
			padding: 24px;
			margin-bottom: 16px;
			text-decoration: none;
			transition: all 0.1s ease;
		}

		.adr-item:hover {
			background-color: #1a1a1d;
			border-color: #2a2a2d;
			transform: translateY(-2px);
		}

		.adr-header {
			display: flex;
			align-items: flex-start;
			justify-content: space-between;
			margin-bottom: 16px;
		}

		.adr-title {
			font-size: 18px;
			font-weight: 600;
			color: #e1e1e3;
			margin-right: 16px;
		}

		.adr-meta {
			display: flex;
			align-items: center;
			gap: 12px;
			flex-shrink: 0;
		}

		.status-badge {
			display: flex;
			align-items: center;
			gap: 4px;
			padding: 2px 10px;
			border-radius: 12px;
			font-size: 11px;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 0.05em;
		}

		.status-icon {
			font-size: 12px;
		}

		.status-proposed {
			background-color: rgba(59, 130, 246, 0.2);
			color: #3b82f6;
		}

		.status-accepted {
			background-color: rgba(34, 197, 94, 0.2);
			color: #22c55e;
		}

		.status-completed {
			background-color: rgba(168, 85, 247, 0.2);
			color: #a855f7;
		}

		.status-deprecated {
			background-color: rgba(107, 114, 128, 0.2);
			color: #6b7280;
		}

		.status-superseded {
			background-color: rgba(251, 146, 60, 0.2);
			color: #fb923c;
		}

		.adr-date {
			font-size: 12px;
			color: #6b6b6d;
		}

		.adr-sections {
			display: flex;
			flex-direction: column;
			gap: 12px;
			margin-bottom: 16px;
		}

		.section-box {
			background-color: #1a1a1d;
			border: 1px solid #2a2a2d;
			border-radius: 6px;
			padding: 12px;
		}

		.section-label {
			font-size: 11px;
			font-weight: 600;
			color: #5e6ad2;
			text-transform: uppercase;
			letter-spacing: 0.05em;
			margin-bottom: 6px;
		}

		.section-text {
			font-size: 13px;
			color: #e1e1e3;
			line-height: 1.5;
			overflow: hidden;
			text-overflow: ellipsis;
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
		}

		.superseded-notice {
			display: inline-flex;
			align-items: center;
			gap: 6px;
			font-size: 12px;
			color: #fb923c;
			background-color: rgba(251, 146, 60, 0.1);
			padding: 6px 12px;
			border-radius: 6px;
			border: 1px solid rgba(251, 146, 60, 0.2);
		}

		.empty-state {
			text-align: center;
			padding: 48px;
			color: #6b6b6d;
		}

		.empty-state-icon {
			width: 48px;
			height: 48px;
			margin: 0 auto 16px;
			opacity: 0.5;
		}

		.empty-state-text {
			font-size: 14px;
			margin-bottom: 8px;
		}
	</style>

	<div class="adrs-list">
		<div class="page-header">
			<h1 class="page-title">Architecture Decision Records</h1>
			<p class="page-subtitle">Important architectural decisions and their rationale</p>
		</div>
		
		{sortedAdrs.map((adr) => (
			<a href={`/adrs/${adr.slug}`} class="adr-item">
				<div class="adr-header">
					<h2 class="adr-title">{adr.data.title}</h2>
					<div class="adr-meta">
						<span class={`status-badge ${statusColors[adr.data.status]}`}>
							<span class="status-icon">{statusIcons[adr.data.status]}</span>
							{adr.data.status}
						</span>
						<span class="adr-date">
							{formatDate(adr.data.date)}
						</span>
					</div>
				</div>
				
				<div class="adr-sections">
					<div class="section-box">
						<div class="section-label">Context</div>
						<p class="section-text">{adr.data.context}</p>
					</div>
					
					<div class="section-box">
						<div class="section-label">Decision</div>
						<p class="section-text">{adr.data.decision}</p>
					</div>
				</div>
				
				{adr.data.supersededBy && (
					<div class="superseded-notice">
						<span>→</span>
						<span>Superseded by: {adr.data.supersededBy}</span>
					</div>
				)}
			</a>
		))}
		
		{adrs.length === 0 && (
			<div class="empty-state">
				<svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
				</svg>
				<p class="empty-state-text">No ADRs yet</p>
			</div>
		)}
	</div>
</AppLayout>
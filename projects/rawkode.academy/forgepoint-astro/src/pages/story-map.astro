---
import AppLayout from "../components/AppLayout.astro";
import InteractiveStoryMap from "../components/InteractiveStoryMap.tsx";
import { getCollection } from "astro:content";

const personas = await getCollection("personas");
const activities = await getCollection("activities");
const stories = await getCollection("stories");
const actions = await getCollection("actions");
const features = await getCollection("features");

// Debug logging
console.log("Collections loaded:", {
	personas: personas.length,
	activities: activities.length,
	stories: stories.length,
	actions: actions.length,
	features: features.length,
});

// Add id field if missing
const activitiesWithId = activities.map((a) => ({ ...a, id: a.slug }));
const personasWithId = personas.map((p) => ({ ...p, id: p.slug }));
const storiesWithId = stories.map((s) => ({ ...s, id: s.slug }));
const actionsWithId = actions.map((a) => ({ ...a, id: a.slug }));
const featuresWithId = features.map((f) => ({ ...f, id: f.slug }));
---

<AppLayout title="Story Map - ForgePoint">
  <div style="height: calc(100vh - 48px); width: 100%; overflow: hidden;">
    <InteractiveStoryMap 
      personas={personasWithId}
      activities={activitiesWithId} 
      stories={storiesWithId}
      actions={actionsWithId}
      features={featuresWithId}
      client:load
    />
  </div>
</AppLayout>
---
import { getCollection } from "astro:content";
import Layout from "../../layouts/BaseLayout.astro";

const activities = await getCollection("activities");
const stories = await getCollection("stories");

const activityStories = activities
	.map((activity) => ({
		...activity,
		storyCount: stories.filter((s) => s.data.activityId === activity.slug)
			.length,
	}))
	.sort((a, b) => a.data.order - b.data.order);
---

<Layout title="Activities">
	<main class="container mx-auto px-4 py-8">
		<h1 class="text-4xl font-bold mb-8">Activities</h1>
		
		<div class="space-y-6">
			{activityStories.map((activity) => (
				<article class="border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow">
					<div class="flex items-start justify-between mb-4">
						<div class="flex items-center gap-4">
							<span class="text-3xl font-bold text-gray-300">{activity.data.order}</span>
							<h2 class="text-2xl font-semibold">
								<a href={`/activities/${activity.slug}`} class="hover:text-blue-600 transition-colors">
									{activity.data.title}
								</a>
							</h2>
						</div>
						<span class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded">
							{activity.storyCount} {activity.storyCount === 1 ? 'story' : 'stories'}
						</span>
					</div>
					
					<p class="text-gray-600 mb-4 ml-12">{activity.data.description}</p>
					
					<div class="bg-gray-50 p-4 rounded mb-4 ml-12">
						<h3 class="text-sm font-semibold text-gray-700 mb-2">Expected Outcome</h3>
						<p class="text-sm text-gray-600">{activity.data.outcome}</p>
					</div>
					
					{activity.data.personas && activity.data.personas.length > 0 && (
						<div class="ml-12">
							<span class="text-sm font-medium text-gray-700">Personas: </span>
							<span class="text-sm text-gray-600">
								{activity.data.personas.join(', ')}
							</span>
						</div>
					)}
					
					{activity.data.metrics && activity.data.metrics.length > 0 && (
						<div class="ml-12 mt-2">
							<span class="text-sm font-medium text-gray-700">Metrics: </span>
							<span class="text-sm text-gray-600">
								{activity.data.metrics.map(m => `${m.name} (${m.target})`).join(', ')}
							</span>
						</div>
					)}
				</article>
			))}
		</div>
		
		{activities.length === 0 && (
			<p class="text-gray-500 text-center py-8">No activities have been created yet.</p>
		)}
	</main>
</Layout>